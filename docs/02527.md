# ABO 和源代码编译的神秘艺术

> 原文:[https://devo PS . com/ABO-and-the-mystic-art-of-source-code-compilation/](https://devops.com/abo-and-the-mystical-art-of-source-code-compilation/)

编译可以提高或降低应用程序的性能质量。开发人员可能会花费数周时间来创建人类已知的最优雅、最高效的算法，但在生产中却只能以蜗牛般的速度运行，因为用于创建应用程序可执行二进制文件的编译器已经过时，并且没有进行优化以利用现代硬件提供的增强性能特性。

![](../Images/489d2d54e10ab28d5bf9c13f7af6bb59.png)

说到最大限度地利用代码，了解内情的公司不久前发现编译器很重要。然而，在很大程度上，它们仍然是一套复杂的——如果不是有些神秘的话——技术。我承认，在很长一段时间里，我对编译和编译器的理解仅限于运行 make 或 build 命令。可悲的是，我对幕后发生的事情一无所知。

但那是过去，这是现在。最近，我对 IBM 的自动二进制优化器(ABO)技术产生了兴趣。ABO 是一种优化现有 COBOL 代码的技术，可以在大型机环境中更好地运行，而不必改变源代码或修改现有的编译。

阴谋相遇有两个原因。首先，它激发了我对大型机编译的好奇心。第二，这让我想知道，如何可能改进已经编译好并在生产环境中运行的代码。

所以，我决定超越我的舒适区，找到围绕这个神秘过程的一些基本问题的答案。大型机编译器到底是如何工作的？好的编译器和差的编译器有什么区别？最后，一个低级的优化技术，比如 ABO，是如何完成它的工作的，假设它被应用到已经编译好的代码上？

以下是我研究的结果。

## **了解前端和后端编译**

编译是将基于文本的源代码转换成可在特定硬件上执行的二进制文件的过程。大型机计算编译分为前端编译和后端编译两部分。前端编译与客户端或 GUI 完全无关。相反，前端编译的目的惊人地类似于[林挺](https://en.wikipedia.org/wiki/Lint_%28software%29)的目的，就像应用于[解释语言](https://en.wikipedia.org/wiki/Interpreted_language)一样。前端编译是确保基于文本的源代码在语法、语义、类型用法和函数声明方面[正确的过程。](http://www.sciencehq.com/computing-technology/programming-language-grammar.html)

一旦源代码经过前端编译，它就被传递到后端编译器进行进一步处理。

后端编译是前端创建的工件(称为中间表示)被转换成特定于目标硬件的特定操作系统和 CPU 的二进制格式的地方。这个二进制文件是在目标系统上运行的文件。(参见图 1)。

![](../Images/388e1bbdf37bbc7ede742dc8528d1464.png)

Figure 1: Compiling COBOL source code transforms it into an opaque binary.

就特定于机器的性能而言，后端编译是橡胶遇到道路的地方。一个设计良好的后端编译器将创建二进制代码，这些代码经过优化以充分利用目标系统的 CPU 架构，尽可能地减少性能优势。一个好的编译器会创建一个加载和运行都很快的二进制文件。然而，如果底层源代码效率低下——例如，代码对数据库进行不必要的访问，从而造成网络延迟的间歇性增加——那么再多的后端编译也无法改善这种运行时效率低下的问题。然而，如果源代码写得很好，一个好的后端编译器将显著提高应用程序的整体性能。一般的编译器弊大于利；由此可见，编译技术在软件开发生命周期中的重要性。

然而，尽管它提供了很多好处，但是任何一段编译后的代码都存在一个潜在的问题。一旦源代码被编译成可执行的二进制文件，维护就变得很困难——尤其是当源代码不再可用的时候。

## **编译带来挑战**

与 Python 或 JavaScript 等解释语言不同，编译后的代码以二进制格式存在，对人类的检查是不透明的。这是机器可读的。一旦代码被编译，它就被“锁定”并且不透明。

这带来了两个挑战。首先，因为二进制文件是锁定的，所以它只使用编译时目标系统上可用的指令集。因此，即使支持更健壮指令集的硬件不断发展，为旧系统编译的旧代码也不能利用现代硬件的特性。编译后的代码所能做的就是执行旧系统上可用的指令集。结果是新的硬件，但旧的性能。编译后的代码就是不知道如何运行得更快。

第二个挑战是，虽然稍后通过重写创建编译代码的源代码来改变编程行为很容易，但是没有直接改变编译代码的简单方法。因此，如果维护开发人员需要升级没有源代码的应用程序，他们就会陷入困境。

在大型机计算的世界里，这是一个大问题。不要忘记，80%的企业数据仍然驻留在大型机中。有很多代码需要升级。

不止一家公司遇到过不得不更新几十年前的代码的情况，但是源代码和创建代码的人都找不到了。结果是，公司剩下的资产没有实现其全部价值。虽然技术取得了重大进步，但代码仍然是静态的。

有一些工具可以用来将二进制文件反编译回原始源代码，可以根据原始源代码进行修改，但是这个过程非常耗时并且容易出错。即使反编译器得到了正确的结果，并成功地复制了准确反映原始版本的源代码，您仍然需要找到一个能够进行所需更改的开发人员。这类开发人员在大型机领域需求量很大。许多公司只是喜欢不去管它，将他们的大型机开发人员分配到投资回报最高的项目上。

很明显，有一种方法可以将旧的、遗留的二进制文件转换为优化的二进制文件，以便在现代大型机上运行，而不必经历复杂的反编译和重新编译过程，这将有利于任何需要以更快、更具成本效益的方式将更好的代码推向市场的公司。幸运的是，IBM 通过其 ABO 技术提供了一种方法。

## **ABO:解决** **编译** **挑战** 

如上所述，ABO 的设计目的是使旧代码现代化，而不必经历艰苦的编译/重新编译过程。它的工作方式很有趣。

ABO 直接在编译后的二进制代码上工作，以重新创建中间表示中所表示的程序结构。程序结构然后被传递给优化器，优化器重新编译一个新的二进制文件。这个新的二进制文件利用了新硬件提供的附加指令集。而且，它这样做的方式不会以任何方式改变原始的编程逻辑。(参见图 2)。

![](../Images/8500b90b580d9d6d1ca5aa1e935de65d.png)

Figure 2: ABO performs optimization on program structures extracted from the legacy binary without affecting program logic.

例如，ABO 通过在机器语言中创建更优雅、执行更快的指令，优化了 COBOL 中的标准数学运算，如减、乘、除和取幂。毫无疑问，考虑到 COBOL 主要用于面向业务的数字处理和关联(能够更快地进行数学运算真的很重要，没有双关的意思)，改进数学运算是非常重要的，但是重要的是要理解 ABO 优化的基本价值是它利用了新目标系统提供的高级指令集。请记住，在新系统上运行旧的编译代码不会对性能产生太大的影响。在 PC 世界里，这和在 64 位机器上运行 32 位代码是一样的。当然，在大多数情况下它会工作，但代码永远不会超过 32 位处理器支持的低级指令的效率。

是的，由于 CPU 时钟速度的提高，不需要重新编译就可以提高性能。然而，新型大型机的时钟速度开始趋于平稳。随着时钟速度趋于平稳，代码在处理器上执行所需的时间也将趋于平稳。大型机设计人员没有忘记这一事实。除了简单地在处理器中更快地移动比特之外，提高整体性能的新方法正在被设计出来。可悲的是，游戏中没有魔法；对于不仅仅依赖于时钟速度的传统代码来说，要实现更好的性能，需要对代码进行编译。

使用源代码从头重新编译是可行的，但是这样做的成本很高。而且，如果重新编译影响了源代码的任何部分，就需要进行额外的测试。因此，由于实际开发的费用和额外的测试，变更的成本增加了。

另一方面，ABO 可以处理现有的二进制文件。结果是一个升级的二进制文件，它针对最新的大型机技术进行了优化。除了拥有快速高效的一流代码之外，公司还可以在重构过程中节省时间和金钱。想想就觉得挺神奇的。

这样提高的效率看起来像什么？IBM 报告说 CPU 消耗时间减少了 24 倍。这是一个相当大的数字。

现在，假设我们谈论的是优化现有功能。毫无疑问，重构现有应用程序以添加新功能需要重写代码。然而，今天有许多应用程序正在做着需要做的事情。问题是他们表现不佳，降低了整个工作流程的速度。优化现有的二进制文件不仅意味着应用程序可以获得更好的性能，还意味着整个工作流变得更加高效，因为有更多的空间供其他应用程序运行。

## **将所有这些放在一起**

从计算诞生的第一天起，让遗留代码变得更好就一直是公司的负担。当源代码和编写代码的开发人员可以完成这项工作时，更新代码就已经够困难了。当两者都不存在，剩下的只是一个可执行的二进制文件时，重构应用程序就变成了一系列艰巨的任务。反编译器只能帮你到这一步。

幸运的是，像 ABO 这样的优化技术让事情变得更简单。ABO 使遗留的二进制文件现代化，而不需要手头有源代码。结果是提高了系统性能，降低了成本，加快了发布周期。

正如我们这些经历过的人所了解的那样，计算机技术的变化速度永远不会减慢。它只会跑得更快。能够适应技术创新极快速度的公司将会繁荣发展。这包括依靠大型机技术完成工作的公司。减少优化遗留代码所需的时间对于在当今市场中保持竞争力至关重要。对于那些依靠大型机技术完成工作的公司来说，ABO 直接针对现有二进制文件优化代码的能力提供了一个难以忽视的转型优势。

鲍勃·雷瑟曼