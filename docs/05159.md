# DevOps 聊天:Spinnaker 可扩展性，带军械库

> 原文:[https://devo PS . com/devo PS-chat-spinnaker-extensibility-with-armory/](https://devops.com/devops-chat-spinnaker-extensibility-with-armory/)

Spinnaker Summit 2019 预览版:大多数开源软件都不是一刀切的，Spinnaker 也不例外。虽然它捕获了软件交付的最一般的用例，但是大多数组织发现它缺少一些他们需要自动化他们的整个交付管道的特性，例如与内部工具或者遵从系统的集成。

Spinnaker 提供了开箱即用的(象征性的)Run Job 和 Webhook 阶段，团队可以使用它们来构建定制集成，以帮助填补任何空白，并支持广泛的用户采用。

[Armory](https://www.armory.io/) 的软件工程师 Ethan Rogers 加入我们的 DevOps Chat，分享他在 2019 年 Spinnaker 峰会上关于 Spinnaker 可扩展性的演讲的预览。Ethan 分享了如何使用 Run Job 和 Webhook 阶段来构建自定义阶段，从而在没有代码和简单配置的情况下捕获任意数量的用例。他还介绍了需要编写代码的情况。

Ethan 的演讲“让 Spinnaker 成为你自己的”，将于 11 月 16 日周六下午 3:45 在圣地亚哥举行的 2019 年 Spinnaker 峰会上举行。另外，伊森出现在 11 月 15 日星期五下午 2:30 的“库伯内特 V2 供应商的状态”专题讨论中。

像往常一样，下面是流媒体音频，然后是我们的谈话记录。

[https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/701304442&color=%23ff5500&auto_play=false&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true](https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/701304442&color=%23ff5500&auto_play=false&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true)

## 副本

米奇·阿什利:大家好。我是 DevOps.com 的米奇·阿什利，您正在收听的是另一个 DevOps 聊天播客。今天，我和伊森·罗杰斯在一起。Ethan 是一名软件工程师，也是军械库的发言人。他将在即将到来的圣地亚哥 2019 年 Spinnaker 峰会上发表讲话。现在，Ethan 将谈论如何让 Spinnaker 成为您自己的产品，这是他的演讲，然后他还将参加一个关于 Kubernetes V2 提供商状况的小组讨论，以及使用 Spinnaker 部署 Kubernetes 的改进推广策略。

那么，我们开始吧。伊森，欢迎来到 DevOps 聊天。

伊森·罗杰斯:非常感谢你邀请我。我真的很兴奋能在这里谈论 Spinnaker。

阿什利:哇。绝对的。很棒的话题。我知道你对此很有热情，很高兴有你在。你能自我介绍一下吗？告诉我们一些关于你的事，你做什么工作，以及一些关于军械库，你工作的公司？

**罗杰斯:**是的。就像米奇说的，我叫伊森·罗杰斯，是军械库的软件工程师。我实际上已经在 Spinnaker 项目上工作了大约三年。我已经在 Armory 工作了一年半，在那之前的一年半，我在我之前的公司工作，你知道，我是交付和开发经验团队的一员。而且，你知道，我们在这个新项目中使用 Kubernetes，我们正在努力寻找一种部署方式，并且很早就参与了 Spinnaker。所以，从那时起，我就成了这个社区的一部分，到目前为止，这是一次非常棒的经历。

是的，所以，这就是我找到军械库的原因。在我上一份工作接近尾声时，我遇到了创始人 DROdio、Ben 和 Isaac，他们刚刚——嗯，大概在六到九个月内开始了 Armory。我们很合得来。我与创始人的关系非常好，这是一个继续全职从事 Spinnaker 工作的机会，这是我感兴趣的事情。

军械库，简单介绍一下我们——我们将把 Spinnaker 带到企业号上。因此，我们正在做的是采用开源的 Spinnaker，你知道，除了提供支持和培训之外，我们还在开源的 Spinnaker 上提供了各种层，各种不同的扩展和功能，使其更符合企业今天的需求。

阿什利:嗯。非常好。这就解释了，我知道有你自己，但也有其他人在大会上发言。

现在，您的主题是，您很好地介绍了您是如何开始使用 Spinnaker 的——您是多久以前开始使用它的？

**Rogers:** 是的，大约三年前，就在第一个版本的 Kubernetes 提供商登陆之前。我想，当时，我并没有意识到我们有多早。这就解释了我第一次参与时不得不提交的许多 PRs。

阿什莉:我赌，我赌。你写任何代码，提交任何代码，或者你主要是在 Spinnaker 的使用端？

罗杰斯:是的，所以，我实际上是一名培训开发人员。我获得了计算机科学的学位，并在职业生涯的早期就开始从事运营方面的工作。所以，我两方面都很流利。我确实写了很多代码。这些天少了很多，只是因为我在的角色。在军械库，我做了很多更高层次的东西，比如 BitTorrent，但我仍然试图每周提交一些 PRs。我在 Kubernetes 提供商本身领导了几个项目，所以我做了一点点事情。

阿什利:好吧，我不会问你哪个是阴暗面，ops 还是 developing——不，我只是在开玩笑。是 DevOps，现在都在一起了吧？

罗杰斯: *【笑声】*是的。

阿什莉:好的。所以，让我们直接进入你要谈论的话题。当然，我们不会在这里面面俱到，但是我知道你关注的是开源，如果你想用这个术语的话，你通常不会开箱即用。我知道这是免费下载的。

**罗杰斯:**嗯嗯。

Ashley: 但是你必须做一些定制才能让它在你的环境中工作，这里我们说的是 Spinnaker。你和顾客打交道的经验是什么？当他们开始使用 Spinnaker 时，他们的期望是什么？您需要做些什么来帮助他们入门？

罗杰斯:是的。所以，关于 Spinnaker 开源的有趣的事情是，它实际上，就像是 Spinnaker 在网飞的一个非常小的部分。对于那些不了解 Spinnaker 的听众来说，它是一个诞生于网飞的项目。他们建造了它，这是一个名为 Asgard 的项目中部署技术的下一次迭代。

阿什利:嗯。

**罗杰斯:**Spinnaker 的驱动原理之一就是让它可以延伸。主要原因是因为网飞有很多他们喜欢的内部工作流程和事情——让他们的开发体验更好，不一定适用于更广泛的社区。

因此，当你开始开箱即用地使用开源 Spinnaker 时，我认为大多数公司都想要很多东西，对吗？同样的原因，网飞有那些，不适用于社区，但为他们工作的东西，每个其他公司都有类似的东西。

阿什利:嗯。

**Rogers:** 所以，当我在以前的公司工作时，我们有一个关于 Docker 图像的工作流程，我们将标签添加到 Docker 图像中，然后我们希望这些标签显示在部署这些图像的 Kubernetes 清单中。

这是在 Spinnaker 中无法开箱即用的，但我们能够使用一些扩展方法来实际获取这些信息并注入这些内容，这是我围绕 Run Job 所做的演讲的基础。

阿什利:好的，太好了。那么，让我们解释一下，因为我知道你会谈到 Run Job 和 Webhook 阶段。什么是 Run Job，什么是 Webhook？

罗杰斯:当然，是的。所以，从某种程度上来说，Run Job 和 Webhook 是您可以扩展 Spinnaker 的方法，让它做一些您需要它做的事情。

阿什利:嗯。

**Rogers:** 扩展 Spinnaker 有更复杂的方法，包括获取代码和编写 Java 代码，但是我们发现大多数用户或操作人员，我应该说，并不十分熟悉 Java。所以，这是一个相当——充满了摩擦，我会说。

阿什莉:是的，这完全是另一回事，对吗？

罗杰斯:对，没错。是啊。因此，运行作业阶段和 Webhook 阶段提供了一种扩展 Spinnaker 的低摩擦方式。因此，Webhook 阶段是 Spinnaker 中的一个阶段，它允许您调用一些 API。您知道，我通过下拉菜单选择它作为管道中的一个阶段，并在那里进行配置。还有我们称之为预配置的 Webhooks 或自定义 Webhooks，它允许您将它实际配置为 Spinnaker 配置的一部分，然后它会显示为一个本机阶段。

阿什利:嗯。

罗杰斯:所以，在引擎盖下，它仍然在呼唤 API。就好像您已经在线配置了它，但是它显示出来，对于最终用户来说，它实际上看起来像是 Spinnaker 本身的一部分。

阿什莉:非常好。那么，在将集成扩展到其他事物时，最常见的用法是什么呢？是内部第三方工具、内部定制软件人员构建的吗？你知道，有没有这方面的典型使用案例？

罗杰斯:我认为我们通常会看到人们更多地集成内部系统，而不是 GitHub 或其他托管服务，我不知道，GitHub 可能是最简单的例子。新遗迹是我们看到的另一个。

但我认为，在大多数情况下，Spinnaker 集成了现成的公共工具，但显然，如果该工具是您公司的内部工具，您就没有这种集成。所以，这通常是我们看到它的地方。所以，我想我曾经和一家公司谈过，他们有一个内部集成测试套件或负载测试套件，他们想要调用，他们使用 Webhook stage 进行调用并启动这些测试。

阿什利:嗯。很好，很好。现在，我知道你不用写代码就可以做很多事情，对吗？

罗杰斯:是的。是啊。

阿什莉:那么，那意味着什么呢？什么样的配置过程看起来像什么，让我们用你举的例子，某人写了他们自己的某种测试框架，他们想在 Webhook 阶段调用它？

罗杰斯:是的。所以，我想我应该后退一步，澄清一下我的答案。

阿什莉:好的。

罗杰斯:所以，在某种程度上，你需要写代码。问题是您是否真的必须将它写入 Spinnaker 本身。

阿什莉:好的。

Rogers: 其中之一，我想我们可以称之为原生扩展，它本质上是使用 Spinnaker 作为一个库，编写 Java 并做一些 spring magic 来实现它。

阿什利:嗯。

罗杰斯:因此，如果你要使用 Webhook 或 Run Job stage，就此而言，你必须写一点代码。但是这样做的好处是，如果它是一个 Webhook 服务，你试图连接的任何服务都可以用你想要的任何语言编写，对吗？因此，如果它是 Go，如果它是 Python，如果它是 Ruby，如果它是——你知道，无论你想做什么，服务都是按照你期望的契约在 API 中运行的。

阿什利:嗯。

罗杰斯:因此，在 Webhook 阶段，你所要做的就是打电话。你知道，你可能会说写 cURL 命令就是写代码，但是我认为很多人对此都很熟悉，这是一个非常低的开销。

阿什利:嗯。

**Rogers:** 所以，如果你能在你的终端里打电话，你就能用 Webhook 阶段从 Spinnaker 打电话。

运行作业阶段实际上更有趣一些，因为它允许您运行容器，就好像它是您可能正在运行的脚本一样。因此，在 CI 系统中进行定制逻辑的一个非常常见的模式是，我有一个容器，容器中有我所有的依赖项，还有一个我需要运行的脚本。我们只是一次性运行它，你知道，一旦这个脚本完成，如果它失败了，管道也失败了。如果成功，管道继续。然后，就像，世界真的是开放的，在这一点上，世界是你的牡蛎，因为你可以用你最舒适的方式编写脚本，然后你可以在 Spinnaker 中运行它。

我们在运行作业阶段做的更有趣的事情之一是，您可以实际输出—您可以在日志中输出这些特殊的标记，Spinnaker 将获取这些标记并将其注入管道，以便您可以在下游阶段使用它们。所以，也许你的工作是去为你收集一些信息。实际上，你可以在部署阶段或下游运行作业阶段或 Webhook 阶段使用它作为你传递的参数。

Ashley: 它几乎就像日志一样被使用，就像一个异步消息总线，让它变得更复杂，但却是一个超级简单的版本。

罗杰斯:对，对。

阿什利:一些后台版本，你可以查看之前发生的事情，并采取适当的行动。

罗杰斯:是的。是的，这真的是—你知道，我们听说，该功能背后的动机是，我们听到许多用户，比如，你知道，他们希望能够扩展 Spinnaker，但他们不想编写 Java 代码，你知道吗？和容器，特别是对于运行作业阶段，容器在我们今天的行业中显然是非常多产的。我的事业建立在库伯内特斯和集装箱上，所以。

阿什利:嗯。

**Rogers:** 容器有点像是能够做到这一点的完美媒介，因为你可以包含你需要的一切——*【笑声】*你可以在这个容器中包含你需要的一切，然后，因为 Spinnaker 可以在 Kubernetes 中运行容器，这有点像是一种自然的适应，对吗？

阿什利:嗯。

罗杰斯:我们可以利用这样一个事实，即你的代码是什么并不重要，我们需要的接口是一个容器，然后是日志，我们可以获取所有的信息。

Ashley: 我很好奇——这完全是一个枝节问题，但是你在大学里学过关于容器和软件架构之类的东西吗，或者这是你毕业后才真正开始做的事情？

罗杰斯:我希望我在大学里学过这方面的知识。所以，实际上，我在 2013 年大学毕业，开始写 PHP 并做更多的软件开发。但是在我的内心深处，我总是喜欢——我对服务器非常感兴趣。

阿什利:嗯。

**罗杰斯:**所以，写代码对我来说很有趣，但它总是看起来像是拥有所有权力的人，所有我尊敬的人，他们就像是在一个外壳中，部署软件，检查，像是，“这个服务器超载了吗？”这不是 DevOps，但它是我真正感兴趣的东西。

阿什莉:当然，是的。

罗杰斯:我——你知道，我花了大概三年时间做软件开发，但没有做过这方面的工作。但是，当我过渡到 CI/CD 领域后，我就有机会更多地关注运营，同时进行一些开发，你知道，我们在我的上一份工作中收购了 Kubernetes，这就是一切开始的地方。

所以，我认为我们从 Kubernetes 1.4 开始，在那里我学到了我所知道的关于容器和编排平台之类的东西。

阿什利:这让你处于一个非常有利的位置，因为如果你愿意，你可以与双方、两个受众，也就是开发者和运营人员交谈。

罗杰斯:是的。

Ashley: 你知道，我在开发容器和所有这一切之前的经历，所有 DevOps 环境，一些最好的开发人员是真正知道如何编写代码的工程师，但他们知道从操作系统到网络的整个堆栈，对吗？他们知道的已经够多了。也许除了写代码之外，它还有真正好的部分。

**罗杰斯:**嗯嗯。

**Ashley:** 如果你愿意的话，我不知道，在理解整个堆栈及其工作方式方面有很多力量。

罗杰斯:是的。我发现你对栈了解得越多，你就能更好地利用它，并且实际上写出更好的代码。你可以回过头来看看 DevOps 的诞生，看到这一点，但工程师花大部分时间写代码，然后把它扔在墙上，更有可能写性能较差的代码，对不对？不知道的代码——你知道，我们想写真正抽象的代码，但在某种程度上，你必须知道你在什么类型的环境中运行。

因此，如果你运行在一台拥有 128 个内核和数百 GB 内存的机器上，你的算法效率有多低并不重要，因为它会运行得很快。你知道，这一切都取决于规模，但是…我发现，了解云及其运行环境以及实际网络边界和实际限制的工程师正在编写更好的代码，他们正在更频繁地发布，他们正在迭代，就像我说过的，他们正在更快地迭代，所有这些都非常重要。

我认为我发现的另一件事是这是一个成长的过程，对吗？我有点喜欢把它看做——嗯，至少在我的个人经验中，我发现我很难抓住我正在做的下一个层次，直到我完全理解了上一个层次。我认为这对很多人来说都是真的，对吗？在你对编程有了扎实的了解之前，你很难想象理解 ops 会是什么样子，对吗？理解你的程序在服务器上实际上是如何运行的。

阿什莉:是的。我会把它描述成某种背景。它有助于了解你何时了解你正在经营的环境和你正在做的事情，你正在建造的东西将在其中运作。反之亦然，对吗？如果您现在从事运营或安全工作，使用 DevSecOps，了解软件是如何构建的。因此，这是关于围绕云和当代软件架构的资源的可访问性的一件大事。

罗杰斯:是的。

阿什莉:嗯，我们没时间了。我希望我们有更多的时间在这方面投资，但重要的是你的演讲即将开始，所以这是你真正要进入更多细节的地方。伊森，谢谢你上播客。

罗杰斯:当然，伙计。谢谢你邀请我。

阿什莉:绝对是。Ethan Rogers，软件工程师，也是 Armory 的发言人，他将于 11 月 15 日至 19 日在圣地亚哥举行的 2019 年 Spinnaker 峰会上发表讲话。现在，他有一个我们刚刚谈论的主题，“让 Spinnaker 成为您自己的”，这是在 11 月 16 日星期六，3:45。他也是库伯内特公司 V2 供应商的成员。那是星期五，前一天——15 号下午两点半。

所以，谢谢你，我们所有的听众，加入我们这一集。我是米奇·阿什利，来自 DevOps.com，你已经听到了另一个 DevOps 聊天播客。在外面要小心。

— [米切尔·阿什利](https://devops.com/author/mitchellashley/)