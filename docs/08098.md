# 设计经济高效的云环境

> 原文:[https://devo PS . com/designing-cost-efficient-cloud-environments/](https://devops.com/designing-cost-efficient-cloud-environments/)

如今，内部部署数据中心的时代已经一去不复返了，云已经在很大程度上取代了可扩展性、灵活性和成本效益。尽管有这些承诺，云经常达不到这些理想。为什么？

因为管理云很难，尤其是在管理成本方面。从你与 AWS 或任何其他云提供商签约的那一刻起，就没有自动节省。相反，实现[云节省](https://devops.com/?s=cloud+cost)需要大量的容量规划、仔细的分析、一致的监控、准确的预测和无尽的调整——这足以让任何人头晕目眩。

但是回报使努力变得值得。如果您正确管理您的云，与内部环境相比，它可以节省大量成本。然而，在没有首先制定成本战略的情况下迁移到云可能会在您的组织长期扩展时花费数百万美元。

那么，您应该遵循什么准则来确保最大化您潜在的云节省呢？这里有一些常见的该做和不该做的事情，你现在就可以开始实施或者停止做。

## 向云迁移

迁移到云是第一步，也是最复杂的一步。因此，在开始之前，请记住以下几点:

### Do:在迁移之前分析您的环境

让我们面对现实吧—如果您有一个组织混乱且过度调配的内部环境，那么您也会有一个组织混乱且过度调配的云环境。当然，除非你在搬家前清理干净。

从好的方面来看，清理您当前熟悉的环境比迁移到新的不熟悉的云环境后进行清理要容易得多。因此，在进行云迁移之前，分析您当前的环境至关重要。

从停用当前未使用的所有资产开始。例如，您可能有一个为特定项目调配的虚拟机(VM ),并且在该项目完成后没有关闭。结果，您将运行一个不再需要的应用程序。现在识别和移除这些资源将降低您未来的云成本，同时减轻工程师未来的头痛。

### 做:为您的云架构创建蓝图

接下来，您需要重新架构您的应用程序堆栈。别担心，这个任务没有听起来那么可怕。您需要创建一个您现在正在使用的基础架构的列表，并在云中找到其对应的基础架构。比方说，您使用多个专用服务器进行消息排队。如果您要迁移到 AWS，您需要在云迁移之前在 AWS 中识别相似的实例类型。

### 不要:遵循“提升和转移”的方法

这可能很诱人，但是无论你做什么，都要避免“搬来搬去”的方法。当然有一些方法可以优化您当前的环境，因此简单地将您现有的资源迁移到云中会错失重组、重构和优化性能和成本的机会。

例如，您可能正在运行未使用的虚拟机，备份未使用的开发服务器，或者存储可分配给低成本归档存储类别的数据。确保重新调整您的架构以适应云，而不是相反。

## 管理

底线是，有人需要负责管理云成本。根据你的公司规模，它可以是一个团队或个人，但它必须尽快完成。

### Do:确保云支出由特定的个人或团队管理

坚持云预算说起来容易做起来难，但如果你将这项任务委托给一个团队或特定的个人，确保你的公司保持目标将是他们的首要任务。他们将负责处理云预算，确定谁可以和不可以配置资源，并监控使用情况。

如果您未能建立治理，您将面临许多个人在没有任何责任或义务的情况下提供资源的风险，这将导致大量超支和大量混乱。

### 不要:假设治理只适用于大型组织

认为你的公司太小，不适合管理？再想想。

至少应始终有一个人负责监控您的云支出，并确保其符合分配的预算。此人将与财务部门携手制定预算、监控使用情况、创建账单提醒等。

## 云安全

如果你不考虑安全性就迁移到云，那你就犯了一个巨大的错误。据估计，到 2025 年，网络犯罪将给世界带来超过 10.5 万亿美元的损失。更糟糕的是，根据威瑞森最近的研究，[云安全漏洞](https://www.datacenterknowledge.com/security/report-cloud-security-breaches-surpass-prem-ones-first-time)有史以来第一次超过了本地同行。

因此，不用说，当迁移到云时，安全性应该是优先考虑的。这里有一些开始的提示。

### Do:制定分层的、多层次的云安全计划

您的云安全策略应该在发生网络攻击时保护您的数据和 IT 资产，同时符合特定于您所在行业的标准和法规。

一些云安全策略包括:

*   使用架构良好的框架构建您的解决方案
*   使用威胁检测、自动修补或安全审计等解决方案
*   使用传输网关或类似技术将您的内部网络连接到云
*   为传统系统和 web 应用程序创建足够的防火墙规则

### 不要:完全依赖你的云提供商的安全控制

虽然许多云提供商提供了很好的安全解决方案，但是完全依赖他们并不能帮你解决问题。AWS 经常引用[共享责任模型](https://aws.amazon.com/compliance/shared-responsibility-model/)，该模型声明 AWS 涵盖基础架构，但用户必须保护自己的应用程序。

## 计划实例

你运行服务器的时间越长，你的账单就越大。对我们来说不幸的是，在云中创建一个新的虚拟机变得如此容易，以至于许多人在不再使用时忘记关闭它们。这导致云成本比实际需要高出 66%。

因此，如果您希望削减[云成本](https://devops.com/?s=cloud+cost)，在安排实例时请记住以下几点:

### Do:自动调度实例

让我们面对现实吧，很容易忘记在数小时后关闭实例。事实上，这太容易了，即使是我们中最优秀的人也会遇到这种情况。另一方面，自动调度实例避免了人为错误，同时简化了关闭过程。

AWS 的 Amazon Instance Scheduler 或 Azure 的启动/停止功能可以在“非工作时间”轻松关闭非生产环境中的实例，并在需要时重新启动它们。除了这些工具之外，您应该考虑实施警报，以便在计划过程中出现任何问题时，您都可以得到通知。

### Do:利用 AWS 自动缩放

AWS 自动扩展使您能够充分利用云的弹性。该技术持续监控您的应用程序的容量需求，并自动调整资源以适应其当前用途。因此，您不必为您的工作负载部署大型虚拟机。相反，您可以从低规格服务器开始，将其添加到自动扩展组。当需求增加时，更多的节点将被添加到您的机群中以适应规模。同样，当需求减少时，额外的节点将关闭。

这有助于优化性能和成本，因此您不必为未使用的资源付费，并且您始终拥有运行应用程序所需的正确数量的实例。

### 不要:让您的虚拟机持续运行

这似乎是显而易见的，但正如我们前面提到的，许多人在不需要虚拟机时会忘记关闭它们。比如工作日的上午 9 点到下午 5 点可能是你的高峰时段。这意味着您可能不需要某些虚拟机在周六或凌晨 3 点运行，那么为什么要为它们付费呢？相反，在“非工作时间”关闭虚拟机，以确保最大限度地节省成本。

## 标记您的资产

这是不可避免的—标记资产是了解您的使用模式和优化云成本的重要组成部分。资产标签是元数据标签，可以将其归属于您的云设备中的单个资源，以跟踪它属于哪个应用程序。通常，您可以为每个资源分配多达 50 个标签，并且可以根据您的需要对它们进行组织和命名。

标记资产时，请确保记住以下几点:

### Do:在您的云之旅的早期实施标记策略

开始标记资产永远不会太早。事实上，你拖得越久，事情就越难。一旦您的支出和使用增加(这是不可避免的)，您将需要有一个标记系统，以确定哪个团队负责每项资产(这样您就可以让他们评估资源和成本)，停用不需要的资源等等。

标签在许多现实场景中非常有用。例如，如果您没有使用特定的应用程序，您可以搜索带有应用程序名称值的标签“应用程序”。然后，您将看到与该应用程序相关的所有资源，因此您可以轻松地删除它们。

此外，标签可以用来加强预算和防止超支。只需在您的标签上设置一个预算阈值，并在您接近该阈值时设置提醒来通知您。

### 不要:在标记资产之前开始云迁移

如果您在环境不太复杂的时候开始做标记，那么标记就很简单。但是一旦你的环境变得更加成熟，这就非常困难了。所以，如果你要迁移到云，确保提前开始标记，这样你就不会有任何遗憾。

### Do:使用保留实例和节约计划

如果您使用 AWS，使用保留实例(ri)和节省计划可以比云巨头的按需定价节省高达 72%。问题是你必须承诺提前一到三年购买 RIs，这意味着你需要提前预测你的使用需求。尽管存在这种挑战，风险投资还是为那些明智使用风险投资人带来了巨大的节约。

### 不要:在没有建立策略的情况下购买保留的实例或储蓄计划

使用 RIs 时，制定一个策略以确保您的储蓄最大化是至关重要的。通常，人们会错误地购买许多没有使用的 RIs。这导致前期节省，但没有回报。确保制定一个如何处理预留容量的计划。在 AWS 市场上销售它们是一个很好的起点。

我们转向云计算是为了获得更大的灵活性和更低的成本。但是为了实现这一承诺，我们不能指望云或我们的云提供商为我们做所有的工作。不幸的是，云节省不是自动的。

这就是为什么创建一个涵盖云迁移的成本、安全性和其他关键方面的策略应该是您的首要任务。即使您已经使用云多年，您也应该继续重新评估您的云成本策略，以确保它得到充分优化。从找出导致云浪费的实践开始，并创建一个游戏计划来防止它的发生。

请记住，新技术总是不断涌现，因此请确保您了解任何可能影响您的云成本战略的行业变化。