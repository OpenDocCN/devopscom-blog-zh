# OpenAPI 规范:感知与现实

> 原文:[https://devo PS . com/open API-specification-perception-vs-reality/](https://devops.com/openapi-specification-perception-vs-reality/)

OpenAPI 规范(OAS)(以前称为 [Swagger 规范](https://swagger.io/specification/))提供了一种描述和记录 REST APIs 及其组件的方法。它包括关于端点、它们的操作、操作所需的参数、每个操作的预期响应、认证方法甚至注释的细节。OAS 是一种易于学习和阅读的格式，可以被人类和机器理解。正如您所想象的，这种“可访问的”文档对于开发和安全团队来说，在许多不同的用例中都是有用和有益的。

## 开发人员与 OAS 的关系

对于开发人员来说，OAS 可以用来为 API 生成文档。适当的文档可以帮助其他开发人员了解如何最好地将这些 API 与他们自己的应用程序集成和使用。

即便如此，许多开发人员对 OAS 还是又爱又恨。让我们面对现实吧，记录与开发相去甚远。虽然它很容易学习，但实际的记录过程是乏味的、手动的和耗时的。坦率地说，这可能是开发人员工作中最不光彩的部分之一，因此，许多开发人员只做最少的工作。因此，OAS 可能不完整，或者在某些情况下完全缺失。更不用说，当 API 更新时，OAS 多久更新一次？

在文档不完整或不存在的情况下，开发人员将通过反复试验来蒙混过关，即使这会减慢开发过程。

如果过时的 OAS 证明是开发团队的烦恼，对安全性有什么影响？

## 安全与美洲国家组织的关系

人和机器都可以使用办公自动化系统，这两者对于办公自动化系统的安全使用都至关重要。

OAS 帮助安全团队(人)意识到 API 的存在，因为它的文档通常是 CI/CD 过程的一部分。

通过检查 OAS 文件，安全团队可以了解 API 应该做什么，并由此确定它是否符合或违反组织的安全策略。例如，安全团队可以使用 OAS 来确保身份验证和授权得到正确实施，并且像 PII 这样的敏感数据不会被暴露。

安全团队还可能部署工具(机器),这些工具使用 OAS 来根据文档中的内容实施策略。例如，OAS 可以指定，对于特定的参数，应该期望一个字符串；它应该不超过四个字符，并且应该只包含字母和数字，没有特殊字符。通过基于 OAS 中定义的内容来验证输入，安全工具可以检查 API 是否按照开发人员的意图工作。

这个计划在理论上听起来很棒，但是…

## 感知与现实

想象一个完美的世界，其中每个 API 都作为开发过程的一部分被很好地记录。当 API 在开发管道中前进时，它与相关的 OAS 携手并进。在适当的时候，在生产之前，让安全部门了解 API 和 OAS，团队评估细节，验证 API 是否符合策略，批准 API 并投入生产。安全和开发团队和睦相处，皆大欢喜。

我们并不是生活在一个完美的世界里。相反，我们必须处理以下问题:

*   OAS 存在吗？在最极端的情况下，OAS 甚至不存在。它从未作为开发过程的一部分被创建，所以它不能用于任何种类的意识。这些失误发生的频率比你想象的要高，导致了影子 API 的问题。这些 API 从缝隙中溜走，在没有任何文档的情况下投入生产。你可能会对自己说，“我们公司绝不会让这种事情发生！”你也应该考虑到许多 API 是由开发团队作为一个测试，作为测试版的一部分，或者作为一种快速而肮脏的方式来完成的。它们比你想象的要多，这些影子 API 会产生未意识到的风险。
*   OAS 是否完整？在稍微不那么可怕的领域，让我们考虑一个不完整的 OAS。您可能会对自己说，“我们拥有一流的开发团队、定义良好的开发流程和严格的文档政策。没有 OAS，任何 API 都无法投入生产！”也许吧，但魔鬼就在细节中，而那些细节往往会被忽略。我和无数的客户一起工作过，他们愉快而自信地生产了一个 OAS，其中关键的细节与 API 的实际情况不符。有时它们并不完整。有时候他们一起失踪了。业界称这些缺失的细节为影子端点。是的，确实有人制作了一个 OAS，并且安全部门知道这个 API，但是缺少了很多关键的细节。
*   它是最新的吗？开发周期似乎变得越来越快，由于文档是开发人员工作中最不光彩的部分之一，更新可能会被错过、忽略，或者至少是滞后。我们通常会看到一个 API 的多个版本，而 OAS 并没有反映出最新版本的新功能。

虽然不存在或过时的 OAS 对 API 可见性有一定的关注，但当试图作为 API 安全性的基础时，它会产生很大的问题。

如果你仅仅依靠 OAS 来保证安全，你会冒很大的风险。通常情况下，OAS 是不准确的，缺少关键的细节，并且只有你输入的数据才是有用的。差距，包括影子 API，遗漏了关键的细节，使得执行不切实际。

OAS 的不准确性给客户留下了两个选择。您可以在严格遵守的基础上实施安全策略，并冒着阻止合法流量的风险，也可以在宽松遵守的基础上实施安全策略，并冒着让攻击通过的风险。在这两种情况下，您的组织都非常容易受到攻击，并且比您的开发团队想要的或者您的安全团队想要的安全性要差得多。

## OAS 只是一个起点

OAS 为记录 API 提供了一个很好的起点。但是，不要错误地将 API 安全策略建立在 OAS 的基础上。这根本不够准确。采用这种方法将使您公司的重要数据和服务处于 API 攻击者的控制之下，这些攻击者会比您的 OAS 更快地了解您的 API 以及它们所公开的内容。