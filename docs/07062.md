# 逐步建立 IaC 安全和治理计划

> 原文:[https://devo PS . com/building-an-IAC-security-and-governance-program-step-by-step/](https://devops.com/building-an-iac-security-and-governance-program-step-by-step/)

基础设施即代码(IaC)无疑正在改变工程师实现云计算的方式。当 IaC 与开发工具和自动化相结合时，[为基础设施性能、可伸缩性以及现在的**安全性**开辟了新的途径](https://devops.com/it-as-code/)。

通过将 IaC 安全性和合规性控制嵌入到您的版本控制系统和 CI/CD 管道中，您可以更早地识别和修复错误。但是，为了做到这一点而不造成中断，制定一个策略来确定在哪里以及如何实施安全控制以满足您的目标而不减慢您的开发人员的速度是至关重要的，从实验到管理您的策略。

![](../Images/04954980e700c828f94824c5b9fdeb4d.png)

这篇文章将分享一个处理和建立内部 IaC 安全策略的技术过程。

### **您的基础设施安全目标是什么？**

实施最可持续的基础设施安全计划的关键在于利用开发人员已经使用的工具和工作流程。对于许多人来说，这可能说起来容易做起来难，因为安全工具传统上缺乏必要的访问和上下文来很好地处理开发工作流。IaC 安全方法与独立于开发人员工作流的更被动的云安全监控和警报有着根本的不同。

当您开始为持续的基础架构安全流程铺平道路时，首先要定义您的理想状态。这样，在整个过程中，您将知道如何以及在哪里实施不同的安全性和合规性控制。

### 你想实施什么政策，如何实施？

您的基础设施安全计划在很大程度上取决于您组织的安全优先级和成熟度，您应该根据自己的独特需求阅读本指南。

如果您想要改善您的整体云安全状况，您可能想要寻找应用通用安全策略框架(如互联网安全中心)的方法。一些开源安全扫描器，如 [Checkov](https://checkov.io/) 或[开放策略代理](https://www.openpolicyagent.org/) (OPA)在 IaC 层执行策略代码。

它们通常是独立的打包容器，定义为接受文件、目录、存储库、分支等。，并以机器可读的格式(如 JSON 或 JUnit XML)输出扫描结果。使用开源扫描器的最大优势在于，它们预先打包了有价值的安全测试逻辑，开发人员不必学习这些逻辑。

扫描器的替代品是一个全功能的安全产品，最好是一个具有公开的 API 和 webhook 集成源的产品。大多数开发人员优先的安全解决方案已经完成了这部分繁重的工作，所以您应该得到一些现成的。

如果您需要实施外部控制，如行业基准或法规遵从性要求，您将需要一种更结构化的方法，将各个检查映射到期望的结果。许多云提供商包括针对 HIPAA、NIST、PCI-DSS 等标准基准的强大合规性报告。确保您的策略实施方法能够让您构建自己的策略，以便您也可以采用这些控制。

### 您应该在哪里实施基础设施政策？

您的每个团队可能都有其独特的框架和流程，在深入研究之前充分了解情况非常重要。从一个简单的映射练习开始，列出所有正在使用的配置框架——从 CloudFormation 或 Azure Resource Manager (ARM)到 Terraform 或 Pulumi。

一旦您知道内部存在什么框架，下一步就是确定扫描它们的基础设施安全错误的最佳位置。有了许多框架，从头开始构建新的流程将是一场艰苦的战斗。根据您的组织的 DevOps 成熟度，您可能会找到一个可以构建的现有基础。

了解您团队的端到端代码审查流程——从提交新的基础设施变更到 CI/CD 构建管道和部署。您的团队可能有一些自动化测试——单元、验收、集成等。—确保更新按预期运行，并且不会引入错误。使用这些流程作为插入安全扫描的示例。为了更好地理解这些流程，您可能需要问一些问题，例如:

*   什么触发了 CI/CD 构建？
*   您当前的自动化质量保证工作是否在每个新的拉取请求和提交上持续运行？
*   更多耗时的测试，比如集成测试，是以不连续的时间间隔运行，比如每晚，还是只在遵循特定命名约定的分支上运行？
*   开发人员在提交之前是否在本地测试他们的工作？
*   有多少 CI/CD 管道在使用中？

实施安全扫描的方式和位置将取决于这些过程和用于执行这些过程的工具。基于您当前的设置，您通常希望采用两种 IaC 安全性方法中的一种——利用 CI/CD 过程或版本控制系统(VCS)的内置功能。

**方法#1: CI/CD 管道**

将安全控制构建为 CI/CD 管道的一部分可能是这两种方法中较容易的一种，因为现代 CI/CD 工具已经完全抽象掉了编排测试逻辑背后的复杂性。

在许多情况下，扫描 CI 管道中的安全性是实施 IaC 安全和治理计划的最快方式。如果一个现代的 CI 工具已经准备好了，你可以在不到 10 分钟的时间内设置好它。如果您发现自己走上了这条路，请考虑扫描的剩余结果，并花时间与负责处理其输出的团队一起试运行它。

对于在集中式基础设施运营模型中运营的团队来说，这是一个最佳的解决方案。专业知识和控制可以保留在少数人的手中，并且对该过程的持续增强不会影响大量的开发人员。对于其他人，请继续阅读。

**方法#2:版本控制系统**

您选择的版本控制系统(VCS)也隐藏了一些健壮的安全治理内部控制。除了添加单独的自动化功能，目前主导市场的三个平台(GitHub、GitLab 和 Bitbucket)都提供了嵌入式代码审查和授权控制，可以用来更好地控制谁可以在哪里更改什么。

通过其本地版本控制和分支，开发人员可以在不损害任何运行的生产系统的情况下执行广泛的测试，并在因测试而做出更改之前继续协作和交流。

通过在这里嵌入基础设施安全性，在更细粒度的访问和控制方面有一些好处。两种更常用的方法是利用标准的拉式请求审核(PR)流程:

*   **PR 注解:**从选择阻力最小的路径开始简单。使用标准的 webhook 或 API 接口，您可以从扫描每个 PR 开始，并用具体的安全编码建议注释其结果。注释的好处是它没有摩擦。开发人员可以选择采用或忽略它——很少沮丧，但另一方面，没有很多治理。
*   **检查:**随着大多数 git 平台增加了本地 CI，您也可以在 git 中加入标准 CI 管道。主要好处是将类似 CI 的扫描作为每个个人 PR 的一部分。它在早期阶段呈现相同类型的输出，并使开发人员能够在管道中实际构建失败之前做出反应。

### 您应该如何实施安全输出？

在包含侵入性控制和压倒性的安全扫描结果之前，最好对安全输出应该如何操作设定预期。没有人想被数十个失败迹象轰炸，没有清晰的路径来证明他们的决策。如果你的 IaC 策略很吵或者在一天结束时变成了一个阻碍物，你的团队就不会采用它。

定义您希望安全控制的输出是被动还是主动。it 应该主动阻止构建还是提供被动反馈来解决一些预定义的 SLA 中的问题？

一些扫描器甚至可以进一步集成到管道中，并协调更高级的操作，例如在测试完成之前阻止构建完成。CI 中的扫描通常是被动的；它不是为交互式测试和故障排除而构建的。开发管道是否应该包含解决安全错误或违反法规时需要回答的复杂问题的答案？

问问自己，当构建失败时，谁会收到通知。继续想象您的 CI 控制台是否是您要排除配置错误的地方。你有足够的背景来解决你的扫描仪将要提出的问题吗？你能推断出通过 CI 扫描所做的改变的影响吗？

除了前面提到的将 IaC 安全策略与 VCS 联系起来的好处之外，git 中还有更多细粒度的控制，例如:

*   **审批规则:**通过 VCS，您可以定义需要多少个审批，一个拉式请求需要多少个审批才能合并。有些甚至让您选择应该是哪些特定用户。
*   **Code owners:** 如果您拥有主 repo 的管理员权限，请考虑使用 Code owners 参数为更敏感的文件定义更严格的批准协议。

一些更成熟的工具也支持高级功能，比如导入自定义规则文件，以及将抑制和跳过作为代码注释来应用。这些应该有助于您确保最终只出现相关的检查。

## 结论

基础设施安全没有放之四海而皆准的策略，作为一个行业，我们仍在定义将其嵌入 IaC 的最佳实践。每个安全团队都要与他们的工程和开发人员紧密合作，使安全成为可消费的，并最终尽可能早地在开发生命周期中预防风险。