# DevOps 聊天:使用 Salesforce 调试 Spinnaker 应用程序

> 原文：<https://devops.com/devops-chat-debugging-spinnaker-apps-with-salesforce/>

Spinnaker Summit 2019 预览版:在任何环境中调试生产问题都具有挑战性，Spinnaker 有其生产学习曲线。在较小的环境中，问题并不总是可复制的，而且调试消息可能会很冗长，让人搞不清到底发生了什么。

我们的 DevOps 聊天嘉宾 Salesforce 首席软件工程师 Chuck Lane 将在 2019 年 Spinnaker 峰会上发表关于“实时调试和分析 Spinnaker 应用程序”的演讲。在 Chuck 的演讲中，您将学习诸如远程 JVM 调试、定制概要构建等技能，以及使用 htop 了解多线程微服务的神奇之处。

查克的演讲是在太平洋时间 11 月 16 日星期六下午 3:40。2019 年 Spinnaker 峰会将于 11 月 15 日至 19 日在圣地亚哥举行。

像往常一样，下面是流媒体音频，然后是我们的谈话记录。

[https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/706468711&color=%23ff5500&auto_play=false&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true](https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/706468711&color=%23ff5500&auto_play=false&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true)

## 副本

米奇·阿什利:大家好。我是 DevOps.com 的米奇·阿什利，您正在收听的是另一个 DevOps 聊天播客。今天，我和查克·莱恩在一起。他是 Salesforce.com[的首席软件工程师。他在销售云上工作，这是你和我使用、了解和喜爱的销售力量，或我们的 CRM 能力。Chuck 正在圣地亚哥举行的 2019 年 Spinnaker 峰会上讲话，他的讲话是关于实时调试和分析 Spinnaker 应用程序。我认为直播的意思是，就像，在他们运行的时候，在生产过程中直播，看看发生了什么。我们会探索那是什么。这个演讲是在 11 月 16 日星期六，下午 3:45 在圣地亚哥。Chuck 欢迎加入 DevOps 聊天。](https://www.salesforce.com/)

**查克莱恩:**谢谢。很高兴来到这里。

阿什利:优秀。你能来真是太好了。你能从自我介绍开始吗？请简单介绍一下您和您在 Salesforce 的工作。

**巷:**耶。我叫查克·莱恩。正如你提到的，我是首席软件工程师。基本上，我在 Salesforce 的主要职责是帮助 Salesforce 将 Spinnaker 用于我们基于公共云的部署。因此，当我们尝试从第一方架构转移到公共云时，我们使用的技术之一是 Spinnaker，我已经成为了 Spinnaker 的主题专家。因此，我在某种程度上帮助弥合了传统开发和部署周期与在容器化世界中使用 Spinnaker 的情况之间的差距。

阿什利:好的，太好了。你用了一个我不知道是否熟悉的术语。您提到了从第一方架构迁移到公共云的事情。你所处的环境是什么意思，你要去哪里？

**巷:**耶。所以，基本上，我的意思是，从历史上看，Salesforce 拥有自己的数据中心，我们已经部署到这些数据中心。我们正在大规模采用公共云架构，无论是通过 AWS，还是通过 GCP，或者任何其他数量的云产品。

因此，与一些人所说的“搬起石头砸自己的脚”不同，我们只是把原本要在自己的硬件上运行的软件搬到云中，我们正在对软件进行基本的重新架构，以利用云架构允许我们利用的所有优势。

阿什利:嗯。太棒了。听到一点关于您自己在 Salesforce 的发展很有意思。所以，你的演讲是关于使用 Spinnaker，你知道，实际上是关于调试和发现生产中发生的问题，但有时你可能会努力尝试将其复制到一个较小的环境中，以解决相同的问题。

你能告诉我们一点是什么引导你走上这条路，让你明白如何去做这件事吗？这是一个正在发生的大问题，还是你反复看到的没有好的解决方案的事情，而你找到了解决方法？这是怎么发生的？

**车道:**对。所以，基本上，当您接受工作负载并将其迁移过来时，我的意思是，当—您知道，当您只是从一小部分工作负载开始时，您知道，路径相对简单。而且，你知道——不管怎样，希望如此——你不会遇到太多不容易解决的问题。

但现实是，随着您将越来越多的工作负载转移到公共云，这是—您知道，细节是魔鬼，对吗？因此，当您遇到各种限制或者软件没有按照您期望的方式运行时，就会出现问题。在这些情况下，我们——投入到生产软件中会非常有益，你知道，有时在上面安装一个调试器，看看它到底在做什么，与你预期的有所不同。你知道，这可以帮助你调整你的工作负载，让事情运行得更顺畅。

阿什利:嗯。我知道有时使用调试器，启用它们—这可能会有所帮助，但也可能会有太多的信息，试图整理所有正在发生的事情，试图找到您应该关注的内容。你在开启调试或使用调试器时发现了哪些挑战？

**巷:**耶。嗯，所以，我的意思是，就你所说的信息太多而言，肯定存在这个问题。Spinnaker 和服务编写方式的一个优点是，您可以非常精细地调整 Spinnaker 内部的哪些库，让它打印和调试信息。

阿什利:嗯。

**Lane:** 因此，如果我们知道某个数据绑定层出现了问题，或者某个授权层出现了问题，那么我们就可以通过配置文件和 Java 设置，真正找到那个显式目录，或者不好意思，是那个显式库，然后说:“给我你所有的调试信息。”

阿什利:嗯。

**Lane:** 但是，你知道，如果做不到这一点，我的意思是，肯定会有有利的时候，最好的行动方案就是下去查看代码，看看它在做什么。同样，最好是在下进行——通常在生产环境中无法做到，但我们可以模拟一个与生产环境中类似的负载，并真正了解发生了什么，以帮助我们识别那些可能是 o 事件平方而不是登录或类似情况的算法。

阿什利:嗯。现在，是否有一些具体的技术——我知道在你的演讲描述中，当你谈到使用远程 JVM 调试、定制配置文件构建，甚至使用 htop，你知道，UNIX 命令或 LINUX 命令来帮助你了解多线程微服务的情况。这听起来像是你发现并学到的各种不同的方法，你可以用来找出正在发生的事情。

**巷:**耶。所以，我的意思是，一般来说，我们喜欢尽可能接近开源版本，由 Spinnaker 提供的版本，最终由 Google 提供。但是，在某些情况下，我们确实需要一个额外的工具，比如 htop，比如 Glowroot，这是一个 Java 应用程序分析器，我们将使用 Spinnaker 映像作为基础构建一个自定义映像，然后添加这些额外的库，将它们放入 Spinnaker 生态系统，然后启动它们，看看我们能从中获得哪些额外的信息。

所以，你知道，在一个对我们非常有用的场景中，我们遇到了云驱动程序，云驱动程序是与我们所有不同的云基础架构进行交互的主要工具。

**阿什利:**嗯哼，嗯哼。

**Lane:** 有时打给云司机的电话需要两到三分钟以上的时间才能得到回应。现在，你知道，超时是这样设置的，如果它在大约 30 或 60 秒内没有听到任何反馈，那么它就会忽略该负载，你知道，这给我们带来了相当多的问题。

通过构建一个包含 htop 的自定义云驱动程序映像，我们能够看到大多数正在运行的进程实际上都在运行一些命令来访问 Kubernetes 集群，并获得 Kubernetes 集群中所有名称空间的列表。并且，通过与一些 Spinnaker 开发人员讨论，我们发现如果您有 15 个左右的集群连接到 Spinnaker，那么查询每个集群以获得名称空间列表并不是什么大问题。但是，当您像我们这样扩展到 400 或 500 个不同的集群时，那么大量的延迟和您的大量时间实际上可能只是 Kubectl 调用，等待向您返回您需要访问和扫描的名称空间列表。

因此，我们实施了一个基于工作流的解决方案，基本上，我们让我们的团队知道，当他们创建集群时，他们应该使用 Terraform 来继续创建集群——对不起，他们将使用的名称空间。然后，如果他们需要在事后使用名称空间，我们会提供一个他们可以使用的管道，它会动态添加一个额外的名称空间，他们的群集将开始扫描该空间。因此，这使我们不必一直扫描所有集群，因为这会导致相当多的性能瓶颈。

阿什利:是的，我可以想象这会有一些开销，如果你经常这样做，可能会有很多开销。因此，这听起来像是一种既能减少开销，又能更快获得信息的方法。

莱恩:完全正确，完全正确——对，对。

阿什利:嗯。非常酷。那么，在你的演讲中，你会做一些演示吗？我知道总会有演示小精灵，或者你会只是展示，你知道，谈论这些技术是什么？

莱恩:所以，我打算做一些演示。至于——

阿什莉:那真的很酷。

**巷:**耶。你知道，我可能会做，那是什么——简单的烤箱，直到，“这是行为，这是我们在代码中发现的。”但据我所知，很多东西可能有点依赖于实际网站的互联网连接。因此，如果我们有良好的互联网连接，那么无论如何，我计划通过几个调试场景，尽可能接近我们实时做的事情。

阿什利:是的。嗯，你知道，某个地方的某人—已经有一段时间了—给了我一个很好的建议，你知道，“准备好你的现场演示，并在后台准备好你的离线演示。”*【笑声】*所以，如果你上不了网，你至少可以在本地展示一些东西。所以，如果你依赖于网络——我不确定你是否支持你的演示，但这总是一堂很好的课，对吗？

**莱恩:**当然，正是。

阿什利:太好了。有没有其他类型的经验教训，常见的错误，或者你或其他人在这个过程中可能犯过的错误，所以你通过尝试和错误学到了一些困难的东西，你打算分享吗？

莱恩:我的意思是，嗯，有——咻。你知道，我在三角帆工作了几年。所以，在这方面，肯定有很多惨痛的教训。但老实说，我会做的是，我会鼓励任何想进入 Spinnaker 的人不要只是在 Slack channel 附近徘徊，因为 Slack channel 确实有泛滥的趋势，你知道，只是有些人发布他们的堆栈跟踪，只是说，“嘿，有人以前见过这个吗？”

而且，你知道，我已经获得了更多的成功，通过检查提交，看着真正编写代码的人，然后直接接触他们，而不仅仅是“嘿，你能给我解释一下吗？”而是，你知道，“嘿，我知道你在这里做了什么，我也知道你在这里做了什么。我在这些线路上遇到了问题。你有不同的方法吗，或者有什么事情我可以做得不同吗？”

另一件我不能夸大的事情是作为特殊利益集团成员的价值。

阿什莉:嗯，有意思。

**莱恩:**所以——是啊。所以，我是 Kubernetes V2 特别兴趣小组的成员，该小组由 Armory 的 Eric Semene 和 Ethan Rogers 领导，Eric 来自 Google。你知道，这是绝对丰富的信息，你知道，老实说，我不知道如果没有那两个人，我们是否会走得这么远。

所以，你知道，是的，我只想说这个社区真的很友好，我们总是欢迎愿意学习的新成员。

阿什利:你知道，我认为这两个建议都很棒，我真的很感谢你提出这些建议。因为，第一，像项目中的 Slack 频道，开源，这些可能有点吓人。有时他们不容易接近，因为有太多的噪音发生在上面，人们寻求帮助，就像你所说的，“这里有一个堆栈跟踪，我正在试图弄清楚。”

而且，你建议与代码作者联系，你知道吗，这是——人们喜欢互相帮助。而且，你知道，这可能看起来像，“嘿，写这个的人不会有时间来烦我”——他们喜欢听到使用他们的东西的人谈论它并帮助他们，但也听到他们如何使用它，当然，他们总是在寻找想法和反馈之类的东西。听起来你有过类似的经历。

**莱恩:**是啊，绝对是。我的意思是，你知道，最重要的事情是，你知道，作为一个程序员，很容易告诉那些来找你只是想让你帮他们解决问题的人，以及那些来找你真正想自己解决问题的人。而且，你知道，比起前者，我对后者的评价再高也不过分。我的意思是，你知道，只要尽你最大的努力，当你陷入困境时，向某人伸出援手，你知道，这是非常有价值的。

阿什莉:这有点像去外国。无论你在哪里，如果你是美国人，要去别的地方，反之亦然，每个人都欣赏你试图说母语，在某个时候，当他们看到你足够努力，你能走多远，他们很乐意帮助你，你知道，用你的语言说话。

所以，帮助人们写代码也是同样的事情。如果你只是想把你的问题推给它的开发者，那就不太好了。但是他们很感激你尽了最大努力。正如你提到的，去看看代码，弄清楚到底是怎么回事。

**巷:**耶。

阿什利:你会得到极大的尊重，你知道，即使你不是那个级别的程序员，在那个级别的软件开发人员中，这对开发人员来说意义重大。

**巷:**绝，绝。

阿什利:嗯，嘿，我认为你会有一个精彩的演讲，我喜欢这个想法，你知道，这个想法试图弄清楚生产中正在发生的事情，你已经想出和开发的一些技术，你已经体验过了，事实上你正在与他人分享这些。我很好奇，你在任何领域为 Spinnaker 项目贡献过代码吗？您主要是 it 从业者吗？

**巷:**所以，我有。我已经完成了一些小的 RPR，但是实际上，我现在的大部分提交都是在 Spinnaker 的网站上完成的。所以，你知道，我不知道 Java 或 Groovy 或 Kotlin，也许，以及。他们使用的一些模式有点——我来自. net 世界，所以他们对我来说有点陌生。

但是，是的，我确实写了一些不同的文档页面，我发现这是一个很好的进入方式，我甚至有一些即将出现的与文档无关的 PRs。所以，是的，希望你能更多地看到我的名字。

阿什利:优秀。你知道吗，文档也很重要。有些人在 Spinnaker 峰会上发言，你知道，有点陷入这样的境地，“嘿，有一种方法的文档，但不是在这套配置或软件下。”所以，这也是一种贡献，所以祝贺你成为社区的一员，并分享你在峰会上的经验。

查克，感谢你今天上播客。

**莱恩:**哦，谢谢。这是一种绝对的特权。非常感谢。

阿什莉:绝对是。太棒了。我希望你的演讲一切顺利，我相信它会很棒，希望听这个播客的人会引起更多的兴趣，让人们听你的。

所以，我要感谢我们今天的嘉宾，查克·莱恩。他是 Salesforce.com 的首席软件工程师，所以你可以想象他工作的环境。恰克带来了一些非常好的经验。他将于 11 月 15 日至 19 日在圣地亚哥举行的 2019 年 Spinnaker 峰会上发表演讲。他的演讲是现场调试和剖析 Spinnaker 应用程序，他的演讲是在 11 月 16 日星期六下午 3:45

我还要感谢你——你，我们的听众——今天加入我们。我是 DevOps.com 的米奇·阿什利。祝你愉快，在外面要小心。

— [米切尔·阿什利](https://devops.com/author/mitchellashley/)