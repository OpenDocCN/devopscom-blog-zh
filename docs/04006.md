# 是时候和你晶片分手了

> 原文：<https://devops.com/time-break-waf/>

如果你拥有网络应用防火墙(WAF)的唯一原因是为了合规，你应该得到更好的。是时候用不仅能提供法规遵从性，还能提供真正安全价值的东西来取代它了。

在 web 应用程序安全领域，有一些保守得不太好的秘密，可以说没有比这更大的了:WAF 幸存下来不是因为它很优秀，而是因为它是强制性的。

WAF 是一项过时的技术，旨在帮助阻止应用程序安全漏洞的增加，这些漏洞的发现频率已经让组织不堪重负。静态和动态分析工具将大量的 bug 丢给了开发团队，他们没有可能修复如此多的代码问题。

作为解决这一问题的权宜之计，WAF 可以过滤掉猖獗的 SQLi、命令执行和 XSS 攻击，这些攻击可能会消耗开发和安全团队的所有可用资源。WAF 背后的想法是，应用程序错误和安全缺陷将暂时进行分类，然后最终在代码中修复问题的根源。

当时，嵌入式 web 应用程序安全过滤器似乎是个好主意。当然，它有时会导致阻塞合法的交通，但这就是生活。它至少在应用程序层提供了某种程度的保护——这是法规遵从性制度迫切需要解决方案的地方。然后 PCI(支付卡行业)法规介入，整个格局都变了。

PCI requirement 6.6 规定，您必须要么准备一个 WAF，要么对应用程序的每个更改进行彻底的代码审查。鉴于第二种选择的不吸引人的性质，大多数组织将此视为获得 WAF 的命令。换句话说，人们不是因为 WAFs 的安全价值才安装它的——他们只是想通过强制性的 PCI 认证。公平地说，PCI 单枪匹马将 WAF 市场从一个有趣的想法发展成为今天的庞然大物。

WAF 继续存在，这是一项过时的技术，由法律术语而非实际效用支撑，提供了一种虚假的安全感，却没有采取任何措施来确保这一点。如果这还不足以让你把 WAF 扫地出门，这里还有四个 WAF 应该被替换的理由。

## **最小晶圆规则方法被破坏**

WAF 实现的一个常见副作用是阻塞合法流量。在应用安全业务中，我们称之为误报。不要被这种无伤大雅的措辞所迷惑，它的意思是客户不能购买他们想要的东西，或上传他们最新的度假照片，或通常使用你的应用程序的功能。就是那种能迅速把现在的客户变成以前的客户的体验。

为了对抗 WAF 误报，大多数公司只运行最少数量的规则。这意味着只有最明显和最恶劣的攻击会被捕获，而其他所有攻击都会通过过滤器。简单的规则意味着容易绕过规则，留给你一个无效的 WAF。

## **学习模式在速度**时中断

WAFs 试图减少误报和避免破坏有效流量的一种方法是通过“学习模式”在学习模式中，WAF 了解正常流量和恶意流量的区别，并采取相应的保护措施。关于获得正确的学习模式有多困难，可以说很多，即使在完美的条件下，但是让我们跳到我们在生产环境中看到的真正问题。

学习模式需要时间。需要学习识别“正常行为”的 waf 需要一定量的流量审查，然后才能主动阻止其他一切。学习安全应用程序流量模式可能需要几个小时。

当您从瀑布式迁移到敏捷和开发运维时，部署速度会越来越快。应用程序代码每周、每天甚至每小时都在变化。如果您使用任何接近现代节奏的方式进行部署，那么在每次代码更改时将 WAF 置于学习模式意味着您总是处于学习模式。本质上，任何一种学习模式，当应用到现代应用程序开发技术时，都跟不上生产的步伐。

## **监控模式确实不合规**

WAFs 之所以幸存下来，是因为法律规定而非有效性，这一事实并不是该行业唯一公开的秘密。当你听到大多数公司从未将他们的 WAF 置于主动阻塞模式时，你也不会感到震惊。毕竟，阻塞模式有很高的误报率，会破坏您的合法流量，所以只有当您希望破坏您的应用程序时，才应该使用它。

相反，WAF 在监控模式下运行，在这种模式下，它会观察流量并将任何事件记录为攻击。当到了审计的时候，WAF 被翻转一小段时间，然后再次返回。当然，在现实中，有些审计员甚至不在乎你是否处于主动阻塞模式。对他们来说，有一个 WAF 就足够了。

在监控模式下运行 WAF 不是一种有效的控制。它所做的只是给安全团队增加了一种虚假的安全感和额外的开销来评估记录的事件。在这种情况下，你把钱花在了不需要花的地方，同时增加了几乎为零的防御措施。

## **基于 CDN 的 waf 是为了方便，而不是有效**

关于 WAFs 的最后一件不那么有趣的事情是他们的日常护理和喂养。您的 WAF 增加了网络的复杂性，并且必须在云中动态扩展它并不容易。进入内容交付网络(CDN)。既然大多数商店已经在使用 CDN 来减轻 web 应用程序的负担，为什么不在 CDN 层增加一个 WAF 呢？这符合合规性(耶！)而且我们不用管它(double yay！).

对于许多企业来说，这种想法是双赢的，即使 WAF 的实用性受到质疑，它也能坚持下去。然而，基于 CDN 的 WAF 的问题是，你最终再次以一组最少的规则运行 WAF(见上文或[此处](https://labs.signalsciences.com/six-reasons-application-defense-doesnt-belong-edge)，为各种攻击敞开大门。事实上，在我在 Signal Sciences 的工作中，许多客户在他们基于 CDN 的 WAF 背后使用我们的 web 保护平台，并发现了大量通过 CDN 成功进行的真实攻击。

如果合规性是您的主要目标，请继续使用基于 CDN 的 WAF。如果你想要真正的防御，去别处看看。

## **快速实现合规性和真正的安全性**

如果这篇文章听起来有点太熟悉——如果你从 WAF 得到的只是合规性——那么是时候替换它了。在 web 应用层增加防御并同时实现合规性有了新的选择——例如，使用 r untime 应用程序自我保护( RASP)或下一代 WAF 来提供应用程序感知防御覆盖。这意味着，您可以主动防御 [OWASP 十大](https://www.owasp.org/index.php/Category:OWASP_Top_Ten_Project)、账户接管、工具业务逻辑和击退僵尸程序，而不仅仅是检查 PCI，所有这些都不会干扰合法的客户活动。

不要仅仅满足于合规。您可以实现合规性和真正的保护，这是您的企业和客户应得的。

詹姆斯·维克特