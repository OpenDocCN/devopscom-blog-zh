# 安全软件峰会:混沌工程在软件安全中的应用

> 原文：<https://devops.com/secure-software-summit-applying-chaos-engineering-to-software-security/>

今天的软件系统本质上是受控混沌——而且是轻度受控混沌。这使得对这些系统的行为建模变得异常具有挑战性。我们的系统正迅速变得越来越大，移动部件越来越多。对于企业来说，拥有 1，000 多个微服务和数百万个容器来运行包含数千个开源库的数千个应用程序并不罕见。

为什么事情变得越来越复杂？因为从微服务到 CI/CD 管道，从服务网格到蓝/绿部署，所有这些新实践和新技术都有助于我们提高应用和基础设施的弹性和可扩展性。不利的一面是不断增加的复杂性，实际上是在加速。

此外，软件已经正式接管了网络和硬件堆栈的每一层(这听起来像是一个矛盾的说法，但它是容器和虚拟化海龟，直到你碰到裸机)。根据定义，软件很容易重写。因此，改变软件的容易程度进一步增加了我们对系统所做的改变的数量。这增加了更多的复杂性。事实上，软件只会越来越复杂；复杂性从未降低。软件总是试图做得更多，包含更多。出于这个原因，即使你试图简化软件，你也只是移动了复杂性，而不是消除它。

## 引入湍流

下面是混沌工程的先驱组织[网飞如何定义这种做法:](https://netflixtechblog.com/tagged/chaos-engineering) *“混沌工程是在分布式系统上进行实验的学科，以建立对系统承受动荡条件能力的信心。”* 湍流是秩序的反义词，但它是所有系统最终的归宿。

在系统生命周期的开始，总是有一个有序的部署和操作计划。对于您的资源、代码库、容器，您总是有一个清晰的图表；对于您将要部署的 AWS 实例和网络拓扑，您总是有一个漂亮的 3D 图表。

事实上，我们的系统从来没有这么简单。系统上线后，我们就开始了解它实际上是如何应对不可预见的事件的，比如营销人员要求重构定价模块，或者支付 API 中断迫使您硬编码令牌或 DNS 中断——嗯，您知道 DNS 中断。在一两年的时间里，您从 300 个微服务增加到 800 个，您必须添加 Kubernetes 集群和一个容器网络接口(CNI ),以正确保护这些集群的网络。诸如此类。底线呢？几乎所有的生产系统都演变成一种我们不理解的状态，并且不容易映射回我们最初的系统图。

混沌工程是一种处理日益增长的复杂性的机制。混沌工程背后的基本思想是向计算机或应用程序或网络(或任何其他环境元素)提出一系列问题。考虑像大型机这样的遗留系统。我们的遗留系统是如何变得如此稳定的？这些都有据可查。工程师们对系统如何运行充满信心。问题是，这个系统一直都是这样吗？这个系统和他们最初设计的一样吗？答案是否定的

遗留系统实际上经历了一场考验；一连串意料之外的惊喜。这些惊喜实际上是问题。通过这些意外，工程师们了解了面对混乱和不可预见的事件，系统实际上会如何运行(或不运行)。这个过程创造了迭代反馈，帮助工程师学习如何使系统持续更稳定。

混沌工程的要点是产生这种相同类型的反馈循环，而没有不可预见(通常是不想要的)事件的痛苦、压力和影响。因此，混沌工程是一种引入不利条件的主动方式，以确保当不可预见的事件发生时，系统仍然可以做它应该做的事情。因为今天的一切都是软件，变化是不断的，所以提问也必须是不断的。

例如，自从我们最初设计任何给定的系统以来，它很可能已经发生了很大的变化。这意味着我们编程的一些或所有缓解和恢复能力—重试逻辑、故障转移、断路器—都是旧闻，是为旧系统设计的。当这些条件的触发因素实际发生时，我们设计的弹性机制可能不会像我们预期的那样发挥作用。

混沌工程师主动提出这样的问题:“在你被设计执行的条件下，你做了你应该做的吗？”我们以可控的方式引入条件本身，使用有限的爆炸半径对系统进行测试，并验证我们的假设与预期的现实相符。混沌工程的实践旨在在实时运行的系统上执行，而没有关闭关键生产资产或伏击毫无防备的应用程序及其相关开发人员和开发团队的风险。这有助于工程团队通过为他们提供增强的上下文来建立对他们系统理解的信心，从而减少不确定性。事实证明，当工程师看到更好的环境时，他们在弹性方面做出更明智、更明智决策的能力会大大提高。

## 网络安全的混沌工程

网络安全是一门与环境相关的学科，取决于你对所保护系统的理解程度。软件工程师不断地改变系统。他们必须能够灵活地改变它，因为他们的主要任务是不断地向商业价值前进。然而，为了有效地应用网络安全实践，我们必须知道我们试图保护什么。从这些知识中，我们可以知道我们最需要保护什么，以及如何在给定系统的最新状态下保护它。

在工程师了解如何建立可靠的安全措施来提供有效的网络安全之前，他必须首先了解系统。这种对“系统第一”的依赖是我们的安全系统和控制——即使是不可变的和短暂的——随着时间的推移经历相当大的工程漂移的基本驱动力。依赖于对系统的状态化理解，我们不断地承受着负担。

在我们的部署后世界中，如果没有某种测试或工具反馈循环，我们不知道我们的安全有问题，直到出现实际问题。在房子燃烧了几个小时后才发现房间着火了，为时已晚。结果是我们今天发现自己处于一系列弄巧成拙的反应式事故消防演习、作战室和停电之中。如果我们不改变这种追逐老虎尾巴的反应性危机循环，它不可避免地会让我们在与工程团队一起前进时后退两步。

当这种漂移未被发现时，我们的伤口暴露在外，攻击者对即将到来的大餐垂涎三尺。工程师总是更喜欢通过一些内部工程故障或受控测试来找到证据和漂移源，而不是经历一次成功的真实攻击。久而久之，系统和安全之间就有了不断的漂移；工程师们在不断地改变系统。因此，系统和旨在保护它们的安全性之间经常缺乏重新校准。实现这种重新校准的方法是通过持续的测试或实验。

测试不是混沌工程。测试是对你知道是真还是假的东西的验证和确认。这可能是特定 CVE 的漏洞或暴露于攻击模式。在实验中，你试图获得新的信息，探索未知的未知。通过这种探索，你可以更好地理解系统的反应，然后与设计系统的人分享。

实时安全事件不是有效的检测手段，因为到那时，在生命周期中有效解决问题已经太晚了。更糟糕的是，事故会导致压力、恐惧和非理性行为。人们吓坏了。毫不奇怪，安全事故不是一个好的学习环境。然而，安全事件服务于相同的目的:询问关于一个或多个系统的问题，并帮助团队了解如何改进它们。混沌工程提供了一种更好的方法，在更容易学习和观察系统行为的条件下产生这些问题，为提高安全性提供了线索。换句话说，安全混乱工程的目的是帮助我们主动了解我们的系统，以及在对手有机会利用它们之前安全漏洞在哪里。

安全混沌工程有多种用例，包括:

*   事故响应:测试运行手册、响应计划的功效，并确定数据收集和警报系统是否按预期工作
*   安全控制验证:引入可诱发一个或多个控制行为的条件，并观察行为
*   安全可观察性:引入意想不到的攻击或漏洞，查看您的系统是否准确地报告和观察事件
*   合规性监控:通过记录系统做了他们声称应该做的事情，适用于所有混乱工程事件

## 实际例子

我领导的一个团队编写了一个开源应用程序 ChaoSlingr，旨在为安全实验生成混沌工程事件。该应用程序由三个无服务器函数组成，用于生成实验、将实验应用于基础设施，然后监控对系统产生的影响。

我们如何使用 ChaoSlingr 的一个例子是我们引入了一个开放端口的练习。企业和工程师总是不经意地打开防火墙中的端口。有时这是配置错误的结果。也可能是由于软件升级后，开发人员或 AppSec 工程师忘记将端口重置为正确的安全设置。理论上，防火墙应该自动检测未经授权的开放端口。

在实验中，我们选择了一组自愿加入实验的资源，选择了一个安全组并打开了端口。当时，我们对亚马逊网络服务还比较陌生。我们惊讶地发现，防火墙只在 60%的时间里检测到未经授权的端口打开。我们发现了配置和安全工具漂移的明显证据。

我们还注意到，我们部署的云原生配置和管理工具几乎 100%都能识别和警告未经授权的端口打开。然后，我们意识到关联和响应未经授权的端口开放事件是复杂的；很难将事件映射回描述我们的系统如何响应事件的日志数据。我们为每个警报添加了一个元数据指针，使我们能够更轻松地关联信息，并节省寻找受影响的安全组和端口的宝贵时间。

简而言之，这次演习为我们提供了极好的背景信息，让我们了解我们的系统在哪些方面出现了问题，哪些系统是最可靠的，以及我们是否可以通过追踪正确的日志文件来快速轻松地应对这些事件。

## 安全混乱工程项目建立信任

在我们管理复杂系统的任何环境中，信任都是至关重要的。您必须相信您的系统将优雅地处理不可预见的事件，并且不会耗费您公司的金钱或声誉。您必须相信设计和构建您的系统的人会不断尝试改进它们。您必须相信保护您系统的安全团队能够胜任这项任务。随着系统变得越来越复杂，未知的未知数也成倍增加。作为人类，由于我们有限的处理能力，我们无法连续地大规模解决未知的未知问题。这就是安全混沌工程及其相关流程的任务:创建一种程序化的方法，对未知进行实验并找到未知的答案。你的系统、开发者、客户和你的 CEO 都会为此感谢你。

* * *

***关于安全软件峰会***  *安全软件峰会汇聚了全球领先的安全软件开发创新者、实践者和学者，分享和传授安全编码和部署实践的最新方法和突破。如果您正在开发、发布和保护软件，快速交付新功能，并从一开始就构建东西，请单击下面的链接访问本次峰会的所有会议。*

[https://go.shiftleft.io/secure-software-summit-2022-replay](https://go.shiftleft.io/secure-software-summit-2022-replay)