# 2019 年最佳:分解 OWASP API 安全十大，第 1 部分

> 原文：<https://devops.com/breaking-down-the-owasp-api-security-top-10-part-1/>

在我们结束 2019 年之际，我们 DevOps.com 想要强调今年最受欢迎的五篇文章。以下是我们为期一周的 2019 年最佳系列的第五部。

由于威胁范围的扩大和 API 使用的不断增加，OWASP API 安全十大项目启动了。从一开始，该项目就旨在帮助组织、开发人员和应用程序安全团队更加了解与 API 相关的风险。今年九月， [OWASP API 安全十大候选版本(RC)](https://github.com/OWASP/API-Security/raw/master/2019/en/dist/owasp-api-security-top-10.pdf) 最终确定并在 [OWASP](https://www.owasp.org/index.php/Main_Page) 上发布。

在我的[上一篇文章](https://www.checkmarx.com/blog/why-you-need-api-security)中，我提供了 API 端点、现代应用和后端服务器之间交互的高层次视图，以及它们与传统的基于浏览器的对等物的不同之处。我还讨论了为什么这个项目对贡献者和整个行业如此重要。

在本文中，我旨在通过强调一些可能的攻击场景来澄清前五种风险，以帮助组织和最终用户理解与有缺陷的 API 实现相关联的危险。以下讨论遵循 OWASP API 安全性 10 强中的相同顺序。

## API 1:2019–打破对象级别授权

攻击者可以通过操纵客户端请求中发送的对象 ID 来利用易受对象级授权破坏的 API 端点。这意味着客户端可以从一个 API 端点请求他们不应该访问的信息。这种攻击通常会导致未经授权的信息泄露、数据修改或破坏。

攻击场景示例:

比方说，有一个电子商务平台向一组不同的在线商店(店铺)提供金融和托管服务。该平台提供了一个 API，用于访问每个托管商店的收入图表，每个商店应该只能访问自己的收入图表。但是，在检查来自希望访问自己的收入图表的单个商店的客户端请求时，攻击者可以识别(找到)这些收入图表的 API 端点并识别正在使用的 URL，例如/shop/{ shop name }/revenue _ data . JSON。使用电子商务平台上托管的其他商店的名称，攻击者可以创建一个简单的脚本来修改后续请求中的{shop name} ID 对象，并获得对所有其他商店的收入图表的访问权限。

## API 2:2019–身份验证失败

与上面讨论的授权不同，另一方面，认证是一种复杂且令人困惑的 API 机制。由于身份验证端点被设计为向任何人公开，因此负责用户身份验证的端点必须与常规 API 端点区别对待，并针对[凭据填充](https://en.wikipedia.org/wiki/Credential_stuffing)尝试以及暴力密码和令牌猜测攻击实施额外的保护层。

攻击场景示例:

假设攻击者从另一个组织获得了一个泄露的用户名/密码组合列表，这是数据泄露的结果。如果处理认证的 API 端点不实现强力或凭证填充保护，例如验证码、速率限制、帐户锁定等。，攻击者可以反复尝试使用用户名/密码组合列表来获得访问权限，以确定哪种组合有效。

## API 3:2019–过度的数据暴露

根据设计，API 端点通常会公开敏感数据，因为它们经常依赖客户端应用程序来执行数据过滤。攻击者通过嗅探流量来分析响应，寻找不应暴露的敏感数据，从而利用此问题。在呈现给用户之前，这些数据应该在客户端应用程序上进行过滤。

攻击场景示例:

图片基于物联网的摄像头监控系统允许管理员添加一名新雇用的保安作为系统用户，管理员希望确保新用户只能访问特定的摄像头。这些摄像头可以通过保安在工作时使用的移动应用程序访问。新雇佣的保安人员的移动应用程序向端点发出 API 请求，以便接收关于摄像机的数据，并依靠移动应用程序来过滤保安人员可以访问的摄像机。虽然移动应用程序只显示警卫可以访问的摄像头，但实际的 API 响应包含所有摄像头的完整列表。利用嗅探到的流量，攻击者可以操纵 API 请求来显示所有摄像头，绕过移动应用程序上的过滤。

## API 4:2019–缺乏资源和速率限制

通常会发现 API 端点没有对 API 请求的数量实施任何类型的速率限制，或者它们没有限制会消耗大量网络、CPU、内存和存储资源的请求类型。满足请求所需的资源量很大程度上取决于用户输入和端点业务逻辑。攻击者利用这些问题导致拒绝服务攻击和相关的端点中断。

攻击场景示例:

假设攻击者想要对包含大量用户的某个 API 造成拒绝服务中断。可以查询用户列表，但是应用程序将可以显示的用户数量限制为 100 个。对应用程序的普通请求应该是这样的:/api/users？page=1&size=100。在这种情况下，请求将返回第一页和前 100 个用户。如果攻击者将 size 参数从 100 更改为 200，000，这可能会导致后端数据库出现性能问题，因为使用的 size 参数太大了。因此，API 变得没有响应，并且无法处理来自该客户端或任何其他客户端的进一步请求。

## API 5:2019–功能级别授权中断

虽然与上面的 API1 不同，但利用此问题需要攻击者向他们不应访问的端点发送 API 请求，但却暴露给匿名用户或普通的非特权用户。这些类型的缺陷通常很容易被发现，并允许攻击者访问未经授权的功能。例如，管理功能是这类攻击的主要目标。

攻击场景示例:

为了进一步说明这一点，设想在向某个只允许被邀请的用户加入的应用程序注册的过程中，移动应用程序触发一个 API 请求来获取/api/invites/{invite_guid}。GET 是一种标准的 HTTP 方法，用于从特定的资源请求信息。在这种情况下，对 GET 的响应包含关于邀请的详细信息，包括用户的角色和电子邮件地址。

现在，假设攻击者复制了请求，并通过将 GET 改为 [POST](https://www.w3schools.com/tags/ref_httpmethods.asp) 来操纵 HTTP 方法。POST 是一种 HTTP 方法，用于发送创建或更新资源的信息。URL 应该是这样的:POST/API/invites/new/{ " email ":"[【电子邮件保护】](/cdn-cgi/l/email-protection)，" role":"admin"}。在这种情况下，攻击者很容易利用这个问题，并向自己发送电子邮件邀请，以创建一个管理员帐户。

在上述五种风险的背景下，人们很容易想象出许多类似的攻击场景。这些只是攻击易受攻击的 API 实现时几乎无限可能性的例子。如您所见，上述风险主要是由错误或疏忽造成的。我相信当组织改进他们的安全编码实践时，这些风险可以很容易地被管理或几乎消除，特别是当涉及到他们利用 API 的方式时。

— [埃雷兹·亚隆](https://devops.com/author/erez-yalon/)