# 优步 API 授权漏洞

> 原文：<https://devops.com/the-uber-api-authorization-vulnerability/>

## 发生了什么

2019 年 9 月，在优步 API 上发现了一个严重的错误[，该 API 允许商家、服务提供商和其他人向客户提供拼车服务。优步暴露了一个易受攻击的应用程序编程接口(API)端点，使得攻击者能够窃取有价值的数据，包括乘客和司机的个人身份信息(PII)记录和认证令牌。泄露的身份验证令牌可用于执行完全的帐户接管。](https://appsecure.security/blog/how-i-could-have-hacked-your-uber-account)

幸运的是，该公司在造成伤害之前就发现了这个漏洞。但这个案例是一个传统安全系统无法发现潜在威胁的例子，因为它们缺乏应用程序逻辑的业务环境。让我们更仔细地看看发生了什么，以及其中的含义。

## 技术细节

当一个新的优步司机通过推荐链接加入平台时，他们的浏览器与 API 主机“**bonjour.uber.com**”通信。注册过程触发对 API 端点的 API 调用:

`POST /marketplace/\_rpc?rpc=getConsentScreenDetails`![](img/6759db04504659f0575c96e327522853.png)

API 从客户端接收“ **userUuid** ”参数，并返回关于用户的详细信息。此信息用于填充客户端的同意屏幕:

![](img/eff88a2479773e2b9a997d12d526b69e.png)

作为合法流程的一部分，用户应该只发送自己的用户 ID。

API 端点易受两种类型的 API 漏洞的影响:

*   [**【BOLA】**](https://link.medium.com/mEhK8kjIBdb)**。**因为程序没有验证发送请求的客户端是否可以访问由用户 ID 参数表示的用户，所以客户端可以通过更改用户 ID 来访问其他用户的数据。
*   **数据暴露过多**。API 响应包含一个包含所有用户详细信息的大型 JSON 对象。API 返回了这个信息，即使客户端没有使用它。

## 为什么当前的安全解决方案无法检测到这一点

当我们仔细观察漏洞利用流程时，我们发现攻击涉及 API 调用中非常微妙的变化，用另一个用户 ID 替换一个用户 ID。为了检测流量中如此微小的变化，需要对应用程序的业务逻辑有深刻的理解。

目前市场上的安全解决方案缺乏这种理解，通常是在单个 HTTP 请求的上下文上操作。他们没有深入了解检测 BOLA 和其他授权漏洞所需的应用程序的重要组件。

## 可追溯 AI 如何解决问题

检测 API 攻击的可追踪防御 AI 方法与其他安全解决方案非常不同。简而言之，它在数据通过应用程序的 API 和微服务时观察数据。然后，它使用机器学习算法来发现应用程序的业务逻辑，提供对用户及其角色、他们与之通信的 API 端点以及端点在幕后交互的资源的全面可见性。

这种方法允许 Traceable 创建合法用户流量的基线，从而检测最复杂和最微妙的 API 攻击，包括 BOLA。

## 有兴趣了解更多吗？

观看我们录制的演示和[看到可追溯的国防人工智能在行动](https://www.traceable.ai/view-traceable-demo)！