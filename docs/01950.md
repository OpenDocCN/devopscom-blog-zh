# ITOps 的混沌工程

> 原文:[https://devops.com/chaos-engineering-for-itops/](https://devops.com/chaos-engineering-for-itops/)

混沌工程(CE)是一门在系统上进行实验的学科，目的是建立对系统承受生产中动荡条件能力的信心。这种方法在软件开发和操作(DevOps)实践中越来越常见。但是它的应用如何扩展到 ITOps 呢？CE for ITOps 提供了一个类似的框架，用于对技术平台进行压力测试，以了解其在巨大压力下的弱点和性能缺陷。

CE 倾向于在 bug 测试期间主要用在 DevOps 中:设置实验以在不同的条件下运行软件，例如高峰流量，并监视它如何工作和执行。这在基于云的系统中变得越来越必要，在这些系统中，未能理解极端负载响应可能导致失控的级联故障，或者更糟糕的是，在不做任何实际工作的情况下，启动数千个额外的节点来处理错误情况。这些应用于 IT 运营管理(ITOM)的相同原则有助于定义基础设施、政策和流程的功能基线和容差，方法是在达到极限时阐明稳态和混沌输出。

## **IT 中的应用**

DevOps 中的 CE 理论在网飞获得了早期的关注，因为他们从物理基础架构转移到了虚拟基础架构，在 AWS 上实施该理论的团队解散并成立了 [Gremlin](https://nam11.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwww.gremlin.com%2Fcommunity%2Ftutorials%2Fchaos-engineering-the-history-principles-and-practice%2F&data=02%7C01%7C%7C617f24935b174a18889108d724eec805%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637018480277954630&sdata=DpbCHqeMf%2FDcyVNUMPmQ4i1FLH9Mpynium9Dsu%2B%2BCn8%3D&reserved=0) 。然而，CE 通常不用于 ITOps，因为 ITOM 在历史上与开发是分开的(通常，它监控系统动态，当问题发生时，工程变更管理或 ITSM 被引入来补救问题)。

随着当今云应用中容器化的增长，IT 基础设施看起来更像开发环境，而不是传统的多层架构。但是，云的无限规模意味着故障也可能是无限的:微服务通过测试弹性和可伸缩性、数据流和弹性得到了很好的服务，方法是在公开崩溃之前将系统加压到其容忍的边缘并修复其缺点。

## 一、二、三……混乱

为 ITOM 实施混沌工程提供了一个系统的方法来识别微服务世界中的弱点。在单一环境中，您可以了解微服务设计可能会丢失的性能和事件指标。因此，在扩展到未知工作负载时，对运营洞察力的需求变得更加重要。

网飞的[混沌猴](https://netflix.github.io/chaosmonkey/)源自他们自己的云原生社区的 CE 原则，旨在解决普通开发工具管理极端复杂性的能力差距。这种方法可以扩展到基础设施，并有助于从整体上为平台行为设置防护。

这里有五个基本步骤，可以将这种思想引入你的团队的 ITOM。

## 定义当前的稳定状态

执行基线分析是容量规划、升级策略和其他高效功能中的标准概念。从相对简单(和小)的事情开始，这样你就不会被数据淹没，或者在出现问题时有干扰业务的风险(例如安全[红队](https://www.csoonline.com/article/2122440/emergency-preparedness-red-team-versus-blue-team-how-to-run-an-effective-simulation.html))。例如，监控 CPU 和网络利用率，这是任何 IT 商店中常见的瓶颈。

## 定义最佳条件

有你的系统一般如何操作，然后有它应该如何操作；这些通常不是一回事。CPU 利用率和网络延迟总是受到应用程序效率、硬件条件和许多其他因素的影响。创建一个标准，概括工程师在平常、轻松和艰难的日子里应该期待什么。这些是对照组，极端的一天将是压力测试。

## 形成假设

系统会在哪里崩溃？如果您正在运行一个应用程序场景，例如将峰值流量增加一倍，即使是迄今为止最糟糕的一天，您的 CPU 是否会像可变控制组一样保持最佳利用率(或者容器供应引擎是否会平稳地部署额外的节点),或者它是否会因为没有足够的内存或网络带宽来管理负载而出现严重的峰值，从而导致进程停止？

## 执行真实世界的事件(但包含爆炸半径)

做一些极端的事情，比如拆除防火墙，切断与一家互联网服务提供商的连接。这将使应用程序感到困惑，因为它试图以重复失败来响应请求，当错误从失效的网络端点返回时，加速 CPU 进程。日志事件将会增加，填满数据库并使主干网饱和。

## 验证假设

发生了什么事？在测试过程中监控利用率和网络吞吐量，并查看系统发生故障的地方。这是你所期待的，还是之前从未想过的事情发生了？您的基础架构中是否出现了新的混乱？稳定、记录和补救。

## 永不停止不害怕

对系统施加最大压力——再进一步——以查看哪里出了问题，可以让您了解稳态行为和错误处理，这样您就可以在事情以新的和意想不到的方式发生之前修复它。流量峰值是什么样子的？什么是真实世界的事件及其对您组织的影响？

CE 不仅仅是 DevOps 的。负载测试(在你的舒适区之外)到失败点应该是一个系统的实践。这不仅仅是微服务部署的责任，还适用于 It 组织内的所有学科。

迈克尔·费舍尔