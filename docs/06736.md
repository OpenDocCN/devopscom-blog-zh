# 配置即代码的利与弊

> 原文:[https://devo PS . com/the-pros-and-cons-of-configuration-as-code/](https://devops.com/the-pros-and-cons-of-configuration-as-code/)

配置即代码，或许多人现在称之为“GitOps ”,是一个简单但令人震惊的想法:标准化配置，将其纳入版本控制；不需要每个运营/开发人员开发自己的一套脚本来完成工作。假设配置中的所有内容都经过测试，配置或重新配置环境就像检验和运行一样简单。对于一个项目或一个团队来说，这是一个重要的时间节省器，并限制了引入我们系统的人为错误。对于频繁推出代码的项目，这是非常必要的。

但是像所有事情一样，它也有它的局限性。我曾经和一个产品管理工程师一起工作过，他编写了一个有数万行代码的脚本，和他用来管理的产品一样复杂。他的场景是典型的代码配置的前身:他会展示产品，他需要的任何功能都可以通过他的脚本来管理。问题在于维护；由于剧本对他的工作至关重要，因此对它的修改是一件大事。尽管他是唯一一个维护它的人，但他确实因为自己所做的改变而被烧伤了几次，因为它太复杂了。

当我们的“按代码配置”开始跨团队时，或者我们将它带到企业级别时，我们就有发现其局限性的风险。我们的环境很复杂，非常复杂。我们可以用代码配置做很多事情，但是把所有东西和厨房水槽都扔进这个系统会产生我们需要克服的问题。

单个项目受到限制。我们知道我们需要做什么来改善环境。我们可以找出弱点，并围绕它们建立制衡机制。

企业环境不是一个项目。敏捷项目和开发运维蓬勃发展，因为他们有一个稳定的工作环境来运行。存储分配、路由和 VLANs 等方面的变化量并不是敏捷项目所看到的变化量。好的文档和配置一样是可靠的解决方案，因为代码很少改变，需要维护的脚本和配置的规模/数量更小。

出于恢复目的，公司范围内的代码配置是一个很好的用例。如果您拥有所有配置和安装该配置的脚本，那么在灾难中恢复环境会容易得多。不幸的是，随着技术的进步，这个用例被最小化了。在我参与(负责)的一次全面破坏恢复中，我们的许多配置不再可用，因为灾难发生时我们在生产中运行的产品不是我们可以购买用于重建的产品。我们最终得到了一个从建筑到服务器的全新数据中心，但它仍然涉及大量的手动配置。因此，尽管用例很好，但它不是万灵药，除非您不断地用最新的产品替换您的基础设施，这也限制了这个用例的有用性。

一些组织已经通过诸如混沌工程之类的方法转移到配置即代码，但是我们大多数人刚刚开始考虑将配置即代码转移到项目级别之外。当真正将基础设施管理转向“配置即代码”这一步(不可否认是很大的一步)时，从盘点您的运营团队每天都在做什么开始。有很多事情——著名的唾手可得的果实——可以归结为脚本或标准化的配置，并被检查到版本控制中。这为如何配置事物提供了一个核心要点，在出现问题时跟踪更改，并通过为新开发人员/运营人员提供一个工具库来审查和使用，缩短了他们的启动时间。当在云中工作时，一切都是可脚本化的，所以使这方面的操作完全是配置即代码。在数据中心，在日常任务自动化后，您最终会得到递减的回报，但指派某人来整理所有可能的更改是一个有价值的目标，只要工作被优先化，以使最频繁或最容易出错的配置问题成为优先事项。一旦焦点转移到硬件上，这些投资小时的回报率就会下降一点，因为专用硬件充满了专有的或以市场为中心的配置信息。举一个我熟悉的比较:F5 ADC 有非常特殊的用例，必须集中重新配置，而恢复您的 Kubernetes 集群通常需要较少的配置，开发容器的团队将从那里开始。不是说 Kubernetes 配置简单；但是每个项目处理他们需要的细节，而公司共享的资源往往需要基础设施团队处理所有的细节。

我们可以详细讨论这个问题，我也和其他人有不同的想法，但是小工具更好。做一件事，并把它做好——最初的 Linux 咒语——然后编写调用小的脚本。这包含了随着时间的推移而发生的变化，并且不会产生依赖性，也不会触及在给定情况下可能不需要它的东西。

继续摇摆。“按代码配置”所做的一切都是为了减少人为错误的工时和机会，所以拥抱它，但要控制它。不要把所有东西都扔在那里，然后就忘了它。制定一个计划，制定一个维护计划。迭代。提高。并利用这些额外的时间来解决用户问题，这也是我们来到这里的原因。