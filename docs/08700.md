# 持续播客:你如何处理你的数据？

> 原文：<https://devops.com/continuous-deal-data/>

欢迎来到 To Be Continuous，这是一个关于持续交付和软件开发的节目，由 CircleCI 的创始人 Paul Biggar 和 LaunchDarkly 的首席执行官 Edith Harbaugh 主持。伊迪丝·哈伯格和保罗·比格与[彼得·范·哈登伯格](https://twitter.com/pvh)谈论组织结构、数据库和定价背景下的持续交付。

彼得是 Heroku Postgres 产品团队的联合创始人。三年多来，他一直负责设计、开发和运营世界上最大的 Postgres 数据库集群。他知道如何让数据库运行，保持它们的安全和快速运行。

这个播客是由 heavy bit(T1)为您带来的，这是一个帮助开发者创业公司将其产品推向市场的计划。

[soundcloud url=”https://api.soundcloud.com/tracks/241491956?secret_token=s-oZ2T7″ params=”auto_play=false&hide_related=false&show_comments=true&show_user=true&show_reposts=false&visual=false” width=”100%” height=’166′ iframe=”true” /]

**Paul:**Peter，按照传统，我问你，你最喜欢连续交付的哪一点？

**Peter:** 嗯，我越来越老了，我做过很多工作，所以我记得向市场提供 Gameboy 墨盒，Gameboy 墨盒是一种进入 Gameboy 的物理设备，因此得名，这一过程涉及物理制造，你只有一次机会，所以有大量基本上浪费的和不好玩的能量用于确保你永远不会出错。

关于持续交付，我最喜欢的是犯错误并继续前进的能力。

保罗:很好。

伊迪丝:这是你自我介绍的好时机。

彼得:你好，我叫[彼得·范·哈登伯格](https://twitter.com/pvh)。我是一个 [Heroku](https://www.heroku.com/) 的老前辈，我加入 Heroku 已经有六年了，我是 Heroku Postgres 团队的创始人之一，从那以后我开发了很多产品。

伊迪丝:你在谈论游戏机很有趣，因为保罗和我正在谈论这个。

**彼得:**关于 Gameboys。

伊迪丝:因为我说过，推动 Zynga 崛起的因素之一是持续的交付。

保罗:这是我们发现的第一件关于持续交付的不好的事情。

彼得:所以我想他们可能还在某个地方不停地送货。在天上的伟大创业中。他们还在附近，不是吗？

保罗:它们仍然存在，仍然是公开的，

我敢肯定，Farmville 永远不会消失。

保罗:我想他们已经转移到其他不太重要的事情上了。

**彼得:**开发者工具。

保罗:想象一下。

**彼得:**游戏化的开发者。事实上，这就是现在所有开发工具的发展方向。

**伊迪丝:** [Github](http://www.gitpoints.com/) 游戏化。你有多少只鸡，你能把它们做成一个漂亮的图案吗？

保罗:新手表。

这有点像一场游戏，只不过如果你输了这场游戏，你就会丢掉工作。

保罗:或者你就是找不到新工作。

彼得:嗯，这实际上可能更准确。是的，如果他们因为你没有足够长的承诺期而解雇你，那将是一家奇怪的公司。

保罗:在开源项目上，这不是你的工作。

彼得:我喜欢这个，实际上，让我们把它变成一个游戏。

Paul: 我们在上一集也谈到了开源融资模式，或者说是对缺乏开源融资模式的愤怒。

彼得:那是一个很难解决的问题。

保罗:那会是一个有趣的问题。如果你没有足够的捐款，你就会被解雇。

彼得:是的，就把它放在你的季度回顾里吧，最新的 Github streak。

保罗:让我们把这个建议放到黑客新闻上，看看人们是否同意。我能想象出接下来会发生什么。

彼得:我尽量不去看评论。

伊迪丝:那么，你认为什么是对犯错能力的解放？

**Peter:** 嗯，我的意思是，比犯错能力更重要的是尝试的能力，对吧，我是说我们，我现在已经习惯了能够看到非常详细的信息，因为有了 SaaS 模型，我的产品在市场上的真实情况，反之亦然，我可以反过来说，嗯，基本上是实时的，如果我们把一些东西放在那里，会发生什么，人们会关心吗？

对领养有帮助吗？是不是突然抛出一堆错误？如果出现问题，您可以非常快速地回滚。您知道，我们运行的是数据库产品，因此可用性非常非常重要，但只对服务中非常小的一部分核心而言。只要你的问题和中断是短暂的，人们通常会非常理解。

> 爆炸半径小，能迅速修复，我认为他们更喜欢在外围获得特性而不是稳定性。从核心上来说，他们需要的是稳定性而不是特性，所以，你知道如果你是一个 stripe，对吧，你需要保持在线支付处理，但是如果你的 API 的某个附属部分有问题，那可能不是什么大问题。

保罗:破折号部分不太重要—

彼得:对。

保罗:比付款要顺利。

**Peter:** 嗯，响应能力和进步非常重要，我认为因为我们处在一个如此变化的市场中，推动前进的能力至少与保持稳定的能力同样重要，但基本上你不能在同一个地方同时做到这两点，对吗？

> 我认为持续交付很酷，因为它是分开的，从某种程度上说，是一个缓慢移动的核心和快速移动的外围。

保罗:所以当你创建一个软件产品时，你真的希望它的每一个组件都是可持续交付的，这意味着你希望能够从你现在正在做的事情迁移到新的事情。

这很有趣，或者说数据库有一个有趣的地方，因为数据库，我认为，从根本上来说，不是为这种模式而建立的。

彼得:它们很重。

保罗:对。我们最近遇到了一个问题，我们删除了一个索引。

彼得:啊，是的。

保罗:哎呀，那个索引被使用了。我们以为它没在用，但它在用。

彼得:你应该用 [Heroku Postgres](https://www.heroku.com/postgres) ，它会告诉你的。

保罗:哦，这很有意思。所以，我想要的是能够，你知道，部分删除它，或者让我们在没有它的情况下运行所有查询，然后在一个小时后，我实际上可以删除它。Heroku Postgres 能给你什么？

**Peter:** 我们有许多诊断工具，可以帮助您准确了解索引的使用频率。此外，下次当你试图删除一个索引时，把它包装在一个事务中，比如说，开始，然后删除索引，然后做任何事情，然后说，回滚，这样，你实际上可以测试，就像你没有索引一样，因为 Postgres MVCC 模型意味着所有的东西都是完全事务性的。

保罗:所以，当你说在两者之间做所有的事情时，你是什么意思？

彼得:你想让它运行的任何查询。此外，我们将进入细节，然后在这里进行一些棒球，但您实际上可以具体禁用索引，也可以在会话级别禁用。

保罗:哦，有意思。这都是 Postgres 还是 Heroku？

彼得:是的，那只是 Postgres，我的意思是，我们围绕它建立了工具，这样你就可以用一种简单的方式来做这些事情，但是，我要告诉你，如果你读了那本 3000 页的 Postgres 手册，你会发现一些真正的精华。

保罗:那么，问题的一部分可能是使用了一个不是真正数据库的东西？

彼得:哦，你没有用真正的数据库？

保罗:我们没有—

彼得:哦，对了，我忘了。

**Paul:** 我的意思是我们正在使用一个真实的数据库，我们正在使用许多数据库，但是那个特定的数据库不在真实的数据库中。

彼得:你知道，即使是婴儿数据库也有一天会成长为真正的数据库。

保罗:是的，好吧，祈祷那个以 M 开头的特殊数据库，我们不会讨论它。

彼得:哦，我们不喜欢说任何事情的坏话。

保罗:不，不，一点也不，尤其是蒙哥。

伊迪丝:不，是你说的！

彼得:你说了那个 M 字！回到堆栈的每个部分的连续交付，是的，这很有趣，我的意思是我们在数据库方面遇到了一些有趣的挑战，实际上[不久前在 Heavybit](http://www.heavybit.com/library/video/2014-01-14-peter-van-hardenberg) 做了一个演讲，内容是关于我们如何在传统意义上将数据库视为服务的一部分，而更像一个工厂。

基本上，当人们向我们请求数据库时，我们会取消一个数据库，然后，你知道，我们会努力保持它的低熵，因此我们有许多围绕数据库的工具和支持服务，但实际的数据库本身，一旦它被提供给客户，我们大多会尝试不去管它。

现在，如果有安全问题或性能问题或任何其他问题，我们将进入，我们将预热它并做一些工作。但即使如此，我们还是更喜欢替换数据库。我们要做的是创建一个复制副本，提高它的速度，然后将负载转移给它。这是一种持续交付数据服务的形式，作为一种抽象，它的功能惊人地强大。

伊迪丝:所以你基本上是把它们当成牛，而不是宠物。

彼得:

> 哦，当然，这都是关于牛和模型，当你饲养一大群牲畜时，你真的不能给每一只都赋予它们自己的个性。

Paul: 这让我想起了很多，我想，开始是 IMVU 的数据迁移方式，不好意思，是在不锁定整个表的情况下进行模式迁移。对于我们国内的人，我来描述一下这个。

所以当你想添加时，假设你想添加一个新值，它有一个默认的模式中的特定表。如果它是一个特别大的表，在这种情况下，它可能会被锁定。至少过去是这样，我认为现在现代数据库在这方面做得更好。

**Peter:** 我相信对于一些默认值，现在的情况是你不需要做表锁，但可能会推到 9.6 或 Postgres，至少，但这是一个常见的和具有挑战性的操作。

**Paul:**IMVU 开始做的不是添加一个模式，他们说对于每个表，该模式是不可变的，相反，他们创建了一个新表，然后他们从该表迁移数据，所以每次你想从用户读取时，你现在从用户表 38 读取，然后你开始从用户表 39 读取。如果用户不在用户表 39 中，

彼得:你又回到了 38 岁。

保罗:回到 38，找到它，迁移它，写入 39，然后做这件事。然后你有一个后台流程。

**Peter:** 如果你有任何从互联网世界收听的听众，并且想尝试为自己实现这种技术，Postgres 有一种叫做模式搜索路径的东西，所以你可以实际上，基本上使每个模式成为它自己的版本，然后你有一个搜索路径，所以如果表不是在最新版本中，它将使用最新版本的搜索路径。

保罗:哦，哇。

**Peter:** 你可以在代码上设置一个版本，基本上，当你创建新版本的表和新模式时，你可以将它们向前推进。这听起来很有可能行得通。现在，在美丽的旧金山，坐在桌旁说这些真的很容易，但是如果你有听众想尝试一下，让他们给我发个短信。

Paul: 我没想到这是一个关于连续交付数据库和 Postgres 现代版本复杂性的会议。

彼得:我不得不说，最难的事情之一就是，你如何处理你的数据？我的意思是，数据从根本上来说是很重的，我的意思是我认为它是有质量的，也就是说，如果你在某个地方的磁盘上有几 TB 的数据，仅仅是将它从那个服务器转移到另一个服务器上就需要几个小时。

保罗:对。

**Edith:** 好的，只是查询数据，将其全部加载到内存中，这需要时间，因此这对于连续交付来说确实是一个挑战，人们已经尝试了各种模式版本化和复制策略以及分片策略，但是，你知道，老问题是，好吧，你部署了新版本的代码，它需要新列，但是新列还没有出现。好的，你把数据移动到新的列，然后你部署你的代码，但是旧的代码没有它。

保罗:对，对。

彼得:

> 这些都是很难的问题，没有人在回答这些问题上做得很好。到目前为止，最先进的技术是，你不断地部署支持两种模式的新版本代码，然后不断地迁移数据库，再部署另一个版本。

现在，如果没有持续部署，这将更加困难—

保罗:这对于一款 Gameboy 卡带来说一定很难。

彼得:哦，是的，让我告诉你，我认为我们有 4k 的内存或类似的东西，所以至少它很快。但是，是的，我认为数据和持续交付确实都是具有挑战性的交互。

**Paul:** 当大客户，尤其是大企业使用旧的测试方式时，我们最终会遇到这个问题，这种方式实际上是使用生产数据库的转储作为测试套件的一部分，当我们看到进入新世界的老公司时，我们遇到的一个主要挑战是，你的服务器在这里，我的服务器在那里，我想将 5gb 的数据库转储到你的服务器上来运行我的测试，我该怎么做？

彼得:没错，它试图用吸管移动浴缸。那你是怎么做到的呢？你就等着，好吗？

保罗:我们一直等到他们停止这样做，然后他们就可以成为我们的客户。

伊迪丝:那你会拒绝顾客吗？

**Paul:** 我们不会拒绝他们，但我们并不真正支持这种使用情形，他们会有一种痛苦的体验。

**Peter:** 我的意思是又有数据迁移了，对，回到物理问题上来。有些事情正在好转，

**保罗:** [光速](https://en.wikipedia.org/wiki/Speed_of_light)在提高？

彼得:你知道吗？去年光速上升了 13%。

保罗:我不知道你是不是在开玩笑，我想你不是。

彼得:绝对没有，是的。他们称之为常数是有原因的。我想可以。

保罗:我想可能会有一些关于，

彼得:暗物质，没有，但我说的方式很有说服力，不是吗？

**伊迪丝:**像这样就是兴登堡原理？

彼得:还不确定。所以不管怎么说，逻辑复制场景越来越好了。亚马逊刚刚推出了一项新服务，它有三个字母长。

保罗:哦，真的吗？

彼得:是的，嗯，知道了，等一下。数据迁移服务。因此，通过黑魔法，可能通过不太好的工作，它会把你所有的数据从一个数据库转移到另一个数据库，以一种在线流的方式，如果它工作的话，真的很酷。

保罗:好的。

彼得:但是，你知道，从甲骨文转移到 MySQL

**Paul:** 所以你可以像使用 MySQL 一样使用这个服务，它会从——

**Peter:** 它的工作方式基本上是建立一个迁移作业，如果你想一想，它基本上是查询一个数据库并写入另一个数据库，这有点像黑客工作，因为如果你从本地机器上迁移，你必须运行桌面客户端。这很复杂，有点巴洛克风格，但是，

保罗:所以这是亚马逊的服务？我猜你以前没用过亚马逊。

**Peter:** 但是，是的，不，这是每个人一直想要的，那就是将他们的数据从一个地方移动到另一个地方，而不必考虑它，当然，这永远不会起作用。

保罗:好的。

彼得:但是，你知道，这会有帮助的，会有帮助的，事情会变得不那么糟糕。我认为最终是什么让我进入数据库的理解是，不管把事情变好是多么不可能，至少我们可以把它们变得不那么糟糕。

保罗:对。

保罗:编写软件这种令人心碎的痛苦至少可以稍微少些。

伊迪丝:我觉得写软件是生活中最大的乐趣之一，因为你可以从无到有地创造一些东西。

彼得:所以你不在数据库工作。

保罗:我不确定你是做软件的。

**伊迪丝:**那么你见过的持续交付最大的变化是什么？

彼得:哦，当然是无处不在。这些天很少见到有人，也许我足够幸运，我住在旧金山。

伊迪丝:你在 Heavybit 闲逛。

**Peter:** 我在 Heavybit 和一群[其他疯狂的人在一起](http://www.heavybit.com/members)但是我想我会说增长，对，我的意思是我们看到大企业在实践连续交付——我们看到小商店在实践连续交付，这不是一个尖端的概念，只有一小群前卫的开发者在做。真的，我认为这是主流。

[点击此处收听完整播客](http://blog.heavybit.com/blog/to-be-continuous-11)听 Peter 谈论组织结构、数据库和定价背景下的持续交付。