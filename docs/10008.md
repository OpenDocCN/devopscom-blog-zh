# 蓝绿部署:有哪些选择？

> 原文:[https://devo PS . com/blue-green-deployment-what-is-the-options/](https://devops.com/blue-green-deployment-what-are-the-options/)

蓝绿色部署是软件发布的[变更管理策略](https://devops.com/low-code-and-change-management-with-max-rudman/)。蓝绿色部署需要两个相同配置的硬件环境。一个环境是活动的，为最终用户服务，而另一个环境保持空闲。

蓝绿色部署通常用于对正常运行时间有严格要求的应用程序。首先，新代码被发布到试运行环境并经过全面测试。审查完代码后，团队调整路由器配置，将应用程序流量重定向到登台环境。这个暂存环境随后成为生产环境。

如果在切换后发现问题，团队会将流量切换回旧的生产环境，并继续运行原始版本。一旦新代码在生产中得到验证，团队就可以在空闲的生产环境中更新代码，并使用它来测试下一个版本。更多背景信息，请参见[这篇关于](https://codefresh.io/learn/software-deployment/what-is-blue-green-deployment/)[蓝绿部署模式的详细博客](https://codefresh.io/learn/software-deployment/what-is-blue-green-deployment/)。

### 蓝绿色部署优势

以下是蓝绿色部署的一些主要优势。

**备用系统**
蓝绿色部署总是确保服务器处于备用状态，在系统出现故障时提供关键的备份。除了便于软件更新之外，这种方法还改善了风险管理，允许您在恶意软件入侵期间切换到备份服务器。

将流量重定向到另一个系统版本很容易，因为它具有相同的基础结构。当团队修复问题时，系统可以保持活跃和正常运行。

平稳、快速发布
蓝绿色部署允许产品所有者快速将软件投入生产。它提供了随时发布更新的灵活性，不需要停机。最终用户感觉不到每个版本的影响。DevOps 团队也可以从平稳的发布中受益，因为他们不必为了满足预定停机的最后期限而竞争。

**简单的回滚过程**
在蓝绿色部署中，回滚更新也很快。简单的回滚降低了在生产环境中进行试验的风险。您可以通过将应用程序设置为只读或使用负载平衡器在转换期间处理活动事务来实现回滚。这对 Kubernetes security 来说意义重大，因为如果在集群中发现安全漏洞，您可以轻松回滚到以前的安全版本。

**无停机时间**
蓝绿色部署可让您避免停机时间，无论是计划内的还是意外的。在维护检查和修复期间，您可以将用户转移到另一个模型。升级可以在任何时候进行，因为不需要等待流量较低的时间(即午夜)。

**生产测试**
生产测试允许你检查一个真实产品的功能，展示它在现实世界中的表现。这种方法的缺点是，它可能会在测试过程中让最终用户暴露于错误之下。蓝绿色部署允许您在非活动的生产环境中测试产品，从而最大限度地降低在活动环境中出现 bug 的风险。

### Kubernetes 的蓝绿色部署

许多开发团队正在迁移到 Kubernetes，作为开发、测试和生产部署的环境。Kubernetes 使部署应用程序变得容易，也可以用来自动化蓝绿部署。

但是，Kubernetes 不提供开箱即用的蓝绿部署。它有一个允许“滚动更新”的部署对象，这允许您通过用应用程序的最新版本逐步替换 pod，在不停机的情况下更新应用程序。

这类似于蓝绿色部署，但不能提供所有的好处。如果新版本出现问题，滚动部署会使回滚变得困难。您可能需要 [Kubernetes 健康检查](https://komodor.com/blog/kubernetes-health-checks-everything-you-need-to-know/)来确定部署中 pod 的状态。应用程序可能需要时间来推出，而纯蓝绿色模式允许您立即切换到新版本。

### Kubernetes 的蓝绿部署:有哪些选择？

**Argo Rollouts**
Argo Rollouts 是一套 Kubernetes 控制器和 CRD，为 Kubernetes 提供高级部署功能，如蓝绿色和淡黄色部署、实验和其他渐进式交付功能。

Argo Rollouts 可选地与 Kubernetes 入口控制器实现和服务网格集成，利用流量整形在更新期间将流量递增地切换到新版本。推出还可以查询和解释来自其他系统的指标，以验证关键 KPI，并自动提升或回滚版本。

Flagger 是一个渐进式交付工具，可以自动完成在 Kubernetes 上运行的应用程序的发布过程。它通过逐步将流量迁移到新版本，同时测量指标和执行一致性测试，降低了将新软件版本引入生产的风险。

Flagger 实施多种部署策略(金丝雀发布、A/B 测试和蓝绿色部署),并与各种 Kubernetes 入口控制器、服务网格和监控解决方案集成。

**GitLab CI/CD**
GitLab 是一个协作式 DevOps 平台，是大型软件开发项目的开源代码库。

除了代码库，GitLab 还提供 CI/CD 自动化和问题跟踪。GitLab 存储库允许托管不同的软件版本和整个开发管道，允许用户在出现意外问题时回滚软件和环境。

GitLab 使用渐进式部署(包括蓝绿色部署)支持手动触发部署和预定部署到 Kubernetes 生产系统。

CircleCI
CircleCI 是一个 CI/CD 平台，帮助工程团队构建、测试和部署软件，同时在仪表板 UI 中实时查看代码变更。

CircleCI 可以部署到几乎任何目标，并且可以轻松配置为与其他服务集成，用于部署策略，如功能标志、蓝绿色和金丝雀部署。它既支持全自动部署流程，也支持手动批准流程，能够轻松定制部署配置。

### 结论

在本文中，我解释了蓝绿色部署模式、它的好处，以及它如何为 Kubernetes 部署带来好处。我介绍了四种工具，可以帮助您在 Kubernetes 集群中实现蓝绿色部署:

● Argo 推广——开源 Argo 项目的一部分。包括 Kubernetes 控制器和 CRD，提供高级渐进式部署功能。flag ger——一个用于 K8s 的开源渐进式部署工具，支持 canary 版本、A/B 测试、blue-green 等等。
●git lab CI/CD–支持手动触发部署和对 Kubernetes 生产系统的计划部署。
●circle ci–支持部署到 Kubernetes 集群，部署策略包括功能标志、蓝绿色和金丝雀部署。

我希望这将对您学习在 Kubernetes 环境中实现渐进式部署模式有所帮助。