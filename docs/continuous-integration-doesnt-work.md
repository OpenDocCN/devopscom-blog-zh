# 为什么持续集成不起作用

> 原文：<https://devops.com/continuous-integration-doesnt-work/>

持续集成很容易。下载 Jenkins，安装，创建一个任务，点击按钮，然后得到一封漂亮的电子邮件说你的构建被破坏了(我假设你的构建是自动化的)。然后，修复损坏的测试(我假设您有测试)，并得到一封看起来更好的电子邮件，说您的构建是干净的。然后，发推特，声称你的团队正在使用持续集成。

在多个项目中见过多次。开始总是光明而顺利的。当构建再次被破坏时，问题就开始了，我们根本没有时间去修复它。我们只是在忙着做其他的事情，一些失败的单元测试不应该让我们分心。毕竟，我们都知道单元测试不适合有截止日期的团队，对吗？

不对。持续集成能够而且必须发挥作用。最新的构建应该总是干净的。一直都是。

# 什么是持续集成？

现在，软件开发是团队完成的。我们在[特性分支](http://martinfowler.com/bliki/FeatureBranch.html)中开发，并在开发过程中隔离变更。然后，我们将分支合并到`master`(假设使用 Git)。每次合并之后，我们测试整个产品，执行所有可用的单元和集成测试。这就是所谓的[持续集成](https://en.wikipedia.org/wiki/Continuous_integration)，缩写为 CI。

有时，一些测试会失败。当这种情况发生时，我们说我们的“构建被破坏了”。这种失败是质量控制的一个积极副作用，因为它在错误进入`master`后立即引发了一个红色标记。这是一种众所周知的做法，当修复错误成为作者和整个团队的首要任务时。持续集成服务器发出红色标记后，应立即修复该错误。

**#为什么持续集成不起作用？**

CI 很棒，但是团队(和代码库)越大，构建就越容易崩溃。修复它们的时间越长。我见过很多这样的例子，一个努力工作的团队在几周之后开始忽略 Jenkins 提出的危险信号，或者试图跟上。

团队变得无法及时修复所有错误。主要是因为企业有其他优先事项。产品所有者不理解“干净的构建”的重要性，技术领导者不能购买时间来修复单元测试。此外，破坏它们的代码已经存在于`master`中，并且在大多数情况下，已经被部署到生产环境中并交付给最终用户。如果商业价值已经交付，修复一些测试的紧迫性是什么？

最后，大多数开发团队都没有认真对待持续集成警告。詹金斯或特拉维斯对他们来说只是花哨的工具，在整个开发和交付过程中不起任何作用。不管持续集成服务器怎么说，我们仍然向我们的最终用户提供新的特性。我们稍后会修复我们的建筑。这是符合逻辑的。

什么是解决方案？

我提出的解决方案很简单——禁止任何人将任何东西合并到`master`中，并创建任何人都可以调用的脚本。该脚本将进行合并、测试和提交。该脚本不会有任何例外。如果任何一个分支在单元测试中被破坏，整个分支都将被拒绝。

换句话说，我们应该在代码进入`master`之前升起红旗**。我们应该把失败的测试归咎于其作者。**

比方说，我正在自己的部门开发一个功能。我完成了开发，坏了几个测试，不小心。它发生了，我们都会犯错。我无法将我的更改合并到`master`中。Git 干脆拒绝了我的`push`，因为我没有合适的权限。我能做的就是调用一个神奇的脚本，让它合并我的分支。该脚本将尝试合并，但在推入`master`之前，它将运行所有测试。如果其中任何一根断了，我的树枝就会被废弃。我的更改不会被合并。现在是我的责任——修复它们并再次调用脚本。

一开始，这种方法减慢了开发速度，因为每个人都必须开始编写更简洁的代码。不过，这种方法最终会带来巨大的回报。

在我的项目中，我使用 www.rultor.com，一个免费托管的 DevOps 服务，自动完成这个合并操作。本文解释了它的用法:[Rultor.com，一个合并机器人](http://www.yegor256.com/2014/07/24/rultor-automated-merging.html)。我很乐意回答你的问题，请发邮件给我。