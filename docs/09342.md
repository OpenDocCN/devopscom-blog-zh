# GraphQL 是否引入了新的安全风险？

> 原文:[https://devo PS . com/does-graph QL-introduce-new-security-risks/](https://devops.com/does-graphql-introduce-new-security-risks/)

GraphQL 查询语言是增加数据共享便利性的优秀工具。前提是您在单个绑定请求中请求您需要的字段，避免多个网络调用。由于其可用性，GraphQL 是一个不断发展的领域。然而，就像任何新技术一样，它也伴随着警告。

REST APIs 作为一个请求-响应范例，其中接收者一次访问一个资源。另一方面，GraphQL 一次公开许多字段，需要额外的速率限制和超时来避免恶意查询。此外，攻击者可能会滥用遍历整个模式的能力来暴露复杂的数据链接。GraphQL 还有一些可用性特性，如果配置不当，可能会被滥用。

GraphQL 是 REST 的友好替代品。但是我们如何处理 GraphQL 的[安全隐患呢？我最近和 Fastly 的安全研究副总裁 Mike Benjamin 聊天，深入探讨了采用 GraphQL 的安全影响。下面，我们将考虑与 GraphQL 相关的独特的不安全性，并提出限制这些风险影响的具体步骤。](https://www.fastly.com/blog/exploring-the-security-implications-of-graphql)

## 四个 GraphQL 安全漏洞

### 1.反省

GraphQL 提供了内置文档，告诉开发人员字段是什么，提供了您可以查询的所有内容的模式。您实际上已经将整个数据集模式交给了开发人员，这意味着他们可以执行自省来捕获攻击面信息。Benjamin 解释说，黑客通常会寻找他们可以利用的注入或变异能力。或者，他们可能会寻求利用数据之间的相互联系来绘制通往机密信息的路径。

为了缓解这个问题，Benjamin 警告不要过度公开所有文档。相反，他建议对外部观众使用限制性的安全模式。“用不同的方法提供适当的用户文档，”他说。这可能最终看起来更像文档的标准 [REST API 视图。](https://nordicapis.com/5-examples-of-excellent-api-documentation/)

### 2.现场建议

GraphQL 的另一个可用性优势也可能是一个潜在的安全问题——字段建议。当您没有输入正确的字段名或输入部分输入，系统返回提示时，会出现字段建议。您可以输入`0`或`user`，系统会建议您填写字段的其余部分。

Benjamin 说，这种用户交互改善了开发者的体验，但不幸的是，它可能被黑客滥用。因此，他建议在初始开发后禁用提示。或者，如果你决定保留它，他建议限制它的使用。例如，如果你一秒钟内尝试五次以上，系统会将其标记为机器人。

目前，这种攻击媒介相当有限，但本杰明预计，随着时间的推移，黑客可以通过大规模扫描仪自动进行这种内省，从而泄露更多信息。

### 3.面向拒绝服务的攻击

如果没有适当的防护，所有的 web APIs 都容易受到拒绝服务(DoS)攻击。这种攻击可能会以每秒一百万次的查询来彻底关闭服务。在 GraphQL 的情况下，这些查询可以深入到嵌套数据关系中。例如，社交网络可能会暴露用户的朋友、用户朋友的朋友等等。

或者，黑客可能利用 GraphQL 的批量查询能力来执行侦察，强行枚举数据来查询数百个用户 id，以查看哪些是有效的。如果您允许在单个请求中捆绑无限制的数据检索，您可能会邀请数百个捆绑的查询，这些查询可能会一下子暴露大量底层数据库。

为了应对这些行为，本杰明建议限制测试深度。这可能涉及到对一个查询可以运行多长时间进行限制，这将导致需要高度处理的请求超时。本杰明说，另一个选择是限制捆绑销售的深度。例如，也许系统限制深入到图形数据库的三个层次，因为这可能会暴露数百万个互连的端点。

### 4.缺乏对象级授权

Benjamin 说，GraphQL 端点可能容易出现的另一个漏洞是缺乏对象级授权，黑客可以利用这一点通过边缘获取数据点。因为这个想法是您可以从一个无所不包的端点访问任何数据，所以授权规则通常太抽象了，脱离了实际数据。查询也可以访问嵌套数据或数据之间的查询关系，这可能会无意中泄露信息。

Benjamin 建议将授权放在离对象或数据更近的地方，以解决这个问题。使用授权级别的控制，使权限结构和角色与用户保持一致。“每个人都需要一个通用的授权模型，”本杰明说。

## 未来发展:GraphQL 安全性成熟

正如我之前所写的，GraphQL 最大的优点也是它最大的缺点。使用默认设置的 GraphQL 是一种有利于可用性的安全性权衡。但是根据 Benjamin 的说法，我们看到越来越多的 GraphQL 服务器禁用了一些自省特性，他认为这是一个非常积极的举措，也是基本配置成熟的标志。

GraphQL 可能会遭受所有 API 都容易受到的类似威胁，如 XSS、注入、DDoS 攻击和[破坏授权](https://github.com/OWASP/API-Security/blob/master/2019/en/src/0xa1-broken-object-level-authorization.md)。然而，Benjamin 强调 GraphQL 增加的复杂性使它成为一个特例。“人们要考虑的最重要的事情是，GraphQL 比 REST 端点更复杂——复杂得多，”Benjamin 说。“GraphQL 的独特之处在于它具有数据链接，这增加了复杂性。这需要多一点时间来思考如何证实、如何呈现以及如何受到攻击。”

换句话说，权力越大，责任越大。

尽管公共 GraphQL APIs 中的漏洞仍然很少，但我们应该保持警惕。Benjamin 鼓励开发人员在设计他们的界面时继续阅读、理解和思考这些攻击载体，因为随着 GraphQL 使用的增长和黑客对这些特定漏洞的熟悉，这些风险将变得更加突出。