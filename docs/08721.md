# 编写自动化测试的 10 条规则

> 原文:[https://devops.com/10-rules-for-writing-automated-tests/](https://devops.com/10-rules-for-writing-automated-tests/)

最近几个月，我们的许多客户请求我们的指导，并正确地构建他们的测试套件。性能、易管理性和可扩展性是他们的首要考虑因素。我们决定与更多的观众分享我们的建议。

在构建我们自己的测试套件时，我们想出了这个列表。因为我们坚信 dogfooding，所以使用 Testim 测试 Testim。从小型创业公司到大型企业，我们在与各种公司的合作中也学到了很多东西。

## **规则 1:区分优先顺序**

大部分 app 都包含了成千上万的场景。测试功能和正确性仅仅是交付高质量软件和满足用户期望的一个步骤。还有性能测试(正常状态或负载/压力下的速度和响应能力)，视觉测试(检查 1+1 = 2 是一回事，但许多视觉错误会使它成为非常糟糕的体验)，等等。

首先列出最重要的用户流程，例如登录、加入购物车、结账等。根据对用户转化更重要的内容对列表进行排序。

尝试排序，首先添加必须成功的项目，例如创建账户、结账和付款。你可以使用你的分析工具(例如 Google Analytics、Mixpanel、Kissmetrics、Woopra)来找出哪些是常见的场景。我们还发现 Segment.io 很有用。

## 规则 2:减少，回收，再利用

下一步是将用户场景分解成简单的、单一目的的、几乎是原子的流程。例如“创建用户”、“登录”、“发送电子邮件”等。为这些流中的每一个创建一个测试。完成后，将其与用户情景进行比较。

**命名惯例**–定义一个好的命名惯例是很重要的一部分。例如，在流名称中包含组件名称，这可以产生流结构(例如“Account.login”和“Account.logout”)。

**重复使用组件。不要复制/粘贴**——对于没有经验的开发人员/测试人员来说，复制/粘贴似乎是一种重用。然而，挑战在于当流程改变时更新这些步骤。即使是在数百次测试中重复的单个步骤/行也是一个巨大的麻烦。

## 规则 3:创建结构化的、单一目的的测试

单一目的测试只验证一件事！

单一目的的测试更容易创建和维护，与更长更复杂的测试相比，它们运行起来也更快。理想情况下，只有当他们测试的特性被破坏或者它的一个依赖项被破坏时，他们才会失败(我们会尽量减少这种情况)。如果你测试了几个特性，第一个失败了，你对其他的特性一无所知，因为你还没有达到它们。

测试应包括三个部分:

1.  **设置**–例如登录
    这些步骤使 AUT(被测应用)达到测试所需的状态。这可能因测试而异:有时您只需要登录。你需要一个复杂的结构来预先存在。
    注意:过早的优化不是一个好的做法。实现登录流(user/pass 字段)是一种简单的开始方式，如果您在所有测试中重用相同的登录，稍后将实现更改为快速实现并不困难(例如，通过使用 cookies)，因此如果您知道速度优化很容易解决，就没有必要从速度优化开始。
2.  **动作**–您想要测试的流量。
    继续我们前面提到的“登录”例子，与设置步骤不同，设置步骤要求成功完成登录(不管以何种方式)，测试“登录”本身是一个不同的任务，不应该被重用。
3.  **验证**–验证 UI 状态，验证 DB–你期望的结果。
    有不同的验证方式，这很大程度上取决于你测试的是每周从生产中更新的数据，还是相同的测试数据。
    在 UI 测试中，对 UI 中的元素进行基本验证。
    *   验证元素是否可见。
    *   验证包含一些文本的元素。
    *   验证元素是否处于特定状态。
    *   视觉验证–验证是否包含预期的文本、图像以及是否具有正确的样式(如字体、布局)。

使用预定义数据集的优点是使验证更容易，因为当我们知道确切的设置状态时，您也知道完成刺激步骤后的精确预期状态。

如果数据集被更新，您会得到您没有预料到的不同场景(因为不同的用户会以不同的方式使用您的应用程序)，这使得调试失败变得更加困难(因为场景可能无法重现)。

示例:登录测试可能如下所示:

*   设置初始状态:
    *   打开 AUT
    *   导航到注册页面

*   动作:
    *   选择一个随机的用户名，并将其变量命名为*用户名*T2 g . " user "+date . now()+" @ mailinator . com "。
    *   使用用户名注册新帐户。
        *   将用户名设置为*用户名*
        *   设置随机密码
        *   单击提交
    *   验证:
        *   打开 mailinator.com
        *   导航到“收件箱”
        *   查找电子邮件至*用户名*
        *   检查是否有一封带有预期链接的电子邮件。
        *   点击链接
        *   用*用户名*和*通行证*登录
        *   验证登录成功

注意:单元测试和端到端测试的最大区别之一是开销。打开一个浏览器并登录到 AUT 曾经是非常慢的，在到达设置状态后，测试人员要执行许多测试，节省了宝贵的时间。如今，有了 docker，启动浏览器的速度更快了，浏览器的速度有助于开发人员编写快速加载的应用程序，最大限度地减少编写端到端测试的开销。

## 规则 4:测试的初始状态应该总是一致的

由于自动化测试总是重复相同的步骤，它们应该总是从相同的初始状态开始。运行自动化测试时最常见的维护问题是确保初始状态的完整性。因为自动化测试依赖于那个状态，如果它不一致，测试结果也不会一致。初始状态通常源自用户先前的动作。

例如:

1.  向已包含某项的列表中添加该项(来自上一次测试运行)。
2.  对于新用户和老用户表现不同的视图。
3.  如果用户已经登录，应用程序会自动重定向。

可能的解决方案:

*   为每个测试运行创建新用户
*   使用专用的应用程序环境进行测试自动化，而不是使用您的生产环境。
*   在每个套件运行之前，用初始数据播种您的应用程序，也称为 [fixtures](https://github.com/junit-team/junit4/wiki/test-fixtures) 。
*   使用步骤/组上的条件来处理测试中难以设置的双重情况。
*   消除测试之间的依赖。“测试 _1”之后 AUT 的状态不应该影响“测试 _2”的流程。

## 规则 5:从简单的步骤组成复杂的测试

复杂的测试应该模拟真实的用户场景，你应该更喜欢从简单的测试部分(共享步骤)组成那些测试，而不是直接记录整个场景。因为您已经在简单测试中测试了所有的简单动作，所以复杂测试应该只在集成问题上失败(这就是规则 2 派上用场的地方)。

确保命令您的套件首先运行简单的测试。当运行整个套件时，它会在复杂测试中出现问题时给你提示。

## 规则 6:在周转点中添加验证

验证通常在测试结束时使用，以表示测试处于通过/失败状态。如果一个动作失败了，最好在主要变更点添加它们作为停止测试的检查点。由于验证将运行到超时，像所有步骤一样，它也是一种在应用中等待长时间异步操作的机制(例如，从服务器获取数据，连续视图渲染等)。)之后再运行下一步。

示例:

1.  行动完成时——导航、表单提交、模式显示等。
2.  在主要的 DOM 更改之后，添加验证以确保您在尝试下一步之前处于新的状态。
3.  客户端与服务器之间的通信改变了应用程序的状态，例如，数据提交成功的消息等。

## 规则 7:不睡觉提高稳定性

持续时间随机的睡眠(我称之为幻数)是古怪测试的主要来源之一。尽管所有的应用程序本质上都是异步的，但也有极少数情况下，人们不知道页面何时准备好并执行下一步操作。自动化测试也应该如此。

避免静态睡眠的原因是您很少知道运行测试时机器的负载。只有在性能测试中，您才拥有自己的机器(确信所有的 CPU 和内存都是为您准备的)。由于您可能使用虚拟机或 Docker，如果您将 sleep 设置得太慢，将会超时；如果设置得太高，将会导致测试变慢。

在大多数情况下，您会添加一个等待条件步骤，就像人一样等待，或者有时等待一些内部状态(例如 javascript 值)。

在 Testim 中，我们提供了各种内置的等待，从等待元素可见到等待特定的文本(也可以使用变量和正则表达式)，再到等待一些视觉变化(如颜色变化)或基于代码的变化。

## 规则 8:至少使用两个层次的抽象

如果您的测试主要由用户交互组成，比如点击和设置文本动作，那么您可能做错了。如果您使用了底层框架(例如 Selenium)，您可能听说过 PageObject 设计模式，它建议将业务逻辑(例如登录)与底层实现(例如设置用户名、设置密码和单击登录按钮)分离开来。Testim 也是如此。让层有助于重用减少了维护，并允许组织的其他成员快速了解发生了什么，因为有时测试人员编写测试，而开发人员运行它们(在合并新代码之前)。在这种情况下，开发人员需要快速理解测试做了什么，以及什么是 bug。

## 规则 9:减少条件的出现

一个测试应该有尽可能少的条件(if 语句)。那些有很多的通常是不可预测的(不知道你的确切状态)或者是复杂的(你甚至可以看到循环)。尝试通过以下方式简化您的测试:

*   在预定义的状态下开始测试；
*   禁用随机弹出窗口；和
*   禁用随机 A/B 测试，选择特定的流。

## 规则 10:编写独立和隔离的测试

测试创作的一个重要方法是创建自包含的、独立的流程。这允许以高并行度运行测试，这对测试套件的扩展至关重要。例如，如果您有 1000 个测试，每个测试运行一分钟，那么逐个运行它们将需要超过 16 个小时。分钟，在完全并发的情况下，可以将测试时间减少到 1 分钟。

拥有一个快速的构建减少了从开发人员提交代码到他们知道他们的特性已经准备好投入生产之间的反馈时间，并且可以带来真正敏捷的开发周期。

## 概括起来

对测试进行适当的规划会对开发过程产生很大的影响。能够快速获得反馈，快速调整测试以适应新的用户流，快速分析结果，识别错误并获得足够的信息以快速修复它们。适当的计划也可以节省大量的时间和费用。没有适当规划的套件需要大量的维护，并且使 R&D 团队无法构建新的功能和增加覆盖率。最后，适当的计划有助于将质量责任扩展到问答组织之外，并让其他人做出贡献。

## **关于作者/柳文欢·鲁宾** 

柳文欢·鲁宾是 T2 测试公司的首席执行官。他在软件行业拥有 20 多年的经验，主要为 IBM、Wix、Cadence、Applitools 和 Testim.io 的开发人员开发测试相关的产品。除了是一名忙碌的企业家之外，柳文欢还是一名社区活动家，并且是 Selenium-Israel meetup 和以色列 Google Developer Group meetup 的共同组织者。他曾在 Technion 大学任教，并在谷歌 Launchpad 加速器担任导师。在 [LinkedIn](https://www.linkedin.com/in/rubinoren/) 和 [Twitter](https://twitter.com/shexman) 上与他联系。