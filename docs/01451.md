# 一次性开发环境

> 原文:[https://devops.com/disposable-development-environment/](https://devops.com/disposable-development-environment/)

*等等！就等一分钟！构建一个开发环境需要*天*，现在我应该读一篇关于一次性开发环境的文章？*

是的。

升级 PHP 似乎花了整整一个 sprint！现在我应该让他们建造一些东西，这样他们就可以把它扔掉？

是的…是的，你是。

## 一次性开发思维

DevOps 基于五大支柱:

*   文化
*   自动化
*   精益思维
*   尺寸
*   共享

因为我们自动化了环境，所以它们易于共享，我们应该能够测量有意义的业务影响。该模型是 DevOps 为操作任务建模开发人员工作流的实践。

## 为什么是一次性开发环境

登录到您的工作站，删除 Java、PHP 等的运行时。删除或更改一些配置文件并清空垃圾箱。现在怎么办？如果你的整个团队这样做是因为他们有一个很棒的想法呢？恐慌了吗？如果在任何团队中开始工作都像以下这样简单，那会怎么样:

*   从源代码管理克隆项目
*   启动运行时环境
*   获取咖啡因
*   开始工作

如今，大多数开发人员都拥有手工构建、手工定制的工作站设置，具有以下特点:

*   吸收一名新队员需要几天时间。
*   围绕运行时环境的创新被扼杀了。
*   从一个团队转到另一个团队需要几天的时间。
*   工作流更像是运营而不是开发。

让我们设定一些目标:

*   新团队成员提交第一个代码的时间不超过 30 分钟。
*   不超过五分钟扔掉一个环境，重新开始。
*   开发人员从一个团队转移到另一个团队不超过五分钟。
*   运行时更改与应用程序更改的方式相同。

除非你的团队可以随意丢弃一个运行时环境，否则这一切都是不可能的，因此可处置性是一种我们应该期望与我们的软件一起交付的"[-能力](https://en.wikipedia.org/wiki/Non-functionalrequirement)"。

## 一次性是不可或缺的

最重要的概念是用工作站上的虚拟机(VM)处理应用程序的运行时。应用程序代码保留在工作站上。这意味着开发人员仍然使用他们今天拥有的所有工具和工作流。如果虚拟机上发生错误，将其杀死并重新开始。如果它发生在工作站上，那么是时候重建笔记本电脑了。

其核心思想借鉴了我们生产环境中的常见概念(以及一个具体的工具示例):

*   用于支持工作站上的来宾虚拟机的虚拟机管理程序，例如 Virtualbox
*   配置客户机的置备程序，如 Chef
*   源代码控制，用于跟踪和管理对应用程序和配置的更改，例如 git
*   粘合，这样提供者和 provisioner 就可以表示为代码，并通过源代码控制进行管理，比如 vagger

## 新团队成员入职

让新员工遵循一套[指示](https://behemphi.github.io/vagrant/chef/development%20environment/2016/06/25/delightful-local-development-environments.html)。员工安装工具和他或她要使用的应用程序应该不超过 30 分钟。作为管理者，这必须被无情地衡量和测试。应该指导新员工记录问题点和任何需要很长时间的事情。他们为下一个新员工改进文档。

## 加速创新

开发人员说，“我希望我能升级到 PHP X！我会在几分钟内完成，而不是几天！”

开发人员有能力进行这样的升级，所以真正的问题是:

*   升级一个语言版本需要几个小时。
*   如果尝试失败，可能需要更长的时间来解开所有手工滚动的变化。
*   如果尝试成功，团队中的每个人都将开始一段艰难的旅程来升级他们的定制工作站。

随着管理层询问诸如特性速度、价值实现时间和内部预期回报率之类的事情，谁愿意花费这样的时间来获得成功，并导致团队中的其他人也感到悲伤呢？这就是为什么安全升级总是这么痛苦地进行。它们被延迟是因为它们“不起作用”

现在，将运行时抽象为虚拟机，并将虚拟机的配置抽象为代码。假设开发者想要升级 PHP。

*   开发人员销毁当前装有 PHP 5.2.6 的虚拟机。
*   例如，开发人员进入 Chef 代码，并将 PHP 版本更改为 5.3.29。
*   开发人员用一条命令启动一个新的虚拟机。
*   开发人员运行自动化测试。

最有可能的结果是一些测试失败。对于定制环境，这是升级工作停止的地方。修复所有的测试是让整个团队步调一致的承诺。对于一个只有五个人的团队来说，这是令人生畏的。开发人员不是项目经理。

对于一次性开发环境，只需要五分钟就可以完成更改。开发人员知道这是他们同事的相同工作，所以想法改变了。

给定一个任意的时间窗口，测试是固定的，PHP 升级节省了时间或提高了系统性能或修补了安全漏洞。为了在团队中共享这一变更，这位开发人员在 Chef 代码中提交了变更。他们将它推送到代码库，并通知团队，“嘿，PHP 5.3.29 工作了，请调整。”一个人做所有的工作。

团队成员停止他们正在做的事情。他们把工作藏在飞机上。他们从代码库中提取变更。他们启动虚拟机，Chef 对其进行配置。他们放下工作，回到提供商业价值上来。不到五分钟，整个团队就完成了。

## 加快安全性和合规性

开发者的升级导致安全问题怎么办？改变语言版本这样重要的东西就是为了展示这种力量。但这个问题问得不对。相反，问这个问题，“我们如何在投入生产之前确保我们是安全的？”

假设开发环境中的任何变化都通过相同的过程反映在生产中。例如，当代码被部署到质量保证(QA)时，Chef cookbooks 就会运行，并使用新的 PHP 版本启动机器。为什么没有测试来证明应用程序至少和以前一样安全呢？

更重要的是:通过使基础语言的升级、测试和团队共享变得容易，升级的风险会小得多。

这种想法有一些新的假设:

*   您信任应用程序级别的测试自动化。(常见)
*   您信任基础设施级别的测试自动化。(不常见)
*   您拥有自动化的安全性和法规遵从性实践，在产品发布之前进行检查。(罕见)

作为经理，我们必须帮助我们的:

*   因为基础设施将是代码，所以 Ops 团队在代码管理实践方面变得更好。
*   开发团队与运营、安全和合规团队合作，做出负责任的改变。
*   安全团队采用安全即代码的思维方式，以便在从开发提升之前进行测试。
*   合规团队加入开发工作，因此变更已经是审计输出的一部分。法规遵从性已经在路上了。

## 一次性开发环境的业务成果

我们在需要的时候会雇佣新人。花两周时间进入工作状态意味着我们在拖延实现价值的时间。拖延 30 分钟比填写人力资源文件还省时间。我们需要这个关键的时间来满足招聘的需求。

开发人员在基础设施中有更多的自由来尝试他们的想法。他们还有一个安全网，当想法不可行时，可以在不到五分钟的时间内把它放回原处。

运行时环境的安全补丁可以在开发时应用，在整个部署周期中可以对它们进行测试。这需要几分钟而不是几天。

如果所有的团队都使用一个标准的方法和工具链，那么就有可能坚持这样的格言，“把你最好的人才放在你最大的机会上。”开发人员可以在不到五分钟的时间内从团队 A 转移到团队 B，并开始学习代码。他们可以在同样的五分钟内返回。

运行时中的更改发生在开发时，它们随应用程序一起升级和发布。因此，也许最重要的是，如果它能在开发人员的笔记本电脑上工作，那么它也能在生产中工作。

如果不能简单地抛弃环境并轻松地重新开始，开发人员和运营人员就无法实现这些优势。因此，继续处置这些定制的工作站，并确保实现以下优势:

*   新团队成员提交第一个代码的时间不超过 30 分钟。
*   不超过五分钟扔掉一个环境，重新开始。
*   开发人员从一个团队转移到另一个团队不超过五分钟。
*   运行时更改与应用程序更改的方式相同。