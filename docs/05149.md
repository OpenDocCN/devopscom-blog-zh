# DevOps 聊天:插件为企业扩展 Spinnaker

> 原文:[https://devo PS . com/devo PS-chat-plugins-extend-spinnaker-for-the-enterprise/](https://devops.com/devops-chat-plugins-extend-spinnaker-for-the-enterprise/)

Spinnaker Summit 2019 预览:秘密管理对于任何充满活力的 DevOps 和 GitOps 工具链都至关重要。作为其开源成熟的一部分，并感谢我们的 DevOps 聊天嘉宾的贡献，Spinnaker 现在有了支持 GitOps 的安全机密管理功能，从 hal 配置文件的明文中提取非应用程序机密。

Cameron Motevasselani，Armory 的软件工程师，将在太平洋时间 11 月 17 日周日上午 10:45 发表他的演讲“Spinnaker 插件:为企业扩展 Spinnaker”。

除了对 Spinnaker 的新秘密管理工具的贡献之外，Cameron 还分享了创建可扩展的 Spinnaker 插件系统的工作进展。当前的工作是早期的 MVP，随后是 PF4J 的实现和具体的扩展点，作为 Spinnaker 阶段的一部分。

像往常一样，下面是流媒体音频，然后是我们的谈话记录。

[https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/701685406&color=%23ff5500&auto_play=false&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true](https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/701685406&color=%23ff5500&auto_play=false&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true)

## 副本

米奇·阿什利:大家好。我是 DevOps.com 的米奇·阿什利，您正在收听的是另一个 DevOps 聊天播客。今天，我和 Cameron Motevasselani 在一起，Motevasselani，谢谢*【笑声】*——一名软件工程师。他也是军械库的发言人。他在即将于圣地亚哥举行的 2019 年 Spinnaker 峰会上做了几次演讲。第一个——我猜第一个是关于插件系统的，第二个是关于秘密管理的。

卡梅伦，欢迎来到 DevOps 聊天室。

卡梅隆·莫提瓦瑟拉尼:你好。谢谢你邀请我。

阿什莉:很高兴你能来。嗯，告诉我们一点关于你自己的事情。介绍一下你自己，告诉我们一点你在军械库做什么，军械库做什么。

哦，完全正确。是啊。所以，我是卡梅隆·莫特·瓦斯瑟拉尼。感谢快速介绍。我想想，我已经在军械库呆了一年了。我加入并抢先一步，开始着手这个秘密管理项目。所以，这很酷。然后，现在，最近，我一直在研究这个插件系统。是的，我想，大概就是这样了。

阿什利:太好了。军械库是做什么的？是啊。

是的，军械库，我们基本上为 Spinnaker 提供了企业产品。因此，我们在 Spinnaker 的基础上编写了一些扩展，所以我们不需要派生和维护所有这些，我们只需要扩展 Spinnaker 并以这种方式提供一些额外的功能。

阿什莉:非常好。现在，按照你的说法，你已经在秘密管理和插件上工作了。这是否意味着你实际上是在贡献，写代码并把它贡献给开源，或者你主要是已经构建好的东西的实现者？

哦，不，这是个很好的问题。是的，对于秘密管理和插件，我们都直接为这两个项目的开源做出了贡献。

**阿什利:**牛逼。非常好。好吧，让我们从秘密管理开始。我的意思是，我认为我们都有点想法，我们要把我们的钥匙，我们的密码，证书，所有的好东西。我们不希望它进入源代码管理系统或云中的某个地方或某人的软件中。请告诉我们一些关于 Spinnaker 的秘密管理部分，以及您一直在做什么，您将谈论什么。

是的，完全正确。因此，当我们开始与客户讨论他们的 Spinnaker 设置以及他们如何部署和管理 Spinnaker 的配置时，秘密管理真正出现了。

如你所知，Spinnaker 实际上掌握着王国的钥匙。它拥有您的集群密钥和您的凭证，以便部署耗费您资金的云资源，对吗？这些都在运行—它运行您的组织到达的代码。你不能在源代码控制中这样做。那不是，不好拥有。

阿什莉:不要——一个大不要，虽然是一个常见的错误。*【笑声】*

**Motevasselani:** 没错。没错。*【笑声】*我想 GitHub 现在甚至会对你大喊大叫，如果你有钥匙的话

阿什莉:哦，是吗？*【笑声】*不错。

在那里。所以，他们在这里和那里增加了一些不错的安全功能。人们希望朝着 GitOps 的想法前进，这样你就可以通过拉请求来管理你的配置。这是一个很棒的想法，很多人做不到，因为键实际上是在 Spinnaker 配置中。

因此，我们拿出这些密钥，并在我们的机密管理解决方案中引用它们。因此，您可以使用不同的后备存储，如 S3 存储桶或保险库，并将您的秘密存储在那里，然后在 Spinnaker 配置中以这种方式引用它们。

阿什利:嗯。很好，很好。那么，在您的演讲中，您将会介绍您一直在做的事情，它的功能，以及如何通过 GitOps 实现它？

是的，没错。它的功能，它与其他开源解决方案有何不同，这些解决方案解决了一个稍微不同的用例。因此，从本质上来说，讨论秘密管理的差异和未来。

阿什莉:好的。非常好。太好了。在我们进入插件系统之前，还有什么要告诉我们的吗？

是的。你知道，秘密管理，尤其是关于 Spinnaker 的秘密。它实际上并没有解决应用程序本身的秘密。

阿什莉:哦，好的。

所以，我只是想澄清一下。那是在当前的时间。将来我们可能会有一个这样的故事，但我要讲的是 Spinnaker 的秘密，而不是应用程序的秘密。

阿什莉:好的。所以，这只是运行、操作、管理 Spinnaker 环境所需要的，而不是您的应用程序秘密？

没错。

阿什利:好的，太好了。嗯，这是一个重要的澄清。太好了。好了，我们来说说新的外挂系统。除了是新代码之外，它还有什么新的地方？

是的。所以，插件系统是，我们一直把它开发成一个非常——它是一个非常 alpha，MVP 类型的特性。所以，现在在开源中，我们有一种方法让用户在 Orca 中创建自定义的 stages。要做到这一点，你必须具备相当多的知识和专业技能，所以我不太建议你现在就去做。但是我们正在建立这个插件系统，我们将在不久的将来和用户一起测试它。

所以，现在还没有 UI，但是我们正在开发 UI，将来应该也会开源。

阿什利:现在，这听起来像是一项艰巨的任务。你如何创建一个插件系统，任何人都可以用它做任何他们想做的事情，因为这可能是一个要求，你需要很大的灵活性。你如何着手架构和设计，使你所构建的东西可以扩展，并且你不需要在一年内重新做一遍？

是的，这是一个很好的问题。因为我们采用的是 MVP 模型，只是让一些东西工作起来，然后得到反馈进行迭代，所以我们实际上已经计划放弃这种先把插件加载到 Spinnaker 的方法。我们已经对它进行了一些内部修订，并且在这个项目上与社区，特别是谷歌和网飞进行了合作。因此，我们将从我们当前的实现转移到另一个成熟的插件框架，为此我们选择了 PF4J。

阿什莉:好的。现在，我不熟悉这个框架。你能告诉我们一点这方面的情况吗？

**Motevasselani:** 是的，所以我们目前做的方式——希望这不会泄露我太多的话题*【笑声】*——但是我们现在做的方式本质上是把罐子塞进 Orca 的类加载器。嗯，通过夸克。这些不同的 Spinnaker 服务和库组成了 Spinnaker。

阿什利:嗯。

现在，这是一种非常愚蠢的做法，只是将 jar 添加到类路径中，以便将其加载到 Spinnaker spring 应用程序上下文中。

**阿什利:**有道理。很简单的方法。

是的，没错。但是就像你说的，没有——现在还没有定论。随着我们转向 PF4J，我们将在 Spinnaker 中定义具体的扩展点，以便实际上没有扩展点的蔓延，在整个代码中有明确定义的扩展点。

阿什利:嗯。

这将有助于我们迭代这个功能，并确保它是一个好的解决方案，因为我们将继续开发它。

Ashley: 好的，这就是 GitHub 上的 PF4J？我想是阿帕奇许可证吧？

是的，没错。我相信是阿帕奇。没错。因此，迁移到 PF4J 将会给我们带来很多我们当前的实现所没有的非常好的特性，比如为每个插件使用不同的类加载器，这样它就可以有自己的依赖项，等等。

阿什莉:这很有道理。在 Spinnaker 这样的环境中实现插件系统有什么独特的挑战吗？你知道，这是软件创造软件，软件部署软件。你知道，它本身并不是一个应用程序，它是你的某种工具链的关键部分，你的工作流程。我想知道在尝试建造它的过程中是否会遇到一些独特的挑战。

是的，这很有趣，因为我们一直在看，你知道，当你开发新的东西时，你会看现有的艺术作品来决定如何建造你正在建造的东西，我想。*【笑声】*

阿什利:嗯。

因为找不到更好的词。

阿什利:技术上来说，我知道。*【笑声】*

没错。*【笑声】*所以，看看像 Jenkins 或 Eclipse 这样都有插件系统的东西，WordPress 也一样，它们都是独一无二的，对吗？

阿什利:嗯。

**Motevasselani:** Spinnaker 无疑是由许多不同的微服务组成的一个应用程序。本质上，我们只是把它变成一个平台，通过使它可扩展和可插拔。

但是，要回答你的问题，一个主要的挑战是，你有所有这些不同的微服务。你知道，取决于你如何部署和更新你的 Spinnaker 安装，它们可能是不同的——我不想说不同的版本，但是如果你一直在部署 master，与如果你都运行相同的发布版本相比，你可能在生产中有不同的一组微服务。

因此，将插件部署到那个环境中并不是一件容易的事情，如何完成版本控制以及回滚非常重要。

阿什利:你这里有点递归问题，对吗？因为你必须对插件管理器进行版本控制，然后版本控制哪些插件可以使用它？

是的，没错。插件可能依赖于一个版本的微服务中的某些功能，而另一个版本中没有，如果你需要回滚，那是如何工作的，等等。没错。

阿什莉:嗯，你让我惊讶了一会儿。你说，你提到了 WordPress 插件系统，吓了我一跳。

***【笑声】***

**阿什利:请不要这样做！*【笑声】***

**我确实认为 WordPress 是一个做得非常好的项目的例子**

**阿什莉:他们有。**

****Motevasselani:——**因为它有这样好的插件生态系统。**

**阿什莉:这是一个漫长的过程。它走过了漫长的道路。我不知道，它更不能自我维持，但比以前自动更新要好得多。*【笑声】***

****Motevasselani:** 对，对。我们也希望从过去的项目中吸取经验。*【笑声】***

**阿什莉:绝对是。我不是想诋毁 WordPress，你知道吗？你必须偶尔。好吧，给我们讲讲你的演讲吧。那你打算报道什么？这更多的是如何使用它，还是你将在下一个版本中规划你要去的地方，并寻求反馈？你想完成什么或者从中得到什么？你希望在会谈中发生什么？**

**是的，你知道，这是一个很好的问题。我认为有很多东西要涵盖，从我们运行和创建这个项目的旅程，与社区和那些努力一起工作，到向用户展示，“嘿，这实际上是一种修改或扩展 Spinnaker 功能的好而简单的方法。”**

**这里的想法是——这个项目有一些想法，因为我们真的希望降低用户的门槛，特别是在企业中，以便能够为 Spinnaker 创建扩展。我们最初选择的方法是大多数用户与 Spinnaker 交互的方式，即创建管道和定义阶段。**

**比方说，一家企业有一些定制的基础设施，用于运行数据中心和云。比方说，如果他们想以 Spinnaker 的本地方式与之交互，您会希望有一个用户可以选择的舞台。因此，您不必在很深的层次上学习 Spinnaker 是如何工作的，您可以实现这个漂亮、简单的接口并让它运行起来。**

**所以，在演讲的最后，如果听众能够理解如何自己创建和实现插件，那就太好了。**

**阿什莉:哦，太好了。好吧，那么，希望你可以，你正在创造一个观众和社区去尝试你的新插件系统和它的变种。**

**现在，您谈到了使用插件作为 Spinnaker 的扩展。您是否也认为这个插件系统是第三方工具的一种集成接口，可能是其他开源、其他商业工具，或者只是扩展 Spinnaker 功能的更多东西？**

**哦，这真是个好问题。因此，有一种推动将 Spinnaker 转变为一个精益核心和一个扩展的生态系统，我相信，这是正在使用的术语，并且这直接朝着那个目标前进。Spinnaker 的核心 Spinnaker 核心中有某些功能不太有意义。**

**例如，有一些特定于公司的阶段。我不想说 Gremlin，我认为他们做得很好。Spinnaker 中有一个 Gremlin stage，可能是一个插件。所以，嘿，小鬼们，打我吧。*【笑声】*但还不完全是，可能是为了末端插件系统。**

**阿什利:这是软件进化，对吗？**

****Motevasselani:** 正是。**

**阿什利:我的意思是，这就是你需要做的事情，你需要把事情做好，所以这是它成长的一部分。**

****Motevasselani:** 没错，没错。是的。如果您可以安装一个 Spinnaker，在那里您可以挑选您想要安装和运行的云提供商，那将会非常酷。如果你只是——你知道，如果你与谷歌和亚马逊的云交互，也许你不需要甲骨文的云软件在你的云驱动上。或者，您可能希望在每个数据中心都有一个云驱动程序，抱歉，在每个云帐户中，只有部署到云环境所需的代码。**

**阿什利:嗯。**

**所以，你有一个更小的攻击面，只是更瘦更小的双星系统，等等，等等。**

**阿什利:太好了。嗯，我想，除非你有什么想补充的，我想你已经对那两个演讲的内容做了全面的了解。**

****Motevasselani:** 是的，你知道，这是希望的，只是让社区兴奋起来，让一些想法流动起来，我认为这些演讲会很棒。**

**Ashley: 我还想表达我的一点谢意，感谢你和所有其他软件项目的贡献者。我总是鼓励那些刚刚使用开源软件的人，Spinnaker 峰会上有人正在实现它，不是为 Spinnaker 编写代码，而是在这样的峰会上谈论它，这是对社区做出贡献的另一种方式。因此，很高兴与实际上也在编写代码的人交谈。**

**是的，谢谢。我也很高兴和你聊天，米奇。**

**阿什利:太好了。嗯，这是我的荣幸。您已经收听了另一个 DevOps 聊天播客。我要感谢今天的嘉宾，他是 Cameron Motevasselani，Armory 的软件工程师，他正在 2019 年 Spinnaker 峰会上发言。会议的日期是 11 月 15 日到 19 日，地点在圣地亚哥，卡梅伦有两场演讲。他关于插件的演讲是在 11 月 16 日周六下午 2:30，然后他还会很早就谈到秘密管理——伙计，你真的会在这里吵醒他们——周日早上 9 点，卡梅伦，所以。*【笑声】***

*****【笑声】*****

****阿什莉:所以，你知道，也许你会在早间谈话中提供含羞草鸡尾酒。*【笑声】*很荣幸请到卡梅隆，感谢今天所有听众的参与。这是 DevOps.com[的米奇·阿什利。您已经收听了另一个 DevOps 聊天播客。在外面要小心。](https://devops.com/)****

****— [米切尔·阿什利](https://devops.com/author/mitchellashley/)****