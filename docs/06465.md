# 如何利用微服务进化 DevOps 管道

> 原文：<https://devops.com/how-to-use-microservices-to-evolve-devops-pipelines/>

企业正迅速成为许多应用程序的复杂网络。随着公司创建越来越多的微服务，他们的部署环境变得越来越复杂。如果没有适当的配置，微服务路线图可能会很快变得不可维护。

根据 DeployHub 首席执行官特雷西·拉冈的说法，如果开发团队不断地向集群推送点，应用程序开发可能会因为缺乏对其依赖性和应用程序相互关系的高度可见性而受到影响。

在最近由持续交付基金会( [CDF](https://cd.foundation/) )发表的演讲“用 DeployHub 发展您的微服务管道”中，拉冈，也是 CDF 的董事会成员，讨论了团队如何获得对微服务交付管道的更好的洞察力。

## 微服务跟踪问题

O'Reilly 进行的一项 [2018 研究](https://www.businesswire.com/news/home/20181204005140/en/O%E2%80%99Reilly-Survey-State-Microservices-Maturity)发现，86%的受访者在生产中采用微服务方面取得了轻微成功。只有 15%的人表示“取得了巨大的成功”这些结果证明了围绕微服务的兴奋和完美执行的罕见。

“我是微服务的超级粉丝，”拉冈说。"对于软件开发来说，这是一个激动人心的时刻."她说，微服务打破了传统的软件交付模式，迫使团队强调运行时。然而，随着这种转变，很容易丢失应用程序之间的逻辑视图。

根据 Tracy 的说法，依赖性跟踪和版本控制是维护微服务安排的首要问题。由于不断更新，跟踪服务使用的版本是一项挑战。“如果没有一致的管理方法，微服务开发就会失败，”她说。

## 从 CI 转移到 CD 时失去可见性

可见性的损失部分源于从 CI 到 CD 的转移。持续集成(CI)包括定期更新源代码和开始编译过程。这通常每小时进行一次，而不是每周或每月。使用传统的 CI，系统创建一个包并在编译时扫描依赖关系。这是连续旅程的第一步。

然而，如今，微服务通常在运行时或在 Kubernetes 部署文件中被链接*，作为连续交付(CD)过程的一部分。在这样做的过程中，我们失去了 CI 授予的一定程度的可见性。拉冈把它比作“锤打酒杯”——我们还有组成部分，但它们已经碎成了碎片。*

如今，50、100 甚至 300 的大型微服务套件并不罕见。如此庞大的生态系统需要对版本和依赖关系进行逻辑跟踪。拉冈认为开发团队需要一个变通层来代替 CI 编译报告中丢失的关键配置管理。为了跟踪一个服务的变化将如何影响其他应用程序，对相互关系的可见性是必要的。

## 输入 ortelius

[Ortelius](https://ortelius.io/) 是一个有助于持续微服务管理的包。以第一张地图的发明者亚伯拉罕·奥特柳斯的名字命名的吕斯，帮助追踪服务之间的联系，以提高生态系统的可见性。

为了了解它的行为，考虑一个电子商务商店。为了实现一个可发展的微服务管道，每个微服务都应该可以独立地部署自己的工作流。例如，一个电子商务商店可能需要一个产品微服务、支付微服务和认证微服务。这些可重用的组件可以独立部署，但是作为一个整体需要相互依赖。

从宏观上看，一个拥有数千个应用程序间依赖关系的企业在视觉上就像一个节点星座。这方面的一个极端例子可能类似于网飞死星，一个相交点的大规模聚集。拉冈说，作为“微服务的内部市场”，奥特利厄斯将透明度赋予了一个混乱的局面。

## 把吕斯和部署中心联系起来

Ortelius 是 DeployHub 的开源核心，deploy hub 是一个用于共享和发布微服务的开源 SaaS。Ortelius 与 DeployHub 配合使用，使团队能够看到逻辑应用地图，从而揭示微服务依赖关系的复杂性。

开发人员在发布之前将 DeployHub 添加到任何现有的微服务开发工作流中。然后调用 Ortelius 来增加服务并记录依赖信息。DepoyHub 然后使用 for Helm 或 Ansible 进行实际的代码推送，并添加记录元数据和添加跟踪和映射层。拉冈指出，拥有这样的信息对于像 dif 报告或物料清单报告这样的报告仍然是至关重要的。

拉冈提出，这种解决方案对于持续配置管理也至关重要——当微服务发生变化时，团队将始终知道新的应用程序版本。

## 新的微服务管道模型

如上所述，在传统模型中，DevOps 团队在 CI 阶段映射依赖关系。当 API 开发人员发布到主目录时，他们会根据微服务定义特定的属性。版本控制引擎通常会映射到可视化依赖关系。

拉冈概述了新的微服务管道的步骤:

1.  **构建映像**:编译并构建容器映像。
2.  **注册**:码头或码头注册。特定于容器注册。
3.  **跟踪服务-应用程序配置**:这是我们收集配置数据以映射结构关系的地方。
4.  **Push to cluster** : DeployHub 有助于在整个组织内标准化这一流程。
5.  **收集反馈**:配置报告和影响分析。

这一流程的核心是能够独立部署微服务并收集有用的信息。当然，这是一个不完整的模型——一个完整的管道将利用其他步骤，包括测试和自动安全扫描。

## 利益

通过以这种方式简化微服务之旅，回购将被打破，团队不再经历一个漫长的工作流程。根据拉冈的说法，通过这种方法获得的可见性可以在多个其他方面帮助组织:

*   **减少时间**:拉冈估计自动化应用程序关系映射可以取代每个开发团队每周一到两个小时的手工工作。
*   可重用性:将应用程序分解到它们的域中有助于整个组织的可重用性。
*   **避免冗余**:代码共享可以显著减少重复代码，从而避免冗余，增加灵活性。
*   **可见性**:服务关系知识的详细应用可以使 sre 做出更好的数据驱动决策。
*   **集中化**:无论集群类型或集合如何，都有助于标准化容器部署流程，有助于传统和容器化微服务部署。
*   **版本控制**:当您需要在外部共享服务时，对版本控制的深入了解会有所帮助。

最后，令人高兴的是，吕斯在 [GitHub](https://github.com/ortelius/ortelius) 上开源。吕斯采用开放的社区形式来接受反馈。“民主化是我们开放源代码的核心原因，”拉冈说。Ortelius 可以免费使用，也可以通过 deploy hub pricing for enterprise cases 的附加功能来使用。

## 软件交付风格的融合

管理跨许多微服务的连续软件交付导致了前所未有的问题。在解决这些问题的过程中，该行业似乎出现了轻微的分裂。例如，拉冈推广的模型与我在 Codefresh 上报道的[最近的演示形成了对比。](https://devops.com/how-to-scale-microservices-ci-cd-pipelines/)

拉冈建议提高独立微服务部署管道的可见性，CodeFresh 的 Dan Garfield 建议采用单个 CI/CD 管道从单个控制平面操作所有微服务。正如在软件工具中经常发生的那样，用例将可能决定采用。

无论软件交付过程如何，当分解应用程序时——或者像拉冈所说的“把锤子拿到酒杯上”——我们可能不应该牺牲与应用程序版本和服务到应用程序相互关系相关的元数据的可见性。如果这些数据丢失或管理不当，我们可能会失去很多潜在价值。

如欲了解更多关于 DevOps 管道发展的信息，请点击此处观看 CDF 在线研讨会[。DeployHub 还在这里](https://www.youtube.com/watch?v=XccAW_hIrG0)发表了一篇关于这个主题的文章[。你也可以在](https://www.deployhub.com/realities-of-microservices-and-the-ci-cd-pipeline/) [GitHub](https://github.com/ortelius/ortelius) 上给吕斯投稿。