# 分解 OWASP API 安全性前 10 名，第 2 部分

> 原文：<https://devops.com/breaking-down-the-owasp-api-security-top-10-part-2/>

由于 API 的广泛使用，以及攻击者意识到 API 是一个新的攻击前沿，因此启动了 [OWASP API 安全十大项目](https://www.owasp.org/index.php/OWASP_API_Security_Project#tab=Main) 。从一开始，该项目就旨在帮助组织、开发人员和应用程序安全团队逐渐意识到与 API 相关的风险。今年 9 月， [OWASP API 安全 10 大候选版本(RC)](https://github.com/OWASP/API-Security/raw/master/2019/en/dist/owasp-api-security-top-10.pdf) 最终确定并在 OWASP 上发布。

在我关于这个主题的第一篇文章[](https://www.checkmarx.com/blog/why-you-need-api-security)中，我提供了 API 端点、现代应用和后端服务器之间的交互的高级视图，以及它们与传统的基于浏览器的对等物的不同之处。我还讨论了为什么这个项目对贡献者和整个行业如此重要。

在我的 [第二篇](https://devops.com/breaking-down-the-owasp-api-security-top-10-part-1/) 中，我重点介绍了前五种风险，并强调了各自可能的一些攻击场景。在本文中，我将试图阐明最后五种风险，以帮助组织理解与 API 实现缺陷相关的危险。以下讨论遵循 OWASP API 安全性 10 强中的相同顺序。

## **API6:2019–质量分配**

现代框架鼓励开发人员使用自动将来自客户端的输入绑定到代码变量和内部对象的函数。这意味着用户应该能够更新他们的用户名、联系方式等。(例如，在他们的简档中)，但是他们应该不能更改他们的用户级权限、调整帐户余额和其他类似管理的功能。如果 API 端点自动将客户端输入转换为内部对象属性，而不考虑这些属性的敏感性和公开级别，则认为该端点易受攻击。这可能允许攻击者更新他们不应该访问的内容。

攻击场景示例:

为了进一步说明这一点，设想一个拼车应用程序为用户提供了在他们的用户档案中编辑关于他们自己的基本信息的选项。例如，他们可以调整自己的用户名、年龄等。在这种情况下，API 请求应该是这样的: PUT /api/v1/users/me 带有以下合法信息{"user_name":"john "，" age":24}

然而，攻击者确定请求 GET /api/v1/users/me 包含一个额外的 credit_balance 属性(字段)，如下所示。

{ "用户名":"约翰"，"年龄":24，"信用 _ 余额":10}。

攻击者希望自己增加他们的信用余额，并使用以下有效载荷重放第一个请求:

{ "用户名":"约翰"，"年龄":24，"信用余额":99999}

由于端点容易受到批量分配的攻击，攻击者可以很容易地随意调整自己的 credit_balance，例如，如上所示，将其从 10 个信用点更改为 99999。

## **API 7:2019–安全错误配置**

攻击者通常会试图找到未打补丁的漏洞、公共端点或未受保护的文件和目录，以获得他们想要攻击的系统的未授权访问或知识。安全错误配置不仅会暴露敏感的用户数据，还会暴露系统细节，从而导致整个服务器受损。

攻击场景示例:

举例来说，攻击者使用流行的搜索引擎，如 [Shodan](https://www.shodan.io/) 来搜索可直接从互联网访问的计算机和设备。攻击者找到了一台运行流行的数据库管理系统的服务器，监听默认的 TCP 端口。数据库管理系统使用默认配置，默认情况下禁用身份验证，攻击者可以访问数百万条记录，包括 PII、个人偏好和身份验证数据。

## **API8:2019–注射**

注入漏洞导致计算系统可能处理攻击者引入的恶意数据。简而言之，攻击者将代码注入一个易受攻击的软件，并改变该软件的执行方式。因此，注入攻击可能会带来灾难性的后果，因为它们通常会导致数据盗窃、数据丢失、数据损坏、拒绝服务等。

攻击场景示例:

假设攻击者开始检查其网络浏览器的网络流量，并识别出以下旨在帮助用户恢复密码的 API 请求。攻击者识别负责启动恢复密码过程的请求如下:

POST/API/accounts/recovery { " username ":"[【电子邮件保护】](/cdn-cgi/l/email-protection) "}

然后，攻击者用不同的有效载荷重放请求:

POST/API/account/recovery { " email ":"[【邮件保护】](/cdn-cgi/l/email-protection)'；等待延迟' 0:0:5 '–" }

增加了；wait for DELAY ' 0:0:5 '–"攻击者观察到 API 的响应多花了五秒钟，这有助于确认 API 易受 SQL 注入攻击。利用注入漏洞，攻击者能够获得对系统的未授权访问。

## **API9:2019–资产管理不当**

旧的 API 版本通常没有打补丁，可以成为一种无需对抗最先进的安全系统就能危及系统安全的简单方法，这些安全系统可能会保护最新的 API 版本。攻击者可以访问敏感数据，甚至通过连接到同一数据库的旧的、未打补丁的 API 版本接管服务器。

攻击场景示例:

比方说，一个重新设计应用程序的组织忘记了一个旧的 API 版本(api.someservice.com/v1 ),并让它不受保护，并且可以访问用户数据库。在针对一个最新发布的应用程序时，攻击者发现了 API 地址(api.someservice.com/v2)。在 URL 中用 v1 替换 v2 使得攻击者能够访问旧的、未受保护的 API，暴露了数百万用户的个人身份信息(PII)。

## **API 10:2019–记录和监控不足**

如果没有记录和监控，或者记录和监控不充分，几乎不可能跟踪针对 API 的可疑活动并及时做出响应。如果无法看到正在进行的恶意活动，攻击者就有足够的时间潜在地危害系统和窃取数据。

攻击场景示例:

想象一下，一个视频分享平台遭到大规模凭据填充攻击。尽管记录了失败的登录，但在攻击的时间范围内没有触发警报，并且它在没有被注意的情况下继续进行。作为对用户抱怨可能的违规行为的反应，API 日志被分析，攻击被检测到，在事后很久。该公司不得不发布公告，要求用户重置密码，并向监管机构报告这一事件。

鉴于上述五种风险，人们很容易想象出类似的攻击场景。这些只是攻击易受攻击的 API 实现时几乎无限可能性的例子。希望您能看到上述风险主要是由错误或疏忽引起的，这些错误或疏忽很容易补救，尤其是当涉及到当今组织利用 API 的方式时。

— [埃雷兹·亚隆](https://devops.com/author/erez-yalon/)