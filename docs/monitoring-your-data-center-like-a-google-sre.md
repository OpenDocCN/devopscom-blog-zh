# 像谷歌 SRE 一样监控您的数据中心

> 原文：<https://devops.com/monitoring-your-data-center-like-a-google-sre/>

早在本世纪初，当谷歌开始扩展其搜索以外的服务组合时，它遇到了一系列挑战。其中一些是从开发人员和运营人员之间或者 IT 服务和业务线所有者之间常见的传统脱节中产生的。另一些是全新的、前所未见的故障模式，源于在新型云平台上提供服务——而且是在全球范围内提供服务。T3

为了应对这些挑战，谷歌开始发展一门名为网站可靠性工程的学科，该公司于 2016 年出版了一本关于该学科的 [非常有用和有趣的书](https://landing.google.com/sre/book/index.html) 。SRE 和 DevOps(至少是 DevOps 的当代版本，它扩展成了 IT 运营在云时代应该如何工作的愿景)分享了许多概念和越来越多的实践 DNA 尤其是因为云软件和工具现在已经发展到允许雄心勃勃的人开始使用开源软件(如 Kubernetes)模拟谷歌的部分基础设施。谷歌用“ [类 SRE 实现 DevOps](https://www.youtube.com/playlist?list=PLIivdWyY5sqJrKl7D2u-gmis8h9K66qoj) ”来命名谷歌云平台的 Liz Fong-Jones 和 Seth Vargo 的一个新的(且不断增长的)视频播放列表，展示了这些学科如何以及在哪里联系起来，并促使 DevOps 考虑一些关键的 SRE 见解。

## 理解谷歌 SRE 原则

先说一些基本原理:

***故障是正常的***–实现服务的 100%正常运行时间是不可能的、昂贵的或无意义的(例如，在您的服务依赖关系中存在掩蔽错误率)。

***在整个组织内就 SLIs 和 SLO 达成一致***–由于故障是正常的，您需要在整个组织内就可用性的含义、与确定可用性相关的具体指标(称为 SLIs 或服务水平指标)以及可接受的可用性在数字上看起来如何(称为 SLO 或服务水平目标)达成一致。

***使用商定的 SLO 计算“误差预算”***–SLO 用于定义 SREs 所称的“误差预算”，这是一个数字线(例如，每月可接受的服务停机时间)。错误预算用于鼓励服务可用性的集体所有权，并无可指责地解决关于平衡风险和稳定性的争议。例如，如果程序员过于频繁地发布有风险的新特性 并且 损害可用性，这将耗尽错误预算。SREs 可以指出有风险的错误预算，并主张停止发布，并将编码人员的注意力重新集中在提高系统弹性的工作上。

这种方法让组织作为一个整体有效地平衡速度和风险与稳定性。对这种经济的关注鼓励在加速业务发展的同时最小化风险的策略上的投资:编写错误和混乱容忍的应用程序，自动化掉无意义的辛劳，通过小的改变来进步，并在进行全面发布之前评估“金丝雀”部署。T3

监控系统是使 DevOps/SRE 学科的这一整体、优雅部分工作的关键。重要的是要注意(因为，请记住:谷歌没有运行你的数据中心)，这与你正在监控的技术类型、你正在争论的流程或你可能应用的特定技术无关。简而言之，将 SRE 度量原则应用于传统的企业系统和运行在容器编排上的 12 因素应用程序一样有意义。T3

## 应用谷歌 SRE 原则

下面是谷歌 SRE 可以告诉你的一些关于监控的事情，具体来说:

***仅在出现故障时发出警报，或在出现早期故障时发出警报***——警报耗尽是真实存在的，并且“呼叫一个人是对员工时间的一种昂贵的使用。”

***监控是一项重大工程***——拥有十几名成员的谷歌 SRE 团队通常会雇佣一到两名监控专家。但是他们不会让这些专家盯着 实时 图表来发现问题:这是一种被 SREs 称为“辛劳”的工作——他们认为这是无效的，他们知道这是没有意义的。

***事后分析，没有魔法***——Google SREs 喜欢简单、快速的监控系统，帮助他们在问题发生后迅速找出问题发生的原因。他们不信任试图自动进行根本原因分析的神奇解决方案，并且他们试图尽可能简单地保持警报规则，没有复杂的依赖关系层次结构，除了系统中处于非常稳定、明确状态的(罕见)部分(他们的“稳定”示例:当他们将最终用户流量从关闭的数据中心重定向时，系统可以停止报告该数据中心的延迟)。在其他地方，他们的系统不断变化，这导致复杂的规则集产生过多的警报。这种简单性的一般规则的一个例外是:Google SREs 确实建立了对最终用户请求率的异常模式做出反应的警报，因为这些会影响可用性和/或反映外部依赖性故障(例如，运营商故障)。

***大量使用“白盒”监控***——Google 喜欢对按应用分组的目标系统进行深度内省式监控(在[ops view Monitor](https://www.opsview.com/products/features/business-service-monitoring)中称为业务服务监控)。查看支持应用程序的所有系统(例如，数据库、web 服务器)的相关指标，可以让他们更清楚地确定根本原因(例如，数据库是否真的很慢，或者数据库和 web 主机之间的网络链接是否有问题？)

***四大黄金信号***——因为监控的一部分点是通信，Google SREs 强烈倾向于在相关的小群体上构建 SLO(和 SLA)，容易理解的 SLI 度量。正如人们广泛讨论的那样，他们认为测量“四个黄金信号”——延迟、流量/需求、错误和饱和度——可以查明大多数问题，即使在工作负载可见性有限的运营商协调器等复杂系统中也是如此。然而，值得注意的是，这个简单的原理图并不像一些监控制造商所说的那样自动赋予简单性。谷歌指出，“错误”本质上是非常多样的，从容易到几乎不可能被捕获，而“饱和”通常取决于对受限资源(例如，CPU 容量、RAM 等)的监控。)并仔细测试关于利用率成为问题的水平的假设。

## 结论

底线是，好的 DevOps 监控系统需要的不仅仅是自己动手的工具包。虽然灵活性和可配置性很重要，但 更重要的是 成熟的监控解决方案能够提供关于所观察的特定系统和服务的精选操作情报，以及将这些系统作为业务服务进行分组和可视化的能力。

约翰·詹斯奇格