# DDoS 防御:你能区分敌友吗？

> 原文:[https://devops.com/ddos-defense-can-tell-friend-foe/](https://devops.com/ddos-defense-can-tell-friend-foe/)

在许多组织中，网络是业务的核心，不仅支持人力资源、供应链和财务等内部职能，还支持业务收入所依赖的服务和交易。这使得网络可用性至关重要。来自外部世界的任何访问中断都会关闭收入龙头，影响利润并造成糟糕的用户体验，从而损害客户满意度并导致客户流失。停电越严重，损失越大。这就是速度在检测、诊断和响应拒绝服务(DoS)和分布式拒绝服务(DDoS)攻击中如此重要的原因。

应对攻击的主要挑战之一是区分敌友。如果无法深入了解流量细节并检查主机级流量行为，就很难区分两者的不同。基于云前架构的传统网络分析技术在计算和存储能力方面过于有限，除了执行预定义的警报和摘要报告之外，无法做更多的事情。这些信息不足以真正了解复杂网络场景中发生的事情的核心。

幸运的是，新的大数据技术让我们能够深入挖掘大量的网络流量细节，从而有可能了解到底发生了什么。借助正确实施的大数据平台，您可以在运营时间框架内快速透视数据视图以获得洞察力，从而采取行动缓解攻击或修复更无害但仍令人头疼的网络问题。我们将研究通过常见的网络流量遥测输出(如 NetFlow、sFlow 或 IPFIX 支持的路由器和交换机提供的数据)随时可用的数据。

## 从顶端开始

假设我们看到了基础设施遭受攻击的征兆。我们将使用流量汇总数据快速扫描总流量(以每秒位数为单位),看看是否有什么突出的地方。

![Picture1](../Images/d8655176322f1ee78e3bfecb5b2b7869.png)

从这个角度看，没有明显的流量峰值，但我们看到的网络平均运行速度为 60 Gbps，这并不意味着网络的更深层没有令人担忧的事情发生。

## 分析源地理

大数据擅长的事情之一是将许多数据源融合在一起。通过将 NetFlow 数据与 GeoIP 相结合，我们可以按来源地理位置查看流量。在这种情况下，网络没有从中国获得大量流量，那么当我们以中国为来源过滤总流量时会发生什么？

![Picture2](../Images/9e97f70580ccd5d80248fb7cafc2300f.png)

啊哈！这个分析支点产生了上图，显示了两个明显高于平均水平的峰值。下面，我们放大峰值的时间。

![Picture3](../Images/a6c29b1e2abaf296605fda76855cca12.png)

## 分析唯一的源 IP

尖峰本身是可疑的，但这只是一个大的数据文件传输吗？我们可以通过查看有多少不同的源 IP 在发送流量来找出答案。要查看主机级别的详细信息，请注意，我们已经超出了可以使用摘要信息的范围。此时，我们正在分析原始网络流记录的详细信息。

![Picture4](../Images/0930bdea2686b723aae3a41dae431cd2.png)

这些原始的网络流细节肯定是有用的，因为事实上，向特定目的 IP 发送流量的唯一源 IP 地址的数量有了巨大的增加。这告诉我们，我们看到的不是来自单台机器的大文件传输，而是一组高度分布的发送者。僵尸网络多吗？

## 谁喝醉了？

下一步是确定哪些 IP 从大约 14，000 个单独的主机 IP 中获取了所有这些(可能是不需要的)流量。

![Picture5](../Images/44ee34f56520864fa51d30495c29d208.png)

挖掘大量主机级 NetFlow 细节的能力再次证明了它的实用性。我们可以看到，主要目标是一个单独的目的 IP 地址。对于来自一个与你没有业务往来的国家的成千上万台主机的流量突然从几乎为零飙升到超过 1 Gbps，真的只有一种可能的解释:这是 DDoS 攻击。请注意，这并不是一次大规模攻击，但它仍然会给运行在该主机上的任何东西以及依赖于它的任何东西带来真正的问题。如果是您的 DNS 服务器，攻击可能会使许多其他服务器和应用程序无法运行。

## 更深入

现在我们知道这是一次 DDoS 攻击，我们不应该停止，因为我们不知道攻击是否来自中国以外的其他国家。我们再次将分析转向拓宽我们的视野。

![Picture6](../Images/c8c21cb5c80a298cfe9a9bb9f64fb0b0.png)

你瞧，确实有来自多个国家的 DDoS 流量，包括美国、日本、俄罗斯、瑞典、中国、台湾、巴西和爱沙尼亚。很高兴知道。

## 描述攻击的特征

接下来，我们想知道我们看到的具体是什么类型的流量，以及它能告诉我们什么。我们将根据协议对来自所有这些源主机 IP 的流量进行分组。

![Picture7](../Images/bc68e5f29cfe2541376c94a8fe2cbb02.png)

显然，这是基于 UDP 的攻击。现在我们来看看目的地端口。

![Picture8](../Images/08da070757c351a8d21bede5a01a8916.png)

我们可以看到 UDP 流量被发送到多个端口，很明显，我们正在经历发生在端口 53 上的 DNS 重定向/放大攻击，大量端口 0 UDP 数据包片段作为并行流量生成。

## 这次袭击背后有什么？

到目前为止，我们已经从完整的 NetFlow 细节中获得了很多关于 DDoS 攻击的细节。但是这种体积 DDoS 是主要事件吗，还是我们被其他不太明显的威胁分散了注意力？我们可以看到许多数据包被发送到端口 4444(图中的绿线)。

端口 4444 是 Kerberos 服务的 UDP 端口，并且——至少对于 Windows 机器来说——是缓冲区溢出攻击的[众所周知的目标](https://isc.sans.edu/port.html?port=4444),通常用于插入 Hlinic 和镇压等特洛伊木马。

因此，潜在地有两种类型的攻击并行进行:DDoS 攻击和缓冲区溢出特洛伊木马插入。许多安全博客和出版物指出，DDoS 攻击经常被用来[混淆其他利用](http://www.esecurityplanet.com/mobile-security/9-enterprise-security-trends-for-2015.html)。这很可能是这种技术的一个例子。

## 控制攻击缓解

描述攻击的特征有助于我们采取缓解措施。一种方法是获取攻击流量，并按 x/24 源网络地址对其进行分组:

![Picture9](../Images/eb7d3a75e91e40bb8b4e5bf73105992c.png)

我们现在可以采取两个缓解措施:

*   如果我们有清理服务或设备，请要求我们的上游 ISP 丢弃此流量或将其发送到清理服务或设备。
*   作为额外的预防措施，在我们自己的路由器上丢弃来自这些国家去往端口 4444 的所有流量。

## 结论

能够挖掘全分辨率网络流数据的一个好处是，您可以获得操作上有用的见解，而不需要在线设备。您还可以更自由地使用各种缓解方法。如果您想要掌握处理 DDoS 攻击的全部细节，大数据是前进的方向。

## 关于作者/亚历克斯·亨索恩-伊万

Alex Henthorn-Iwane 是 Kentik 的营销副总裁。他拥有 20 多年将网络、安全和软件领域的新技术推向全球市场的经验。Henthorn-Iwane 领导 Kentik 的全球营销战略，并帮助该公司将其创新故事和解决方案带给世界各地依赖网络的组织。在 [LinkedIn](https://www.linkedin.com/in/alexhenthorniwane) 、 [Twitter](https://twitter.com/heniwa) 或 [SlideShare](http://www.slideshare.net/AlexHenthornIwane1/followers) 上与他联系。