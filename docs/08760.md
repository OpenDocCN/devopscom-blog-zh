# 无服务器应用中的身份验证—有哪些选项？

> 原文:[https://devo PS . com/authentic ation-in-server less-apps-what-the-options/](https://devops.com/authentication-in-serverless-apps-what-are-the-options/)

无服务器应用在 DevOps 工程师中越来越受欢迎。它们提供了一种方便、可预测的方式来运行 CI/CD 构建或自动化脚本等简单流程，而无需建立基础架构。它们也常用于部署微服务。然而，无服务器应用程序带来了独特的安全挑战，其中之一就是身份验证。

如何确保服务只有在获得授权的情况下才能与其他服务或外部世界进行通信？如何确保用户能够方便、安全地访问无服务器功能的多个实例？

在无服务器应用程序中，有许多组件在交互——不仅是终端用户和应用程序，还有云供应商和应用程序。这就是为什么常见的身份认证方法，如单因素、双因素和多因素身份认证，只提供了最低限度的基础。无服务器身份验证需要一种 [零信任心态](https://www.hysolate.com/learn/zero-trust/zero-trust-from-vision-to-reality/)—不应该信任任何连接，即使是应用程序内部组件之间的通信也应该进行身份验证和验证。

为了正确保护无服务器身份验证，您还需要使用身份验证和授权协议，配置安全的内部服务权限，并监控传入和传出访问。在本文中，我将简要介绍所有这些内容，并演示一个实际例子——在 [AWS 无服务器生态系统](https://lumigo.io/aws-serverless-ecosystem/) 中设置身份验证。

## 最常见的身份验证方法是什么？

下面是大多数应用程序使用的标准身份验证方法的概述。

### 单因素认证

也称为主要身份验证，这是最普遍和最直接的身份验证类型。单因素身份验证只要求一种身份验证方法；例如安全 PIN、密码或 PIV 卡，以获得对服务或系统的访问。

这些方法在熟悉度和可用性方面是可靠的；然而，它们通常与较差的安全性相关联，并且凭据很容易通过网络钓鱼、数据泄露或使用键盘记录器被窃取或猜测。

### 双因素认证

双因素身份验证(2FA)增加了另一层复杂性，因为它需要一个额外的因素来验证用户的身份。常见的验证方法包括一次性密码、由注册设备创建的令牌或 PIN 码。两种验证方法的存在显著提高了您的安全级别。

### 多因素认证

这是最复杂的认证过程。它利用两个或多个独立的因素来验证用户的身份并授权对系统的访问。在常见情况下，多因素身份认证(MFA)至少利用以下两个因素:

*   个人识别码或密码(已知的东西)
*   安全令牌或移动电话(拥有的东西)
*   FaceID 或指纹(你是什么)
*   位置信息、打字速度或类似信息(您可以做的事情)

## 认证和授权协议

身份验证协议是在两个实体之间传输身份验证数据时保护身份验证数据的通信协议。它使接收实体能够认证连接实体以及向连接实体认证其自身。这是通过声明身份验证和语法所需的信息类型来实现的。

有几种类型的身份验证和授权协议，包括:

*   **轻量级目录访问协议**(**LDAP)**—一种软件协议，允许任何人在网络中查找有关个人、组织和资源(如文件和设备)的数据。无论用户使用公共互联网还是企业内部网，LDAP 都允许这样做。
*   **安全声明标记语言(SAML)**—一种开放标准，允许跨多个不同系统共享有关身份验证、授权和身份的安全信息。T3】
*   **开放式授权(OAuth)**—一种开放式标准授权框架，旨在通过互联网建立基于令牌的授权。OAuth 使第三方服务能够使用最终用户帐户信息，而不会将用户帐户凭证暴露给第三方。这篇博文可以帮助你了解[SAML 和 OAuth](https://frontegg.com/blog/authentication-standoff-oauth-vs-saml) 的区别。
*   **OpenID**—支持认证服务和网站以标准化的方式交换安全信息。OpenID Connect 是该协议的最新版本，提供了改进的身份管理、对移动应用程序开发的支持以及互操作性。在 [官方了解更多 OIDC 常见问题](https://openid.net/connect/faq/) 。

## 无服务器上的安全认证

在无服务器系统中，有四种访问形式——四种应该受到保护的通信形式。一个单独的服务不需要包含所有四个类别，但是它所包含的类别应该得到很好的保护。

### 内部服务访问

通过联合[无服务器](https://devops.com/?s=serverless)服务创建一个系统有很多好处。但是，您应该考虑每个附加服务的安全性。T3】

权限过多的服务是一种负担。不必要的权限提供了对数据、操作或服务的过度访问，并且错误可能会让恶意用户利用该服务并使用其权限来危及您的系统。因此，您应该仔细考虑每个服务所需的权限。

有效地监督内部服务访问权限通常是一项繁重的工作。幸运的是，所有顶级云提供商都有本地访问管理服务来简化这项任务。AWS 有 AWS IAM，Azure 有 Azure Active Directory，Google 云平台(GCP)提供云 IAM。

### 输入访问

外部用户可以通过 SaaS 访问网络。访问将受到限制，每个用户都需要官方凭证才能访问。

然而，这带来了上面提到的同样的问题——秘密必须存储在某个地方。您无法管理用户如何访问和存储您提供给他们的凭据；因此，您应该假设他们的凭据没有得到安全的保存，并且随时都有可能遭到破坏。

这似乎是一个难以处理的问题，但是有一个解决方案——提供临时凭证。这意味着，即使秘密被揭露，它们也会在不久后失效。

云提供商有这方面的服务。Google Cloud IAM 提供短期凭证，AWS IAM 允许您创建临时凭证，Azure Active Directory 允许您为其共享访问的签名配置到期日期。

### 出局接入

当您组织的无服务器功能可以访问外部第三方服务时，通常需要某种访问凭据。这些凭证需要保存在某个地方，但是这种存储有时并不安全。今天，某些 web 应用程序继续将秘密存储在数据库、文本文件或硬编码的函数代码中。

云提供商拥有安全保留凭证和机密的服务。AWS 有 AWS Secrets Manager，Azure 提供 Azure Key Vault，GCP 提供 Google Cloud Secret Manager。

### 最终用户和客户访问

这种访问类型的问题类似于传入访问的问题，尽管解决方案不同。无论是在 B2B 还是(特别是)B2C 环境中，没有多少用户会忍受不断重新生成或刷新其凭证的要求。因此，需要另一种方法。

顶级云提供商都有用户认证服务——Azure Active Directory B2C、AWS Cognito 和 Google Identity Platform。您还应该考虑使用第三方最终用户验证，因为这将帮助您避免供应商锁定。第三方产品也倾向于提供更好的开发者体验。最常见的第三方认证提供者是 Okta 和 Auth0。

## AWS Lambda 身份验证解决方案示例

Amazon Cognito 提供托管认证和授权，可以帮助您在无服务器架构中构建安全的 web 服务。在构建需要权限控制的复杂无服务器应用程序时，它通常与 Amazon API Gateway 结合使用。

例如，一个工资系统可能有一个经理和两个额外的雇员。这三名员工可以使用他们唯一的用户名和密码登录工资单系统，这个过程称为身份验证。

为了检索工资单，这三名员工接受了基于角色的身份验证:

REST API GET/API/employee/{ employee _ id }/工资单

但是，他们通过此过程获得的权限应该是他们需要的唯一权限。这可能涉及设置以下条件:

*   经理可以查看所有员工的工资单。
*   员工不能访问其他员工的工资单，只能访问自己的工资单。

您可以使用 AWS 托管服务来满足上述要求，同时满足未来的扩展需求。

![](../Images/cb66341a877f5739c74b4517e1b9e47b.png)T2】

*图片来源:[AWS](https://d2908q01vomqb2.cloudfront.net/77de68daecd823babbb58edb1c8e14d7106e83bb/2020/11/02/ASCENDING-Securing-Objects-2.jpg)T5】*

### 第一步:设置 AWS Lambda 授权器

Lambda 授权者是集中决定请求者是否拥有所请求的 API 资源的相关权限的大脑。

以下是您设置它的方法:

*   导航到 Amazon API 网关并创建一个授权者。
*   选择您想要保护的 API 资源，并将 AWS Lambda 函数分配给它们。
*   配置您的新 AWS Lambda 授权器。

![](../Images/0e11f48efe6e8afcd583edbd773b4046.png)T2】

### 第二步:建立用户访问控制列表(ACL)

建立用户权限并保持其最新是至关重要的。根据您的身份提供商，方法可能会有所不同。如果您使用 Amazon Cognito 作为您的 IDP，这里有一个流程示例。

**1。初始化 ACL**

每个用户都有一个唯一的 ID，所以在向 Cognito 注册时，可以通过在 Amazon DynamoDB 的权限表中插入条目来描述每个用户的权限。DynamoDB 权限表存储所有用户的访问控制列表，尽管实现可能因用例而异。

对于这个例子，让我们为每个雇员使用一个整数 ID(实际应用程序中的 UUID 字符串往往要长得多)。

经理:

uuid:xxxx-XXX-XXX-xxxx-xxxxxxxx

员工:{"allow": ["/5 "，"/5/*"]}

工资单:{ "允许":[1，2]}

员工 1:

uuid:xxxx-XXX-XXX-xxxx-xxxxxxxx

员工:{"allow": ["/6 "，"/6/*"]}

工资单:{ "允许":[3，4]}

员工 2:

uuid:xxxx-XXX-XXX-xxxx-xxxxxxxx

员工:{"allow": ["*"]，" deny":["/7 "，"/7/*"]} // employee_id=7 是员工 2 的经理

工资单:{"allow":[1，2，3，4]}

**2。管理访问控制列表**

复杂项目中的用户权限是不断变化的。员工可以被提升、降职或解雇，根据其角色的变化有不同的访问要求。例如，一位新经理需要访问所有工资单，这意味着您必须为每个员工创建一个新的工资单对象。

您可以使用 Amazon DynamoDB 流来管理用户权限:

![](../Images/60abf52ef3aa3871197117f0577264ba.png)T2】

当您在权限表中插入或修改项目时，可以很容易地集成 Lambda 函数。Lambda 函数可能包含根据用户角色的变化修改权限的代码。

**3。建立 ACL 策略**

一旦为每个对象建立了具有用户权限的 ACL，就应该创建一个授权策略文档。Lambda 函数授权器使用这个策略来评估是允许还是拒绝用户 API 请求。

Amazon API Gateway 提供了一种内部评估策略的机制。内部政策评估机制。网关将自动评估授权人返回的任何策略 JSON。关于 Lambda authorizer 的输出标准详见本文档[。](https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-lambda-authorizer-output.html)

在本文中，我介绍了无服务器应用程序中身份验证的基础知识:

*   单因素认证
*   双因素认证
*   多因素认证
*   内部服务访问
*   出局接入
*   输入访问
*   Amazon Cognito 的真实例子

我希望这将有助于您更好地理解帮助保护无服务器应用程序的身份验证和授权技术。