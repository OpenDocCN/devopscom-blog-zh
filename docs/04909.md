# SSH 密钥管理和您的组织

> 原文：<https://devops.com/ssh-key-management-and-your-organization/>

它总是以同样的方式开始:管理几台机器、几个用户和几个 SSH 密钥。您手动将他们的密钥(以及您自己的密钥)复制到适当的机器上。你甚至可以说，“去他的”，共享一个根访问的密钥。承认吧。没关系。嗯，不，这是不好的，但我们都在某些时候这样做，即使我们知道得更多。就像把油脂倒进下水道:我们知道我们不应该这样做，但有时这只是权宜之计。

无论如何，你足够幸运，你的公司开始扩大规模，事情开始变得更加复杂。更多的用户，更多的服务器，更多的密钥。就像生日聚会上有太多孩子:你开始花所有的时间确保他们有冰淇淋吃，他们不会从蹦床上掉下来，他们不会打架。你花了太多的时间来管理你的用户和他们的密钥，所以你意识到你需要某种系统来保持一切协调。这通常始于 Excel 电子表格跟踪谁在什么机器上有什么键(另一件我们都做但不愿意向朋友承认的事情)。这是一个开始，但这只是 SSH 密钥管理需要的许多东西之一，这个过程越不需要手动操作越好。

### 身份的集中存储

首先，让我们承认 Excel 电子表格真的不足以跟踪谁可以访问你的服务器上的什么。如果没有集中的密钥管理，您很可能会拥有被遗忘的临时帐户，并永远保留下来。您还会遇到流氓用户的问题:您授权的用户之一绕过您添加其他人，而作为管理员的您对此一无所知。您希望这些机器有一个身份来源，一个添加位置，一个删除位置，一个审计位置。

### 设置新用户

如果我一个月增加一个用户，当然，我可以手动将用户的密钥添加到每台机器上。当然，这需要预先假定您已经从用户那里获得了公钥，并且可以使用它。前提是他们足够聪明能自己制作钥匙。一个密钥管理系统应该使这个过程对你来说更简单，从你的身份存储中读取并把它们放到合适的机器上。

### 取消预配离开的用户

如果有人友好地离开了，从你的服务器上删除他们的密钥是个好习惯。它保持东西干净和安全。但是，如果他们以不太好的方式离开，你最好知道每台机器上的钥匙在哪里，并且能够快速地移除它们。这也重申了为所有用户保留单独的密钥的必要性:如果他们有 root 的私钥，您不仅要从机器上获取该密钥，还要将新密钥分发给应该有权访问共享帐户的每个人。

### SSH 密钥旋转

如果旧密钥泄露，保留相同的密钥会使您更容易受到攻击。PCI DSS 标准规定密钥必须至少每年轮换一次。让用户尽可能容易地做到这一点很重要，而且您必须有地方记录每个密钥最后一次旋转的时间。对于许多组织来说，这可能是某个地方的 Excel 电子表格，就在审计之前被重新整理过。正确的做法——定期在所有机器上轮换您的所有密钥——需要一个自动化的过程。

### SSH 密钥健壮性

假设您组织中的每个人都在使用 1024 位密钥，突然有消息说您需要 2048 位密钥。拥有一个密钥管理系统将有助于协调更新。否则，您将会查看每台服务器上的每个键(注意这里的模式吗？)来查看哪些需要更新。

### 删除失效的 SSH 密钥

这不是一次性的事情；密钥(和用户)倾向于被“临时”提供，然后被遗忘并留在机器上。一个好的密钥管理系统会找到并删除这些密钥，或者至少通知您它们的存在。

### 允许用户自助服务

虽然我们不想让用户随意地为自己和其他人添加帐户，但我们也不想创建和处理他们的私有/公共密钥对，并在他们丢失密钥或想要更新密钥时进入每台机器进行更改。理想情况下，我们的密钥管理系统将允许(安全的)用户控制他们的密钥，允许重置和更新。

虽然这些事情中的大部分都可以手工完成，但这并不容易，而且会花费太多的时间。也许你可以把它写成剧本——事实上，很多公司都是这样做的。但是许多公司过去也编写自己的字符串库，运行自己的邮件服务器，管理自己的工资单。这不是对你时间的最好利用。

— [Rajat Bhargava](https://devops.com/author/rajatb73/)