# 保持冷静，重构操作

> 原文:[https://devops.com/keep-calm-refactor-operations/](https://devops.com/keep-calm-refactor-operations/)

开发人员一直在重构以提高效率和避免错误。让我们不仅仅将理论应用于 ops 来做同样的事情。

[![keep-calm-and-refactor-operators](../Images/ea17cca684d973c6f25cd565922dc12b.png)](https://devops.com/wp-content/uploads/2014/08/keep-calm-and-refactor-operators.png) 如今，大约有一百万篇文章、博客、推文和信息图表以这样或那样的方式描述 DevOps。但是一个核心事实仍然存在:DevOps 部分试图将敏捷之类的方法应用到运营中，以便提高效率和避免错误。我们需要效率，因为需要部署、更新、迁移和维护的应用程序数量在增加，而不是减少，而且一天中(或每月变更窗口期间)根本没有足够的时间来完成所有工作。

我们需要消除错误，因为根据 initial state 的数据，这些错误的代价非常高。修复一个 bug(错误)比写一行代码要花费**30 倍**的时间。任何曾经花时间追逐一个疯狂指针的人都会立即说这个估计太低了，但有趣的是，我愿意接受这个数字。毕竟这是一个平均值。从这个角度来看，同样的数据表明开发人员必须在每 1000 行代码中找到并修复 100 个产品错误。这是 10%的错误率。

我将让您思考一下这对 DevOps 以及将基础设施视为代码的愿望意味着什么。

没错。当您着手自动化和协调所有基础架构的配置、配置和常规管理时，您可能希望避免这种错误率。仅仅几个错误就能有效抵消自动化节省的时间。那么如何避免这种情况呢？

避免这种情况的方法之一是重构。

重构最常用于将反复重复的代码片段(脚本)提取为可组合的函数(在过程语言中)或方法(在面向对象语言中)或服务(在微服务或基于 SOA 的系统中)。它是一种原始的抽象形式，用于产生更易管理、可扩展的代码库。

基本上，你正在采取一组你重复执行的动作，并把它们变成一个可重用的、可重复的“东西”。在操作的情况下，那个“东西”可能是一个脚本。

比方说，每次部署应用程序时，您也在部署负载平衡服务，因为您当然希望它是可伸缩的和/或可靠的。您总是执行相同的一组步骤来完成这项任务，只需进行一些更改-通常是 IP 地址、主机名或其他网络和应用程序特定的设置。

但是你是手动的，或者每次都写一个新的脚本。在大多数情况下，手动进行更改会引入错误。胖手指是一个常见的原因，尤其是当你没有密切关注时，因为，嗯，无聊！你已经这样做了五千万次，坦率地说，你已经厌倦了这一切的乏味。[![refactor all the things](../Images/b9df23fb76891ba60b87135c752259eb.png)T2】](https://devops.com/wp-content/uploads/2014/08/refactor-all-the-things.jpg)

我们都做过，不要假装你们都没觉得无聊*和*犯了错误。相信我，你在一个好公司里。

在这种情况下，开发人员所做的就是重构公共代码，并在整个系统中重用它。那些被改变的位被参数化，其他的都保持不变。即使 DBA 也这样做，他们只是将结果代码称为存储过程。

这种努力的结果是自包含的自动化任务，当用于编排流程时，支持可组合的操作。你把这些脚本串在一起，瞧！资源调配完成，减去粗手指错误或遗漏的手动步骤。

当然，重构代码比这复杂得多，操作内部也是如此，但这里的一般前提是 DevOps 的实际应用包括重构操作的过程。它是将 It 重组为更具可组合性、逻辑性和离散性的任务，这些任务可以作为实现更易于管理和扩展的操作的一种方式进行自动化和编排。它是关于在一个过程中识别那些可重复的步骤，并且可以被重构为一个单一的、共享的可执行任务。

当开始一个应用 DevOps 的计划时，你可能需要证明你所花的时间是值得投资的。方法之一是重构那些持续使用和重用的操作，以实现更加一致、可预测和可重复的配置和部署流程。通过选择那些最常重复的步骤，并将它们重构到自己的可组合脚本中，您可以提高效率，减少错误(并消除查找和修复它们所需的时间)。