# Web 应用防火墙不能保护云原生应用

> 原文:[https://devo PS . com/we B- application-firewalls-arent-protecting-cloud-native-apps/](https://devops.com/web-application-firewalls-arent-protecting-cloud-native-apps/)

您的[网络应用防火墙](https://devops.com/?s=web+application+firewall) (WAF)在您网络的边缘嗡嗡作响，忠实地阻止恶意攻击，以免造成任何伤害。

更好的是，它是下一代 WAF (NG-WAF)。它由签名、规则和一些机器学习组成，以保护您的应用程序(和用户数据)免受损害。你已经搞定了，对吗？

是啊，没错。

你是安全专家。你不相信任何事物的表面价值。您如何确定您的应用程序受到了保护？

如果您有云原生的应用程序—微服务、飞来飞去的 HTTP 请求、每个用户请求的多个接触点，会怎么样？NG-WAF 能保护所有这些应用免受外部和内部攻击吗？

我们已经找到了答案。让我们来看看 NG-waf 擅长什么，他们在哪些方面苦苦挣扎，以及某个解决方案是否弥补了他们的差距。

## 传统 Web 应用防火墙的挑战

根据 [OWASP](https://owasp.org/www-community/Web_Application_Firewall) :

“web 应用防火墙(WAF)”是用于 HTTP 应用的应用防火墙。它将一组规则应用于 HTTP 对话。通常，这些规则涵盖常见的攻击，如跨站点脚本(XSS)和 SQL 注入。

现代应用程序比传统的 web 应用程序更加透明。专注于开发的速度和敏捷性——持续集成、持续交付(CICD)和 DevOps 取代瀑布开发模型——开发人员倾向于使用开源项目来节省开发时间和成本。

文档的透明性、易访问性和难以置信的细节使现代应用程序成为吸引人的目标。应用程序的频繁变化使得检测和保护每个漏洞几乎是不可能的。

WAFs 在过去几年中增加了新的功能，但是它们检测的基础仍然在于它们的签名或规则。问题是:WAFs 真的适应了云原生应用的需求吗？

应用已经从大规模单片发展到微服务和分布式架构。他们现在几乎生活在公共云、私有云或混合云的任意组合中。分布式架构带来的新挑战和新威胁催生了 NG-WAFs。

网络防火墙经历了类似的转变，下一代防火墙(NGFWs)引入了一种新的视角，通过深度数据包检测和以攻击为中心的检测模型来查看防火墙流量。

下一代 WAFs 通常被定义为具有三个主要特征:

*   检测基于应用程序和攻击者的行为。
*   超越特征识别异常和基本的攻击者行为。
*   支持各种云平台、API 和微服务架构的云原生部署

![NG-WAF](../Images/f3e45f957de2115f0d473f28b313087e.png)

## NG-WAFs 解决什么问题

NG-WAFs 旨在解决应用架构变化带来的新问题。

他们做得怎么样？先来回顾一下 NG-waf 做的好的地方。

### 增加了攻击者的成本

攻击者有一个明显的优势——他们不按规则行事。

我们生活在一个几乎可以将家中任何设备连接到互联网的时代。不幸的是，许多物联网设备没有采取安全措施，这意味着攻击者对机会垂涎三尺。

恶意行为者试图使用一群“机器人”来掩盖他们的来源并逃避检测。是的，他们用录像机、照相机和灯泡攻击你。

NG-WAFs 采用了一种新的方法来关联此类行为，以检测攻击者并阻止他们，从而增加了攻击者的成本，并在一定程度上阻止了脚本小子。

### 分层保护:深度防御

深度防御通过使用具有有意冗余的多层方法来提高系统安全性。它通常被称为“城堡方法”，因为它反映了中世纪城堡的分层保护。如果一层失败了，另一层会代替它。

NG-WAFs 已经发展到在多个级别进行保护，包括传统的边界和与应用程序一起嵌入的新方法。这些层使得攻击者的工作更加困难和昂贵。

### 具有自动化策略学习的机器学习和行为分析

NG-WAFs 聚合来自多个应用程序的检测，从更广泛的角度了解攻击者，并根据上下文对其进行评分。NG-WAFs 通过对聚合数据进行机器学习和行为分析，自动禁用会触发误报的签名，并相应地更新应用程序策略。

### 虚拟修补

理想情况下，您希望识别并修复代码中发现的每个漏洞。但是现实世界的商业情况表明，并不是所有的漏洞都会被快速修复或者根本不会被修复。

一些 NG-waf 支持虚拟修补，以防止攻击者利用关键漏洞，直到官方修复可用。

### 云原生支持

NG-WAFs 现在支持在公共、私有或混合云中部署。NG-WAFs 自动与容器化方法集成，以本地和弹性地扩展安全性。它们将节点分布在世界各地，以在不增加延迟的情况下最大化覆盖范围。

## NG-WAFs 未能解决的问题

NG-WAFs 在保护应用程序方面取得了长足的进步。他们利用纵深防御让成功的攻击变得越来越难以实现。

他们整合了新的架构和虚拟补丁，以适应当前应用程序开发的速度和风格。但是他们并没有解决所有的问题。

现在让我们来看看 NG-WAFs 缺少哪些可能会为您的安全带来漏洞的内容。

### 有动机的攻击者可以绕过 NG-WAFs

WAFs 使漏洞发现和利用更加耗费资源，从而给黑客和渗透测试人员带来了障碍。然而，一个有经验的黑客或有足够动机的研究人员可能会找到绕过它的方法。

当应用程序用例变得复杂时，可能需要禁用许多会产生更高误报率的防御措施。web 应用越复杂，它的攻击面就越大，越容易为它找到旁路。

### NG-waf 容易被用例利用

部署在不同上下文中的相同应用程序表现出不同的行为。对一个应用程序有害的请求对另一个应用程序可能是完全正常的，因为用户行为因情况而异。

NG-WAFs 没有完整的应用程序使用情况，它们无法检测业务用例。攻击模式隐藏在常规流量和嵌套协议中。最终，攻击者可以调整自己以适应业务流量并绕过 NG-WAFs，从而导致漏洞窗口和漏洞检测延迟。检测这种用例利用的简单实现经常导致高比率的误报和漏报。此外，客户很少使用现代 NG-WAFs 中所有可用的特性和规则。

### 机器学习和行为分析仅限于外围防御

NG-WAFs 是从 WAFs 发展而来的，它基于一种“外围防御”模型，只防御来自网络外部的恶意流量。但是，如果攻击来自内部，这种模式就会失败——鉴于用户可以通过多种方式连接到内部网络，这种情况很常见。

新的“呆在家里”常态和内部威胁风险的增加导致企业采用零信任模型。监控应用程序的内部流量和状态以及外部流量是非常重要的。

### 缺少运行时保护

恶意黑客正在攻击所有的应用程序堆栈层，无论是 web、内存还是数据库。按照设计，NG-waf 被限制在应用程序模块的边缘，不能在运行时保护应用程序。有了这些知识，攻击者还可以通过改变他们的攻击方法或混入业务流量来规避虚拟补丁防御。

### 监控盲点

整体框架将应用程序的可见性基于日志框架。想知道发生了什么吗？只需检查一个目录。

构建在微服务和无服务器基础上的现代应用程序为应用程序开发带来了优势，但也带来了可见性降低的代价。您可以单独监控每个服务，但是很快就会忽略全局系统行为。

对现代应用程序的单个请求可以在后台创建一系列调用。看似简单的事情有时会非常复杂。例如，当你在最近一次狂欢中点击 play 时，看看[网飞](https://medium.com/refraction-tech-everything/how-netflix-works-the-hugely-simplified-complex-stuff-that-happens-every-time-you-hit-play-3a40c9be254b)内部发生了什么。

这个调用链沿着它的流程生成了大量的数据。外部应用程序很难全部接收。大多数 NG-waf 没有解决这个问题，而是限制了它们可以捕获和处理的数据量，引入了攻击者可以利用来绕过它们的盲点。

## 如何保护云原生应用

云原生微服务架构带来了巨大的优势，但也很难保护。虽然 NG-waf 取得了一些进展，但在几个关键领域仍有不足。为了全面保护您的云原生应用，您应该寻找一种无缝提供安全可观察性和智能威胁检测的解决方案。寻找能够提供以下优势的解决方案:

*   端到端分布式跟踪和可见性，在不增加额外开销的情况下提高攻击检测的准确性和深度
*   为用户行为、API 逻辑和数据流建立基线以识别异常的功能
*   阻止业务用例滥用、内部攻击和威胁参与者的能力，甚至在分布式系统中也是如此
*   可见性提供了数据(尤其是敏感的业务和个人数据)如何在应用程序中移动的完整画面，因此您可以在问题区域被利用之前发现它们
*   发现和保护您的微服务的完整生态系统

如果你想了解更多关于 TraceableAI 的信息，你可以[观看 Traceable 在行动中的录制演示](https://www.traceable.ai/view-traceable-demo)。