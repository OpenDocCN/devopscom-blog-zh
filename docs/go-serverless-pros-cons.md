# 你应该选择“无服务器”吗？事物的利与弊

> 原文：<https://devops.com/go-serverless-pros-cons/>

当亚马逊在 2014 年推出 [AWS Lambda](https://aws.amazon.com/lambda/) 时，“无服务器”一词开始流行起来。从那以后，我们看到这个术语的使用和引用呈指数级增长，更多的供应商带着他们自己的解决方案进入市场(例如，Azure 最近正式发布了函数)。

它是什么？这种新趋势如何影响人们编写和部署应用程序的方式？“无服务器”是一种范式转变，还是基础设施即服务(IaaS)和平台即服务(PaaS)的自然演变？在这篇文章中，我将讨论什么是“无服务器”,什么不是——以及它与现有的 PaaS 解决方案相比是如何形成的。

## 什么是“无服务器”？

“无服务器”表示一种特殊的软件架构，其中应用逻辑在没有可见进程、操作系统、服务器或虚拟机的环境中执行。值得一提的是，这种环境实际上运行在操作系统之上，并使用物理服务器或虚拟机，但供应和管理基础架构的责任完全属于服务提供商。因此，一个软件开发人员专注于编写代码。

换句话说，开发人员从服务或功能的角度进行思考，这些服务或功能相互之间以及与外部世界进行通信。在实现这些服务之后，当安装、运行、监控和更新在特定服务器或虚拟机上运行的特定操作系统的这种过程时，使用传统方法的开发者将它们组合成多个分布式过程。在“无服务器”方法中，第三方服务提供商负责从流程到操作系统再到服务器的一切。

当第三方服务提供商负责底层 IT 基础架构时，开发人员不再负责购买专用服务器或虚拟机。同时，服务提供商可以自由决定如何有效地利用其基础设施来满足所有客户的请求。因此，服务提供商通常不需要为特定的客户运行永久的工作负载；相反，该软件同时处理来自所有客户的请求，仅花费有限的时间处理来自特定客户的每个请求。因此，这种提供商通常根据请求的总数、特定时期内请求的频率或服务于来自客户的所有请求所花费的总时间来对他们的客户收费。

相同的方法适用于不同类型的负载，因为第三方服务提供商通常提供弹性、可伸缩的服务。当客户开始使用第三方服务时，与购买、配置和管理他们自己的内部或云中的基础架构相比，预期的请求数量可能会很低，客户支付的费用也会少得多。对于大量请求，无论是预期的还是意外的负载峰值，客户都不需要添加服务器来横向扩展他们的应用程序。相反，服务提供商确实关心增加的负载。当然，处理更多的请求会花费更多的钱，但是在大多数情况下，这仍然比使用专用的 it 基础设施更有效率。

## 巴斯和 FaaS

经常与无服务器一起提及的两种方法是后端即服务(BaaS)和功能即服务(FaaS)。

### 老板

越来越多的第三方服务实现所需的功能、提供服务器端逻辑并管理它们的内部状态，这导致应用程序不具有特定于应用程序的服务器端逻辑，而是使用第三方服务来处理所有事情。在这方面，这样的应用是*无服务器的*。

第三方服务的一些例子包括身份和认证即服务(Auth0，AWS Cognito)，登录即服务(Loggly，Logsense，亚马逊 Elasticsearch 服务)和分析即服务(亚马逊 Kinesis，Keen IO)。

### 法斯

当应用程序仍然需要特定的服务器端逻辑时，开发人员可以使用传统架构的现代替代方案:FaaS。使用这种方法，开发人员专注于实现由事件触发的短命无状态函数，这些函数可以相互通信以及与外部世界通信。剩下的工作由 FaaS 提供商来完成——根据需要提供尽可能多的此类功能的实例来处理所有请求，终止不再需要的实例，监控所有实例，并提供身份和日志记录服务。FaaS 非常适合微服务架构，因为 FaaS 提供了组织运行微服务所需的一切。

Auth0 Webtask、AWS Lambda、Google Cloud 函数和 Azure 函数都是 FaaS 实现的例子。IronFunctions 是 Iron.io 的一项雄心勃勃的计划，目标是在最受欢迎的云提供商和内部运行 AWS Lambda 功能。

## 什么不是“无服务器”？

无服务器和 PaaS 之间的主要区别在于，Heroku 或 OpenShift 等传统 PaaS 提供商通常缺乏自动扩展功能。传统 PaaS 的用户必须为应用程序指定资源量，比如针对 Heroku 的 dynos 或针对 OpenShift 的 gears。仍然可以通过更改分配的资源数量来手动放大或缩小应用程序，但这主要是开发人员或系统管理员的责任。

第二个区别是传统的 PaaSes 是为长时间运行的服务器应用程序设计的。有了这样的设计，应用程序应该一直运行以服务于传入的请求。如果您关闭应用程序，它显然不能满足请求。使用 FaaS，您的函数开始服务于一个请求，并在请求被处理时终止。理想情况下，当没有传入请求时，您的函数不应该消耗提供者资源(另请参见下面的“冷启动”问题)。

根据这个术语的严格定义，传统的 PaaS 实现并不是“无服务器的”,因为它们没有自动扩展，并且要求服务器端应用程序始终运行，以便能够满足请求。出于同样的原因，传统的容器管理平台不是“无服务器”的。

了解提供者是否允许无服务器方法的另一种方法是确定两个责任领域之间的边界:提供者的消费者和提供者本身。在“无服务器”中，边界在应用程序代码和这些代码如何在物理服务器上实际部署和运行之间。在容器平台中，平台的消费者仍然负责操作系统级的工作，以定义诸如将在哪些容器中运行的流程以及每种容器将运行多少个之类的事情。

尽管如此，容器和无服务器之间还是有内在的相似性。例如，Kubernetes——一个开源容器编排平台——允许使用应用程序提供的指标(如并发请求的数量)来自动扩展容器。AWS Lambda 实际上为每个函数运行一个容器。

换句话说，容器和容器编排可以提供实现 FaaS 的有效方式，而 FaaS 提供了额外的抽象级别，该抽象级别对开发人员隐藏了特定的进程、操作系统和容器，并允许他们专注于代码。

## “无服务器”的优点和缺点

正如我们已经提到的，“无服务器”具有以下主要优势:

*   **缩短上市时间，加快软件发布。**
*   **降低运营和开发成本。**
*   **更低的扩展成本**–开发人员无需实施扩展代码，管理员也无需升级现有服务器或添加额外服务器。
*   与敏捷开发一起工作，允许开发人员专注于代码并更快地交付。
*   **适合微服务，可以实现为功能。**
*   **降低软件的复杂性。**
*   **简化打包和部署，无需系统管理。**

同时，“无服务器”有以下缺点:

*   无服务器对于长时间运行的应用程序来说效率不高。在某些情况下，使用长任务可能比在专用服务器或虚拟机上运行工作负载要昂贵得多。
*   **供应商锁定。**您的应用完全依赖于第三方提供商。您不能完全控制您的应用程序。很可能，如果不对应用程序进行重大更改，就无法更改平台或提供商。此外，您依赖于平台的可用性，并且平台的 API 和成本可能会改变。坦率地说，现有的 FaaS 实现互不兼容。
*   无服务器(和微服务)架构为函数/微服务调用带来了额外的开销。没有“本地”操作；您不能假设两个通信功能位于同一个服务器上。
*   为了更有效地利用其资源，服务提供商可能会在同一台物理服务器上为几个不同的客户运行软件(这也称为“多租户”)。即使客户的工作负载被隔离在虚拟机或容器中，在 FaaS 产品的早期阶段也会有不同的缺陷。如果使用敏感数据，这可能是应用程序的一个主要安全问题。平台中这种潜在的错误或一个客户代码中的错误(一个“吵闹的邻居”)会影响应用程序的性能或可用性。
*   在实践中，一个可扩展的无服务器平台需要一些时间来处理你的函数的第一个请求。这个问题被称为“冷启动”——一个平台需要初始化内部资源(比如 AWS Lambda，需要启动一个容器)。如果长时间没有对您的函数的请求，平台也可能会释放这样的资源(比如停止容器)。避免冷启动的一个方法是通过定期向函数发送请求来确保函数保持活动状态。
*   一些 FaaS 实现——如 AWS Lambda——不提供开箱即用的工具来本地测试功能(假设开发人员将使用相同的云进行测试)。这不是一个理想的决定，尤其是考虑到您将为每个函数调用付费。因此，一些第三方解决方案正试图填补这一空白，使您能够在本地测试功能。
*   不同的 FaaS 实现提供了不同的函数登录方法。例如，AWS Lambda 允许使用特定语言的标准框架(Java 的 Log4j，Node.js 的控制台方法，Python 的日志模块)将日志写入 AWS CloudWatch。如何实现更高级的日志记录完全取决于开发人员。

## 摘要

无服务器架构是一种编写和部署应用程序的新方法，它允许开发人员专注于代码。这种方法可以减少上市时间、运营成本和系统复杂性。虽然无服务器利用 AWS Lambda 等第三方服务来消除设置和配置物理服务器或虚拟机的需求，但它也将应用程序及其架构锁定在特定的服务提供商。在未来，我们可以期待更多 FaaS API 或框架的统一，如 [IronFunctions](https://github.com/iron-io/functions) ，这将有助于避免供应商锁定，使我们能够在不同的云提供商甚至内部运行无服务器应用程序。

——[阿萨夫·伊加尔](https://devops.com/author/ayigal/)