# 全堆栈监控解决方案需要考虑什么

> 原文:[https://devo PS . com/what-to-consider-in-a-a-full-stack-monitoring-solution/](https://devops.com/what-to-consider-in-a-full-stack-monitoring-solution/)

在 DevOps 领域，有各种工具可用于监控。然而，在构建全栈监控解决方案时，选择正确的监控工具并根据 IT 运营需求设计监控是一个关键决策。

## 实施全堆栈监控解决方案的设计考虑

以下是实施全栈监控时的一些关键设计考虑因素:

### **分布式监控**

考虑选择最适合应用监控需求的拓扑。例如，要监控的应用程序较少的小型团队可以选择在单服务器独立拓扑中实施监控工具，而具有许多不同监控应用程序的大型 IT 运营团队可以选择分布式体系结构，其中主节点包含监控工具的元数据，而监控和从属节点是集中式的，充当数据收集器和数据节点，然后连接在一起作为集中式监控系统。为了实现高可用性，监控工具群集应包含最少的建议主节点和数据节点。如果发生网络中断，监控系统可能无法检测到潜在的问题；但是，对于分布式从属节点，如果一个从属节点离线，可以向集群添加一个新的从属节点，该节点执行检查并将结果写回数据节点。根据您的工作负载选择内部或基于 SAAS 的监控工具(云/内部)。定价也各不相同，应该加以考虑。

### **可用性**

现场可靠性工程(SRE)团队专注于应用的可靠性、正常运行时间和可用性，因此持续监控以识别任何潜在的风险/中断。这就要求监控工具始终保持启动和运行。大多数监控系统都设置在它们监控的同一个网络中，如果网络中断，监控系统就无法监控安全威胁。因此，必须在高可用性集群中配置监控工具，并为可用性、备份和灾难恢复提供可用性区域和地理冗余区域。

### **可扩展性**

通常有多个监控系统来监控多个位置或具有数千台主机的数据中心。每天从每台主机收集多次数据，这可能会导致巨大的负载和性能损失。在从机分布的分布式监控系统中，可以在数据中心本地执行数据检查，可以处理数据，然后从机可以将结果发送给主机。根据负载，可以利用硬件 CPU 内核在不同的线程中运行多个检查，或者可以将从处理器添加到集群中，以实现可扩展性和冗余。

### **存储**

监控系统收集和使用来自多个工作负载的数据，以满足各种监控需求。这导致持续监控，从而产生大量的数据积累，并可能导致监控工具分析数据的性能降低，存储数据的存储需求增加，并影响更快的故障排除。监控系统使用基于文档或基于时间序列的数据库。基于时间序列的数据库可以以时间为点来存储数据，现代监控系统提供插件来从各种来源收集数据，并提供要存储到数据库的指标的内置模式。考虑根据需要存储的指标定制插件，以及根据粒度和必要的数据存储时间范围聚合数据。数据可以被聚集并存储在数据库中的每周或每月的表中，以最小化监控工具的维护成本的开销。配置保留和备份策略，以保留用于机器学习和异常模式检测的聚合数据。

### **性能**

考虑到主监控节点和从监控节点的大小和容量以及要监控的主机数量，应该测试监控工具的性能。在主机中执行各种检查，然后将数据返回到服务器节点，这涉及大量具有高计算需求的处理。使用队列或传输机制来管理从客户端到监控系统的数据传输，以避免因网络中断或延迟而丢失数据。大多数监控系统提供内置或支持排队机制，在数据丢失的情况下重试读/写操作。从代理节点可以通过在本地执行数据丰富和数据转换来提高监控系统的性能，然后将结果转发给主代理，以便更好、更快地报告。根据为优化监控工具性能而定义的 SLO，确定监控数据所需的时间间隔。监控系统可以使用基于代理或无代理的监控方法:在基于代理的系统中，使用安装在每个要监控的主机中的二进制文件来收集数据，而无代理的监控系统使用基于拉的方法来从各个主机收集数据。当使用基于代理的方法时，考虑代理安装的内存占用:对监控系统数据库中的主字段和聚合的搜索功能/索引使用优化的查询，以提高数据检索、绘图和报告的性能。

### **安全**

在监控系统中配置安全权限。从节点/主系统应该彼此安全地通信，并访问不同进程的端点和各种端口以执行检查。在应用程序、不同组件、中间件软件和防火墙的所有级别配置安全性，以允许访问监控系统需要访问和监控的端口和进程。根据需要和管理员权限，将安全访问权限限制在已定义的利益相关方，以便为策略、阈值、与其他工具的集成、管理用户、备份、保留和其他因素配置监控工具。

### **自动化**

由于监控系统使用基于代理或无代理的监控模式来收集数据，因此必须在每台要监控的主机上安装代理二进制文件或插件，这可能是一项繁琐而耗时的任务。虽然一些监控工具可以执行主机和代理二进制文件的自动发现，但是可以通过配置管理工具将自定义配置推送到主机，并自动进行配置以执行检查并将工具转发到集中式监控系统。监控系统的基础架构脚本需要进行版本控制，并且可以使用配置管理和 CI 工具来部署计划的作业和维护活动，例如清理旧数据和对监控数据运行启用批处理脚本以触发修复操作，从而减少大量手动工作和维护成本。可以通过监控工具中的自动化脚本来配置对资源的供应、取消供应和使用的监控。

### **测试监控工具**

像测试任何其他应用程序一样测试您的监控工具。创建测试用例来测试用于各种检查的配置；测试是否从正确的主机报告了正确的数据，并带有适当的标签和标记；检查端点和配置的策略；测试代理和主节点之间的延迟/数据传输；测试所提供的数据相关性是否给出了有时限的准确信息；测试以确保仪表板、警报和可视化图形报告正确的数据；以及任何机器学习和补救脚本功能测试。配置测试环境，在转移到生产环境之前，在试运行环境中安装监控工具，以测试监控数据的行为、性能和准确性。

### **选择要设置的指标**

指标提供了对系统行为的深入了解，选择不相关的指标会增加更多的开销和较差的监控。选择可提供整体平台运行状况的指标，如吞吐量、延迟和错误指标，这些指标可洞察来自多个来源的错误结果、成功指标和性能指标。为单个资源配置衡量利用率、饱和度、错误、可用性、性能(如响应时间、磁盘/CPU/内存使用、数据包流入/流出等)的指标。根据事件日志选择要配置的指标，例如扩展/缩减主机、容器扩展/停止、构建或部署失败、分析和堆栈跟踪，这些指标可以提供数据关联，并配置指标以支持从工作级指标到资源级指标再到事件级指标的下钻，具有所需的粒度并标记到资源的范围。为了实现高效的全栈监控，请配置所有类型的指标，以便更快地进行故障排除。

### **定义 SLO**

SRE 团队更关注应用程序的正常运行时间、可靠性和可用性，许多因素都会影响可靠性。最常见的情况是，应用程序设计会影响应用程序的性能。服务水平目标(SLO)必须根据期望的目标进行设计，并为目标设定目标，明确定义如何衡量目标以及目标有效的条件。配置与性能和可用性相关的 SLO，这些 SLO 可以在 SLA 中用定义的错误预算来衡量，并标准化服务级别指标，这些指标可以作为模板创建，以便在多个项目中重复使用。

### **设计警报**

监控系统应该知道要监控什么，如何发出警报，以及使用什么渠道传达警报。可以根据各种标准定义警报，例如监控潜在的问题/事件，并在它们发生之前发出警报(主机、磁盘、内存、CPU 指标)；监控预期的系统行为和关键用户操作的绿色状态，并在系统行为偏离时发出警报监控应用程序的关键资源和组件及其影响应用程序的各个其他部分的影响，并在资源出现故障时发出警报。警报也可以基于黑盒监控，即基于外部可见因素和真实用户影响配置警报，或者基于白盒监控。检查历史值和过去的补救措施，以确定阈值和优先级，其中高优先级警报可以作为寻呼发送给随叫随到的工程师，低/中优先级警报作为二级通知发送。警报应设计为提供上下文信息，如指向适当图表/日志/附件的链接，这些图表/日志/附件可包含有关所发生事件及其相关性的深层信息。确定接收警报的正确团队以及最适合随叫随到的工程师和具有升级计划和缓解计划的响应者的沟通渠道。基于用例配置警报的频率和优先级。在低警报和过度警报之间取得平衡非常重要，警报需要不断改进和微调，以避免误报警报。

### **可视化和仪表盘**

度量被收集并存储为时间序列数据，其中数据可以最好地表示为 x 轴上的时间图，并且可以注意到值随时间的变化。配置图表和控制面板，以提供不同组件的整体视图，这些视图可以在不同的时间范围内可视化，以了解长期趋势以及当前可能影响系统的最新变化。配置通用控制面板，将当前运行状况指标可视化为屏幕显示，配置集中控制面板，深入查看可用于故障排除和特定使用情形(如容量规划)的上下文信息。

### **事件补救**

设计明确的事件补救流程包括集成监控系统警报，以在 IT 服务管理(ITSM)工具中创建自动票据，并公布必须触发的事件/问题管理工作流。确定自动补救的潜在使用案例，其中可靠的来源可以确定潜在问题并获得相同的响应，而无需任何手动决策输入。例如，可以将工作流设计为与知识库集成，以检查已知问题，并从已知组件或来源验证问题，并运行自动补救操作和与 SLA 绑定的通知。通过多种通信渠道将自动开票、自动调查、自动补救和自动通知的监控系统扩展到随叫随到的工程师，将加快全栈监控。

### **机器学习分析**

随着大量数据生成并存储在监控系统中，考虑机器学习技术，如预测性机器学习，其中算法学习系统如何正常运行，提供正常行为的结果模型，并预测位于数据中标记为异常的范围之外的一系列观察点，这可用于容量规划用例。设计用于测试机器学习算法的测试用例，以避免错误识别异常或导致恶意事件作为正常行为被忽视的任何误报。

了解您环境中的监控需求，然后选择合适的工具，并在考虑各种设计因素的情况下实施这些工具，通过持续监控和进一步优化，可以加速 SRE (IT 运营)团队实现全栈监控。

— [拉旺亚·苏巴拉亚路](https://devops.com/author/lavanya-subbarayalu/)