# 将大项目转移到 CI/CD

> 原文:[https://devops.com/moving-big-project-cicd/](https://devops.com/moving-big-project-cicd/)

任何存在了几年以上的组织(以及许多没有存在的组织)都有一个庞大的系统，需要花费一大笔钱来更换。大多数中型企业都有几个。这些系统是企业不像创业公司那样采用 CI/CD 的原因之一。当然，任何新项目或小事情都会去那里，但是房间里的大象只是在那里闲逛。

那么，当您被要求将其中一个系统移入 CI/CD 时，会发生什么情况呢？

让我们从简单的例子开始:重写。在这种情况下，您几乎从一开始就是新手，可以将 CI/CD 构建到您的开发和测试过程中，就像您对任何全新项目所做的那样。

更困难的情况是，当组织已经看到 CI/CD 的好处，并决定将它们应用于使每个项目慢如蜗牛的怪物。这些大型系统通常是任务关键型的，所以这里有一个附加层。但这是可行的。

## 是的，这是令人生畏的，但是…

首先，在单独的环境中获得应用程序构建的副本。容器很适合这一点，因为它只是一个开发环境。将整个系统复制到这个新环境中(除了未擦除的真实数据，你是否在测试中使用它是每个组织的问题)，确保它构建并通过现有的测试环境。

接下来，配置 Dev/CI/CD 工具(对于我们正在讨论的这种规模的项目，我建议配置 application release automation[ARA]来帮助跟踪依赖性)，并在这些工具下进行系统构建和测试。这需要时间——配置 CI/CD 工具的时间，让构建环境在它们下可靠工作的时间，以及找出如何将现有测试结构集成到 CI 工具中的时间。没关系，关键是现在投资是为了以后储蓄。请注意，这也是升级您的开发工具的时候。例如，如果你在 J2EE 5 号上，现在是时候升级了。已经十年了，你还在做这个项目的副本。

一旦可靠地构建并通过了测试，下一步就是将这些部分转换成一种更加 CI/CD 友好的格式。传统的测试脚本可以在 CI 中调用，但是有意识地在 CI 环境中构建测试更有弹性。仔细看看测试，遗漏了什么，什么可以变得更好，什么需要保持原样并报告回来是这个测试的最大部分。

请注意，变更请求也必须被复制到新环境的变更请求系统中。一些项目很幸运地锁定了对源应用程序的更改，而新的应用程序正在加速运行，但是对于大多数项目来说，在原始应用程序中所做的更改将需要被复制。一旦您开始修改代码，它们就不能再仅仅从源代码树中拉出。

然后开始碎片化应用。这种规模的应用程序不可避免地会有大量的功能/方法来做很多事情。在单处理时代，这并不是一个糟糕的计划，但是如果您正在转向 CI/CD 并升级开发工具，您也可以优化代码。将一个 5000 行的子程序分解成一个主子程序和四个子子程序，每一个子程序有 1000 行(是的，这并不容易，但是你明白这一点)可能会为并行化提供空间，并且当你不得不进去修改代码时，肯定会减少你的修改足迹。

## 害怕有建议的专家

在 DevOps 中，有人提供这样的建议是比较常见的，“每次都要获得最新的 X。”不要听从那个建议。选择一个版本并硬编码。DevOps 中工具/操作系统/库的硬编码版本令人讨厌，但 DevOps 的要点是控制变化，任何提供这种建议的人都错过了他们的建议在 Python 3 或 RHOS/CentOS 7.0 发布时会造成的混乱，在这两种情况下，向后兼容性有利于进步。计划更新；不要说“昨晚整个构建都失败了”，然后必须修复它。

至此，您将对该应用程序有更好的了解，并将知道(或至少怀疑)监控点的最佳位置。将它们添加进来进行主动监控，而不是记录日志。您的第一组点不会尽善尽美，您会想要检查它们以查看您可以做出哪些改进，但是系统的薄弱点应该被监控到最低限度，并且警报或纠正措施会自动发生。

## 测试，测试和更多的测试

一旦新的 CI/CD 环境稳定下来，就从用户社区引入测试版测试人员来帮助您发现它的行为不像原来那样的问题。这里的要点是首先复制原始内容，最有可能在未来实现更快的更改，所以只需要求用户在与应用程序交互时做他们通常会做的事情，然后看看会发生什么。任何有问题的地方都是添加测试的好地方(我不知道任何具有 100%代码覆盖率的单片应用程序，老实说，我只听说过新应用程序具有 100%代码覆盖率的传闻，所以在已知的薄弱点总是有更多测试的空间)。

在您知道之前，系统将被移到 CI/CD 中，您将有一个在新环境下想要改进的事情的列表。在这一点上，您被覆盖了，并且可以移动过程来替换您的旧的构建过程。

## 瞧啊。

将一个大的应用程序转移到 CI/CD 中是一项工作，而防止它失控则是更多的工作。在新的环境中，很容易想一下子改变一切。但不要做那部分动作；在转移到 CI/CD 完成后，建立变更请求，以保持项目线的整洁，并根据所有其他变更请求的建立来评估那些期望的改进。

唐·麦克维蒂