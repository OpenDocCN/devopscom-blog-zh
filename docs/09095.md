# 更新和管理基础设施代码(IaC)

> 原文：<https://devops.com/updating-and-managing-infrastructure-as-code-iac/>

基础设施即代码(IaC)通常由开源平台体现，是云和云原生战略的重要组成部分。但是，如果没有扩展、保护和管理 IaC 的能力，您很快就会遇到漂移。 [Tim Davis，DevOps 倡导者](https://www.linkedin.com/in/tim-davis-2b22821a/) [，env0](https://www.env0.com) ，发音为“N zero”，讨论了通过更新和管理基础设施作为代码来建立单一的真理来源和统治漂移。下面是视频，后面是对话的文字记录。

[https://player.vimeo.com/video/577715076](https://player.vimeo.com/video/577715076)

播音员:这是数字无政府主义者。

米奇·阿什利:我很荣幸能和蒂姆·戴维斯在一起。Tim 是 env0 的 DevOps 倡导者，因此，我们将作为代码类型讨论进入一些基础设施，所以，我很期待。欢迎你，蒂姆——很高兴和你谈话。

蒂姆·戴维斯:你也一样，米奇。很高兴见到你。谢谢你邀请我。

米奇·阿什利:你也是。顺便说一句，我喜欢你右肩上的云。[笑声]总之，介绍一下你自己，告诉我们一些关于 env0 的事情。

蒂姆·戴维斯:当然。所以，我是 env0 的 DevOps 倡导者。dnv0 是一个 TACoS 平台，如果你愿意，Terraform 自动化和协作软件空间。我们真正关注的是代码基础设施、自动化、团队和治理，以及其他工具，以帮助您在代码环境基础设施的生命周期中发挥作用。

米奇·阿什利:酷。很好。嗯，你知道，这是一个很好的对话，因为我观察到在我们的行业中经常发生的事情是，你创造了一项新技术，它很容易开始并开始使用，有时并不总是容易，但复杂性来了——好的，我如何扩展它？我如何在一个更大的开发团队或者多个开发团队中做到这一点？我如何操作它？第二天我该如何保护它？

蒂姆·戴维斯:对。

米奇·阿什利:如果你告诉我基础设施和代码一样，我不会感到惊讶，事实上，我知道这是真的。

蒂姆·戴维斯:[笑声]完全正确。

米奇·阿什利:让我们谈谈这个。一旦人们开始将基础设施作为代码来做，特别是使用 Terraform，会面临哪些挑战？你遇到了哪些挑战？

蒂姆·戴维斯:是的，其中大部分都与可见度和控制空间有关。作为代码的基础设施是伟大的。这是一种加速的奇妙方式，有点像将自己推向 DevOps 的未来，进入真正的 GitOps 生命周期。但是，你知道，如果它通常只是由一个开发人员或一个基础设施人员开始在他们的笔记本电脑上本地运行并解决它，这很好，它做了他们想要的。

一旦您开始扩展该方法并在本地对多人使用，您就开始看不到“我的状态文件存储在哪里？谁刚刚在云中部署了一些东西？他们可能为此使用了什么变量？”

所以，这真的变成了一种“我不知道谁在我的云中做什么了。”

米奇·阿什利:嗯。

蒂姆·戴维斯:所以，真正确保你保持在顶端，有点集中一切，以保持可见性是非常重要的，当你扩展它。

Mitch Ashley:那么，让我问你——在一个软件开发团队中，你有一个人或一个足够紧密协调的团队，把软件作为代码，把基础设施作为代码，这是不是很典型？然后，当你开始跨多个团队时，困惑可能会存在，或者它也发生在一个团队中，只是有时，每个开发人员都为自己，所以—

蒂姆·戴维斯:是的。

米奇·阿什利:在你意识到之前，你可能会有一种狂野西部的感觉。

蒂姆·戴维斯:[笑声]当然，答案是肯定的，我的意思是，以上都是。甚至可能只是一个小团队中的两个人开始使用这些工具，并且他们开始通过进行某种程度上相互抵消的部署来踩对方的脚。或者，有些人将您的基础架构作为代码部署到云中，而其他人只是进入云中，点击并手动部署东西，这种情况称为漂移，代码所说的基础架构并不一定与实际情况相匹配。

米奇·阿什利:嗯。

Tim Davis:所以，它可以跨单个团队或多个团队，任何时候你真正超越一个人使用笔记本电脑时，你就会开始看到这些问题。

米奇·阿什利:是的，好的。很熟悉的问题吧？

蒂姆·戴维斯:[笑声]完全正确。

米奇·阿什利:我们在其他事情上也遇到过这种情况。那么，有哪些最佳实践或良好的基础设施，如代码卫生，可以让您的世界至少从一开始就保持理智，所以您的第一个问题总是，“那里有什么？”如果你不知道那里有什么，那么—

蒂姆·戴维斯:对。

米奇·阿什利:所有的事情都是公开的，或者你质疑所有的事情，因为你不觉得你对你正在看的和你正在处理的事情有一个好的基础。有哪些最佳实践？

蒂姆·戴维斯:我真的——我试着远离最佳实践，因为有时候对某些人来说好的东西对其他人来说不一定好，但是——

米奇·阿什利:嗯，我说最佳实践并不普遍，对吗？

蒂姆·戴维斯:当然。当然，你也可以做一些事情来帮助自己。如果你使用基础设施作为代码，拥有单一的真实来源对每个人都很有帮助，从本质上阻止了我刚才提到的漂移。因此，如果您将基础设施用作代码，请将它们保存在某个存储库中。让它成为事实的唯一来源，无论那里有什么，无论那些基础设施中有什么代码文件，都是真实的。

因此，无论何时你决定将基础设施作为代码，停止使用云用户界面，停止到处点击，点击，点击和添加资源和东西。通过将基础设施更新为代码文件，然后重新部署来实现。这真的可以帮助你确保你没有引起任何问题，没有人踩在任何人的脚趾上，你知道如果我在这个地方的文件中看到它，那就是那里的东西。

米奇·阿什利:嗯。是的，我完全同意你。这对我很有意义。那么，你必须处理哪些复杂的问题呢？因为现在我们工作的环境中，基础设施、堆栈、分布、位置，无论是地理位置还是服务提供商，都可以在不需要整个开发团队的情况下立即改变，这是一个优势，对吗？你想要那种抽象。

蒂姆·戴维斯:没错。

米奇·阿什利:但也有可能——引入新的变量，甚至可能带来新的问题。

蒂姆·戴维斯:是的，可能是新问题，也可能是同样的老问题，或者是你用同样的老方法处理的新问题。而且，你知道，添加控制以确保你遵守策略，比如，你只被允许部署到特定区域或你只能部署特定数量或大小的实例，确保你有某种形式的基于角色的访问控制，你知道，这个人被允许直接部署到开发，没有问题，但是如果它要投入生产，它需要等待批准，并且在我们实际进行推送之前，来自 DevOps 团队或 SRE 团队的某人需要首先验证一切。

米奇·阿什利:嗯。我认为还有一些经常发生的事情——你知道，我是一个安全人员，也是一个软件人员，所以我总是担心它的安全方面。现在，自动化可以做得更好。

蒂姆·戴维斯:完全正确。

米奇·阿什利:更可靠，更少的人为错误。从安全的角度来看，基础设施作为代码带来了很多好处，但它也可能是安全的，它在某种程度上是在编剧和人的眼中—

蒂姆·戴维斯:对。[笑声]

米奇·阿什利(Mitch Ashley):你知道，做配置或者编写脚本，这可能是好的也可能是坏的。在这样一个世界里，你如何解决安全问题？

Tim Davis:是的，这只是我们都听过的术语“左移”的其中一个方面，所有这些不同的方面都发生了变化，包括安全性、性能、计费等，如果你将它左移到部署流程中，如果你促进这种交流，这将非常有帮助。我的意思是，我们知道一个人没有和另一只手交谈的老术语“筒仓”。如果每个人都参与进来，如果安全团队参与了策略的编写，他们就会参与到对策略在部署过程中的实施的双重检查中，这样您就不必在以后去修复有问题的部署，它只是在开始之前就停止了。这确实可以确保每个人都得到他们想要的东西，但安全人员仍然必须参与进来。他们仍然负责整个流程、程序和政策，这只是一种新的实施方式，以及在生命周期的哪个阶段实施。

米奇·阿什利:你认为它会移动吗——实际上，我刚刚就此谈过，我们想把所有东西都向左移动，这通常是个好主意，对吗？

蒂姆·戴维斯:对。

米奇·阿什利:为了能够尽早解决其中一些问题，并设计它，设计安全性，等等。通常，它被解释为，“让我们把这也放在开发人员身上。让我们拥有它们吧——开发人员会担心这个问题的。开发商会担心所有这些。”现在，这几乎是，它可能是一切，有点荒谬的要求，对不对？

蒂姆·戴维斯:对。

米奇·阿什利:因为开发人员没有必要知道所有这些事情。当你说“左移”或“基础设施是代码”时，你的意思是什么

蒂姆·戴维斯:对。

Mitch Ashley:从软件团队的实际角度来看，这看起来像什么？

蒂姆·戴维斯:是的，很多人认为这只是意味着，“嘿，我要拿走你作为安全人员的工作，我要把它交给开发人员”，但事实并非如此。开发人员可能有一点安全意识，他们可能了解基础设施或网络部分，但远不及职业安全人员或职业网络和基础设施人员。它只是把他们带进来，促进对话。

我绝对认为开发人员将成为对话的一部分，因为这将把它带入他们的工具、他们的语言、他们的生命周期，但它仍然需要专业知识来确保它被正确地完成、被正确地实现，并且被按照需要的方式检查。

米奇·阿什利:嗯。那么，用安全工程师的术语来说，他们是否会和开发人员坐在一起，说:“好吧，我们如何配置环境？”“这就是你如何构建你的地形配置”——和他们一起经历这些？

蒂姆·戴维斯:我想是的。

米奇·阿什利:它是在说，“这是我们希望你遵循的原则”—

蒂姆·戴维斯:是的。

米奇·阿什利:“当你创造这个的时候，请做这些事情，然后我们就不用坐在你的肩膀上了”？

蒂姆·戴维斯:我绝对认为有很多不同的方法可以做到这一点。我的意思是，很明显，你知道，举行你的站立会议，确保他们有点告诉他们，“这是政策应该看起来像什么，但是你想实施它是好的，但是这是一种过程和程序，这些是我们需要检查的规则。”因此，这肯定可以做到，但对每个人来说都是最好的，但只要你进行沟通，并确保一切都顺利进行，你知道，你总是可以用不同的方式做到这一点，并取得成功。

米奇·阿什利:嗯。有意思。你看到了哪些变化？你知道，在过去的 12 到 18 个月里，速度有了很大的提高。

蒂姆·戴维斯:对。

米奇·阿什利:你知道，我听到人们谈论——当然，你总是听到，在过去的一年里发生了许多五年计划的数字化转型。

蒂姆·戴维斯:是的。

米奇·阿什利:这有一定的真实性，我相信也有一些夸张。但是有一种强烈的信念，你知道，人们现在认为他们可以更快地部署应用程序，他们已经在最后一个窗口中证明了这一点。你见过这种情况吗？

蒂姆·戴维斯:是的，绝对是这样，你知道，技术在变化。他们过去常说每六个月翻一倍，实际上，我们正在迭代和变化，并以非常非常快的速度前进。很多时候，我们得到了一个新工具，它很棒，然后人们就像这样，“好吧，我要把这个工具拉进来并自动化它”，然后他们发现，“哦，这里有一些额外的复杂性，我们必须回去弄清楚。”

我绝对认为有很多变化，我想，甚至只是从本地传统企业架构到新的云原生架构等的转变。我们正在快速前进，我们能够改变和调整，做我们需要做的事情，但是只要我们确保我们在某种程度上掌握了我们应该从安全或基础架构构造方面做什么，我们就可以确保我们能够尽可能快地迭代、改变和适应，而不会导致任何重大问题。

米奇·阿什利:嗯。酷毙了。你认为未来 6 到 12 个月会是什么样子？如果你必须戴上你的水晶球，你的魔法 8 号球，上面写着“再问一次”？

蒂姆·戴维斯:[笑声]是的，我喜欢研究这个问题。显然，很高兴看到，你知道，我下周午餐会吃什么，而且，你知道，看看这个行业会发生什么。我们看到越来越多的 X 作为代码。我们将基础设施作为代码，将安全性作为代码，将策略作为代码工具。我认为我们将会看到越来越多的代码性能和类似的东西，它们能够将第二天的操作工具更紧密地留在部署周期中，并在存储库中拥有所有这些单一的真实来源，我们确切地知道我们的基础架构应该是什么样子，我们知道它应该如何受到保护，我们知道它应该如何执行。所有这些都是声明性地设置在那里的。我认为我们会看到更多这样的事情发生。

米奇·阿什利:嗯。当然，如你所说，它遵循“一切如代码”，对吗？

蒂姆·戴维斯:完全正确。

米奇·阿什利:如果我们没有学到其他东西，我想这是过去 12 到 18 个月的教训，对吗？它是软件，一切都与软件有关。

蒂姆·戴维斯:绝对是。

米奇·阿什利:你认为当我们继续发展并进入这个快速发展的世界时，人们面临的一些技能挑战是什么，向左移动东西，做更多的基础设施代码，也许星号代码-一切？你知道，自学者总是处于曲线的边缘，其他人有其他的学习方式。就技能、学习和发展而言，我们如何带动每个人？

蒂姆·戴维斯:是的，这绝对是件大事。我是说，我碰到了自己。我本质上是一个基础设施的人，这就是我的整个职业生涯，最终，有人告诉我，“嘿，这个 Python 的东西可能会起飞”或“我听说过这个叫 Terraform 的东西，它基本上就像代码，但这是我们的工作。”而且，你知道，只是意识到没有人试图夺走你的工作，作为一个保安或基础设施的家伙或女孩或你有什么。他们并没有试图把它从你这里拿走，并把它交给开发者，这只是你需要适应以更快前进的事情之一。

现在，不仅仅是基础设施人员在学习编码，开发人员也在学习基础设施，并想出如何针对这种基础设施更好地优化我的应用程序？我们如何共同努力更快地前进？所以，这是一种来自不同的，你知道，老派筒仓的技能的融合，现在一起工作来解决问题。

米奇·阿什利:大约 10 年前，我向一名网络和安全工程师提出了这个建议。就好像——学 Python，他看我的眼神好像我有六只眼睛而不是两只。

蒂姆·戴维斯:[笑声]

米奇·阿什利:他从思科会议回来后说，“现在我知道你为什么这么说了。”[笑声]

蒂姆·戴维斯:完全正确。即使在 2021 年的今天，这也是一个很好的建议。我的意思是，如果你从事基础设施建设，或者你是一名网络技术人员，或者你是一名安全人员，那就去看看 Python 吧。它没有你想象的那么难，而且你可以用它做很多事情。这是进入 DevOps 自动化领域的一种奇妙方式。

米奇·阿什利:我也喜欢这一点，并不是说我们试图让每个人都成为开发人员，但如果这不是你所拥有的技能，这就有点忽略了你可以做的事情的整个领域，以了解正在发生的事情—

蒂姆·戴维斯:对。

米奇·阿什利:或者做自动化等等。这有点像你有一只胳膊被绑在背后，为什么你没有两只胳膊在前面，在那里你可以充分工作？

蒂姆·戴维斯:是的。这也有助于团队之间的理解。当我还是一个专注于基础设施的人时，我自己和开发团队并不关心对方，因为我们似乎都在试图妨碍对方。我们试图解决同样的问题，只是用不同的方式去做，因为我们不一定理解方法论，或者那些人是如何试图完成他们的工作的。

如果你作为一个基础设施、安全或其他操作人员开始学习开发方法并弄清楚事情是如何工作的，这将有助于你更好地跨团队交流和解决问题，因为你可以看到他们的工具集和他们做生意的方式。

米奇·阿什利:太好了。嗯，这是一次很棒的谈话。我很高兴我们能一起探索这条路。

蒂姆·戴维斯:当然。

米奇·阿什利:人们在哪里可以找到更多关于 env0 的信息？我知道你对 env0 的拼写有点奇怪。

蒂姆·戴维斯:[笑声]是的。我们在 env0，E-N-V 和 0.com 号。你可以在 Twitter @E-N-V-Z-E-R-O 和 YouTube 上找到我们。

米奇·阿什利:太好了。所以，零环境，对吧？

蒂姆·戴维斯:完全正确。

米奇·阿什利:完美。嗯，嘿，和你聊天很开心，希望你能再回来。

蒂姆·戴维斯:听起来很棒。我很期待。很高兴见到你，米奇。谢谢你的时间。

米奇·阿什利:好吧，保重。

[End of Audio]