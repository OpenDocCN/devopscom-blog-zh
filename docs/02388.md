# DevOoops 的移动:部署代码不同步

> 原文：<https://devops.com/devooops-moves-deploying-code-out-of-step/>

***“一切如代码”可以为开发团队创造机会***

DevOps 的最终目标是在软件交付过程中创造效率。但并不总是这样。有时开发计划会导致错误——我们亲切地称之为“开发计划”CloudBees 最近对一些同事进行了民意调查，并提出了五个实施减贫的例子。以下是由工程总监 Laura Frank Tacho 提交的关于不同步部署代码的讨论。

## **场景:**

在 CI/CD 期间并行运行可以加速你的自动化测试并缩短你的反馈周期。只需确保部署不是作为并行步骤执行的。这种错误配置将导致您的代码在测试运行的同时进行部署，而不管它们的退出代码，这大大违背了在部署之前进行自动化测试的目的。

这个场景触及了一个我们在同事们想出的大多数“DevOoops”故事中看到的主题。主题是“一切都是代码”这一新兴概念如何为 DevOps 团队创造机会，让他们在众所周知的香蕉皮上滑倒。

在这种情况下，我们讨论的是一个过程中的排序问题，我们可以称之为代码管道。

为了取得成功，团队需要在他们的连续交付生命周期中扩展自动化测试中的质量第一方法——从代码到提交到测试，以及通过开发生命周期的各个层次。对于质量第一的方法，您需要将测试和质量管理作为代码应用到您的环境配置和基础设施中。

Laura 的例子强调了团队需要如何将他们的 CD 管道视为应用程序本身。他们需要检查并消除 CD 管道代码中的错误，以确保代码按预期运行。未能正确管理复杂 CD 交付管道的创建和发展将导致巨大的成本或风险。

因此，如果您没有对应用程序代码进行适当的测试，您可能最终会发布一个根本没有经过测试的应用程序。如果应用程序没有通过安全门，就像它应该通过的那样，你可能会发布非预期的生产前数据。

虽然未经测试的代码总是有风险，但我们必须对未经测试或未经管理的 CD 管道给予独特的考虑。我们需要考虑错过盖茨可能对我们的开发者、我们的组织和我们的客户意味着什么的风险。

团队在发布他们的 CD 管道时应做以下工作:

*   **构建**:从流程的左侧开始，按照应用和开发工件流动的方向，从左到右完成 CD 管道的定义和编码:从开发到测试，再到部署。虽然我们可能无法在第一遍就完全定义一个理想的自动化解决方案，但是从左到右鼓励团队关注工件的生命周期。
*   **管理**:使用一切如代码或管道如代码的方法定义您的 CD 管道。为了增加价值，您必须像管理您的应用程序代码和应用软件最佳实践一样管理您的 CD 管道的开发。将您的 CD 管道代码签入源代码库，并利用特定于语言的技术来检查您的语法。(如果您使用基于 Groovy 的代码或基于 Jenkins 的代码，有一些 Lint 版本可以执行这些功能。)
*   **创建暂存环境**:您应该建立暂存环境或测试管道来验证您的 CD 流程。这些管道应该通过针对您的真实工具的所有检查和检查，使用代表您的管道将服务的应用程序的参考代码，但是在生产到环境中之前停止。

这将给你一个机会来迭代你的应用程序代码，做一些初始的扫描和检查来合作定义你在代码管理 SCM 中的 [CD](https://en.wikipedia.org/wiki/Continuous_delivery) 管道。将扫描作为管道代码执行初始验证，然后在临时环境中验证预期操作，然后将其部署为关键业务应用程序生产管道的基础。

## **关键要点** 

*   这个故事强调了确保您的应用程序代码和环境在部署给客户之前通过某些关卡和检查是多么重要。
*   您需要构建您的 CD 管道，以便将您的并行测试作为生产的入口来管理，确保正确测试和验证的更改不会自动部署。
*   部署发生在管道内所有流程的末尾，在向客户部署任何变更之前，所有要求的测试、验证、检查和批准都已完成。

要阅读我们之前的“DevOoops Moves”帖子，请点击[这里](https://devops.com/devooops-moves-unforeseen-lock-outs/)。

— [布莱恩·道森](https://devops.com/author/bdawson/)