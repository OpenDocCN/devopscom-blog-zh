# 生产中的测试 101

> 原文：<https://devops.com/testing-in-production-101/>

开发人员的首要任务是在他们的用户群访问之前知道他们的新特性代码将在产品中工作。这就是为什么生产中的测试在软件开发行业越来越受欢迎。

开发人员需要知道，他们可以安全地将代码部署到生产环境中，并有能力专门针对内部团队成员，测试功能并验证功能的设计和性能。他们还需要灵活性来修复出现的任何错误或缺陷。选中所有这些复选框后，是时候打开[功能标志](https://devops.com/?s=feature%20flag)并让您的用户群访问新功能了——*已经* *知道*它在生产中工作。

生产中的测试提供了开发人员期望的快速结果，但是如何开始呢？该分步指南提供了最佳实践和操作顺序，说明如何实施才能在生产中成功进行[测试。](https://www.youtube.com/watch?v=gxbxC6AgNM8)

## 生产测试的好处

您不会让您的用户登录到您的测试环境中并以这种方式使用您的软件，那么您为什么要在发布之前使用虚拟环境来测试功能呢？答:这就是一贯的做法。多年来，流程一直是将代码部署到试运行阶段，让 QA 团队在试运行阶段进行测试，然后在测试后部署到生产阶段。但是，当您的试运行测试结果与您的生产结果不匹配时，您会怎么做？你如何告诉在试运行阶段测试该特性的 QA 工程师，它在生产阶段被破坏了？更重要的是，如果试运行不能给你和生产一样的测试结果，那么投入到测试中的所有努力又有什么意义呢？

特性标志通过在生产环境中进行测试，并确认特性将在它最终所处的环境中成功运行，从而使您能够避免这些问题。

底线是客户不关心一个特性在一个阶段环境中的表现。他们关心的是当他们需要使用它的时候它能工作，并且保证它在生产中能工作的唯一方法是在生产中测试它。

## 实施计划

仍然不确定从哪里开始？以下计划列出了实施的前 30 天、60 天和 90 天的逐步说明。

**前 30 天**

在最初的 30 天里，重点应该放在项目协调上，熟悉并学习您决定使用的特性标志管理工具。这段时间应该用来敲定细节，以确保生产中的测试对您的团队有用，其中一个重要的部分是重新审视团队的自动化框架，以确保它易于使用和实现。自动化框架需要能够编写端到端的测试，并有足够的报告，这样当测试失败时，团队就可以更新细节。跳过这一步，您的自动化框架将成为一个障碍，阻碍您未来在生产中的测试，并成为一个烦恼而不是一个好处。不要跳过这一步！

对于那些使用新工具来管理您的特性标记和实验的人来说，下一步是根据您的需求配置工具。这可能包括设置 SSO、权限、用户创建和用户维护。当这些完成后，是时候实现适当的 SDK 了。

这前 30 天也是设定基准的好时机。这些指标可以包括发布时间、页面加载时间、产品中的 bug 相对于产品阶段的百分比、发布前发现的 bug 相对于发布后发现的 bug 的百分比等。有了这些基线度量，您就有了一个可以用来比较任何变更的标准，并且一旦一个特性被发布，您就可以快速地测量它的性能并做出任何必要的过程改进。

**第 30 天到第 60 天**

在接下来的 30 天内，优先设置您的功能标志管理工具，以反映您当前的环境设置。例如，如果你目前在你的软件开发生命周期(SDLC)中有开发、测试、质量保证、UAT 和生产，你应该在你的工具中准确地反映这些。最终，您会将此范围缩小到仅生产和开发环境，以反映生产设置中的真实测试，但现在，这些环境应该反映您应用程序中的当前环境设置。

设置好您的环境后，您可以在功能标志配置的“Allowlist”部分授予团队的各个部分对每个环境的访问权限。例如，如果您的产品团队当前在发布到生产环境后验证功能，您可以为产品团队添加一个段，并允许他们在生产环境中访问该功能。这确保了即使当特性标志关闭时，团队仍然可以访问该特性。

下一步是区分测试数据和生产中的真实数据。这可以通过为生产中的测试实体设置一个布尔值来实现，例如为测试用户设置“is_test_user = true ”,为实际生产用户自动设置“is_test_user = false”。对于与 Datadog 和 Looker 等产品一起使用的商业智能(BI)工具，为所有测试用户的活动创建一个单独的数据库。这使您能够基于真实的用户数据而不是来自生产中自动化测试的数据来做出业务决策。

对于过程的这个阶段，你的团队遵守相同的“完成”定义也是至关重要的。您的团队必须同意一个特性不能被标记为“完成”,直到测试在生产中运行，并且这个标志已经为您的 100%的用户打开。

**第 60 天到第 90 天**

您已经到达了终点，现在有趣的事情开始了:您在生产中的第一次真正测试。首先，为了安全起见，将您的第一个特性部署到生产环境中，并禁用默认规则。这确保了只有目标用户才能访问该功能。接下来，在目标测试用户的生产中运行您的自动化脚本，以及回归套件，以保证先前发布的特性不会受到您的更改的影响。随着特性标记的关闭，只有您的目标团队成员可以访问该特性，您将正式在生产中进行测试。这是解决任何错误和验证所有正确功能的时候了。重要的是要记住，因为最终用户还没有访问您的功能，所以即使出现任何问题，他们也不会受到影响。

在您解决了第一次测试中出现的问题，并且确信该特性将正常工作之后，是时候使用 canary 版本向 1%的用户群开放该特性了。接下来的几天，我们将监控错误日志，增强您对该功能的信心，直到您觉得应该增加可以访问您的功能的用户的百分比。一旦你达到了 100%的用户，并且你毫无疑问地知道这个特性是有效的，那么是时候打开这个特性的默认规则了。

当您到达第 90 天时，您应该有一个常规的测试节奏，下一步是与您的产品团队一起工作来决定哪些测试将以什么样的节奏运行。例如，您可以将较低优先级的测试套件安排在夜间运行，而高优先级的测试套件每小时运行一次。请确保设置当测试失败时自动通知的警报，以便您可以立即分析失败。

在你完成了 90 天的测试之后，和你的团队一起回顾在这个过程中成功的地方，以及团队可以改进的地方。通过以这种方式调整你的团队，并调整流程以使其发挥最佳效果，你正在建立你的团队以实现最佳绩效。

## 放下你的恐惧

在生产中进行测试时，要克服的最大障碍之一是恐惧。团队害怕对他们的用户群产生负面影响，对数据产生负面影响，并且通常会在生产中制造混乱。虽然这些担心是有根据的，但是它们都可以通过特性标志来避免。当特性标志被正确实现时，它们为测试打开了一个可能性的世界。所以把你的恐惧放在一边，相信特征标志的能力吧！