# MongoDB 下一代应用的备份和恢复

> 原文：<https://devops.com/backup-recovery-next-gen-apps-mongodb/>

这个博客是关于 MongoDB 备份和恢复的两部分系列的第一部分。在第一部分中，我将讨论保护驻留在 [MongoDB](https://www.mongodb.com) 上的数据的动机以及现有的备份和恢复解决方案。在第二部分，我将讨论如何解决这个问题。

在大数据时代，企业应用程序会产生大量数据，这些数据可能是结构化、半结构化或非结构化的。此外，应用程序开发周期要短得多，并且应用程序可用性是一项关键要求。考虑到这些应用需求，企业被迫超越传统关系数据库，采用下一代云原生平台 3 应用，即基础架构即服务(IaaS)或平台即服务(PaaS)应用。像 MongoDB 这样的 NoSQL 数据库现在正被企业用于这些下一代应用，包括电子商务和内容管理。MongoDB 的好处有很多，包括动态模式、通过自动分片实现的轻松伸缩、可调的读取一致性和内置复制。

MongoDB 数据库还具有满足可用性需求的本机复制功能。但是，必须满足可扩展时间点备份和恢复的数据保护要求。为了实现强大的数据保护，企业需要备份和复制；如果没有时间点备份，组织将面临因人为错误、逻辑损坏和其他操作故障而丢失数据的巨大风险。传统备份解决方案旨在满足关系数据库上结构化平台 2 应用程序的需求，这些应用程序使用共享存储并具有 ACID(原子性、一致性、隔离性和持久性)事务模型。遗憾的是，它们无法满足平台 3 应用程序和分布式数据库的时间点备份需求(本地存储、最终一致性和基础架构的弹性)。有一些替代的基于脚本的解决方案，如 Strata，企业正在使用这些解决方案来填补数据保护缺口，但这些解决方案充其量是次优的。

## 手动脚本解决方案

手动脚本解决方案(MSS)利用本机 [MongoDB 快照实用程序和脚本](https://medium.freecodecamp.com/mongodb-point-in-time-recoveries-or-how-we-saved-600-dollars-a-month-and-got-a-better-backup-55466b7d714#.tgl5w55t5)将数据传输到辅助存储。这些脚本(通过 mongodump)是为每个 MongoDB 集群定制的，需要大量的操作工作来扩展或适应任何拓扑变化(比如向 MongoDB 数据库添加或删除节点)。此外，这些脚本对诸如节点(主节点或辅助节点)故障或间歇性网络问题等故障场景没有弹性。最后，恢复(“备份”的最大价值)是一个手动过程，因此非常耗时(导致非常长的应用程序停机时间)，并且包含由于脚本中的任何错误而导致的数据丢失风险。总的来说，当 MongoDB 环境很小时，这些解决方案是可行的，并且在应用程序中可能允许一些数据丢失。这些解决方案面临的一些关键问题是:

*   缺乏针对共享配置的企业备份解决方案
*   拍摄快照时，数据库需要离线
*   在节点故障和其他基础架构故障的情况下，备份和恢复都会失败
*   恢复过程是手动的，需要验证，这增加了恢复时间
*   集合级别的恢复需要耗时的手动恢复
*   无法恢复到不同的拓扑(分片→非共享)进行测试/开发更新

大多数企业使用这些脚本方法作为临时的快速解决方案。这就像你开着爆胎的车:你可以继续开；但是，你不可能以你想走的速度走下去，也不是没有灾难风险。

## MongoDB 付费备份和恢复

MongoDB(该公司)提供了几种备份 MongoDB 数据库的方法。企业可以选择在公共云中运行的托管备份产品(MMS ),或者，如果他们是 MongoDB 的付费客户，他们可以在内部部署备份服务。除了成本过高之外，托管备份服务还将客户的数据存储在公共云中。对于在内部部署 MongoDB 的客户以及需要在内部保存敏感数据的客户，通过 WAN 传输备份数据可能不适用。此外，使用这个服务，每个分片都有很大的数据限制。

使用 MongoDB 本地备份服务是可能的，但是部署和操作起来过于复杂(这个[部署图](https://docs.opsmanager.mongodb.com/current/core/system-overview/)说明了一切！).企业需要部署八台服务器、额外的数据库(需要额外的许可)和大约 6 到 9 倍的存储容量(备份数据库的容量)来实现内部备份。

总的来说，现场备份服务是一种理论上的解决方案，它带来了大量的资本支出和 OPEX 投资:

1.  部署多个数据库的复杂性
2.  额外基础架构(服务器和存储)的成本
3.  许可额外 MongoDB 节点的成本
4.  节点出现故障时备份失败的风险(从中进行备份的辅助节点)
5.  仅用于 MongoDB 数据库的孤岛式备份基础架构

期待这次讨论的第二部分即将到来。