# Mesos:安全意识和注意事项

> 原文:[https://devops.com/mesos-security-awareness-considerations/](https://devops.com/mesos-security-awareness-considerations/)

正如普通读者所知，这些天我一直在深入研究 Mesos，在很大程度上，我喜欢围绕它成长起来的整个生态系统。当把服务器组织成一个巨大的应用程序(或微服务)交付平台时，有一些非常酷的可能性。虽然有一点学习曲线，但我不会说它像现有的应用程序配置工具一样糟糕，而且有能力在维护单一参考体系结构的同时扩展和管理应用程序。

但是每种技术都有它的问题，如果它们要在企业中获得成功，我们需要诚实和开放。Mesos 也不例外。

大多数开源项目都是这样开始的，“如果我们只做 X，Y 和 Z，我们就能做这个很酷的东西！”并且仅在之后才考虑目标受众的安全需求。这是野兽的天性，梅索斯也不例外。Mesos 团队目前正在从很少(或可选)的安全性走向企业级安全性，但是现在，需要考虑一些事情来帮助确保您的 Mesos 安装的安全性。

据 Apache Mesos 的联合创始人 Ben Hindman 说:“对于那些在没有认证的情况下运行的人，我们不想在他们升级时破坏他们的集群。默认情况下，身份验证将在框架升级足够长的时间后开启。我们启用了一种混合模式，在这种模式下，一些框架可以进行身份验证，而其他框架则不能，以支持这种升级路径。”

事实是，此时安装 Mesos 的默认设置是没有——我重复一遍，没有——框架认证，并且对这些框架可以看到的内容没有限制。如果您使用[命令行开关](https://mesos.apache.org/documentation/latest/authentication/)，您可以修改这个默认行为，但是在涉及框架时，默认行为仍然是完全开放的。这篇博客的目的是敦促您在您的环境中尽可能使用这些命令行开关。

行业标准是做与 Mesos 完全相反的事情——提供关闭安全性的选项——但在默认情况下是打开的。虽然这使得最初的试点部署更加困难，但这正是 Mesos 需要(并且从 Ben 的上述评论来看，计划)做的。

以下各项合在一起构成了核心问题:

1.  默认情况下，Mesos 允许框架注册而无需认证(参见上面标记为“命令行开关”的链接)。通常，需要某种形式的身份验证。OAuth 访问控制正被越来越多地使用。API 认证设计示例见 [Stormpath](https://stormpath.com/blog/build-api-restify-stormpath) 或 [DigitalOcean](https://www.digitalocean.com/community/tutorials/an-introduction-to-oauth-2) 。
2.  Mesos 使用“ [roles](https://mesos.apache.org/documentation/latest/roles/) 来确定哪些框架可以访问哪些资源。默认情况下，框架可以注册任何角色。
3.  持久磁盘(比如您的数据库或合同目录)可以是在 Mesos 中分配的资源。访问仅由[角色](https://mesos.apache.org/documentation/latest/persistent-volume/)(版本历史之前的最后一个项目符号)控制，以使它们可用于多个框架上的多个应用。这也使得任何承担与具有访问权限的框架相同角色的框架都可以使用访问权限。
4.  Mesos 可以根据需要通过 mesos [fetcher](https://mesos.apache.org/documentation/latest/fetcher/) 将代理分发到集群中的每个节点。因此，代理的分布(这将是这一弱点的限制因素)实际上很容易——一个框架可以根据需要请求将其代理下载到集群中的任何服务器。
5.  有一个公共框架[开发指南](https://mesos.apache.org/documentation/latest/app-framework-development-guide/)。

因此，使用默认的 Mesos 安装，以及任何可以为框架调用 [REST API](https://mesos.apache.org/documentation/latest/endpoints/) 的机器，我可以注册一个我自己构建的框架。Mesos 系统具有注册的自动化批准，因此不涉及人工决策；如果未启用授权，注册(称为调度程序订阅)意味着批准，并且响应包括注册信息。考虑到添加框架的频率应该是最小的，这是一个让人类参与到过程中的好地方。注意，使用 libmesos.so 的旧框架开发也可能滥用这个缺省值，但是这条路更难走，因此不太可能被利用。我的新框架可以提供其他框架中存在的角色，然后我只需等待 Mesos 给我正确的资源，就可以访问这些静态资源。这些资源可以包括分配给该角色的任何持久磁盘，具有读/写访问权限(因为当前的 Mesos 只支持读/写)。这是我在用 Marathon 开发 Mesos 时注意到的，但简单地用 Mesos 也是可能的。

同样，这是一个已知的问题，Mesos 团队正在慢慢解决这个问题。但是现在，如果环境允许，用户需要锁定他们自己的实现。

解决方法很简单，有命令行选项可以打开框架的身份验证，并限制哪些框架可以使用哪些角色。但是您必须将两者都打开——默认情况下它们是关闭的——并且查看我的 Mesos 集群上的日志，似乎没有使用默认的日志记录设置来记录框架注册。请注意，角色管理有开销，但是当应用于框架时，不会造成很大的安全负担，除非操作人员不断地在系统中添加/删除框架(这是极不可能的)。还要记住，系统目前被设计为双向工作的原因是，一些框架还不支持身份验证，因此在生产中推广之前，必须测试这个特性。

我认为这个问题的风险很大吗？老实说，这取决于您的实现。如果有问题的 Mesos 集群将敏感信息放在持久性磁盘上，则风险可能很高。如果有问题的群集不是这样，则仍然存在来自体系结构设计和缺乏身份验证的风险，但是可用的数据(以及在 Mesos 之外如何保护这些数据)决定了攻击的危险程度。修改正在运行的应用程序的配置的能力是另一个问题；单单 HTTP 重定向就可能很麻烦。

简而言之，这个过渡期的存在将使我更加意识到 Mesos 中其他所有东西的安全含义，仅仅是因为它显示了未能遵循通用实践，并且可能表明项目中的其他地方遭受了类似的安全设计决策，尽管朝着修复身份验证的方向发展将使我不那么吹毛求疵。

请注意，我想得到这些信息，因此还没有花时间在我的集群上探索利用这个问题。实施几乎总是提供与研究不同的信息/问题，因为它是过程的不同阶段。当我有时间做一对框架，一个“正常”和一个“攻击者”来测试时，我会更新。在安全性方面，首先测试出问题总是最好的，但是这些问题都有足够的文档记录，我选择在开始可能很长的证明之前通知社区。

这篇文章的目的不是暗示应该避免使用 Mesos。要点是建议您应该遵循、阅读“命令行开关”链接(如上),并且至少应该执行打开身份验证的指南。我也建议限制角色，但至少要为框架打开身份验证，并测试它是否在您的环境中工作。

我要感谢 Ben Tomhave，他是 [New Context](https://www.newcontext.com/) 的安全架构师，他在这些问题上帮助了我。如果我的分析有任何错误，那是我一个人的错误，但是博客对他的帮助要好得多。

唐·麦克维蒂