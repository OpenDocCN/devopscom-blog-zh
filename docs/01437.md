# MongoDB Atlas:一个巨大的飞跃，但需要更多的步骤

> 原文:[https://devo PS . com/MongoDB-atlas-one-giant-leap-steps-needed/](https://devops.com/mongodb-atlas-one-giant-leap-steps-needed/)

阿特拉斯，在云端支撑你的数据库。我不确定这是否是 MongoDB 想要的，但我个人喜欢这种类比。

在[MongoDB World’16](https://www.mongodb.com/world16)大会上，MongoDB 宣布推出 Atlas，这是该公司广受欢迎的开源 NoSQL 数据库(在云端)的数据库即服务产品。Atlas 允许公司将所有这些细节留给 MongoDB 的主人来管理，而不是自己处理设置、供应和配置 MongoDB 集群的复杂性，从而将应用程序开发人员解放出来，专注于更重要的事情(如应用程序开发)。 [Atlas](https://www.mongodb.com/cloud) 目前在亚马逊 AWS 上可用，但有计划将其扩展到其他公共云平台，如微软 Azure 和谷歌云平台。

根据应用程序的需要，Atlas 允许您纵向(使用更强大的服务器)和横向(在集群中使用更多的碎片)扩展或缩小集群。随着数据的增长，您还可以调配更多的磁盘空间。只需告诉 Atlas，它就会自动更新云中的集群，以符合您的规格。文档不清楚 Atlas 是否利用了 AWS 的自动缩放功能，但似乎缩放必须手动完成。

## 启动 MongoDB 集群

当您第一次登录 Atlas 时，您会看到一个非常简单的用户界面(UI)。您可以做的第一件事就是在云中启动一个新的集群。

![2](../Images/3aceaab32926d3a5d2d1146e3cfc6ff9.png)在部署集群之前，您需要了解放置集群的 AWS 区域、AWS 实例大小、所需的磁盘空间量、是否使用加密存储、是否启用备份、底层存储的速度(即 IOPS 的数量)以及碎片和副本集成员的数量。

首先，指定要在其上运行集群的 AWS 实例的类型(范围从 M10 到 M100)以及要提供多少磁盘空间，从 10GB 到 16TB。所有实例都可以配置加密存储，无需额外费用。我首先从 M10 实例中选择默认设置开始，这也是最便宜的。

*![3](../Images/f4c9961d43fc789d3c2c2fe9a753bf1f.png)实例尺寸、规格和可配置选项。包括成本在内的详细信息整合在右侧。*

指定实例后，可以配置集群中的节点数量。对于副本集，可以有三个、五个或七个成员。此外，您可以指定是否应对集群进行分片以及集群中的分片数量。请注意，分片集群需要 M50 或更高版本的 AWS 实例，这是成本更高的*实例之一，因此从基本的非共享集群到分片集群的转换成本相当高！*

*![4](../Images/40bfc0a10e374ce9be42a9742d773633.png)T2】*

*![5](../Images/ed521be3976cc351e8df438058198ac8.png)最便宜的分片簇* *比最便宜的非分片簇* *贵 56 倍。如果可以的话，您可能不想将 Atlas 用于任何分片的测试集群。*

对集群配置感到满意后，只需单击“确认和部署”我的集群在几分钟内就启动了，但你的里程数可能会有所不同。将访问 Atlas 实例的 IP 地址添加到安全白名单后，就可以开始使用新的 mongo 集群了。我真正欣赏 Atlas 的一点是，它为您提供了连接到您的集群应该使用的确切命令和主机名(通过 mongo shell 以及通过 MongoDB 的许多驱动程序)。这使得连接到您的集群变得异常简单。复制粘贴即可。

*![6](../Images/d08c603d4b9aebb4cea4e6b863729c9e.png) Atlas 为您提供集群的高级统计数据，包括 IOPS、读写性能、磁盘使用情况等。您还可以获得每个节点的更详细的指标。*

*![7](../Images/364bac4940e98496270c22294c1a760a.png)轻松连接到您的集群！只需下载一个更新的 mongos 二进制文件，然后复制粘贴即可。*

创建集群后，通过添加更多碎片来水平扩展集群是相当简单的。对我来说，将我的 1×3 集群升级到 2×3 集群的整个过程花费了大约 10 分钟(同样，您的里程可能会有所不同)。相当光滑！在这个过程中，Atlas 将自动提供更多的服务器，并用新的配置服务器、mongos 和 shards 来配置您的集群。值得注意的是，一旦您决定对集群进行分片，您将无法返回到非共享的实例，所以当您决定向上扩展到分片集群时，请确保您绝对*确定——您将无法返回！*

总的来说，除了少数不受支持的情况，设置集群和手动扩展集群的过程相当顺利。虽然到目前为止在将集群配置减少到几个可调选项方面所取得的成绩无疑是在简化用户集群设置的正确方向上迈出了一步，但是 Atlas 还可以做得更多。与其他现有的云数据库服务相比，如亚马逊的 DynamoDB 或微软的 DocumentDB，在这些服务中，您只需指定应用程序的 IOPS 需求(应用程序 IOPS，而不是 Atlas 中的存储 IOPS)。在这些相互竞争的云数据库中，用户看不到复制、碎片数量和高可用性等问题。诚然，DocumentDB 已经推出一年了，DynamoDB 在此之前已经推出很多年了，所以 Atlas 赶上来只是时间问题。无论如何，Atlas 还可以做得更多，以实现真正的无服务器甚至更简单的使用——这是坚实的第一步，但还需要开发更多来与云数据库竞争并赢得企业客户。

## 幕后:备份和恢复

现在，由于我在 Datos IO 从事类似的工作，我对 Atlas 的备份和恢复选项非常感兴趣。乍一看，它与 MongoDB 早期产品(如 CloudManager 和 OpsManager)提供的备份和恢复服务很相似。在体验了这个特性之后，我更加确信 Atlas 使用的备份技术本质上与以前的产品是一样的，只是它应用于 Atlas 实例。

前 1GB 的备份是免费的，之后每 GB 每月 2.50 美元。可以按设定的时间间隔安排备份，但最小时间间隔为六小时。虽然我最初被最短的快照时间间隔吓住了(毕竟，六个小时内会发生很多事情！)，经过一些调查，Atlas 还允许您在快照之间安排“检查点”。检查点可用作恢复点，但它们需要更长的时间来恢复，因为它需要应用自上次快照以来的所有增量。需要注意的是，该特性仅适用于分片集群。如果您想要保护非共享集群上的数据，那么您将不得不接受 6 小时的最小快照间隔。

在群集初始化期间，可以通过切换标志来设置备份。在恢复期间，您可以选择要恢复的特定快照。如果您需要更精细的恢复粒度，Atlas 还提供了时间点恢复，这非常简单。您可以指定两个快照之间的时间，以分钟级粒度进行恢复。如果您需要更精细的粒度，您可以指定要恢复的特定操作日志时间戳和时间间隔。

*![8](../Images/b1137dec9ea7790d7666cdea5b4a0fa1.png)现有集群快照和您可以执行的恢复类型。*

当我执行一些备份和恢复时，我对这个特性有一些保留。我的疑虑大多来自于 Atlas 将整个集群视为其备份“单元”这一事实。我的意思是，Atlas 创建的备份是整个集群的快照。所以根本没有粒度，这在几个方面是有问题的。

首先，由于 Atlas 会拍摄整个集群的快照，因此您无法控制想要备份哪些数据。例如，您的数据库中只有一小部分包含需要备份的关键敏感信息。使用 Atlas，要备份您的关键数据，您还必须备份所有非关键数据！考虑到备份成本会随着数据大小的增加而增加，您最终会不必要地为备份您并不真正关心的数据支付大量费用。

此外，由于备份是在群集级别进行的，您在恢复备份时的选择受到了限制。由于是群集级快照，备份必须恢复整个群集；您不能还原特定的数据库或集合。比如说，当生产集群中只有一个集合损坏时，这可能会产生问题。在这种情况下，Atlas 采取了一种非常强硬的方法，即关闭整个集群并将每个集合重置回快照点，而不是只恢复有问题的集合。

最后，Atlas 只允许您将快照恢复到与快照具有相同碎片数量的集群。例如，如果您有一个包含三个碎片的集群，您只能恢复到包含三个碎片的其他集群。您可能希望将数据恢复到具有不同拓扑的集群的一个潜在原因是出于测试目的:您可能希望随着集群中碎片数量的增加来测量应用程序性能，或者您可能只需要一个小型、廉价的集群来进行基本测试。如果您想将生产数据恢复到 Atlas 中的一个测试集群，您要么必须启动一个与生产集群具有相同拓扑的集群(这对 MongoDB 来说是好的，但对您的钱包来说是坏的)，要么您必须手动从 Atlas 中下载数据，然后手动将该数据恢复到 Atlas 中的一个不同拓扑的集群中。这两种情况都可行，但远非理想。

## 总结想法

Atlas 是 MongoDB 的一个很好的举措，通过将集群配置的许多更普通的细节抽象给最了解 MongoDB 的人，使得在其数据库之上构建应用程序变得更加容易。对我来说，Atlas 是创建和扩展 MongoDB 集群的一种简单快捷的方式。虽然朝着正确的方向迈出了很好的一步，但 Atlas 还可以做得更多，使其成为真正的无服务器方法，就像目前市场上的其他云数据库一样。