# 使用托管服务优化 Prometheus 实施

> 原文：<https://devops.com/optimizing-prometheus-implementations-with-managed-services/>

[Prometheus](https://prometheusintelligence.com/) 是一款领先的基于指标的开源监控解决方案和时间序列数据库，用于整个 IT 社区[从系统、应用和服务中收集指标](https://devops.com/using-devops-metrics-effectively/)。根据 云原生计算基金会(CNCF)的 2021 年云原生调查，Prometheus 在生产中的使用已经达到 65%，同比增长 43%。

“随着云原生堆栈的发展和成熟，可观察性对于应用指标、性能、警报和洞察力的可见性变得至关重要，”CNCF 首席技术官克里斯 阿尼斯奇克 说。"普罗米修斯是其中的一个关键因素，使组织能够建立一个可观察性的基础."

如果你正在使用 Prometheus，那很可能是因为它的诸多优点包括可靠性、易于初始实现以及 其 的开源性质。然而，除了这些好处之外，如果您自己部署和维护解决方案，Prometheus 也会带来一些挑战。

### 面对普罗米修斯的四大挑战

Prometheus 用户面临四个主要挑战，这些挑战可以通过合适的服务提供商得到缓解:

**挑战一:支持**

Prometheus 用户面临着任何 开源 工具带来的困境:解决方案背后没有供应商提供技术支持。人们很容易将技术支持视为理所当然，但是当您正在使用一项不受支持的技术时，即使是一个小问题也可能会变成一个大问题。一个商业支持的产品可以提供你内部没有的关键水平的专业知识，负责保持系统正常运行。

**挑战二:维修**

在 Prometheus 中，你可能面临的最大挑战是你的团队必须花费大量的时间来配置和维护系统。

Prometheus 如何消耗您的资源的一个例子是使用第三方导出程序以 Prometheus 格式公开指标。这些集成是由 开源 社区的成员设计的，不提供任何支持；升级是偶然的。

出口商很难维持。首先，通常有多个出口商选项，为每项服务选择正确的选项非常耗时。第二，您可以轻松地在您的环境中运行数百种不同的服务，并且您的团队可以每天花费数小时来确保导出器正常工作。

另一个维护问题涉及到普罗米修斯查询语言。 PromQL 是一种自定义查询语言，而且非常复杂，很难学。不得不依靠您的一个 PromQL 专家来处理整个组织的所有 Prometheus 查询，这是不切实际的，也是不可持续的。

面对所有这些维护需求，您将会让一些团队成员把所有时间都花在管理和维护 Prometheus 环境上，消耗掉原本可以专注于业务需求和创新新应用的资源。

**挑战三:扩展性**

用户倾向于在孤岛中部署 Prometheus，每个集群有一个单独的服务器。随着时间的推移，您的环境中可能会有数十台甚至数百台 Prometheus 服务器，而您对此一无所知。这导致了关于一致性、可维护性和度量全局视图的可伸缩性问题。

此外，存储是扩展 Prometheus 的一个主要障碍，因为系统通常会存储大约两周的指标。如果您需要分析超过几周的指标，就会遇到严重的问题。

**挑战四:关联数据**

如果您无法将数据关联起来，那么数据就没有多大价值，而且不幸的是，Prometheus 不提供指标与您环境中其他元素(如流程或云区域)的关联。这使得 很难查明 问题的来源或影响。

### 解决普罗米修斯挑战的选项

有几种选择可以帮助你解决的问题，但大多数都不能解决上述四个主要问题。以下是您的选择:

**APM:** APM 厂商都对 Prometheus 有一定程度的支持，但这是他们平台的附加产品。它们提供了一个接收工具，可以将 Prometheus 数据转换为您可以在 APM 平台中进行本地查询的格式。在 现实中，他们 不是在帮助你利用普罗米修斯，而是在强迫你在他们系统的约束下工作。

**云工具** : 某云 超大型 提供方案支持普罗米修斯。这些工具可以帮助进行部署和基础设施维护，但是您仍然需要做所有其他的配置和维护工作。

**托管服务:** 首选是普罗米修斯托管服务，可以缓解 开源 普罗米修斯带来的所有四大挑战。合适的优化托管服务提供商提供支持、维护、长期存储和数据关联。

### 【Prometheus 托管服务提供商必备的功能

以下是您在选择 Prometheus 托管服务提供商时应该考虑的基本能力:

**Prometheus 兼容性** **:** 您需要一个优化的托管服务提供商，其平台设计为与 Prometheus 本机兼容，使用 Prometheus 格式的数据，并允许您对数据运行 PromQL 查询。

**简化PromQL:**为了消除每个查询对 PromQL 专家的依赖，托管服务提供商应在不破坏兼容性的情况下简化 PromQL 的使用。

**出口商管理:** 合适的优化托管服务提供商将能够简化出口商的选择、部署和管理，为您节省大量时间和精力。

**自动发现:** 跟踪和优化您的所有服务可能会很有挑战性。因此，Prometheus 管理的服务应该能够自动发现在您的 环境中运行的服务，并通过 帮助指导您进行配置。

**公制储存:** 普罗米修斯的缺点之一就是缺乏长期储存。因此，Prometheus 托管服务提供商应提供一个长期存储指标的数据库，以便您可以执行逐月甚至逐年的数据比较分析。

**普罗米修斯兼容性:** 如果你已经在使用 开源 普罗米修斯，你的团队习惯使用 PromQL 和 Grafana 仪表盘之类的东西。您应该选择与 Prometheus 兼容的托管服务提供商，以便您的团队可以使用他们一直用来查看数据的相同仪表板和查询。

### 结论:优化的贵重工具

Prometheus 不是一个独立的解决方案。但它是一个经过优化的有价值的工具，可以收集性能分析的指标，受到您的架构师、开发人员和 it 运营专家的赞赏。虽然普罗米修斯可能有一些局限性，但找到这些问题的解决方案是值得的；该解决方案是托管的 Prometheus 服务。合适的托管服务提供商可以为您提供两全其美的服务 Prometheus 的所有优势，而无需有效运行它所需的时间、资源和费用。