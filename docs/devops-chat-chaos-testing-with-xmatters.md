# DevOps 聊天:用 xMatters 进行混沌测试

> 原文：<https://devops.com/devops-chat-chaos-testing-with-xmatters/>

将混乱的、不可预测的测试软件引入你的系统化测试体系是一个好主意，对吗？是的，它是测试的一个分支，叫做混沌工程，或者混沌测试。网飞的“混沌猴子”向我们许多人介绍了一个著名的想法，即如果我们使用混沌测试方法在客户之前找到它们的弱点，弹性系统、网络和软件会变得更有弹性，更不脆弱。

xMatters 的一名创新工程师推出了一款新的开源混沌测试工具，该工具以 H.P. Lovecraft 的噩梦般人物克苏鲁命名。Cthulhu 旨在跨多个云提供商进行测试，最初支持谷歌云，计划支持亚马逊网络服务。它是开源的，可以免费使用，正在寻找更多的贡献者，并且可以在 GitHub 上获得。

CTO Tobias Dunn-Krahn 和 Cthulhu 开源项目的首席工程师 Gabrielle Gasse 参加了我们的 DevOps 聊天，两人都在 xMatters。

像往常一样，下面是流媒体音频，然后是我们的谈话记录。

[https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/635744880&color=%23ff5500&auto_play=false&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true](https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/635744880&color=%23ff5500&auto_play=false&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true)

## 副本

米奇·阿什利:大家好。我是米奇·阿什利，和 DevOps.com 在一起，您正在收听的是另一个 DevOps 聊天播客。今天，xMatters 的首席技术官 Tobias Dunn-Krahn 和 Gabrielle Gasse 加入了我的讨论，他们是我们将要讨论的软件项目 Cthulhu 的首席工程师，这就是我们今天的主题。

现在，如果你读过 H. P. Lovecraft 的书，你至少知道我们正在谈论的这个虚构的人物，但我们将进入这个软件，并了解它的更多功能。

Tobias，Gabrielle——欢迎来到 DevOps 聊天室。

托拜厄斯·邓恩-克拉恩:谢谢。

阿什莉:好吧，让我们从自我介绍开始。你呢，Tobias，如果你愿意开始，就介绍一下——告诉我们一点关于你自己，xMatters 做什么，你作为 CTO 在那里做什么。

邓恩-克拉恩:当然。我叫 Tobias Dunn-Krahn，xMatters 的首席技术官。这需要的是开发运营、质量和产品战略的权限。所以，这就是我的角色。

xMatters 是做什么的？xMatters 是一个数字服务可用性平台。这在实际意义上意味着 xMatters 帮助负责数字服务的团队为这些服务提供高水平的正常运行时间和可靠性。因此，这意味着为这些服务过滤不需要的信号，在这些信号相关时使用解决程序，促进事件解决过程中的协作，以及在工具链中集成工具，以消除解决事件过程中涉及的任何手动工作，以便能够非常及时地完成。

这就是 xMatters 所做的，也是我所做的。

阿什利:有意思，是的。我很想知道克苏鲁是如何融入其中的。Gabrielle，你能介绍一下你自己并告诉我们一些关于你在 xMatters 做什么吗？

加布里埃尔·加斯:是的，当然。所以，我是克苏鲁的首席工程师，我们的混沌测试工具。日复一日，我也只是一个系统本身的 Java 开发人员。

当我大约一年前进入公司时，我的任务是在我们将系统迁移到谷歌云时验证系统的弹性。因此，我对现有的工具做了一些研究，并意识到我们需要一些已经可用的有点不同的东西。这就是我开始建造克苏鲁的原因。

因为——这不是 xMatters 的核心产品，而且我们确实希望将混沌工程的使用作为每个人的日常实践来推广，所以我们决定以开源方式发布该工具本身。

阿什利:太好了。也许我们应该从这开始，对于不知道什么是混沌工程或其背后理论的人，你想说一点吗，加布里埃尔？

**加塞:**当然。因此，混沌工程背后的想法是，如果你想到一个由多个微服务组成的分布式系统，你可能最终会有大量的小型虚拟机或容器并行运行。而且，当东西部署在云中时，有时会发生故障。它总是发生。

因此，混沌工程把这作为一个前提，它说如果你预期会一直失败，那么你将在头脑中建立你的软件的弹性，以便失败不是一个问题。所以，这就是混沌工程的想法的来源。因此，像 Cthulhu 这样的工具将在我们的系统中运行，它会导致停机，因此我们可以验证我们的系统是否检测到这些问题，并且在某些情况下——在大多数情况下，理想情况下——以编程方式或主题方式从这些故障中恢复，这样我们就不需要在凌晨 3 点呼叫我们的工程师了

Ashley: Tobias，这个项目或想法是你想出来的，还是你和 Gabrielle 一起做的，Gabrielle 来找你，还是这一切都是从 xMatters 开始的？

不，我不会为这个项目邀功。*【笑声】*我会把这个完全交给加布里埃尔。但是从另一个角度来看，当我们随着时间的推移将我们的整体分解为微服务时，我们真正想要做的是缩小我们团队中主题专业知识和知识的范围，以专注于我们系统的一小部分。因此，这降低了单个团队的复杂性，并能够保持这些服务正常运行和高度可靠。

但它也引入了一个问题，它将复杂性引入服务之间的空间，这些服务的不同故障模式，依赖关系的不同复杂性。

因此，在我们的数字化转型过程中，我们很早就认识到了这一点，Gabrielle 提出了为此引入混沌测试的想法，并且现有的混沌测试工具不适合我们的目的，我会让她解释克苏鲁是如何不同的。

阿什利:好的，太好了。加布里埃尔，你为什么不从那里拿起它？

**加塞:**是的。所以，一年前，当我们开始研究混沌工程的时候，有一些可用的工具。混沌猴是很受欢迎的一个。当时，Chaos Monkey 主要为 Amazon Web Service 工作，并且它也部署在 Spinnaker 中。但这对我们没用，所以，我们在谷歌云上。

我们想出了这个工具，它可以连接到许多不同的云服务——目前，我们支持谷歌云和 Kubernetes，但我们正在添加其他服务，例如亚马逊网络服务。因此，它可以一起运行这些失败场景，而且，我们希望能够对这些测试进行版本控制，以便当我们发现导致失败的特定场景时，我们可以有一种方法将其生成为文件，如果您愿意，我们可以将它附加到一个错误上，然后交给工程师处理。

**Ashley:** 那么，让我问一下，你提到了混沌猴，对我来说，这是对你正在做的事情的一种自然的比较——克苏鲁是否一直在后台运行，制造混乱，就像混沌猴在生产环境中让事情停止并查看它们是否恢复一样？克苏鲁也是这样吗？或者你采取了一点不同的方法？

**Gasse:** 类似，虽然有不同的运行方式。在 xMatters 的通常场景中，我们根据需要运行它。因此，我们有一个小场景，我们将立即运行。正如你提到的，在后台运行 Cthulhu 也是可能的，它将获取测试并运行它们。

阿什利:嗯。那么，用有针对性的控制方式运行它，还是让它在后台运行，做它的事，两种方式都可以？

是的，没错。这种想法很大程度上是为了能够像混沌猴一样不断地运行它，但也为工程师提供了一个工具，以便在本地或开发环境中执行一个场景，尝试重现和理解故障。

**Ashley:** 你提到了，当然，Chaos Monkey 是由 Amazon Web Services 创建的，在 AWS 环境中运行得非常好——多种云服务是 Cthulhu 的主要优势吗，或者也进入了 Kubernetes、Docker、Containers，你认为这是 Cthulhu 做的特殊附加功能，而其他工具可能没有？你创造克苏鲁的所有优势是什么？

混沌猴子实际上是由网飞创造的，他们在亚马逊网络服务上有栈。

阿什莉:哦，你说得对。是的，我的错误——谢谢你纠正我。

但是，正如你提到的，混沌猴只在亚马逊网络服务的虚拟机上工作。还有其他工具，比如 Pumba，可以在 Docker 容器级别工作。强大的 Seal 于去年推出，当时我们正在考虑这个问题，强大的 Seal 在 Kubernetes 的 pod 和节点级别上进行部署，这非常有趣。

但是，没有一个系统可以做到这一点——可以跨所有这些平台进行测试。你需要使用强大的 Seal 与 Pumba 配合使用，当时没有任何东西直接运行在 Google Cloud 上。现在，混沌猴确实支持谷歌云。

因此，Cthulhu 为我们带来的主要价值是能够拥有一个工具，可以跨我们的 Kubernetes 部署和虚拟机执行复杂的故障场景。是的，正如我前面提到的，我们还希望能够对其中一些测试进行版本控制，这样我们就可以将它们传递给我们的开发人员，让他们使用 Chaos Monkey 和其他工具，通过一些参数来运行它们，以过滤掉您不希望它崩溃的某些机器。然后它就从那里开始滚动。什么都没有——没有办法从中构建一个可重复的场景。

我们用它测试的一部分是我们的系统能够检测故障。因此，当我们运行一个场景时，我们希望 Splunk 中记录错误，并向我们发送警报。因此，工具本身只是引入了故障，然后由工程师来寻找故障所在。

**阿什利:**嗯哼，嗯哼。非常好。托拜厄斯，克苏鲁如何融入 xMatters 的战略？

**邓恩-克拉恩:**所以，我们会——你知道，我们的个人经历或我们的公司经历经历我们自己的数字化转型——这是一个持续的过程，我不想让它听起来像我们已经完成了，我们永远不会完成。但这很有教育意义，我们学到了很多，我们愿意分享。我们的许多客户都在经历同样的事情，因此我们希望为他们提供在这些转型中取得成功所需的工具。

因此，克苏鲁在过渡过程中提供的帮助尤其多，如果你是一家云原生公司，你会遇到这种情况。因此，我们希望为我们的客户和整个社区提供支持。我们长期以来一直是开源软件的用户，我们希望回报社区，并获得扩展的开发者社区为 Cthulhu 做出贡献的所有优势，我们可以一起让它变得更好。

阿什利:太好了。所以，克苏鲁是一个开源项目。你把它放在 GitHub 还是你自己的服务器上？人们在哪里找到它？

**邓恩-克拉恩:**加布里埃尔，你可以确认，但我相信它在 GitHub 上。

加塞:没错，是的。

阿什利:太好了。你知道，有时开源项目是开放的，但大部分工作是由首席开发人员或创意者完成的。有时，这是一个非常活跃的社区，人们在那里测试或创造新的功能。你知道，其中一部分不仅是项目的风格，还有它的成熟度。

你在哪里？加布丽尔，主要是你在工作吗？你有——你从外界从其他人那里有什么样的活动？

是的，克苏鲁是最近才在 GitHub 上发表的。到目前为止，当我们推广它的时候，已经有相当数量的维多利亚本地人在关注这个项目，但是我们还没有看到真正开始为它贡献模块的人。

阿什利:嗯。

我认为下一个真正有助于激励人们使用 Cthulhu 并贡献额外模块的补充将是我们对亚马逊网络服务的支持。

阿什利:嗯。它出来多久了？我应该先问的。

**Gasse:** 出了几个月了，才。

阿什莉:好的。所以，在它生命的早期。所以，有趣的是，随着越来越多的人使用它，通常会有人对此感兴趣并说，“嗯，我想在这里放些东西。我想尝试做一些改变，贡献一些东西。”克苏鲁是用什么写的？

克苏鲁是用 Java 写的。我们正在使用 Spring Boot 平台，作为该平台的一部分，有一种简单的方法来编写模块，插入到平台中，增加功能。所以，在克苏鲁中很容易添加新的破解方法，而不必理解整个代码库。

阿什利:关于克苏鲁，我们还应该知道些什么？

**Gasse:** 我可以简单谈谈路线图上的下一个项目，如果—

阿什利:那太好了，是的。

**胡同:**——对。

阿什莉:当然，很高兴听到这个消息。

**加塞:**嗯嗯。因此，在完成对 AWS 的支持之后，如果您愿意，我的下一个任务是开始添加一个功能，通过 SSH 运行命令，并通过目标主机上的 SCP 发送文件。这为一系列全新的测试打开了大门。例如，可以在目标虚拟机上暂停一个进程来模拟死机，或者使用流量控制等工具在网络上引入噪声、丢失数据包等等。

因此，一旦我们有了这种支持，我们就真的能够应对许多有趣的故障类型，而不仅仅是虚拟机已经关闭并且不再可用。

阿什莉:托拜厄斯，我非常感谢你把所有该归功于加布里埃尔的功劳都交给了你。我也很欣赏你的想法，从战略上或与产品计划、产品战略相结合的角度，你认为克苏鲁的未来是什么？

邓恩-克拉恩:当然。嗯，正如我前面提到的，xMatters 产品是为了帮助团队支持数字服务而构建的，其中的一部分是确保您不仅为事件做好计划，而且可以模拟真实世界的事件并进行某种形式的练习或演习。

因此，我认为未来集成到产品中的方式是促进这些类型的实践，然后评估团队的表现，或者 xMatters 中的所有配置都是正确的，以尽快解决问题，等等。

阿什利:优秀。嗯，你知道，我们可能只是刚刚触及表面，我很兴奋地看到你们都做了什么，以及社区对克苏鲁做了什么。感谢你们两位参加播客。我感谢来自 xMatters 的 Tobias Dunn-Krahn 和 Gabrielle Gasse，任何其他信息都可以在 [xMatters](https://www.xmatters.com/) 获得，是这样吗，Tobias？

邓恩-克拉恩:这是个好问题。是的，网站上肯定有一些材料，或者你可以在网上搜索一下，如果你知道如何拼写的话。

阿什利: *【笑声】*好吧，让我给大家一个开头，它是 C-T-H-U-L-H-U，就像 H. P .洛夫克拉夫特拼写的那样。嗯，我想感谢你们两位，Tobias 和 Gabrielle，参加我们今天的播客。时间又一次飞逝，希望随着这一过程的发展，我们可以让你在另一个时间回来，你可以告诉我们更多关于你把它带到哪里以及人们对克苏鲁做了什么的故事。

邓恩-克拉恩:好的。非常感谢邀请我们。

阿什莉:没错。谢谢你。我是 DevOps.com[的米奇·阿什利](https://devops.com/)，您已经听到了另一个 DevOps 聊天。

— [米切尔·阿什利](https://devops.com/author/mitchellashley/)