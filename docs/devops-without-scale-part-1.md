# 不带刻度的 DevOps，第 1 部分

> 原文：<https://devops.com/devops-without-scale-part-1/>

当大多数人想到 DevOps 时，首先想到的是持续集成(CI)和持续开发(CD)管道。虽然它们可以说是 DevOps 最重要的部分，但它们并不是全部。那么，DevOps 是什么？它是一种关于如何构建和操作软件产品和系统以提供最佳用户体验的哲学。这是一种将以前独立的开发和操作规程混合在一起的思维方式，这样软件产品既可以在功能上发展，又可以在操作上保持稳定。实际上，这意味着开发团队参与运营，并且在许多情况下，完全拥有他们产品的运营。

顶级公司已经在那里了，因为否则他们就不能交付 99.9%正常运行时间的大量功能丰富的产品。但是仍然有太多的公司和开发者没有“这么做”这通常反映在产品质量上。

DevOps 似乎被打上了困难的烙印，需要昂贵的工具，如果你很大，通常被归类为需要。在这篇博客中，我将带您了解 DevOps 的不同方面，并分享每个方面背后的商业价值、常见的实现技术和免费(或廉价)工具，它们将让您在几周内快速启动您的 DevOps。

## 产品健康:用户体验

作为工程师，我们的目标是制造可供他人使用的产品。通常我们称他们为用户，有时我们与他们有着紧张的关系。但是，如果用户不喜欢我们的产品，也不使用它们，那么我们的核心工作就失败了。那么，除了功能，用户还想要什么呢？

用户想要速度相当快的产品，并且在他们需要的时候工作。你的网站宕机是一个明显的例子，说明了了解产品健康状况的重要性。但是还有更微妙的例子。有时一个新的发布打破了一个边缘案例，并且没有被回归测试所捕获。有时服务变得很慢——它仍然工作，没有人抱怨，但它已经危险地接近不可用了。你需要了解用户的体验，这样你才能积极主动地解决问题并交付高质量的产品。

因此，您需要测量的第一组指标是用户体验指标。这些通常包括所有外部端点的成功/失败和延迟:REST、网页等。如果用户是外部的，您希望从他们的角度来衡量体验，包括网络延迟和网页的 HTML/CSS/JS 执行时间。如果这是一辆汽车，这些指标将是你的低冷却剂红灯。如果灯亮了，你必须尽快停下来，在你的发动机缸体因过热而破裂之前添加冷却液。

要测量和监控网页的客户体验，Google Analytics 是目前最受欢迎的选择。它很容易设置，并给你你想要的:每页的错误统计，页面加载时间，包括单个页面组件，甚至浏览器解析 HTML 的时间。您可以根据地理区域、浏览器类型等对数据进行分割，以确定需要改进或有问题的地方。Google Analytics 也是一个很好的跟踪产品其他方面的工具，采用它你可以一石多鸟。

然而，谷歌分析将只提供数据，只要有用户和你的网站工作。但是，如果网站崩溃了，可能是部分崩溃，也可能只是某个地理区域的崩溃，该怎么办呢？对于不能使用 Google Analytics 的公共 API，你会怎么做呢？你需要一个综合监控服务。这些服务通过自动调用 API 或打开网页来模拟客户端。它们通常是可脚本化的，并在世界各地运行。他们可以告诉您您的服务何时启动或关闭，并可以按地理区域测量(模拟)用户延迟。Pingdom 是新一代的这类服务之一，它以适中的价格提供你所需要的东西。它还集成了一个名为 [Datadog](https://www.datadoghq.com/) 的图形和报警工具，我稍后会谈到。

## 产品健康:技术内部

现在你对你的用户体验有了一个坚实的了解，可以实时检测用户问题。但是如何找到根本原因呢？通过在用户问题发生之前发现它们，你能做得更好吗？你需要做的是更深入一层，监控应用程序的关键技术方面，这样你就可以将它们与用户问题联系起来。观察技术指标很重要，因为它们可能是问题的早期迹象，如果你行动迅速，问题是可以避免的。

这可能是一个危险的领域，因为第一个愿望是监控一切。请在这里保持冷静，以免你淹没在数百个没人理解的指标中，错过重要的指标。在软件中，失败通常发生在集成点，所以这是您应该关注的:数据库和缓存交互、对其他服务的调用、磁盘操作、队列大小(对于发布/订阅架构)等等。通常情况下，您不需要测试业务逻辑，因为它要么工作要么不工作，问题会在测试中被发现。这是很容易在一瞬间创建许多指标的地方。一个值得注意的(也是罕见的)例外是，出于性能原因，您希望监控代码的负载密集型部分。

如果您发现数据库调用的延迟增加，缓存命中率下降，或者线程池或队列大小增加，您可以在问题影响到用户之前经常发现并修复问题。更深入地说，您希望密切关注虚拟机(VM)和服务器性能。如果你的垃圾收集次数增加了，如果你的线程数增加了，或者如果你的服务器显示出压力的迹象，是时候格外注意了。如果这是一辆车，这将是你的检查引擎黄灯。如果灯亮了，你需要马上检查一下，但是你可以再开一会儿。

测量应用程序指标最流行的方法是使用代码工具。目前，Coda Hale(又名 [Dropwizard](https://dropwizard.github.io/metrics/3.1.0/#) )度量框架及其对大多数流行语言的移植正在进行中。考虑到大量的文档和与各种系统的集成，这并不困难。有许多编码模式或外部库可以用来避免编写样板代码。请注意，您希望在测量请求(序列化、日志记录等)中包含尽可能多的内容。)因此，您需要尽可能将这个逻辑放在过滤器链或中间件的最高层。

难题的最后一部分是虚拟机和服务器监控。传统上，这是专门的操作工具的领域，但是我将在下一节中讨论的服务 Datadog 提供了开箱即用的功能。它的代理运行在每台机器或虚拟机上，收集服务器指标、JVM/JMX 数据、IIS 信息(是的，它甚至支持 Windows)等等。

## 处理和显示数据

现在，您的代码被检测并生成各种有趣的数据。你用它做什么？这些数据首先去了哪里？如果这些数据就放在那里，那么它们就毫无用处。您希望能够观察趋势，将它们关联起来，并获得一组基本的统计信息，如平均值、均值、标准差等。你也想看到漂亮的图表(谁不想呢？)并能够创建仪表板。这是最酷的部分，所有之前的工作都有了结果。

数据狗是一个很好的开始方式。它提供您需要的一切，甚至更多。您所要做的就是在每个机器上安装它的代理，并配置 Metrics 框架来发送数据给 Datadog。大多数度量端口已经包含 Datadog 适配器，因此不需要额外编码。

现在您拥有了一切，可以按照您想要的任何方式对数据进行分割。您可以导出数据以供进一步分析。您可以定期检查它是否有问题。你甚至可以在办公室的大屏幕上显示仪表盘(看起来很酷，是吧？).

## 把所有的放在一起

我在几周内看到了这一切。然而，如果这整个领域对你来说是新的，这可能需要更长的时间，因为你将随着工具一起学习概念。有时最后期限很紧，甚至几周都是奢侈的。然而，在没有深入了解用户体验或产品健康状况的情况下推出一款产品并不是一个好主意。如果我的时间有限，必须进行优先排序，我会从测试用户体验指标开始，并将其连接到 Datadog。即使对于网页，如果你在模型-视图-控制器上，你也可以从仅仅监控为它们提供动力的 REST 服务或者控制器层开始。很快你就会意识到拥有硬性指标有多好，并希望在你的产品中加入谷歌分析和更深入的代码监控。

所有这些可能看起来很多，但是您在这里只处理四个工具:Pingdom、Google Analytics、Metrics framework 和 Datadog。如果你的产品是一个 API，那么你不需要谷歌分析，如果你的产品是内部的，你不需要 Pingdom。

正如我前面提到的，Metrics 框架已经移植到多种语言。但是，即使您有开箱即用不支持的特定需求，也很容易扩展它。例如，在有保证的速率下，我们为编写并开源了 [Metrics/DataDog 适配器。NET](https://github.com/Guaranteed-Rate/App.Lib.MetricsDotNetDatadogPlugin) 和一个用于代码检测的库，以及用于 Clojure 的[数据狗集成。](https://github.com/Guaranteed-Rate/logdog)

。NET 在 DevOps 上的落后是众所周知的。直到最近，原因之一是缺乏工具；然而，现在已经不是这样了。这里提到的所有工具，以及第 2 部分和第 3 部分，都适用于。NET 并在需要的地方有适配器和端口。与。NET 进入了新的开源时代，没有更多的理由留下来。

给自己两周时间，阅读文档，一步一步来，你会惊讶自己能走多远！

## 下一步是什么？

第 2 部分将介绍如何根据现有数据最大限度地延长产品正常运行时间。它还将讨论当不可避免的生产问题发生时，如何理解数据、自动报警和故障排除。

## 关于作者/杰克·科拉贝尔尼科夫

杰克·科拉贝尔尼科夫 10 岁时编写了他的第一个计算机程序。又过了 15 年，在 Orbitz.com 获得高级工程师的职位后，他进入了管理层。他仍然喜欢科技方面的东西，并继续修补与冷静的新技术。他目前是担保利率工程副总裁，领导公司的技术发展和下一代抵押贷款产品的构建。

在此之前，他在 Orbitz Worldwide 的多个业务领域工作，如酒店、自有品牌和 B2B 网络服务。他在推广敏捷方面发挥了关键作用，最近，他是整个组织持续交付和开发运维背后的主要驱动者。

[【邮件保护】](/cdn-cgi/l/email-protection#751f14161e351e1a07141710191b1c1e1a035b161a18) | [LinkedIn](https://www.linkedin.com/in/jackkorabelnikov)