# TraceAI:机器学习驱动的应用和 API 安全

> 原文:[https://devo PS . com/trace ai-machine-learning-driven-app-and-API-security/](https://devops.com/traceai-machine-learning-driven-app-and-api-security/)

## API 安全性

现代应用首先是移动的，并且是围绕[云原生](https://containerjournal.com/?s=cloud-native)分布式微服务架构构建的。这些体系结构已经成为复杂可靠的分布式 web 和移动应用程序的基本构件。许多这样的分布式 API 直接在 web 上公开业务逻辑；因此，对于这些下一代应用程序来说，攻击面和攻击媒介是非常不同的。这些下一代应用程序需要下一代应用程序安全解决方案，这些解决方案需要使用分布式跟踪等技术将分布式应用程序的活动缝合在一起，然后使用下一代 ML 技术来解决重要的应用程序安全问题。

## 主动异常检测

异常检测方法是一种发现攻击者隐蔽策略的实用方法。然而，这些方法容易产生非常高的假阳性率，从而违背了它们的初衷。大多数异常检测系统向分析师发出大量错误警报，导致认知疲劳。传统上，异常检测方法的缺陷是通过误报工作流、更好的用户界面和用户体验工具来解决的。分析师的反馈被视为对算法的强化，算法会自行调整。然而，这种方法的工程成本非常高，并且产品变得非常复杂，导致可靠性和灵活性问题。其次，它仍然需要回路中的分析师来调整后端算法。大多数从业者认为问题在于异常检测算法，但实际上，在网络安全环境中，驱动这些算法的底层数学真的无能为力。这些算法已经在网络安全以外的领域得到了验证。在 Traceable，我们认为问题出在别处。我们对数据本质的理解表明，我们需要用其他东西来支持异常检测算法。我们需要将特定的应用程序安全细微差别与支持这些异常检测算法的数学方法结合起来。这种理解让我们建立了 TraceAI。

## TraceAI 和 API

TraceAI 是支持可追踪安全产品组合的应用程序安全功能的核心引擎。TraceAI 背后的基本原则是:

*   为了能够将 AppSec 需求分解成构成应用程序漏洞的根本原因的实体
*   为了能够整体地观察这些实体之间的交互行为
*   为了能够发现这种行为的异常模式

使用这些指导原则，TraceAI 实现了一个复杂的行为异常检测器。为了给这种行为异常检测器提供支持，我们已经确定了五个相互作用导致安全漏洞的实体。它们是:

*   **API**–分布式应用程序的基本构件
*   **API 交互**–如何连接这些 API 以提供预期的功能
*   **参与者**–用户、IP 地址或客户端应用程序，如使用 API 从预期功能中获益或在恶意情况下破坏预期功能的移动应用程序。参与者可能被分配不同的角色，如管理员、客户、经理等
*   **API 数据**–API 实现所需的参与者输入。响应输入的 API 输出。
*   **资源**–后端数据或参与者通过调用 API 请求的计算功能

TraceAI 将[API](https://devops.com/?s=APIs)、API 交互、API 数据、资源和参与者有机结合，构建了一个以参与者为中心、以 API 为中心的行为异常产品。因此，从跟踪数据中发现了常见行为、异常行为、自动机行为(bot)和攻击行为。这些行为是以 API 和参与者为中心的。

通过引入通常称为信任和风险模型的附加安全概念，可以消除误报。TraceAI 通过观察与基线相关的数据，自动识别 API 风险和参与者信任，基线也是自动建立的。基线本身不是各种不相关基线的零碎集成，而是使用现代机器学习工具建模的各种观察的整体组合。我们不需要数据科学家和安全工程师团队来支持系统，因为底层算法会自动从数据中学习。一旦投入生产，算法以自驱动模式运行，自动构建基线并生成 ML 模型。

## 引擎盖下的机器学习算法

任何机器学习的基础都是数据集相对于用于检测目的的特征数量的深度和广度。部署在您的应用程序、API 网关和 Kubernetes 集群中的可跟踪代理自动收集所有必要的数据，并构建分布式跟踪，这些跟踪构成了 TraceAI 的数据层基础。从边缘 API 到内部 API，再到后端和第三方服务，跟踪被持续收集以成为逻辑和数据流的学习集，从而生成表示应用上下文的特征。通过跟踪平台解决了数据挑战后，我们的下一个挑战是选择合适的机器学习技术。

机器学习在网络安全方面面临的最大挑战是必须处理序列性质的高维分类数据，同时需要可解释性、因果关系和归因。由于攻击者的策略不断变化，监督学习有其局限性。大多数流行的 ML 算法在同时处理这两个需求时都失败了。考虑到这些因素，我们通过构建算法(而不是完全依赖库)和采用自我监督的学习框架，设计了基于 ML 的解决方案。我们表示多维分类信息的独特方式允许我们执行基于 ML 的检测，甚至对某些形式的加密数据也是如此。

基于 ML 的解决方案的一个关键组件是能够发现 API 端点，并通过数据分析自动生成 API 规范。结果，预期的请求/响应头、主体参数和查询参数不仅被识别，而且被表征。这有助于构建 API 规范，对其的违反被标记为异常。由于核心分布式跟踪平台捕获了丰富的数据，这种不需要手动注释数据的完全自动化的过程是可行的。

除了检测 API 数据异常的能力，TraceAI 还检测 API 交互中的异常，以及访问这些 API 的用户中的异常。用户行为和业务逻辑表示模块捕获、表示和构建常规用户行为和预期业务逻辑的基线。采用无监督的 ML 技术是因为这些技术是唯一可扩展的替代方案。一旦构建了基线模型，业务逻辑滥用和行为偏差就会被捕获并以警报的形式出现。

TraceAI 将行为异常检测扩展到预测性威胁检测，为 API 安全引入了一种新的探索性学习范式。这种方法利用了强化学习背后的基本原理，专门适用于应用程序和用户行为表示。使用这种方法，我们能够在潜在的异常模式出现之前就发现它们。通过将用户的活动与这些生成的模式进行比较，我们可以识别出开始走上危险道路的用户。因此，我们甚至可以在全面攻击开始之前标记这些用户。作为副产品，我们还能够在没有人工干预的情况下量化已知和危险的行为。我们用来支持 TraceAI 的一些机器学习技术是基于 MinHash 的嵌入、使用 LSH 和 OLAP 式子聚类的分层用户行为聚类、用于时间序列异常检测的双向 RNN 变体，以及用于探索性学习的带有进化算法的随机行走的使用。

## 业务逻辑环境中用户行为的异常

了解应用程序行为和用户行为有助于:

*   识别对已知用户行为的违反
*   发现新奇的行为
*   基于用户的行为对用户进行分组，以创建用户群组
*   确定如何准确地使用 API 来构建 web 应用程序

可以将用户群体行为表示为如下所示的概括流程图。

![sample application flow](../Images/988c5b642958f7164af9f3e4b5c98ceb.png)

Sample application flow.

图中的每个节点代表一个在活动用户会话期间调用的 API。如果存在从一个 API 到另一个 API 的转换，则两个节点是连接的，并且两个节点之间的流表示各种统计数据，例如有多少用户表现出这样的转换，或者这样的转换在用户会话之间发生的频率，等等。

在上图中，大约有 26 个不同的节点，每个节点代表一个 API，连接这些节点的流根据监控用户的 API 调用图指示 API 访问的路径。对于人类分析师来说，这个图很难理解，尤其是检测特定用户的行为相对于其他用户的行为已经改变，或者检测特定用户的行为相对于基线已经改变。只有机器学习算法可以自动解释这些类型的表示，而且在我们必须处理的规模上也是如此。

![](../Images/1503033058b251004e2608c7b468d368.png)

Behavioral clusters

上图显示了 TraceAI 是如何基于 API 访问模式创建用户行为组的。本质上，TraceAI 已经仔细研究了上面显示的复杂流程图，然后根据用户各自的 API 调用流程行为来识别用户组。灰色圆圈代表属于常见行为组的用户。对于分析师来说，这些组的优先级较低，因为它们是群体特征。红色圆圈-A 代表行为与灰色圆圈-B 非常相似的用户。这意味着圆圈-A 中的用户正在访问与圆圈-B 中的用户相同的 API，但设法攻击了一个或多个 API。这进一步暗示了 circle-A 中的用户遵循与许多其他用户相同的业务逻辑，但是设法损害了一个或多个 API。对于分析师来说，这是一个有趣的信息，因为除了知道什么受到了损害之外，现在还可以了解导致损害的原因。

![](../Images/40f4789a20f486e7853a367c1dc7ebd9.png)

Tracking user behavior to detect API attacks

这里，上图显示了用户的行为以及攻击发生的确切位置。在两个红色的 API(节点)中检测到授权绕过。分析师现在知道攻击发生在哪里，以及他们是如何到达这个阶段的。现在可以分析导致受攻击 API 的 API 的安全漏洞和代码设计缺陷。本质上，TraceAI 已经从许多可能的行为中分离出有趣的行为，以便安全分析师可以进一步调查。通过减少可能的候选人，TraceAI 将认知负荷和调查疲劳降低了许多数量级。TraceAI 还可以检测异常行为，以标记那些对已知攻击没有明确责任，但表现出可疑行为且与其他用户不同的用户组。分析师还可以深入到显示为“蓝色”圆圈的异常组中，分析其中的一些用户，然后批量将所有这些用户放在观察列表中。通过在组的级别上工作，可以标记/标记/监视多个用户，而不必单独处理每个用户。

## 摘要

Traceable 结合了分布式跟踪和 TraceAI 技术的力量，以保护对 Web 应用程序和 API 的下一代攻击。通过选择正确的机器学习技术，并专注于解决可追踪的 API 安全问题，正在推动 API 安全的边界。

我们很乐意与您进一步交流，并展示我们的技术如何解决您环境中的 API 安全问题。