# 环境变量——终极目标

> 原文:[https://devops.com/environment-variables-ultimate-gotcha/](https://devops.com/environment-variables-ultimate-gotcha/)

我们都认为自己非常了解变量。毕竟，如果你是一个程序员，变量就是你每天都在创建和使用的东西。但当涉及到 DevOps 时，变量是我们试图消除的东西，但往往被忽视。

在这篇文章变成变量的文字游戏之前，让我澄清一下我指的是什么:不是应用程序代码中的变量，而是应用程序基础结构中的变量。在脚本化基础设施的“管道”梦想中，这些变量对运行应用程序的机器进行建模。正确设置后，您可以在每次部署前布置新基础设施。

理想情况下，通过“管道”的是划分好的、完全包含脚本的环境。如果操作得当，这意味着您可以将您的环境带到任何地方！然而，当您开始审视当前基础设施提供商的细微差别时，您可能会感到意外。即使是处理 IP 和连接字符串的基本操作，也可能会将整个“管道”扔进下水道。

即使只有一家提供商，一个小小的变化(可能是地区变化或后端服务器的 ip 地址变化)也会对您的整个基础架构产生连带影响，尤其是在脚本化的情况下。为什么！？

与代码中的最佳实践不同，您的基础设施建模脚本可能包含一些硬编码和静态的部分。因此，你不仅需要确定它们的存在，还需要确定它们存在于何处。即使在中等复杂的多层脚本中，找到这些引用也可能是一场噩梦。

当然不仅仅是公共 IP。随着应用程序变得越来越复杂，您需要知道内部私有 IP、公共 IP、主机名和 MAC 地址。最终你需要管理这些的组合来构建连接字符串、webhooks、端点等等。

显而易见的解决方案是一些友好的工具，使变量易于实现、定位和操作。这个领域的一个参与者已经为此做出了特别的努力:VisualOps.io 是一个很好的所见即所得版本的流行工具，如 Chef 和 Puppet。它们侧重于允许您定义资产，如 IP、MAC 等。–作为脚本中的变量。您可以在管道中的这个关键点灵活地查找、编辑和版本变更，而不是处理硬编码。这是一个非常酷的趋势，我怀疑它只会继续下去。

虽然 VisualOps.io 目前仅支持一个云提供商，但您可以在多个服务中或跨混合云和蒸发云看到这种模板的威力:即应用程序可以无缝地从一个云迁移到另一个云，或者(甚至更酷地)跨云和 PaaS 服务。

今天，用当前的配置管理和脚本工具来解决这个问题的另一个方法是非常聪明和勤奋地对待变量的位置。这意味着练习将它们隔离到代码中的一个区域，或者更好的是隔离到外部引用文件。如果你将所有静态变量放在一个位置，那么你将有一个位置来更新，而不是追捕他们。

不利的一面是，大多数发生在资产属性上的可变变化都是在你不知道的情况下发生的，这让它们变得更加灾难性。所以这没有预料到像动态引用这样的问题；它只是让你更快地做出反应。不管你用什么方法，你都要确保你已经准备好了非常好的监控工具、人员和传呼机。

基础设施脚本中的硬编码引用可能是一个隐藏的威胁——一个经常非常痛苦地“解决”的威胁。因此，在新的和现有的部署中考虑它是一个好主意。好消息是你已经学会了火箭科学——优秀编码的原则。这只是一个工具的问题，并将它们应用到您的基础结构脚本中。