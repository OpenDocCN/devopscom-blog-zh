# Windows 沙盒和基于虚拟机管理程序的隔离

> 原文：<https://devops.com/windows-sandbox-and-hypervisor-based-isolation/>

完全固定[端点](https://devops.com/?s=endpoint)很难。在不牺牲[用户生产力](https://devops.com/?s=productivity)的情况下保护它更加困难。例如，想象一台运行 [Windows 10 操作系统](https://devops.com/?s=windows%2010)的现代笔记本电脑。操作系统由数百万行潜在易受攻击的代码组成。它有许多传统的组件，都是按照旧的安全标准编写的。内核可能正在执行几个第三方驱动程序，这些驱动程序[也可能容易受到攻击](https://www.bleepingcomputer.com/news/security/windows-10-security-alert-vulnerabilities-found-in-over-40-drivers/)。最后，还有几十个日常使用的应用。有的是企业提供、管理、打补丁，有的是用户按需安装；后者并不总是来自合法来源，这使得追踪和评估安全性变得更加困难。及时检测和防范威胁是一场猫捉老鼠的游戏，攻击者的一次胜利对用户来说就是游戏结束。

还要考虑组织向云迁移的速度。对于那些纯粹将终端用作浏览器的人来说，web 隔离产品可以隔离浏览器对风险网站的访问，有时还可以隔离对风险电子邮件附件的访问，从而显著增强安全性。使用考虑到安全性的云操作系统 ChromeOS T1 可以提供额外的 T2 安全优势。

但是对于大多数组织来说，只使用浏览器还不现实。许多传统的业务线应用程序仍在日常使用。员工安装视频会议应用程序与业务合作伙伴会面。开发人员为他们的日常工作安装和更新软件。几乎所有流行的现代云应用程序(Slack、团队、Office 等。)附带了一个完整的桌面客户端，可提供卓越的功能。对于希望采用这些工具的组织来说，web 隔离只能解决部分问题。

[VDI](https://devops.com/?s=VDI) 或[桌面即服务(DaaS)](https://devops.com/?s=desktop%20as%20a%20service) 解决方案允许公司将企业应用程序工作负载转移到数据中心或云。通过将端点操作限制为瘦客户端操作，并且仅将它们连接到该基础架构，潜在攻击媒介的列表变得更小，并且变得非常安全。

但是，如果大量用户需要同时进行远程访问，那么为整个组织使用 VDI/DaaS 会变得非常昂贵。进一步来说，用户体验和延迟远不理想，离线工作是不可能的。在安全性方面，虽然终端现在更加安全，但威胁仍然存在-它只是转移到了数据中心或云，本质上是一个胖 Windows 桌面在那里运行。使用 DaaS，当多个用户共享同一个虚拟操作系统时，安全性可能更具挑战性；一个威胁可能会同时危及多个用户会话。

## 基于虚拟机管理程序的隔离

世界信任现代虚拟机管理程序能够在云中安全地运行服务器、容器和其他工作负载。有时，多个虚拟机管理程序在同一台物理服务器上并行运行，尽管它们彼此完全分离和隔离。与现代操作系统内核不同，虚拟机管理程序旨在执行非常具体的任务。他们的代码库通常很小，经过充分审查和彻底测试，因此很难被利用。根据经验，很少会发现或发布与虚拟机管理程序相关的漏洞。

有可能通过虚拟机管理程序级隔离来保护终端吗？想象一个“生产力环境”，员工可以浏览任何网站；打开任何电子邮件附件或安装和执行软件，都不会危及企业环境或组织的皇冠上的宝石。更妙的是，危及该环境的恶意软件或攻击者被强大的基于虚拟机管理程序的隔离边界困在了内部。

## Windows 沙盒

[微软](https://www.microsoft.com)近年来一直在[基于虚拟化的安全【VBS】](https://devops.com/?s=virtualization%20based%20security)上投入大量资金。[基于虚拟机管理程序的隔离](https://devops.com/?s=hypervisor%20based%20isolation)是一个关键元素，无论是用于隔离带有[凭证防护](https://techcommunity.microsoft.com/t5/windows-it-pro-blog/comprehensive-protection-for-your-credentials-with-credential/ba-p/765314)的 LSA 机密，还是隔离关键[设备防护](https://docs.microsoft.com/en-us/archive/blogs/ash/windows-10-device-guard-and-credential-guard-demystified)代码。随着 Windows 1903 的发布，微软推出了 [Windows 沙盒](https://techcommunity.microsoft.com/t5/windows-kernel-internals/windows-sandbox/ba-p/301849)，将其描述为“为安全运行应用程序而定制的轻量级桌面环境”Windows 沙盒使用户只需点击一个按钮，就能几乎立即启动第二个独立的 Windows 实例。

Windows 沙盒基于新的"[氪虚拟机容器](https://www.hysolate.com/blog/windows10-technology-for-isolation-workspace-as-a-service/)"-Hyper-V 支持的轻量级容器。轻盈体现在:

*   减少了磁盘空间:容器重用了主机的二进制文件，减少了磁盘空间，使其更易于管理。这也意味着它仍然像主机一样修补和安全。
*   优化的内存和 CPU 使用:主机的内核知道容器，并将它作为另一个应用程序来管理。这意味着根据实际需求和使用情况改进 CPU 和内存分配。
*   半虚拟化 GPU:通过在容器内启用 GPU 加速，CPU 可以做更少的工作。

与 web 隔离产品不同，Windows Sandbox 几乎可以隔离任何应用程序。借助氪优化，它速度很快，并且对硬件没有太多要求(任何三年前的笔记本电脑都应该足够)，这使得它比 VDI 更加经济实惠。虚拟化层几乎不引人注意，因此性能优于 VDI/DaaS。

## 缺失的部分

Windows Sandbox 能否让组织在进一步强化和保护主机操作系统的同时，提供一个隔离的“工作环境”？理论上可以，但实际上，不幸的是，它缺乏企业环境所必需的某些功能:

*   可管理性:采用 MDM 系统(如 Microsoft Intune)的 Windows 沙盒难以部署，也无法管理(策略、应用程序)。
*   可用性:Windows 沙盒是非持久的。用户或管理员安装的应用程序将在重启时被擦除。用户设置、cookies 和浏览历史将不会被保存。
*   操作系统集成:虽然用户可以在容器内而不是在主机上安装有风险的软件，但他们不会被迫这样做。
*   安全性:虽然在代码执行方面完全隔离，但 Windows 沙盒不提供网络隔离。恶意软件可以访问和攻击主机可访问的其他设备，即使在网络访问控制(NAC)之后。
*   软件兼容性:一些应用程序无法在 Windows 沙盒中运行或安装。

与传统的安全方法相比，基于虚拟机管理程序的隔离具有明显的优势。通过避免猫捉老鼠的游戏，并转向“通过隔离来缓解”，组织可以提高安全性和生产力，并降低成本。一旦填补了上述缺口，基于虚拟机管理程序的隔离可能会成为终端安全的未来。