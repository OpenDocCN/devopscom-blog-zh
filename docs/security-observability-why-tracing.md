# 安全可观察性:为什么要跟踪？

> 原文：<https://devops.com/security-observability-why-tracing/>

检测一次网络攻击可能需要 200 多天的时间。在此期间，攻击者可能会在您完全不知情的情况下利用您的系统。网络攻击会让受影响的组织每年损失高达[1300 万美元](https://www.accenture.com/_acnmedia/pdf-96/accenture-2019-cost-of-cybercrime-study-final.pdf)。

如果我们能把检测网络攻击的时间一路减少到零会怎么样？通过在攻击仍在发生时检测并阻止攻击，您可以节省多少资金？

如果我们能做得更好呢？如果我们能够在攻击发生之前就检测到安全漏洞，会怎么样？

安全可观察性对于实现这些目标至关重要。让我们看看安全可观察性意味着什么，以及分布式跟踪(可观察性的一部分)如何帮助保护您的企业免受网络安全威胁。

## 什么是安全可观察性？

了解软件内部发生了什么是学习如何保护它的最好方法。可观察性是指在任何时候看到系统状态的能力。就像打开手表，看着齿轮转动。

使用[API](https://devops.com/?s=APIs)和微服务构建的应用和服务比其他系统更有优势，因为你可以更容易地观察它们内部发生了什么。您向 API 和微服务添加挂钩，并使用附加工具来收集细节。

这为我们提供了一个更好地保护应用和服务免受网络攻击的机会，让我们可以确切地看到系统内部发生了什么。

### 可观察性的三大支柱

要使一个系统可观测，需要三种类型的数据。这些通常被称为“可观察性的三个支柱:

*   日志:原始数据，记录系统中发生的每一个活动
*   度量:聚合的性能度量，如 CPU 负载和内存使用，以最小值、最大值、平均值、计数等形式收集
*   分布式跟踪:请求流经微服务时遵循的完整路径
*   数据分析/可视化工具(有时被称为“第四”支柱)。

是的，一共四个，但是这个项目不是数据。上述数据过于复杂，无法直接消化，因此这些工具对于实现可观测性至关重要。

![](img/bdd4921f778fbe48ea7060aae7b6eecb.png)

*Figure 1\. Sending observability data from the microservices to their respective collectors.*

这三个支柱如图 1 所示。图中的每个微服务都包含额外的代码，这些代码将日志、指标和跟踪发送到各自的收集器。这些收集器收集数据、存储数据、过滤数据，并将其传递给分析和可视化工具，使数据可供人类使用。

SIEMs 等传统安全工具利用日志和指标来保护公司的资产。然而，这些工具远不能保护应用程序。

## 保护应用程序的日志和指标的局限性

日志和指标开始描绘出 APIs 微服务内部正在发生的事情。但画面并不完整。日志和度量可以帮助开发人员确保系统正常工作，并且可以帮助解决调试过程中的问题。但是它们不能提供足够的信息来保护系统免受网络攻击。

### 日志:只是事实

每次调用微服务或生成请求时，都会向日志收集器发送一条描述该活动的消息。

![](img/20d5f46f40208c4c025e4b1573630c18.png)

*Code Snippet 2\. Example of a log message, indicating that Service A has received a GET request.*

这个消息包含了关于已经发生的事情的信息，但是它是一个非常原始的形式。你可以把日志当成事实。它不提供对系统中发生的事情的任何真实理解。

如果这个 GET 请求是攻击的第一步，我们不能只看日志来判断。

### 指标:增加洞察力——发生了什么

指标是从微服务活动中收集的聚合数据。指标可能包括 CPU 使用率、内存使用率、执行时间、单位时间内的调用或请求数量等等。每个指标都与记录它的微服务相关联。

![](img/4d06428a4ab437da12e8cefc81448ac6.png)

*Figure 2\. Metrics example, showing the number of calls received for the Login service. What do the spikes reveal? Are they attacks, or are they normal user behavior?*

图二。显示一段时间内登录服务的活动。登录活动通常是统一和一致的，但偶尔会出现非常大的峰值。

峰值表明系统上偶尔会出现登录尝试的爆发。它们可能表示黑客正在发送暴力攻击，试图猜测系统中管理员的用户名和密码。或者它们可能表明黑客正试图通过拒绝服务(DoS)攻击使服务器过载。

但是这些峰值可能表示正常的用户活动。也许许多用户正在同时运行一个应用程序，因为他们刚刚在超级碗中场休息时看到了一个引人注目的电视广告。或者每个人都在同时联系优步要求搭车，因为滚石乐队的演唱会刚刚结束。

另一种可能性是，这些活动的爆发表明系统中存在缺陷。也许有某种不可预见的无限循环导致了意想不到的活动爆发。

我们只是不知道是什么导致了这些爆发。为了获得保护 API 所需的洞察力，我们需要知道在这个指标生成之前发生了什么。我们需要逆向工作的能力。

## 分布式追踪:背景和因果关系——事情发生的原因

分布式跟踪可以帮助我们理解事情发生的原因。当我们知道事情发生的原因时，我们就可以确定攻击是否正在进行。

![](img/ec7a6b36936285e45e37a5f349de4eb0.png)

*Figure3\. A “span”, or trace, showing the path a request follows through the API/microservices system.*

分布式跟踪是一种专门适用于微服务架构的跟踪形式。它允许我们从头到尾观察系统中的每个请求。我们可以使用跟踪来提高性能，并了解典型的行为是什么样子的。

但是，跟踪也给了我们识别对我们的微服务的攻击并阻止它们的能力。

跟踪显示了请求通过 edge API 和微服务的整个路径。他们可以告诉我们:

*   如果请求通过了所有必需的服务，包括身份验证和授权检查
*   如果请求调用了任何意外的服务或被授权访问未经授权的数据
*   请求进入系统的位置。(如果请求没有通过边缘 API(也称为 API 网关)进入，可能会有问题)
*   发起请求的 IP 地址
*   如果它们工作得特别好，跟踪甚至可以帮助识别攻击者。

## 数据分析和可视化工具:看到人类看不到的东西

在真实的系统中，请求可能有数百条不同的路径，如图 3 所示。并且每个请求可能涉及数十甚至数百个服务。虽然分布式跟踪让我们有能力观察所有这些，但其复杂性使人类无法获得更多的洞察力。

[机器学习](https://www.traceable.ai/blog-post/traceai-machine-learning-driven-application-and-api-security)和数据可视化工具可以识别数据中的模式，以识别正常行为和异常行为，甚至可以在检测到异常行为时创建警报。

这些正常和异常行为模式有助于我们识别 API 和微服务中的安全漏洞和攻击。

### 追踪以揭示漏洞

图 4 中的图表显示了系统中的走线组合。我们可以使用这个图表来识别可能的安全漏洞。

![](img/ec4cf9390850e0483d9ecae31f5daec2.png)

*Figure 4\. Possible security vulnerability, indicated by the red-colored trace. The diagram shows that this group of requests may inadvertently grant unauthorized access to the user’s account-info.*

图 4 显示了一个包含“过度数据暴露”漏洞的模式，这是 OWASP API 安全 Top 10 中的漏洞#3。该模式显示，当用户查看购物车时，API 也会返回用户的帐户信息。这些不必要的信息可能包括黑客可以利用的个人信息、帐户信息或财务信息。

这些见解有助于开发人员识别潜在的安全漏洞，并纠正代码以消除它们。

## 实时跟踪检测攻击

跟踪可以监控每个请求，并将其与已建立的规范进行比较。如果跟踪偏离这种预期行为，系统会生成警报。

![](img/de84e516cc3432392c4a1676e338a858.png)

*Figure 5\. Possible attack in progress. The diagram shows that a possible attacker may have found a way to bypass a required authentication or authorization step.*

图 5 展示了一种模式，它可能表示“破坏对象级授权”攻击或“破坏用户身份验证”攻击，这是 OWASP API 安全 10 大漏洞中的第 1 和第 2 个。

该图表明攻击者已经找到了一种方法，可以绕过授权或身份验证检查，进入另一个用户的购物车，并可能获取该用户的信息。

通常情况下，跟踪使我们能够及时找到如上所述的攻击。跟踪是否有助于实时阻止攻击？

是的，跟踪提供了我们实时检测和阻止攻击所需的信息。然而，还需要更多。追踪机制之上的复杂人工智能将能够注意到人类可能忽略的异常，并能够在造成任何损害之前阻止异常行为。

追踪加 AI 给了我们实时的安全可观测性。在未来的博客文章中，我们将讨论人工智能如何利用追踪带给我们的东西，并使用它来创建针对攻击的实时保护。

## 使用分布式跟踪来保护您的 API

网络犯罪代价高昂，而且检测一次攻击可能需要很长时间。攻击者具有创造性，使用日志记录和监控的旧技术无法在攻击发生时提供足够的洞察力来识别攻击。

安全可观察性使用内部状态来彻底理解您的 API/微服务系统内部正在发生的事情，目的是保护它们免受攻击。

观察您的软件，使用日志、指标，最重要的是，分布式跟踪为您提供了识别攻击模式、消除安全漏洞和在攻击造成严重损害之前阻止攻击的机会。[观看录制的可追溯演示](https://www.traceable.ai/view-traceable-demo)亲自观看。