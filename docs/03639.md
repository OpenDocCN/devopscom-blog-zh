# 构建 DevOps 云的更明智的方式

> 原文:[https://devops.com/a-saner-way-to-build-a-devops-cloud/](https://devops.com/a-saner-way-to-build-a-devops-cloud/)

对精神错乱有一个流行的定义:重复做同样的事情，却期待不同的结果。然而，太多在云中实施数字服务和应用的企业在转向其云组件的点对点集成时没有注意到这一警告。在这个过程中，他们引入了巨大的复杂性，这与大约 15 年前集中式中介概念出现之前公司面临的点对点应用程序集成难题非常相似。

考虑挑战的范围。一个云部署可以包含 30 多个产品组件，这些组件需要集成在一起才能顺利运行。任何时候，对这些产品之一的更新都可能会中断依赖于其他组件的进程。DevOps 增加了复杂性，因为团队需要确保开发、测试和生产环境的一致性。当只有一个项目时，由团队中的一个专门的 DevOps 团队来处理这些环境可能是好的。然而，随着利用云技术的应用程序数量的增长，让 DevOps 团队将每个环境构建为一个狂野西部项目是非常昂贵的。

## **在堆栈上标准化**

一个更明智的方法是实现一个在堆栈级操作上标准化的云架构。有效实施后，堆栈可作为创建生产环境副本所需的所有组件和自动化的参考体系结构。这个“完整的堆栈”本质上很像曾经被认为是企业圣杯的配置管理数据库(CMDB)。

有了针对服务或应用的完整体系的元描述，就有可能为开发、测试和生产部署相同的副本，并跨应用自动执行开发运维。这种复制堆栈的能力消除了障碍，例如，部署多个测试环境或堆栈的多个副本以实现安全合规性或灾难恢复。

栈是理解如何构建和运行软件的一个重要概念。如果出现问题，它还提供了对正在运行的内容、部署方式以及问题可能是什么的可见性，有助于系统地纠正问题并将修复部署到所有需要的副本。开发一个堆栈概念还可以让您跟踪整个组织中的应用程序，以及相关的工具、开发实践、云实践和漏洞，为企业云开发的成熟度提供关键的一步。

基于堆栈的标准化使开发团队能够专注于构建新的应用和服务，而不是花费 6 到 18 个月的时间来实施云架构。与此同时，不同的群体可能需要不同的能力，这使得一个堆栈适合所有方法不切实际。中间立场是提供一组“认可的堆栈”或一个用于配置堆栈的门户，这将选项限制在已经过预测试以确认它们可以协同工作的产品上。

## **构建 DevOps 云堆栈**

DevOps 云架构至少包括两个主要堆栈:核心基础架构堆栈和 DevOps 堆栈。这些堆栈越来越多地在容器中运行，这提供了两个关键优势:通过更快地启动应用程序的能力来提高敏捷性，以及通过操作系统级虚拟化来更经济高效地利用资源。

核心基础设施堆栈支持一项服务或应用程序，并提供确保安全性、可靠性和可扩展性的服务。它包括云基础设施，如网络和存储，可由公共云平台或私有云处理，以及特定于容器的功能，如 Docker 运行时，由 Docker Swarm 或 Kubernetes 提供编排。该堆栈还有一个处理性能和管理的层，包括网络、负载平衡、服务目录、日志管理、监控、备份和恢复以及漏洞扫描，这些都由一系列不同的产品支持。

核心基础设施堆栈的顶部是应用层或堆栈，包括开发工具，如 Java Stack 或 Node.js Stack。更高级的应用程序堆栈将超越工具，为从单一应用程序迁移到容器和微服务提供蓝图。

DevOps 堆栈支持持续集成/持续部署(CI/CD)。它跨多个基础架构堆栈运行，并整理工具、流程和程序，以测试和部署或回滚对基础架构堆栈的更改。它通常包含 DevOps 指令，使用 Chef 或 Terraform、Ansible、Puppet、Swarm、Helm 和半打其他工具。因为自动化测试是至关重要的，DevOps 栈还应该包括帮助开发、构建、集成和自动化测试的工具。流行的选项包括用于测试 web 应用和服务的 WireMock 和 Selenium，用于性能测试的 cannon 和用于安全测试的 Blackduck 或 Clare。

此外，DevOps 云平台中的一些关键功能可以扩展到开发、测试和生产堆栈。其中包括安全性、堆栈模板目录、认证容器注册表和使用数据收集，以应用预测分析来优化性能和成本。

## **引入堆栈自动化**

实施支持 DevOps 的云的企业需要考虑尽可能多地自动化流程，尤其是大型安装。例如，一家银行可能有 150 到 200 个开发应用程序的团队。每个应用程序都需要开发、测试和生产环境，这意味着要维护 450 到 600 个部署的堆栈。

值得注意的是，更新堆栈组件需要一个协调的过程。依靠单个产品供应商提供的自动升级和安全补丁是不够的。这是因为如果升级或补丁改变了影响企业堆栈中组件的某些东西，供应商可能不知道这一点，这可能会破坏堆栈。

使用集成了中央协调中心的智能、集中式“命令中心”门户，可以以协调的方式实现堆栈功能的自动化。通过在堆栈上执行整个操作，这消除了与手动运行多个脚本相关的许多复杂性。无论是您的组织构建它还是您使用第三方解决方案，这个自动化脚本执行的中心都应该包含编排引擎、可视化地图、域模型、主动监控和成本分析。

重要的是，包含自动化中心的指挥中心让您可以利用堆栈提供的更好的可见性来跟踪和报告云成本。此外，通过使用 hub 自动处理周期性中断并重新部署被带走的组件，您可以利用“现场”实例——成本比持久实例低 5 到 10 倍。

通过自动化堆栈，您的组织现在有了一种合理的方法来降低实施 DevOps 云的复杂性，同时提供一个敏捷的平台来支持您的开发团队的创新。

约翰·马顿