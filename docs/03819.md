# 传统的内部应用让您感到失望？Cloud DevOps 来救援了！

> 原文:[https://devo PS . com/legacy-on-premises-apps-got-you-down-cloud-devo PS-to-rescue/](https://devops.com/legacy-on-premises-apps-got-you-down-cloud-devops-to-the-rescue/)

随着 DevOps 的出现，我们倾向于假设每个人都在做这件事。但现实是，大部分公司都不是。这是因为使用传统本地应用程序的组织认为 it 不能为他们工作，而且根据 IDC 的调查，绝大多数企业应用程序仍然驻留在本地。即使在 2018 年，基于软件即服务(SaaS)的全球企业应用市场预计也不到 28%。但是，即使您的组织被数据中心中的传统应用程序拖累，也并不意味着您不能在云中进行开发运维。

# **DevOps 需要牛**

DevOps 的一个很好的参考点是“牛与宠物”的类比。也就是说，你应该把你的服务器当成牛，而不是宠物:它们都应该得到平等的对待，这样你所有的测试实验室都是一样的。问题是，当谈到内部应用程序的测试实验室时，似乎每个人都有宠物，而只有新品种的 SaaS 应用程序被像牛一样对待。这是因为实验室非常复杂，有办法积累自己独特的设置，从而引发对话，例如:

*“这个 5000 行的 XML 是什么？！?"*

“哦，那是 Adam 在 1999 年配置的，从那以后我们一字不差地复制了它。”

“亚当是谁？”

“哦，他已经不在这里工作五年了”

良好的 DevOps 实践要求组织拥有多个相同的实验室，可按需提供。你在宠物实验室是得不到这些的。这就是问题所在。

## **可怕的配置漂移**

宠物实验室还会导致其他一些不好的现象，比如配置漂移。配置漂移源于这样一个事实，即很难正确维护一个实验室，因此部署和管理两个、三个或 20 个实验室成为一项令人生畏且非常容易出错的任务。因为更容易，人们通常会简单地复制其他实验室的图像。但随着时间的推移，这些实验室不断进行手动配置，以应对各种版本需求和错误修复。因此，出现了“漂移”

治疗漂移的一个方法是每次都从头开始。但是对于那些“宠物”实验室来说(就像那个亚当，他已经不在这里工作了，他自己配置了自己，并且是活着的最后一个知道如何和为什么的人)，每次从头开始都是令人生畏和不切实际的，所以他们只是继续随波逐流。这意味着即使你的测试实验室应该是完全一样的，但它们不是。

## **“对我有效”和“无法重现”综合症**

实验室之间的不一致还会导致错误跟踪系统中的一些常见症状，即“对我有效”和“无法重现”。

这些是如何进行的:QA 团队有自己的一套实验室(希望它们不是单独的雪花)，每个开发团队也是如此，还有客户环境——另一种类型的野兽。现在一切都乱套了——一些 bug 只出现在 QA 中，而不出现在客户或开发环境中，而另一些只出现在客户级别。不可思议的是，开发人员实验室中的一切总是正常工作，因为这些实验室自真空管时代以来就没有重新安装过，它们包含人类已知的所有注册表黑客、调试符号和内核补丁。

“不能生育”综合症浪费了大量时间。当 QA 人员发现一个 bug 时，他们会与开发人员交谈，但开发人员并没有在进行 bug 修复冲刺，并说他们会在几周内解决这个问题。所以实验室继续前进。与此同时，两周后，一个开发人员终于投入了几个小时，但没有找到它，并以“不能重现”结束了这个 bug。然后 QA 又花了三个小时试图再次找到它。

## **实验室稀缺的严重问题**

最后但同样重要的是，物理内部实验室导致实验室稀缺。许多公司发现，要建立和维护让所有团队并行工作所需的实验室数量，成本太高，也不划算。在实验室数量有限的情况下，开发人员必须等待其他人完成他们的任务，然后才能将实验室用于他们自己的工作。从我自己的经验来看，我们的开发人员不会离开实验室去午休，因为他们不想冒险失去他们在队列中的位置；他们实际上因为一周不吃午饭而体重下降了(对某些人来说也许是好事？).

实验室稀缺实际上是 DevOps 的杀手，更不用说浪费开发人员时间的后果了。(有人可能会说，花在 Reddit 上的实验室等待时间并没有真正浪费，但那是另一回事了。)重点是，您希望为每个开发人员、每个测试人员和每次 CI 运行建立一个实验室。迪士尼世界级别的等待线不是 DevOps 的推动者。

# **云中的 devo PS** 

最终目标是为每个测试、测试人员和运行创建相同的、可重复的测试环境，这些测试环境是有弹性的、可突发的，并且反馈循环时间短。这是您选择云的原因。

使用云来复制和共享相同的实验室，可以很容易地重新开始并在特定状态下保存，这是避免这些问题的方法。但并非所有公共云提供商都是平等的，尤其是在云中重建复杂的内部环境时。

商业云提供商 AWS、谷歌和 Azure 提供了一种选择。但是，它们很少或根本不支持上传您的映像，没有复杂的 L2/L3 网络支持，很少或根本没有嵌套虚拟化，也没有混杂模式适配器。毕竟，它们是为“云原生”应用而构建的。

另一个选择是建立自己的数据中心。但是这在硬件方面是昂贵的(每两到四年重复一次),而且做起来相当复杂，并且涉及创建和维护它们的大量开销。最终，您可能会意识到您不是一家基础架构即服务(IaaS)公司，您更喜欢专注于您的核心业务。

最好的选择是寻找像商用云一样方便、敏捷的东西，但它是专门针对您的内部挑战的。

在许多情况下，您会发现专业的虚拟 IT 实验室提供商让您无需修改即可在云中复制生产服务器映像，并且还可以保存生产实验室的模板，而不管复杂性或节点数量如何。这些提供者应该使您能够根据需要快速构建尽可能多的相同环境，然后轻松地连接工具和脚本以跨系统自动化流程。

当进行调试时，确保您可以轻松地捕获问题的快照，以便稍后返回到相同的位置。然后寻找节省时间和控制成本的自动化功能，如环境策略、自动暂停、Zapier 集成、组织结构建模等。

## **一个示例用例**

较小的创业公司经常会遇到挑战，因为他们希望在非常大的系统上快速运行。以一家金融贸易公司为例，该公司一开始投资生产实例并手动调整它们。该系统由六个以上的子系统组成，每个子系统都有自己的编程语言、技术栈和部署方法。开发一个子系统的开发人员除了知道接口如何工作之外，实际上对其他子系统一无所知。这种设置在生产中有效(大部分时间……)，但是质量问题随之而来。

该公司首先投资了一种瀑布式的长 QA 周期方法。但是大部分 QA 发生在生产中，因为没有完整的分级系统。当你是一个与人的钱打交道的金融交易组织时，在你的生产环境中做 QA 在很多方面都变得很昂贵。

缺乏完整的暂存环境形式的安全网也减缓了新功能的部署。即使一个变化在子系统内部很好地工作，它仍然必须与更大的系统协调一致——有点像一个作曲家改变了一个乐器的音符，然后不得不召集所有的演奏者来听整个交响乐。

该公司最终通过将现有生产机器的完整映像上传到云来解决问题，然后将它们分成具有不同蓝图的子系统。一旦公司建立了每个子系统的“黄金蓝图”，通过混合和匹配来自不同蓝图的服务器，测试变得非常容易。继续作曲家的类比，该公司现在可以改变一个子系统中的音符，并通过将它们与所有其他演奏者的录音一起演奏来看看它听起来如何。

该公司最终实现了生产问题数量的大幅下降，并显著提高了开发新功能的速度(毫无疑问，当有安全网存在时，人们在高空钢丝上跑得更快)。

## **Docker 用户的特别奖励**

使用 Docker 时，快照也非常方便。在基于 Docker 的环境中，当前的实践是以短暂的方式在实际的 Jenkins slaves 上运行 CI 测试，这在连续运行之间会消失。这意味着您只有最终结果的日志。但是当有一个故障并且你想调试时会发生什么呢？这个 bug 可能看起来是不确定的，但实际上它是确定的，因为在两次测试之间发生了变化。即使 bug 是确定性的，您仍然需要重新创建它。想象一下，如果不是在短暂的 Jenkins slaves 上运行测试，而是启动一个短暂的基于云的 Docker 机器，并且在测试失败的情况下，将 CI 设置为拍摄快照。然后，您可以稍后返回到您的快照并采用传统的调试技术，从而节省开发人员的宝贵时间。

# **所有人的 DevOps】**

在云中进行开发运维可以让这一切成为可能。无论你的架构变得多么古老和复杂，你仍然可以进入游戏。只要记住牛比猫更容易放牧。

— [莫利·戈特利布](https://devops.com/author/muly-gottlieb/)