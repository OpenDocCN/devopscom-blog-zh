# 利用混沌工程构建弹性系统

> 原文：<https://devops.com/using-chaos-engineering-to-build-resilient-systems/>

在过去的十年里，[混沌工程](https://devops.com/?s=chaos+engineering)已经成为 DevOps 中最流行的方法之一。它独特地适应复杂的基于云的系统，并有可能在更传统的方法可能不成功的地方取得成功。

## 混沌工程解释道

传统上，开发运维团队使用单个服务器上托管的系统。他们会仔细分析日志，寻找潜在的异常。他们实现了自动化测试，以确保系统符合规范。他们采用根本原因分析来调试应用程序。

现代系统使用基于云的分布式架构，这种方法过于复杂，难以成功；它们包含数百个，有时甚至数千个实例。  在很多情况下，他们的行为 [可以是混乱的](https://www.oreilly.com/content/chaos-engineering/) ，让人几乎无法预测。

正因为如此，现代系统需要从一开始就为弹性而设计。混沌工程是通过有意预测故障模式来促进弹性系统设计的。

## 走向混乱的两步

它是这样工作的。在描述了系统的“健康”状态之后，DevOps 团队进行了一次混沌实验。就像物理或化学实验一样，混沌实验包括建立一个系统的两个版本:实验版本和控制版本。

然后，实验系统会受到一连串虚拟的拳打脚踢，从注入故障到破坏数据中心。DevOps 团队然后仔细研究由此产生的日志数据，试图理解混沌实验如何影响系统的状态。

混沌工程与传统的 DevOps 实践有两个主要区别。首先，虽然传统的测试形式提供了一个受控的输入并测试了一个预先定义的输出，但混沌实验的开放性要大得多。它们从一开始就被设计为预料不到的事情，要求对整个系统进行分析，以给出新颖的见解。

第二，它们是在实时系统上执行的。这使得混沌工程备受争议，因为它的实验有可能影响真实用户。尽管如此，它还是比其他方法更有效。混沌工程通过在野外系统中承担真正的风险来鼓励弹性设计。

## 为什么公司拥抱混沌工程

混沌工程已经存在十多年了。在那段时间里，它已经被几个科技界的大腕所采用。率先采用这种方法的网飞公司仍然因其使用故障注入的[](https://coralogix.com/blog/how-netflix-uses-fault-injection-to-truly-understand-their-resilience/)而闻名。

2008 年，网飞从内部数据中心转移到了云。他们知道，随着他们的扩展，他们的应用程序将经历大规模的水平扩展。因为它的数千个实例中的任何一个都可能在任何时候失败，所以它需要有弹性。

他们创造了第一个混沌实验， [混沌猴。](https://netflix.github.io/chaosmonkey/) 这是通过随机关闭网飞的实时应用程序中的实例来检查其容错能力实现的。这种做法听起来很危险，但它鼓励了网飞的工程师们设计弹性系统架构。

混沌猴听起来很疯狂，但它确实有效。在它运行的头五年里，只有一次故障被一名随叫随到的工程师迅速修复。那次失败是混沌猴自己造成的。

脸书是另一家采用混沌工程的大公司。在 2012 年飓风桑迪之后，他们创造了风暴项目。  虽然飓风本身没有影响到脸书，但它充当了一个 [的警钟](https://www.forbes.com/sites/roberthof/2016/09/11/interview-how-facebooks-project-storm-heads-off-data-center-disasters/%233bc1f4f64875) 。一场风暴袭击脸书的一个数据中心可能会造成严重破坏。

2014 年，脸书采取措施关闭了他们一个数据中心的流量。尽管最终用户没有受到影响，但各种不同的子系统上的流量负载都失控了。

一旦脸书成功识别出系统弹性中的这一弱点，他们就可以先发制人地设计出能够在数据中心实时关闭时保持弹性的流量管理软件。

随着越来越多的公司使用云计算和 [超大规模](https://www.fortinet.com/resources/cyberglossary/hyperscale) 数据中心，混沌工程很可能成为 DevOps 战略的一个本质特征。

## 在你的公司中应用混沌工程

混沌工程是复杂、分布式系统的理想方法。很有可能，您的 DevOps 团队要么在云中运行他们的应用程序，要么正计划迁移到云中。

在 Kubernetes 和 Heroku 等系统的伪装下，无服务器计算受到越来越多的组织的欢迎。现在，系统通常包含数百甚至数千个实例，托管在大型数据中心。

到目前为止，我们只在 10000 英尺的高空看到了混沌工程。是时候看看如何让它在实际中发挥作用了。

首先，我们需要了解 [可观测性和](https://coralogix.com/blog/key-differences-between-observability-and-monitoring-and-why-you-need-both/) 监控在混沌工程中扮演的角色。  要成功实施混沌实验，需要有高水平的系统可见性。

## 处理数据

[马里乌斯·莫斯科维奇](https://insidebigdata.com/2016/02/08/4-strategies-for-finding-and-interpreting-data-anomalies/) 概述了从数据中提取有价值见解的四种策略。他讨论了检测数据流中异常的重要性，这是混沌工程师需要擅长的。

无论是脸书风暴项目中混乱的交通还是网飞实例的停用，混沌实验都依赖于诊断数据中不寻常模式的能力。

### 1.剖析正常系统行为

为了检测异常，您需要很好地了解您的系统通常会做什么。在他们关于混沌工程 的 [书中，网飞使用了人体生命体征的类比。正如医生知道 98.6 华氏度是正常的人体体温一样，他们的 IT 同行需要为他们的 DevOps 系统描述“正常”的“健康”状态。](https://www.oreilly.com/content/chaos-engineering/)

市场上的许多日志分析和可观察性工具提供了机器学习功能来帮助实现这一点。

### 2.全面检测异常情况

异常检测应该集成到数据分析的每个步骤中。你需要能够检测到所有的异常，而不仅仅是你碰巧看到的地方。因为混沌工程不同于更传统的测试形式，它旨在揭示新的和意想不到的信息，所以拥有一个完全开放的数据策略是至关重要的。

### 3.关注的数据科学家

时刻警惕潜在的异常行为。混沌工程将要求你的公司把它的 DevOps 策略提升到一个新的水平，无论是在你的团队的心态方面还是在他们的测井工具的复杂性方面。

因为混沌工程要求你在不做假设的情况下分析所有可用的数据，所以有必要利用机器学习从你的日志中提取模式。  混沌工程需要科学的思维方式和对数据力量的欣赏。

### 4.创建警报

最后，确保异常行为被标记出来，并且团队知道它何时发生。如果可能的话，应该使用动态警报来避免假阳性和警报疲劳，这在静态阈值中是常见的。

## 混沌工程

越来越多的组织正在向云迁移，并构建高度分布式的应用程序基础架构。DevOps 团队被迫每天面对混乱和复杂性。

虽然现代 IT 系统的复杂性使得混沌工程成为必要，但它也使之成为可能。在一个混沌的世界里，混沌工程带来了工程方法的秩序。