# AWS 中用户管理模型的最佳实践

> 原文:[https://devo PS . com/white-paper-best-practices-user-management-models-AWS/](https://devops.com/white-paper-best-practices-user-management-models-aws/)

Amazon Web Services (AWS)为组织提供了使用多种不同方法管理用户帐户的灵活性。在本文中，我们将了解一些最佳的用户帐户管理实践及其潜在的优缺点。

## AWS 账户的来龙去脉

AWS 帐户提供对帐户创建过程中创建的资源的全面访问。当用户提供他的支付细节时，创建第一个帐户。从那时起，该用户被视为根用户。可以通过名为身份访问管理(IAM)的 AWS 服务设置其他用户和帐户。我们可以使用该服务来创建具有粒度级角色和权限的用户。

创建帐户时，会为每个帐户分配两个唯一的标识符:

*   AWS 帐户 ID
*   规范用户 ID

**AWS 帐户 ID** 是一个唯一的 12 位数字，作为每个用户的参考点。它还有助于区分用户和资源。

**规范用户 ID** 是一个长字符串，用于在 S3 存储桶上启用跨帐户访问。这是通过在编写 S3 存储桶策略时使用任何其他 AWS 帐户的规范用户 ID 来实现的。

## AWS 账户明细

AWS 帐户有一套通用的特性和功能。这些资源和功能有助于定义在 AWS 帐户中运行的应用程序和服务之间的界限。有六种不同类型的属性和行为:

*   安全和访问控制
*   沟通
*   AWS 服务限制
*   成本和账单
*   资源共享
*   账户关联和合并计费

## 安全和访问控制

### InternationalAssociationofMachinists 国际机械师协会

在 AWS 上创建的每个帐户都有身份访问管理和 AWS 身份。它提供了对 AWS 帐户内的访问和权限的控制。它允许创建用户和角色以及权限集，以控制对帐户内资源的访问。

默认的 IAM 配置可防止与 AWS 帐户无关的用户进行任何未经授权的访问。跨账户访问也是可能的。AWS 帐户最适用于将组织划分为业务单元的情况:在每个业务单元中，用户、角色和权限都是针对该单元创建的。

### 安全组

EC2 中的安全组用于控制来自弹性计算云(EC2)实例的入口和出口请求。换句话说，可以配置安全组来控制用于 EC2 实例的入站和出站请求的开放端口。它们允许使用实例 ID、CIDR 范围或通过引用现有的安全组来访问。与 CIDR 不同，其他安全组只在 AWS 帐户内工作。

**优点**:

*   可以轻松避免允许跨帐户访问的意外配置。
*   组织/业务单位内各部门的职责已明确定义。

### 沟通

AWS 虚拟专用云(VPC)是 EC2 环境中系统的逻辑隔离部分，有助于为工作负载或组织构建离散网络。它们使用户不仅能够控制子网，还能访问路由表、互联网连接等。IAM 控制对 VPC 的访问。安全组在 EC2 实例级控制入口和出口，访问控制列表(ACL)在 VPC 层控制对子网的访问。

默认情况下，不同 VPC 中的实例之间不可能进行秘密通信。但是使用 VPC 对等的独特功能，可以在两个不同的 VPC 的 IP 空间之间连接路由流量。两个或更多 VPC 内的子网之间的通信也是可能的。为了发起 VPC 对等连接，请求者必须向目标或对等 VPC 发送请求，然后该请求必须被与目标或对等 VPC 相关联的管理员接受。一旦建立了连接，就可以修改所有的路由表，使流量能够在连接的 VPC 之间流动。如果没有特定的 IAM 配置，发起 VPC 对等请求的人可能拥有接受来自目标 VPC 的请求的权限，从而允许 VPC 间的访问。

使用 VPC 对等可以实现跨帐户对等，但是 AWS 帐户的管理控制通常是分开的。

### AWS 服务限制

默认情况下存在许多 AWS 服务限制。它们是特定于区域的，并提供对可以创建的不同类型资源的数量的控制。

**AWS 服务限制的示例包括:** 

**![screen-shot-2016-10-05-at-1-48-32-am](../Images/9a6064e285ae10461d64ef02b81e16b0.png)T2】**

虽然规定的大多数限制是软的，可以根据要求轻松增加或减少，但变化不是瞬间的。在收到基于业务需求的请求后，AWS 支持需要 24 小时来取消服务限制。如果一个组织使用单独的 AWS 帐户，它最终会有多组 AWS 服务限制。当任何组织中有多个独立运作的业务单位时，设置逻辑边界是一个好的实践。

## 成本和账单

AWS 账户可以被视为计费实体，其作为与账户内的资源相关联的成本分配的边界。不同的 AWS 帐户可能有不同的支付模式，并且可以生成详细的账单。标记用于识别 AWS 帐户中的各个资源，使精确的成本分配模型成为可能。

**注意**:可能有一些资源不使用标记，不会在详细报告中显示。例如，如果一个组织为几个需要分摊成本的不同实体共享一个 AWS 帐户，那么最好的处理方法就是使用单独的 AWS 帐户。

以下是无法标记的资源列表:

*   EC2 的入口或出口带宽
*   VPC 端点
*   VPC 流量测井
*   弹性 IPs
*   来自 S3 的入口或出口带宽

当谈到成本优化时，保留实例(RIs)起着至关重要的作用。RIs 允许客户通过承诺实例类型、区域可用性、周期和利用率级别，获得比按需 EC2 实例更大的折扣。RI 不允许在帐户之间移动，但是可以在保留的实例市场上出售不需要的 RI。

## 共享资源

虽然有几种方法可以防止跨帐户共享，但也有一些方法可以促进共享。通过 VPC 对等提供具有适当安全控制的跨帐户交互。

有助于在帐户之间共享资源的一些方法有:

*   EC2 亚马逊机器图像(AMIs)
*   EBS 卷快照
*   RDS 备份
*   亚马逊 S3 桶

这些机制用于共享来自关键服务的数据。即使不依赖这些工具，数据的传输也可以手动完成，这通常容易出错并存在安全风险。不建议这样做。

## 链接账户和合并计费

在 AWS 中，以父子模式链接多个帐户是为组织组织帐户的有效方式。这种称为关联账户的方法为客户提供了从多个子 AWS 账户到单个主 AWS 账户的整体计费视图。通过包含每个子帐户的单独报告的单个计费报告，链接帐户为用户提供了一个关于 AWS 帐户群集的资源费用的综合视图。它提供了对组织在所有 AWS 中的支出的更多可见性，仍然利用 AWS 帐户作为边界。

建立关联账户模型后，最佳实践是创建一个空的主 AWS 账户，严格用于合并计费。当在主账户内创建 AWS 资源时，会增加合并计费配置/数据和持有付款的账户的复杂性。

在购买 RIs 时，合并计费也有利于优化成本。在主账户级别购买的 ri 可以在实例启动时链接到链接到主账户的任何子账户。

## 帐户使用模式

培训帐户可用于不同的目的:

*   单一账户模式
*   自主模型
*   单一主层级账户模型
*   多个主层级账户模型

## 单一账户模式

在这个模型中，所有 AWS 资源都包含在一个组织使用的单个 AWS 帐户中。对于 AWS 客户中需要简化工作负载或更少工作负载的小型组织来说，这是首选模式。集中管理 It 和业务职能的组织也可以利用它。使用这种模式，采用单一支付方式的客户将收到一份账单报告，而无需处理大量账户进行访问管理或通信。

### 优点:

*   没那么复杂。
*   不需要跨账户配置。
*   共享资源保存在一个帐户中。
*   财务管理更容易，也更容易集中。
*   向客户提供单一支付方式和账单报告。

### 缺点:

*   随着使用量的增加，需要频繁提高账户限额。
*   一个环境中的配置和资源问题会对其他设置(包括生产)产生负面影响。
*   没有办法隔离独立于 IAM 策略的访问控制。
*   对安全组或 IAM 策略的错误更改可能会产生负面影响。
*   生产和非生产工作负载并不是相互独立的。

## 自主模型

这种模式利用多个 AWS 非关联帐户来提供单一帐户模式的优势。这允许独立的 IT 或业务功能独立运行。它还允许每个司或部门有一个分散的模式来管理他们的职能。

### 优点:

*   降低模型中所有客户的复杂性。
*   共享资源是在帐户内进行的。
*   不需要跨账户配置。
*   每个 AWS 帐户的单独计费报告。
*   每个 AWS 帐户和业务单位的支付模式。
*   AWS 资源的分散治理。
*   对 IAM 策略或安全组更改等项目的错误更改的影响缩小到一个单独的组织单位

### 缺点:

*   指定一个帐户来管理一个业务单位可以减少业务单位外部错误变更的影响。但这也有单一账户模式的弊端。
*   由于没有集中化，构建多个帐户成为一项管理挑战。
*   使用不同的独立帐户管理 IAM 策略可能会导致标准和访问控制的偏差，例如用户管理。
*   工作重复，因为组织管理几个不同的帐单和付款报告。

## 单主层次模型

在这种一对多关联账户模型中，单个主账户有助于组织整合 AWS 支出的控制和治理，同时允许业务部门拥有一定的自主权。财务集中的大型组织更喜欢单一主层次模型，这些组织在职能组或项目中有多个工作负载。该模型使用不同的从属 AWS 帐户来隔离组织内的应用程序环境。

### 优点:

*   提供一个中央管理系统。
*   跨多个账户的单一支付机制和集成计费报告。
*   一份涵盖下级账户的账单。
*   提供将可标记或不可标记的成本归属于单个业务单位的能力。
*   不太容易发生 IAM 政策的不正确变更，因为影响包含在有限的账户中。
*   可以授权业务部门执行管理和 IT 职责。
*   ri 可以在主账户级别购买，并用于子账户。

### 缺点:

*   管理 IAM 用户和其他策略可能很棘手，因为每个帐户都需要重复配置。
*   设置新的下属 AWS 帐户需要手动链接。
*   包含子帐户的合并帐单可能会生成多个报告，从而难以进行有效的数据分析。

## 多主层次模型

这种模式也称为多主帐户结构，是拥有众多业务部门或管理机构的大型组织或企业的首选。出于立法、政治或财务方面的原因，这些集团通常希望其业务部门彼此独立运作。在这种模式中，设置了几个主付款人账户，然后是从属子账户。这种模式保留了单主模式的优点，同时允许在主账户基础上向付款人和支付方式进行成本分摊。

### 优点:

*   一个集中的管理机构，但子帐户之间是分离的。
*   根据业务部门和单位的需求，为每个账户提供单独的支付方式。
*   减少错误造成的间接损失，如安全违规或 IAM 更改(仅限于个人帐户)。
*   业务单位和项目组可以被授权执行管理和 IT 职责。
*   RI 买断可以在每个主账户级别进行，从而在每个业务单位内部实现 RI 改进。

### 缺点:

*   由于 AWS 主帐户和子帐户的存在，IAM 客户端、策略和角色的管理可能会更加棘手和复杂。
*   多个主 AWS 账户和多个子账户的合并计费会产生复杂的计费文件。
*   通过限制每个主账户的 RI 购买，多主账户安排通常会损失一些成本效率。
*   没有将多个主记录设置为 n+多级结构的嵌套方法

对所有 AWS 资源使用单一帐户将降低复杂性，但会增加风险，因为一个帐户的问题可能会损害多个业务应用程序。单一报告模型应该只用于简单或单一的用例。

最终，对于什么是最好的客户模型没有明确的答案。模型的选择是基于需求的主观决定。但是，关联账户模型的某些方面可能非常适合大多数现实情况。设置起来很棘手，但是关联账户模型的行为和效率会掩盖其设置的现金支出。选择结构时应该着眼于未来。这种结构能支撑快速增长吗？它能在不久的将来促进交流吗？这些是在选择模型之前应该解决的问题。

## 简化您的 AWS 客户战略

利用单一 AWS 帐户模式可能会带来运营挑战。管理和设置 IAM 用户、角色和组会耗费大量时间，并可能导致麻烦和意外行为。虽然可以使用身份提供者联盟或跨帐户 IAM 来减少开销，但它们的配置设置可能很复杂。

AWS 有许多专家可以帮助配置、组织和管理 AWS 资产。它们还可以帮助简化 AWS 基础设施的操作。

## AWS IAM 配置设置和管理

使用 IAM，可以允许用户使用跨帐户 IAM 角色。应该删除 root 帐户对控制台和 API 的访问权限。此外，可以创建父帐户，以管理员身份或只读/读写模式访问特定的 AWS 资源。作为最佳实践，角色和策略应该根据角色来定义。然后，当创建用户时，可以根据需要允许他们成为特定角色的一部分。

## 合并计费

通过将一个公司内的多个 AWS 账户或 AISPL(Amazon International Services PVT . Ltd)账户中的任何一个定义为付款人账户，合并记账可用于合并这些账户的付款。合并计费是一项免费服务，它提供了所有帐户变更的汇总视图，以及与个人级别的付款人帐户相关联的帐户的成本报告。通常 AISPL 和 AWS 不能合并在一起；但是，服务提供商可以将这两个帐户绑定在一起，并提供合并计费。

合并计费为多个账户提供了一张账单的简便性。帐户费用和成本数据跟踪以 CSV 格式提供。而且，在多个帐户的情况下，AWS 集成了所有帐户的使用，使用户有资格享受批量定价折扣。

## 摘要

通过遵循本白皮书中讨论的使用模式，可以通过适当的规划、自动化和其他工具来解决操作问题。

— [苏迪·塞沙哈拉](https://devops.com/author/brj4832/)