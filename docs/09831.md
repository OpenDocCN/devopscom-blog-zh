# GraphQL:模糊的安全性是不够的

> 原文：<https://devops.com/graphql-security-by-obscurity-just-isnt-enough/>

关于如何保护 GraphQL 的争论仍在继续。许多组织对面向公众的 API 采用 [GraphQL](https://devops.com/?s=GraphQL) 犹豫不决，因为目前还没有精确的方法来处理授权问题。如果没有一个基于角色的访问层来为每个字段(以及 GraphQL 可能包装的底层服务)提供细粒度的权限，查询语言很容易出现访问控制问题。

阻碍 GraphQL 访问的一种方法是完全关闭自省特性。有些人可能会认为，如果终端不可见，黑客就无法对其进行自省。但这并不完全正确——即使一个“内部”端点可能没有完整的文档记录，公共 web 上的任何端点都可以很容易地通过强力查询或通过字段建议进行搜索和内省。

我最近会见了逃生技术公司的网络安全工程师卡里姆·鲁斯通。根据鲁斯通的说法，“让某样东西变得模糊并不足以让它变得安全。”利用访问控制中的一个小失误可以作为进入这些系统的入口。他说，尽管限制自省是一种最佳实践，但这可能不足以保护生产 GraphQL 端点。下面，我们将考虑一些常见的 GraphQL 威胁和替代解决方案，以保持安全的 GraphQL 实现。

## 常见的 GraphQL 威胁

在对生产 GraphQL 端点运行了数千次扫描后，鲁斯通发现围绕 GraphQL 威胁出现了一些共同趋势。首先，他注意到拒绝服务攻击的可能性非常高。按照设计，GraphQL 旨在查询客户机需要的任何数据。但有时，这些查询会返回大量数据。

如果 GraphQL 所有者不对单个查询中可以请求的内容进行限制，该平台很容易成为拒绝服务攻击和服务中断的受害者。限制并不仅仅是批量只读操作所必需的——尽管 GraphQL 主要用于获取数据，但一些方法可能会启动密集的服务器端处理，这应该以某种形式加以限制。根据鲁斯通的说法，这种数据处理方法在金融科技、食品配送或医疗保健相关应用中尤为普遍。

另一个猖獗的 GraphQL 威胁在于访问控制问题。这并不奇怪，因为访问控制被列为 OWASP 最常见的 web 应用安全风险。鲁斯通说，通常，当创建新对象或新查询时，开发人员可能会忘记添加正确的授权。这可能会成为一个大问题，并导致特权升级。

最后，太多的产品 GraphQL 实现依赖于模糊的安全性。“人们认为禁止自省是一层安全——我们高度强调它不是，”鲁斯通说。他回忆起为某个客户执行渗透测试；即使他们禁用了自省，团队也能够获取足够的开放路径，并发现一个不安全的通道来泄露秘密的内部知识。

## 解决方案和最佳实践

为了避免上面提到的一些漏洞，建议首先对过于复杂的 GraphQL 调用设置请求限制，以防止拒绝服务攻击。这里鲁斯通建议的一个细微差别是考虑请求的复杂性——不是根据查询大小，而是所需的整体处理。他建议为每个查询和排列分配分数，以帮助决定是否处理来电。

此外，建议禁用字段建议，因为该功能可能会被滥用。使用领域建议，黑客可以泄漏大量信息来建立部分或完整的自省。这些策略类似于黑帽用来在 REST 端点上执行自省的单词破坏技术。

尽管限制监视的可能性是一个很好的做法，但黑客仍然可以发现系统并利用其他常见的漏洞，如破坏访问控制。鲁斯通提出了其他策略，比如引诱攻击者进入蜜罐或者让他们登录一个假账户。或者，创建有意误导攻击者的错误消息。

为了保持安全的 GraphQL 实现，组织可以使用预制的免费和开源工具来审计其外围应用，并扫描已知的漏洞。例如， [GraphQL.security](https://graphql.security/) 快速扫描您的 GraphQL URL 端点以发现漏洞。或者， [Graphinder](https://github.com/Escape-Technologies/graphinder) 可以检查一个子域来发现 GraphQL 端点，这有助于审计。还有一些中间件包装了具有额外安全性的 GraphQL 服务，如 [GraphQL Armor](https://github.com/Escape-Technologies/graphql-armor) 和 [GraphQL Shield](https://nordicapis.com/walkthrough-of-using-graphql-shield/) 。

## GraphQL 的市场前景

市场上似乎有许多 GraphQL 风格。我们已经看到它作为一种机制出现，为后端微服务提供动力。我们还见证了作为一个层被采用的技术，它通过前端工程师更有用的数据检索机制来[集中多个 REST 服务](https://devops.com/supergraph-one-graphql-schema-to-rule-them-all/)。一些 GraphQL 端点也运行在公共 web 上，为终端客户和外部合作伙伴提供服务。

“GraphQL 是一项漂亮的技术，只是缺乏安全性，”鲁斯通说。不幸的是，他对 API 安全的前景看起来很严峻——在欧洲等地区的政治动荡和经济不稳定的情况下，一些公司可能会寻求削减网络安全投资以保持精简。鲁斯通说，对于尚未遭受入侵的公司来说，安全很容易被削减到微薄的预算，但它应该仍然是一个优先事项。“继续保护 GraphQL。”