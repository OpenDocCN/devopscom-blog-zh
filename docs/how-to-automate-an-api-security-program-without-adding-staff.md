# 如何在不增加员工的情况下自动化 API 安全程序

> 原文：<https://devops.com/how-to-automate-an-api-security-program-without-adding-staff/>

在当今的信息经济中，数据是主要的原材料，也是提供商和消费者的价值来源。对于许多公司来说，整个商业模式都建立在信息交换的基础上。

考虑一家没有自己车辆的拼车公司。然而，该公司拥有的是一个愿意开车的私家车主数据库，一个愿意付费乘车的人的名册，以及一个可以通过应用编程接口(API)立即将骑手和司机联系起来的应用程序。拼车公司通过收取车费提成来赚钱。

另一个例子是一家公司收集和提炼财务数据，并将其提供给可能想购买股票的投资者。E*TRADE、美林(Merrill Lynch)和富达(Fidelity)等公司购买这些投资数据，以供客户使用。API 是这些重要数据交换的核心。

## API 有多重要？

信息经济是 API 经济的同义词。API 越来越成为内部和外部业务合作伙伴交换数据和服务并从中获利的方式。API 允许机器对机器的数据检索，从本质上消除了障碍，加速了数据访问。如今，几乎没有一个现代应用程序不提供 API 来与其他应用程序和数据源集成。如今，典型的移动应用程序平均使用 10 到 15 个 API 将有意义的数据移入和移出应用程序。名为 SPAs(单页应用程序)的现代网络应用程序也是如此。API 已经被证明是如此高效和有用，以至于许多公司已经开始通过向第三方开发者和公众移动他们的数据来创建新的商业企业。

DevOps 团队热情地拥抱 API 来提高他们更快地生产应用程序的能力。然而，对于安全团队来说，API 在很大程度上是一个谜，他们必须确保这种快速数据交换的方式不会给公司或其品牌带来不必要的风险和负面影响。企业安全团队质疑 API 带来的漏洞和威胁是正确的。不安全的 API 导致了一些非常严重的数据泄露，其中一些在黑暗阅读文章“[预计 API 泄露会加速](https://www.darkreading.com/application-security/expect-api-breaches-to-accelerate/d/d-id/1332504)”中有所概述

例如，移动支付应用 [Venmo 通过一个安全性差的 API 暴露了](https://www.technadu.com/venmo-public-api-data-leak/36042/)数亿笔交易的敏感细节。在另一个案例中，一个移动应用程序使用的不安全的 Panera Bread API 通过一个可搜索的 API 暴露了用户的隐私细节，该 API 无需验证即可访问。结果，多达 3，700 万条记录被暴露，其中包括客户个人信息标识符(PII)，如姓名、电子邮件地址、实际地址、生日和信用卡的最后四位数字，所有这些都是纯文本格式。T-Mobile、麦当劳、赛门铁克、Instagram 和许多其他公司都遭受过可追溯到不安全 API 的重大数据泄露。这种损害是很大的，因为大多数 API 在设计时都没有考虑安全性。

开发运维团队和安全团队一致认为，来自他们应用程序的数据泄露是完全站不住脚的。因此，设计和应用跨越所有应用程序的所有 API 的安全程序是保护数据和品牌的基本功能。这到底是如何实现的呢？让我们看看自动化 API 安全程序的步骤，而不需要增加额外的安全人员。

## **保护 API 的挑战**

识别所有 API 的本质使得保护它们成为一项挑战。一个开发者可以在几分钟内创建一个 API，并在使用亚马逊、微软和谷歌等公共云服务时几乎没有阻力地将其发布到互联网上。更重要的是，她可以根据自己的需要随时更改 API，每个更改周期都是引入新风险的机会。对于开发人员来说，每周或每天更改 API 并不罕见。

让我们回到那个向股票经纪人出售数据的金融服务公司的例子。假设开发人员对她的 API 进行了更改，这无意中使代理能够看到通过 API 消费数据的每个其他代理的客户列表。这将是一场灾难性的破坏，然而这正是一年前美国邮政服务遭受的 [API 破坏的类型。](https://krebsonsecurity.com/2018/11/usps-site-exposed-data-on-60-million-users/)

如今，API 越来越多地建立在无服务器基础设施上，如 Amazon Lambda、Azure Functions 或 Google Cloud Functions。传统的防火墙、网关和代理无法保护这种建立在短暂基础设施上的 API。现在考虑一个大型企业可能开发和/或使用数百甚至数千个 API。保护每一个 API 的挑战变得显而易见。手动安全监督和执行根本不可能。持续进行安全评估的自动化是唯一可扩展的方法。

## **从一个 API 安全框架开始**

每个创建或使用 API 的组织都需要一个由三个步骤组成的 API 安全框架:

1.  持续的 API 发现和规范创建。
2.  持续的 API 规范分析和检查。
3.  API 策略启用和实施。

让我们看看每一步及其影响。

### **了解正在使用的 API 及其用途**

收集 API 规范是定义 API 目的的重要的第一步。然而，许多 API 没有任何规范。创建 API 规范的服务有助于处理那些缺少文档的 API。然而，这个规范创建服务还需要不断地监控和发现新的 API，以解决不知道存在什么 API 及其预期功能的问题。对于一个开发人员来说，最初记录她的 API 被设计用来做什么是很常见的，但是每次她对她的 API 做出改变时更新那个文档是很少见的。为了弥补这一点，组织需要一个自动化的工具来收集这些信息，并在每次 API 发生变化时进行记录，然后相应地更新 API 规范。

例如，考虑一个用于在公司的后端服务器和移动应用程序之间传输客户信息的 API。开发人员添加了一两个特性，API 进行了更改以支持这些新特性，导致 API 做了一些它最初没有预料到的事情。组织如何了解这些变化？有必要持续分析 API 的这种变化，以了解 API 正在做什么的规范的当前状态。

组织需要创建所有 API 的规范，尤其是云中托管的面向公众的 API。该服务需要持续运行，以不断寻找 API 中的变化。有一些工具可以自动化这些不同的活动，包括发现新的 API 和对现有 API 的更改。这些工具还可以发现与这些 API 相关的其他云资源和数据服务；枚举 API 域、函数和相关方法；如果不存在的话，生成一个基于标准的(Swagger，OpenAPI v3)规范。

### **分析 API 的安全威胁**

下一步是在每次 API 操作发生变化时对其进行安全检查。安全团队需要知道:它有正确的数据加密吗？是否有适当的身份验证？应用了什么类型的授权策略？API 的可用性级别是什么？它访问哪种数据源？如果组织想要避免数据泄露，了解每个 API 的当前安全状况是至关重要的。

这种 API 分析需要持续地、大规模地进行，因为手动过程对于使用大量 API 的组织来说是无效的。幸运的是，有一些工具和技术可以自动完成这个过程，并执行一些任务，比如在 API 的身份验证和加密层中查找潜在的漏洞。这些工具还可以为开发人员生成具有建议更改的安全任务，以纠正他们各自的 API 问题，并在 API 规范与其功能操作之间存在差异时提醒安全人员。

### **创建并实施安全策略**

没有哪两家公司有相同的风险偏好。如果说创建一个 API 安全程序需要人工投入时间的话，那就是策略创建。然后可以使用自动化来执行策略。API 的安全策略应该从两个主要问题开始:谁应该能够使用 API？API 的敏感程度、监管监督和/或隐私问题如何？基于对前两个问题的回答，您可以形成安全策略的基础。

例如，一家银行有一个 API，它为一个指定的帐户提供交易报表。该 API 可以访问每个客户的极其敏感和隐私的信息。绝不允许一个客户访问另一个客户的账户报表。因此，该 API 的身份验证、授权、加密和可用性将被设置为最严格的安全标准，以确保数据暴露受到严格控制。来自同一家银行的另一个 API 可以提供储蓄和货币市场账户的当前利率。这是银行可能会与任何有兴趣在他们那里开户的人分享的数据。在这种情况下，安全限制的级别将会降低，以支持各种各样的系统、浏览器、SDK 和应用程序，从而确保这些信息高度可用。

历史上，针对身份验证、加密和可用性的 API 策略实施通常是在网络网关层完成的。随着应用程序迁移到移动和云等现代架构，网关方法变得越来越不实用，可扩展性越来越差，限制也越来越多。应用程序开发人员通常利用通过 SDK 和/或云服务提供给他们的身份验证、加密和可用性区域。在这些情况下，与传统网络网关相比，集成了这些安全服务的自动化服务是更好的 API 策略实施方法。

## **自动化是关键**

众所周知，安全团队工作过度且人手不足。在世界范围内，可雇佣的熟练安全专业人员严重短缺，因此增加额外的安全人员来构建和执行 API 安全程序并不是一个实际的选择。聘请顾问费用高昂，可能会超出预算。因此，通过工具和技术实现自动化是一种明智的方法。

在执行上述三个步骤时，自动化提供了节省时间和金钱的好处。此外，自动化程序为发现、记录和分析使用中的 API 以及执行公司策略以控制风险所必需的重复性任务提供了一致性。

API 对现代应用程序至关重要。DevOps 人员由衷地接受它们，并且一旦安全团队理解了一个健壮且持续的 API 安全程序将如何使他们的组织受益，他们也可以了解它们的价值。

道格·杜利