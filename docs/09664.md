# 防止停机的 5 种方法

> 原文:[https://devops.com/5-ways-to-prevent-an-outage/](https://devops.com/5-ways-to-prevent-an-outage/)

在当今永远在线、永远连接的世界中，我们都期望 100%的可用性。

是什么阻碍了这一切？细节决定成败。随着时间的推移，一切都会崩溃:  磁盘、节点、容器、网络、DNS 服务器和配置问题都可能导致重大停机。

亚马逊在 2021 年 8 月的 13 分钟宕机导致近 500 万美元的收入损失 [，亚马逊网络服务在去年 12 月的三次宕机导致数百万美元的损失](https://www.washingtonpost.com/business/2021/12/22/amazon-web-services-experiences-another-big-outage/) 。据 [广泛报道，2021 年 10 月脸书](https://fortune.com/2021/10/04/facebook-outage-cost-revenue-instagram-whatsapp-not-working-stock/) (包括相关产品:Messenger、Instagram 和 WhatsApp)因网络配置错误导致约 1 亿美元的收入损失。

有许多不同范围和持续时间的停机—一些归因于技术突破，另一些追溯到人们犯了错误。事实上，一次 [2017 年亚马逊宕机](https://www.vanityfair.com/news/2017/03/one-amazon-employees-human-error-may-have-cost-the-economy-millions) 被归咎于“人为错误”——或者更具体地说，是一名员工的打字错误。该员工打算让少量服务器离线，以修复计费系统问题，但错误的命令导致几台服务器受到影响，并造成重大停机。

那么，贵公司如何降低潜在停机的风险、持续时间和影响呢？首先，公司不能假装只要他们更加努力，就能防止人类犯错。您是否有几十个人每天手动键入数百条命令？如果是这样，一个错误是不可避免的。相反，公司应该调查命令行中的一个小错误如何以及为什么会造成大范围的破坏。护栏和冗余应到位，以防止并最大限度地减少此类事件。T3】

随着企业继续其[数字化转型](https://digitalcxo.com)迈向一个多云、混合和分布式的世界， 这里有五条指导方针需要考虑——这些指导方针可以帮助您抢先一步，防止下一次大停电。

### 1.  时刻考虑你的爆炸半径

爆炸半径衡量一个错误、打字错误或故障如何影响系统的其他部分。

受一个错误影响的组件或服务链是什么？

有哪些隐藏的依赖关系？

有多少客户会受到影响，影响时间有多长？

连接的比你想象的要多；提前发现它们之间的联系，以消除惊喜。

如果网络中有太多的系统相互依赖和相互连接，结果就是死锁。换句话说，当一个坏了，另一个也坏了。我们在过去的脸书停机中已经看到了这一点。一个错误的命令引发了多米诺骨牌效应，关闭了连接脸书全球所有数据中心的主干网。

如何防止这种情况发生？做最坏的打算。对于任务关键型系统，要有意识地进行故障转移和备份。如果 A，B，C 都同时发生了呢？此外，考虑您的成本与可靠性之间的权衡。也许你买不起两套完整的服务器，但是可以买得起一套完整的存档代码。**T3】**

### 2.  磨平粗糙的边缘

考虑到核心基础设施和代码比边缘代码/基础设施得到更多的使用(和测试)。 基本上，核心得到强化，而边缘基础设施更易受到攻击。您应该更加积极主动地识别漏洞，并进行明确的测试来应对这种风险。

2014 年谷歌磁盘擦除/卫星故障是一个涉及边缘的警示故事。在谷歌的案例中，[边缘网络](https://devops.com/?s=edge+networks)提供了一个关键优势:由于延迟较低，为客户提供了更好的连接，因为数据是从更接近用户的来源访问的，而不是核心网络。谷歌有一个 CDN/edge 网络，用于 TCP 连接终止、各种应用的缓存、DNS 监管等。团队需要定期升级卫星机架并运行退役自动化，而这种自动化在中途失败了。错误消息。他们再次重试退役过程以调试故障。停用自动化的手动重新执行意味着数千台卫星机器被停用，并且在几分钟内，全球所有卫星机器的磁盘被擦除。结果是:客户经历了延迟的增加。在幕后，重新安装这些机器需要两天的时间。T3】

### **3。** 认为扶梯，不是电梯

好的系统既有防御，又有纵深。考虑到(真的)出错需要三到四件事情，想想失败的级联。直白的说，限制依赖。测量最长的依赖故障路径和平均恢复时间(MTTR)。当你这样做的时候，想想自动扶梯而不是电梯。我什么意思？嗯，当电梯出故障时，你只剩下一个竖井；自动扶梯出了故障仍然可以作为楼梯使用。

2016 年，澳洲悉尼的恶劣天气导致 [AWS EC2/EBS 停运](https://aws.amazon.com/message/4372T8/) 。首先，公用事业提供商的一个地区变电站断电。这一故障导致多个 AWS 设施的公用电源完全丧失。在其中一个设施中，AWS 电源冗余没有按设计运行，该可用性区域中的大量实例都失去了电源。更糟糕的是，由于几个电力输送线路无法将负载转移到发电机，失去电力的情况失去了主电源和辅助电源。此外，AWS 实例管理软件中的一个潜在缺陷导致剩余实例的恢复速度比预期的慢。

教训？这种相关的电力输送线路故障说明故障不是独立的。您必须针对最大的相关故障以及正在发生的独立故障的背景噪声进行设计。恢复代码需要针对最大的预期故障进行规模测试。

### 4.领先于数字证书轮换

不要低估数字证书的重要性，以及它们的有效期。几年前，LinkedIn 允许其一个 SSL 证书过期，并关闭了美国、英国和加拿大的 LinkedIn 网站。2017 年，由于证书过期，Equifax 错过了 76 天的违规事件。由于 [证书过期导致的计划外停机的平均年成本为 1110 万美元。T3】](https://ponemonsullivanreport.com/2019/03/)

例如，您可以在几台服务器前放置一个负载平衡器。负载平衡器可以在它后面的服务器过期时拥有最新的证书。以多种方式检查过期的服务器非常重要。理想情况下，您可以用两种方式检查这些框: P 检查 HTTP 端点，也可以用脚本检查证书文件本身。

过期的证书(例如 TLS)可能会导致加密和身份验证风险，以及互联网连接中断和涉及网站和应用程序的更大范围的停机。为了避免这种情况，您需要不断检查、更新和部署证书，这可以通过自动化来实现。考虑自动轮换即将过期的证书。T7】

### 5.

现场可靠性工程师( [SREs](https://devops.com/?s=SRE) )和管理生产运营的人最头疼的是什么？辛劳。T3】

我们可以将辛劳定义为工程师在生产环境中执行的手动、乏味的任务。基本上，辛劳浪费时间，减缓行动。因此，大多数 sre 和工程团队都努力将工作流程中的辛劳降到最低。

在生产作业中，你应该努力减少劳累。确保你的团队定期投入时间进行前瞻性工作；被动的工作不应该占用他们的大部分时间。Toil reduction 让开发人员、开发运维工程师和软件工程师有更多的时间专注于为业务创造全新价值的项目(新的应用程序特性)。 [谷歌声明](https://sre.google/sre-book/eliminating-toil/) 它有一个“标榜的目标”，即保持辛劳“低于每个 SRE 时间的 50%。”基本上，没有一个工程师应该把超过一半的时间花在手工的、重复的工作上。但是最终的目标应该是让辛劳尽可能接近于零。自动化事件补救可以帮助 sre 减少工作时间和待命时间。

另外，当你实施修复时——尤其是人员和流程修复——问问你自己这是一个系统性的修复还是一个依赖于最佳意图的修复。寻找工具安全地授权给你的团队(用护栏)。当您努力确定主要的漏洞和依赖关系时(如上所述)，您应该自动消除最常见的问题，同时为可能导致重大中断(也就是最坏的情况)的“角落情况”(或 1%中的 1%)做好计划。

当您考虑这些指导方针时，请确保您将重点放在建立实际的机制上——而不是一次性的、“充满希望的”指令。不要依赖人们记住培训课程中的最佳实践——这些不是机制。相反，设计可以系统实施的流程。当你进行事后分析时，寻找你可以实施的具体计划，以防止同样的错误再次发生。自动化可以帮助您实现这种水平的信心、管理和质量控制，并且它可能会让您在未来潜在的停机前领先一步。