# 分布式跟踪的历史

> 原文:[https://devops.com/a-history-of-distributed-tracing/](https://devops.com/a-history-of-distributed-tracing/)

组织越来越多地使用分布式跟踪来监控其复杂的基于微服务的架构。分布式跟踪在微服务应用、云原生和分布式系统中已经变得必不可少。微服务和无服务器应用可能会呈指数级增长，这使得大规模观察它们非常具有挑战性。传统的日志记录方法变得昂贵，如果出现问题，时间序列数据可以揭示症状，但不能揭示根本原因。例如，使用像 Istio 和 Envoy 这样的 Kubernetes 服务网格的现代使用模式，每天可以有数十亿次微服务调用。

## 什么是分布式跟踪？

跟踪描述了系统中事务或工作流的进度。分布式跟踪通过提供端到端的可见性，提供了对服务依赖性及其相互依赖性的可见性。完整地可视化事务允许您将非正常跟踪与正常跟踪进行比较，以确定行为、结构和时间上的差异。通过分布式跟踪，您可以识别系统中的瓶颈。当被跟踪的请求流经网络时，它可以被跟踪。

![](../Images/e639695a21e717f9deb796ef5a1cb6ed.png)

随着请求从前端流向后端并流向数据库，跟踪提供了诊断技术，揭示了一组服务如何协调处理应用程序请求。使用分布式跟踪，开发人员可以对有错误和高延迟的请求进行故障排除。单个跟踪通常显示应用程序中请求或事务的活动。跟踪显示了每一步的变化。当您汇总跟踪信息时，您可以看到哪个后端服务或数据库对性能的影响最大。

## **分布式跟踪的历史**

Dapper 是谷歌在 2010 年推出的大规模分布式系统跟踪基础设施。Dapper 公开两年后，Twitter 开源了 Zipkin，这是为应用程序性能调优而设计的。Zipkin 是第一个开源分布式追踪项目。Zipkin 跟踪数据可以使用 UI 收集和可视化。2015 年，优步推出了 Jaeger，它的灵感来自 Dapper，并以德语单词 hunter 命名。2017 年晚些时候，优步发表了一篇名为[在优步工程](https://www.uber.com/blog/distributed-tracing/)发展分布式跟踪的博客文章，解释了耶格架构选择的原因。除了创造了 Jaeger，它的作者 Yuri Shkuro 还写了一本关于分布式追踪的书，名为《掌握分布式追踪》。

2016 年，Lightstep 的创始人 Ben Sigelman 写了一篇名为[走向交钥匙分布式跟踪](https://medium.com/opentracing/towards-turnkey-distributed-tracing-5f4297d1736)的博客文章，将 OpenTracing 描述为一个单一的标准。一些人将此称为 OpenTracing 宣言。OpenTracing 允许应用程序代码、开放源代码包和开放源代码服务的开发人员检测他们的代码，而无需将他们自己绑定到任何特定的跟踪解决方案。OpenTracing 的目标是解决标准化问题。跟踪上下文必须通过所有组件，包括应用程序代码、相关库、独立的开源服务(Nginx、MySQL)和其他特定于供应商的库和服务，以收集完整的分布式跟踪。如果没有标准的 API 来定义跟踪上下文的收集和传递，收集完整的路径是很困难的。OpenTracing 旨在通过定义一个标准 API 来解决这个问题，该 API 可以由来自不同跟踪解决方案的组件实现，允许收集端到端的跟踪数据。云计算原生计算基金会(CNCF)于 2016 年 10 月接受了 OpenTracing 作为其第三个项目。两个月后，OpenTracing 1.0 发布。开放追踪后，耶格加入了 CNCF。

W3C 跟踪上下文规范于 2019 年 11 月提出，使分布式跟踪更接近标准化。十年来，分布式追踪从一张纸发展成了一个活跃的社区。随着所有层的标准化，it 正在从仅仅跟踪转向整体[可观察性](https://devops.com/?s=observability)，范围从延迟优化到根本原因分析和应用性能管理。它正从单一后端系统转变为跨多个系统的端到端解决方案。

2019 年 OpenTracing 和 OpenTelemetry 合并。使用 OpenTelemetry，可以实现端到端的分布式跟踪。它在 2021 年发布了 1.0 版本。CNCF 的 OpenTelemetry 项目是快速发展的项目之一，OpenTelemetry 已经成为跟踪、度量和日志记录的事实上的标准。

## **工作原理**

分布式追踪中的轨迹由称为跨度的标记时间间隔组成。可以将跨度视为一个工作单元。轨迹是由称为跨度的线段组成的有向无环图(Dag)。[根据 OpenTelemetry](https://opentelemetry.io/docs/concepts/signals/traces/) 的说法，一条轨迹有四个主要组成部分:

*   **traceID**

*   **西班牙语**

*   **跟踪标志**

*   **跟踪状态**

轨迹中的跨度由连续的工作段组成，这些工作段被命名和计时。跨度有开始和结束时间，还有元数据，如帮助对跨度进行分类的标记或日志。跨度之间可能存在父子关系，以显示特定事务如何遍历应用程序的众多服务和组件。

![](../Images/38a7d5ca27408da0881a4dba66dab3db.png)

跟踪代表一个端到端的请求；它可以包含一个或多个跨度。跨度表示由单个服务执行的工作以及相关的时间间隔和元数据。跟踪的目的是通过标记提供一个以请求为中心的视图。尽管微服务使团队能够独立工作，但分布式跟踪提供了一种中央资源，允许所有团队从用户的角度理解问题。

## 结论

在分布式系统中，响应延迟会产生重大的商业影响。识别瓶颈和理解一个请求如何在一个复杂的系统中移动是很复杂的。其他技术，如日志记录和监控指标，不能提供对分布式应用程序(如使用微服务架构创建的应用程序)的洞察。一些开放标准和工具正在分布式跟踪领域出现，比如 OpenTracing 和商业工具，它们可能会与现有的 APM 解决方案竞争。为现代云原生服务实现分布式跟踪提出了几个挑战。OpenTelemetry tracing 对于处理大量跟踪数据同时生成有意义的洞察是必要的。