# 做 Devops: URL 管理

> 原文:[https://devops.com/devops-url-management/](https://devops.com/devops-url-management/)

运营人员的一个相当常见的任务是管理 URL。URL 管理要么使用重定向或重写来管理诸如虚荣 URL 或营销活动 URL 之类的东西，甚至只是让用户从旧的、废弃的 URL 访问当前的 URL。抛开管理 URL 背后的商业目的不谈，这样做的过程可能会变得非常笨拙和耗时。

这是因为传统的 URL 重定向和重写是第 7 层代理或 web 服务器功能，需要修改配置文件。例如，下面是 Apache 的一个简单的 URL 重写配置摘录:

```
01.RewriteEngine On
```

```
02.RewriteBase /books
```

```
03.# If there's a cookie called thgtp-pre-version set,
```

```
04.# use its value and serve the page
```

```
05.RewriteCond %{HTTP_COOKIE} thgtp-pre-version=([^;])
```

```
06.RewriteRule ^guide-to-node$ %{REQUEST_FILENAME}-%1.html [L]
```

这里的关键是它在*配置*文件中。这只是一个重写规则。想象一下需要数百条这样的规则，然后想象一下它们每周甚至每天都在变化。这不仅很可能*不是*你签约的工作，而且不可避免的是，在某个时候你会发现一个规则改变，你知道那意味着什么。没错。阿帕奇没有开始。你就能知道它在哪里。

在某些架构中，重写/重定向规则只是 web 服务器配置的一部分。当单个规则改变时，每个 web 服务器都必须更新其配置文件。更现代的方法利用代理，这极大地减少了需要更新的 Apache(或您使用的任何代理)实例的数量。

无论如何，这是一件非常平凡和无聊的事情，老实说，让营销部门(或任何人)开始请求新的重写/重定向规则并让票证到达您的办公桌的整个过程可能比输入规则并键入 *restart httpd* 需要更多的时间。

那么，我们如何利用网络中的一些可编程性来自动化这个坏男孩，如果你愿意，把繁琐的 URL 管理交给拥有它们的人(业务和营销人员)呢？

**可编程代理**

我之前解释过[可编程组件](https://devops.com/features/what-programmable-means/)，尤其是数据路径中的组件，其中一个组件可以简单地描述为“可编程代理”代理对于开发人员或运营人员来说并不陌生，所以我假设我们在这方面做得很好。当您基本上将配置文件中编码的所有逻辑(如重写和重定向)转移到编程环境中时，可编程部分就出现了。因此，与其让**配置** **代理的行为**，不如让**编写代理的行为**。

你可能会问，这有什么用？首先，它让“基础设施即代码”这句话听起来更加真实，因为它确实是代码。这意味着它像任何其他代码一样成为一个工件，并像代码一样被管理。这意味着更简单的回滚和版本控制。

第二，这意味着如果你有一个足够健壮的环境，你可以扩展逻辑来包括数据源，如数据库(SQL 或 NoSQL，你的选择),管理旧 URL 到新 URL 的映射。如果它在一个数据库中，让某人在它前面放一个漂亮的 HTML 表单是一件非常简单的事情，使业务人员能够管理该列表。

实际的执行很简单:代理接收对一个 URL 的请求，比如说 www.example.com/TVad，然后查询数据库，得到真实的 URL，比如说 www.example.com/marketing/tv/2014。这与基于配置的方法没有太大区别，只是您能够动态地确定映射，而不是将其硬编码到文件中。

现在，代理用它做什么取决于你。您可以用“真正的”URL 向客户端发送重定向，或者(如果您关心性能，这是一个更好的选择)重写它，并将其发送到正确的服务器。

可编程代理应该是每个 devops 从业者口袋里的关键工具。凭借网络和应用程序的流畅性，可编程代理为各种依赖于实时动态评估应用层请求的架构模式提供了基础。可编程代理非常适合这些任务，因为它可以几乎透明地插入到数据路径中，并且不需要特殊的网络(或者更重要的是，网络团队的合作)。