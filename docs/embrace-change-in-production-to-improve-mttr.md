# 拥抱生产变革，改善 MTTR

> 原文：<https://devops.com/embrace-change-in-production-to-improve-mttr/>

DevOps 通过不断的部署变更创造价值。如果做得好，更频繁的部署允许团队持续改进他们的产品或服务，同时使管理变更的效果变得更容易。一种方法是使用[持续集成和持续部署](https://devops.com/what-is-a-ci-cd-pipeline-how-to-improve-ci-cd/) (CI/CD)。CI/CD 有助于降低每个构建的风险，并允许团队快速安全地发布有价值的特性。但是 CI/CD 本身不足以理解生产中的变化和服务影响。最近的[DEJ IT 绩效报告](https://www.dej.cognanta.com/2022/03/30/technology-innovation-spotlight-march-2022/)发现变化是生产问题的最大来源。所有性能问题中有整整 76%最终可以追溯到环境的变化，但是 67%的组织没有能力确定导致性能问题的环境变化。

在现代 IT 环境中，不同的团队不断集成新功能和新技术，并更新他们的堆栈。由于有许多移动部件，在生产前测试新功能时，不可能模拟生产环境。当您实现并测试新代码时，您的分支将与生产中的不同。

这就是我们工作的现实:

●在 CI/CD 管道中集成测试不会将 bug 排除在生产之外。一些组织不做真正的 CI/CD，这意味着一些流程甚至没有在管道中测试和自动化。
●用户配置错误很常见。这里有一份[导致](https://github.com/danluu/post-mortems#config-errors)停产的配置错误综合清单。
●变革焦虑是真实的:操作人员在按下部署按钮时会感到紧张，即使是很小的变革。

在 DevOps 中，变化是不可避免的，但是组织可以通过几个简单的步骤安全地集成生产中的变化来保护自己免受性能事故或停机的影响。

### 建立数据连接

如今，数据保存在孤岛中，这就是为什么建立关联并利用它们来找到性能问题的根本原因既费时又具挑战性。DevOps 团队需要以有意义的方式连接他们的数据，以解决分布式系统中的复杂问题。构建“连接”基础对于理解系统的状态以及各个部分如何相互连接和交互至关重要。

应用程序在生产中的表现与代码、基础设施和操作的组合有关。例如，当一个事件发生时，团队应该很快知道这个问题是否与代码、基础设施或操作活动有关。无法手动理解这些连接并关联数据。我们在连接数据仓库方面碰壁了；我们只是不能像软件那样扩展。团队需要考虑一种监控和分析方法，从一开始就将运营数据联系在一起，并对数据之间的因果关系进行建模，以便进行实时根本原因诊断。

### 了解变更影响以避免停机

您的 DevOps 团队能在多大程度上确定对您的生产环境所做的关键更改？如果您的答案是“不太好”，那么您就错过了有助于加快故障诊断的关键数据。缺乏对变化及其对生产的影响的可见性，使得运营人员无法确定原因，而这正是 SREs 最关心的事情。

出于各种原因，对代码或云基础设施进行了直接或通过基础设施即代码(IaC)模板的更改。当这些操作活动没有在整个体系中持续监控和关联时，配置错误和性能问题的风险会增加。

指标并不能说明全部情况。日志没有指出在哪里行动。简单地收集这些数据类型会让许多公司难以知道在实时故障排除时什么是重要的，什么是不重要的。

为所有不同的活动流的变更建立一个共享的“记录系统”,可以提高所有变更的实时可见性和控制力。团队可以看到预先发生的事件，并在进行更改时意识到增加的风险，尤其是在高速更改期间。通过了解代码更改如何影响后续工作，开发人员可以主动排除故障并调试代码。

### 实施实时根本原因诊断

在同一份 DEJ 报告中，各组织称 MTTR 有 66%的时间用于“诊断”阶段。这与 67%的团队无法识别导致性能问题的环境变化有关。

通过共享的【记录系统】进行更改，开发运维团队可以实时排除事件故障，从而大幅减少花费在 MTTR【诊断 】阶段的时间。当团队可以在一个单一的、可搜索的/可过滤的实时提要中看到所有的变更和系统中发生的其他事件时，这尤其有效；该时间表将提供问题的潜在原因。

最好的工具是让你从一个结果开始，反向工作，将多个事件与可观察性数据联系起来，快速确定原因。从末端构建因果链有助于团队专注于相关的变化，并以简单明了的方式回答每个 “为什么 ”。这种能力使得通过可操作的上下文来确定相关变更的优先级和解决性能下降或停机变得更加容易和快速。

### 沟通一切

在诊断和解决问题的过程中， 看到 正在做什么很重要，而不必在空闲时询问、等待对方或不知不觉地干扰补救行动。最好的选择是利用相同的时间线，在事件发生时以及在诊断和解决过程中的任何时刻捕捉事件的所有上下文，以避免恢复彼此 的更改。

虽然事故后调查将团队聚集在一起收集数据，讨论细节并从中吸取教训，但这一过程通常效率低下且耗时。参与事故响应工作的每个团队成员都必须回忆他们观察到了什么，他们采取了什么行动，以及他们向其他团队成员传达了什么。如果一个系统可以捕获事件响应过程中的所有行动和通信，会怎么样？用一句话概括你的想法并结束报告不是很好吗？

为可能影响底线的计划内和计划外变更做准备时，开发运维团队需要考虑这些步骤，以获得其运营的真正[可观察性](https://devops.com/?s=observability)。专注于寻找数据中的联系来解释因果关系。了解变更影响—因为这些变更正在进行——以避免停机。尽可能无缝地捕获和交流活动，并识别和利用自动化工作流的机会。