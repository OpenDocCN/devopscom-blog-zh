# 将基础设施视为代码

> 原文：<https://devops.com/meet-infrastructure-code/>

也许你已经听说过“可编程基础设施”和“作为代码的基础设施”这两个术语。但是即使你没有，如果你对 DevOps 感兴趣，这是你需要知道的。大多数新行话让我翻白眼。但在这种情况下，这不仅仅是新的行话，这是一个全新的概念。除了让书呆子在说的时候感觉很酷之外，这些术语描述了一个应用程序由什么组成的新想法。哦，太好了，这是我们多年来所做工作的又一个术语。我经常决定使用一个术语来保持相关性，所以我开始称“网络”为“云”,这样我就可以和别人谈论它了。有时我会让自己大吃一惊，当我花时间去了解一个术语及其真正含义后，我会完全理解它。但我更少发现真正让我重新思考事情是如何做的术语。可编程基础设施和作为代码的基础设施就是这样的术语。

[![infrastructureascode](img/cf2d6be73676fafcad8fefa7237871f7.png)](https://devops.com/wp-content/uploads/2014/05/infrastructureascode.gif)

*代码可视化的基础设施*

## **好吧，也许这不是全新的**

自动化的想法并不新鲜。我使用 BAT 文件和最近的 PowerShell 脚本在我的基础设施上做各种事情已经很多年了。但是当这种自动化遇到虚拟化和专门设计用来描述基础设施编排的语言时。我们不只是在谈论重新包装技术，并把它们称为新事物。我们正在谈论一个全新的概念，它将改变谁来做，他们如何做，以及他们能有多有效。那么什么是可编程基础设施呢？可编程基础设施和作为代码的基础设施是同义的。我从 Gartner 的一位分析师那里了解到“可编程的基础设施”，我怀疑这是它的起源，而“作为代码的基础设施”则来自博客的世界。后者用了一个“as _ _ _ _ _ _ _ _”，这似乎是创造一个新术语的神奇秘方。它们都意味着，您可以编写脚本来完成配置，而不是手动配置基础架构。但不仅仅是脚本，您实际上可以将配置完全整合到应用程序代码中。这在很长一段时间内都是可能的，但受到了限制。在你能做的事情上，你几乎总是碰壁。但是，新的工具，如 vagger、Ansible、Docker、Chef 和 Puppet，无论是独立的还是组合在一起的，都使得您可以手动、自动地在基础架构层和操作系统层完成任何事情。即使已经创建了基础设施，您也可以使用这些工具运行更多的脚本，甚至是您刚刚构建的可信赖的旧 BAT 和 ps1 文件。这是对基础设施协调的一种反映。

## **开发商完全控制**

有人可能会说这只是配置管理。从某种意义上说，它是完全自动化的。但是还有一个很大的不同。这也意味着开发者可以做所有的事情。在过去，所有这些编排和自动化都属于系统管理员，现在，开发人员至少要提供建议，但在许多情况下，要完全接管整个过程。使得应用程序代码和它所运行的基础设施之间的关系更加紧密，几乎无法区分。现在，开发人员不仅可以编写应用程序代码，还可以编写代码运行的基础设施。在 web 开发领域，开发人员创建类似“deploy.php”的东西并不少见，这种东西为整个应用程序的运行奠定了基础。该脚本以创建虚拟机开始，以来自源存储库的拉请求结束。我目前的观点是，组织应该组建一个小团队来负责这些脚本，因为开发人员的时间应该花在错误修复和增强功能上。但是，无论如何，要使这项工作成功，信息技术和发展之间不能有这样的鸿沟。

## **显示数值**

尽管配置管理带来了效率和可重复性的好处。作为代码的基础设施提供了其他东西。首先，基本上脚本也可以作为应用程序基础设施的文档。这是一个很大的附带好处。因为您已经努力创建了脚本，所以它看起来就像是基础设施的网络图。也许有人可以把这带到下一步，实际上从脚本中创建外行人友好的内容、图表和文档。其次，因为一切都是从脚本启动的，所以您有一个一致的位置来启动所有部署。因此，您知道每个部署都带有相同风格的基础架构。这是一个想法，但在实践中，我看到许多组织在现有基础设施上运行脚本，或者在自动化运行后对配置进行手动修改，并且在这样做时不一致，从而污染了他们的脚本。它还建立了基础设施的独立性。如果操作正确，这些脚本可以在任何云上运行，公共云、私有云和混合云，谁在乎呢。一旦软件定义网络的世界主导了路由器的物理世界，就不仅仅是 90%的独立性，而是 100%的独立性。这种独立性对于组织来说是非常强大的，可以避免云锁定和/或通过在多个云上运行来增加冗余。不仅不同的用例可以在特定的云上运行。例如，可以有一个独立于生产云的集成测试云，它也独立于测试版云。最后，因为它是可重复的，部署不仅仅是复制资产和运行代码。部署也可以是基础设施。因此，每次部署都有一组新的基础设施来部署代码。这避免了污染。帮助 QA 避免“它在我的机器上工作”的问题。并允许整套测试单元集成到功能上，以便在全新的基础设施实例上运行。其额外的好处是能够在出现问题的地方对整个部署、代码和基础设施进行快照。而不是发送神秘的截图和文本错误描述。更有趣的是，大多数公共云本身现在都有有限的或完全成熟的基于 REST 的 API，允许您针对他们的云进行编码。因此，我可以对我的生产云进行 REST 调用，以启动前端和数据库服务器，就在我从 github 向这些服务器进行拉取之前。

## 一系列新的挑战

有一些差距阻碍了代码/可编程基础设施成为规范。它们是:

1.  仍然受限于微软的堆栈。Linux 基础设施带来了整个世界的灵活性。虽然微软堆栈有很多可能性，但它仍然只有 40%。这是由于 Windows 的封闭性，同时也是因为人们对创建专门针对它的工具缺乏兴趣。然而，当你谈到 Azure PaaS 时，情况就不同了。可以肯定地说，如果您对微软堆栈的可编程基础架构感兴趣，您将支付更多费用，并且您将面临一种新的锁定，即使用 VMWare 的 [VIX 或系统中心运营经理 SCOM 进行编排。](https://www.vmware.com/support/developer/vix-api/)
2.  多层应用程序使得脚本更加复杂。而将网络和安全作为一个组件添加进来，可能会让它变成一场噩梦。当您开始处理联网虚拟机以及 vLANs 的设置和安全性时，在编写部署脚本时，事情会变得很复杂。一个 vLAN 可以很容易地被当作一个 VM 本身，但是编排语言目前还没有足够强大的支持来使它成为一个完整的解决方案。我看到的趋势是找到从应用系统架构中去除这个变量的方法。
3.  必须首先考虑基础设施工具的基础设施。这是一个奇怪的问题。您必须弄清楚您的各种编排工具将在哪里以及如何运行，这需要基础设施，或者基础设施规划来完成。鸡还是蛋，等等。有时，规划虚拟机管理程序、在虚拟机上安装代理、拥有创建虚拟机的安全性和访问权限等真的很烦人。这可以像一个小的组织变化一样简单，或者在 Azure 或 AWS 上选择正确的 VM 模板。而其他时候，开发团队也缺少使用他们想要的工具的方法。
4.  各种工具仍然需要专门化。今天，所有可用的工具都需要花费大量的精力来学习它们是如何工作的，它们语言的语法等等。对于许多组织来说，这通常是一个很大的障碍，不能花费时间和金钱。
5.  当应用程序都是 PaaS 或 PaaS 和基础设施的组合(无论是在云中还是在本地)时，制作包罗万象的脚本变得更加困难，您必须考虑几个脚本。这带来了将它们的执行组合在一起的额外问题。

我预计，未来两年，这些领域的市场将出现显著改善。我相信一切都会变得更容易。最终，您会惊讶地听到有人正在手动配置任何基础架构。当我刚开始接触虚拟化时，我喜欢说“现在整个机器只是文档”。实际上，这也是应用程序的全部，是文件的集合，文件中有按某种顺序执行的指令。因此，最终应用程序代码和它所运行的基础设施是分开的这种想法已经过时了。一切都是包容的，我不确定它是否会成为“可编程的基础设施”，或者“作为代码的基础设施”。但我确实知道，应用程序现在可以包含它们运行的基础设施，这一想法进一步推动了开发运维的发展，并内置了比任何想法都更大的灵活性。