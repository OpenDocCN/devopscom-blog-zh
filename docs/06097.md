# 定义动态 JAMstack 应用程序的数据库要求

> 原文:[https://devo PS . com/defining-the-database-requirements-of-dynamic-jam stack-applications/](https://devops.com/defining-the-database-requirements-of-dynamic-jamstack-applications/)

零配置托管解决方案，如 [Zeit Now](https://github.com/zeit/now) 和[Netlify](https://www.netlify.com/)因其易用性正在席卷前端社区。如果我们添加静态站点生成器，如 Gatsby/next . js/nuxt . js/Hugo/Jekyll，并将我们静态生成的页面部署到内容交付网络(CDN ),我们就可以用最少的努力获得非常想要的东西:零配置的分布式自动伸缩应用程序。

静态站点生成器和 cdn 的使用变得非常流行，以至于 Netlify 决定给它起一个名字:JAMstack。起初，这可能不会让你觉得有什么新闻价值。我们不是都在 cdn 上部署了博客或者文档之类的静态站点吗？这种方法有什么不同？

为了回答这个问题，让我们先来看看通常用来解释 JAMstack 的定义:JAMstack 是一个静态的 HTML 网站，每次更新内容时都会自动重建，并直接部署到 CDN。

当然，这仍然不能解释为什么这种方法是不同的。当我第一次读到这个定义时，我想知道如何才能用这样的堆栈来构建比博客更动态的东西。但是，请注意，在前面的描述中没有说我们站点的每个元素都必须静态生成。事实上，JAM 首字母缩写代表 JavaScript、API 和标记，其中字母 A 是动态内容的答案。

这个想法是在可以的地方预生成标记，然后用从 API 获取的动态内容来丰富这些静态生成的页面。JAMstack 应用程序中选择的 API 通常是来自第三方服务的 API(SaaS 平台)或定制的具有服务功能的 API(FaaS)。Netlify 和 Zeit 都有很棒的零配置 FaaS 产品，可以为您的 JAMstack 编写 API。  本质上，JAMstack 社区中的开发人员经常在寻找一组特定的需求:

*   **零配置—** 轻松设置，轻松部署，无需服务器管理。
*   **扩展**—您的应用程序可以处理突然增加的流量，而无需额外的努力。
*   **速度**—低延迟和快速页面加载(得益于 cdn 的分布式特性)。
*   **按需付费— 只有当你的页面真正为客户服务时才开始付费。T3】**

通过将易于使用的托管解决方案、静态站点生成器、cdn 和可扩展 API 组合在一个堆栈中，我们可以相对容易地满足这些需求。

## **如果我的应用需要高度动态的数据怎么办？**

假设你正在为专业人士建立一个社交网络，专业人士可以在上面创建个人资料。专业人士创建个人资料来提升他们的技能，公司搜索网络来为特定项目雇佣专业人士。对于这样的应用程序，您需要存储、搜索、过滤和分页数据。

![](../Images/5c2f3767bd9fd3e6ad9cfb948019f39d.png)T2】

要构建这样一个应用程序，你需要一个数据库，但不是随便一个数据库。理想情况下，您希望避免失去 JAMstack 应用程序通常提供的零配置、按需付费、可伸缩性和速度优势。数据库拥有的几个特性使它非常适合 JAMstack 应用程序。

在本文中，我们将描述这些特性，并解释它们如何使数据库成为 JAMstack 应用程序的更好候选。由于这类应用程序通常依赖于无服务器函数，因此这些属性中的许多也适用于用 FaaS 构建的应用程序。

## **与 JAMstack 和 FaaS 应用程序配合良好的数据库属性**

**多区域、全球复制**

为了理解为什么多区域分发是可取的，让我们再来看看为什么 cdn 上的静态网站如此之快。CDN 可以快速传递您的内容，因为它在不同的位置包含您内容的副本。当从特定位置向 CDN 请求内容时，它将尝试从离请求者最近的位置交付该内容。为了了解这有多重要，看一下 [Zeit CDN 状态页面](https://zeit.co/smart-cdn) ，它显示了您当前位置与其他位置之间的延迟差异。通过将我们的应用部署到 CDN，我们的页面会从离用户最近的位置自动加载，从而降低加载延迟。和低延迟带来了出色的用户体验。

为了保持这种用户体验，将从我们的 API 加载的动态数据也必须表现出低延迟，实现这一点的最佳方式是使用分布式数据库。具有多区域副本的数据库，如 [FaunaDB](https://fauna.com/) ，[Google Spanner](https://cloud.google.com/spanner/)或[Amazon Aurora](https://aws.amazon.com/rds/aurora/global-database/)不仅提供您需要的动态查询，还可以像 CDN 一样从最近的位置交付您的数据。

**无连接**

许多传统数据库不是无连接的，这意味着它们需要与查询数据库的进程保持持久连接。数据库可以处理的连接数通常是有限制的，建立连接需要时间，而且会给数据库带来更大的压力。支持 JAMstack 应用程序的数据库要么从前端调用(如果可能安全的话)，要么从无服务器函数调用。用户数量的增加增加了运行函数或前端调用的数量。

限制连接和/或创建/破坏许多连接很快就会成为一个问题。理想的 JAMstack 数据库的行为类似于 API 它不需要连接。关于这个话题有一篇很优秀的 [文章](https://medium.com/swlh/databases-that-play-nice-with-your-serverless-backend-13eb7dc1e1c) 从 FaaS 的角度描述了连接问题。

**灵活的安全性**

提供开箱即用的安全性，免除了开发人员繁琐的配置工作。如果这个安全层还可以提供一种从前端安全访问数据库的方法，我们就有可能无限地写回我们的应用程序，消除额外的一跳，并进一步减少我们从分发中获得的低延迟。当数据库是无连接的，并且可以从前端安全地访问时，我们认为它是前端友好的。然而，安全要求可能很复杂。如果我们完全依赖数据库安全层，它必须足够灵活来表达自定义规则。[Firebase](https://firebase.google.com)Cloud Firestore、[FaunaDB](https://fauna.com/)以及即将推出的[Userbase](https://userbase.com/)提供通过客户端直接访问，就像浏览器一样。

**扩展和现收现付**

在我们添加数据库之前，我们典型的 JAMstack 应用程序是完全自动扩展和按需付费的，这被认为是许多初创公司的优势。我们只为我们的应用实际使用的 CDN 带宽和函数调用付费。如果我们的数据库也是按需购买、自动扩展的，我们也不会失去这一优势。

**强一致性**

强一致性是一个相当技术性的问题，所以我们简单解释一下，对于技术细节， [这篇文章是一个很棒的资源](https://aphyr.com/posts/313-strong-consistency-models) 。当您的应用程序存储和更新数据时，强一致性在分布式数据库中非常重要。在这种情况下，保持良好的开发体验有两个要求:

*   **您永远不会丢失数据:** 当写入或更新被确认时，它将不再被丢弃。
*   **数据更新是可预测的:** 当您保存或更新数据时，后续读取将反映这些变化。

强一致性(或严格可串行化)是最终一致性的反义词。通过采用一个做您期望它做的事情的数据库，您可以完全专注于您的应用程序。只有少数分布式数据库能够无限制地提供强大的一致性。

## **结论**

JAMstack 应用程序并不局限于完全静态的页面；通过从 API 中检索数据，它们可以部分是静态的，部分是动态的。分布式数据库可以是这些 API 中的一种，如果您的应用程序包含带有过滤或分页数据的动态页面，那么分布式数据库是必不可少的。 理想情况下，这样的数据库满足上述六个要求，这样我们就可以构建动态 JAMstack 应用，而不会损失速度、可伸缩性、按需付费或我们喜欢的零配置方法。

如果您想知道如何使用现代前端框架以优雅的方式创建一个部分静态、部分动态的 JAMstack，请看一下 [水合](https://www.gatsbyjs.org/docs/react-hydration/) ，这可能是即将发表的一篇文章的主题。

— [布莱希特房间](https://devops.com/author/brecht-de-rooms/)