# 德沃普斯的微积分

> 原文:[https://devops.com/the-calculus-of-devops/](https://devops.com/the-calculus-of-devops/)

这是一系列博客中的第二篇，与 Lee Reid 合作，他写了第一部分“[DevOps 的简单数学](https://devops.com/2015/06/22/the-simple-math-of-devops/)”和 Sanjeev Sharma，他们都是 IBM 杰出的 devo PS 思想领袖。

我正在使用李的数学 DevOps 模型来应用微积分的观点，如果你愿意的话，可以称之为“DevOps 的微积分”(好吧，不完全是大爆炸理论的核心微积分，而是从工程排队论的角度接近它)。

DevOps 带来的文化挑战之一是，它的某些方面与我们许多人在容量和响应时间方面学到的工程原则背道而驰。当我在贝尔实验室工作时，我们会应用排队论来确定如何最好地打包要通过网络发送的信息。一个基本前提是吞吐量和响应时间之间的权衡。一方面，打包到信息包中的消息越多，有效载荷就越能提高容量，因为处理信息包的开销会分散在消息中。然而，等待积累足够的呼叫处理信息意味着数据包的传输频率会降低，从而增加了响应时间。

一个简单的例子就是去杂货店。如果想花最少的资源(时间、汽油、汽车磨损等)。)购物时，人们会减少旅行次数，然后购买更多的食物。因此，如果史密斯一家每月旅行一次，花费 2 小时，那么他们每周花在购物上的平均时间将是 30 分钟。如果琼斯一家每周去一次，花一个小时，那么他们将会花两倍的时间和四倍的汽油去杂货店购物。然而，如果史密斯一家用完了某样东西(比如说谷类食品)，他们就不得不等待，平均要等两周才能得到补充。相比之下，琼斯一家在任何物品上的平均缺货时间是 3.5 天。

因此，当 2014 年 DevOps 报告发布时[【1】](#_ftn1)指出部署更频繁的区域更快地获得客户反馈，这是意料之中的。但没想到的是，这些组织也有更高的生产力。那么，这里到底发生了什么，似乎与吞吐量和响应时间的原则发生了根本冲突？

**攀比**

如果我们考虑大中型企业的预开发运维状态，那么应用程序通常一年只发布(部署到生产环境中)几次来提供业务功能。(我假设对于“计划外的工作”有更频繁的发布，比如缺陷和其他变更或者操作工作)。为了便于讨论，我们称之为 Smith 应用程序。因此，从业务角度来看，业务部门希望将尽可能多的工作打包到 Smith 版本中，因为他们一年只有几次将新业务功能投入生产的机会。

史密斯应用特点:

*   一年交付 3 次商业价值(每 4 个月一次)
*   成本是 C1
*   交付的商业价值(BV)是 V1
*   从概念(例如故事)准备好从待办事项列表中提取到交付给客户的平均时间是 2 个月，加上任何额外的等待时间(例如优先级)
*   每年交付的 BV 为 3*V1
*   每年的费用是 3*C1

现在让我们转移到 Jones Planet，在那里应用程序被发布到生产环境中，并在每两周的迭代结束时提供新的业务功能。在这种情况下，企业更关心的是向 IT 部门提供持续的需求流，而不是争论一个给定的特性/故事是否会包含在这个特定的版本中。相反，有一个持续的优先化(或连续规划)过程，确保最高价值的工作被输入到 IT 管道中。

琼斯应用特征:

*   一年交付 26 次商业价值(每两周一次)
*   成本是 C2
*   交付的 BV 是 V2
*   从概念(例如故事)准备好从待办事项列表中提取到交付给客户的平均时间是 1 周，加上任何额外的等待时间
*   每年交付的 BV 为 26*V2
*   每年的费用是 26*C2

基于之前的工程分析，我们预计会出现以下情况:

1.  史密斯年度成本(3C1)
2.  史密斯年度 BV (3V1)>琼斯年度 BV (26V2)

因此，琼斯通过更频繁地交付所做的权衡(我们相信)是，他们每年花费更多的钱，而交付更少的商业价值。

然而，之前引用的 DevOps 报告中的数据正好相反。事实上，研究结果表明，更频繁地部署较小工作单元的企业具有更高的质量和更高的生产力(能力)。这是怎么回事？

**一种新的范式**

如果你走到任何一个 IT 团队(即使是敏捷团队)面前，问他们为什么不更频繁地部署业务价值，他们通常会提到他们遇到的以下类型的浪费等待状态:

*   等待工作(缺乏一致的流程)
*   等待其他人做某事(依赖其他团队)
*   等待环境(争用)

这种情况的一个主要根源是大型企业将大量工作打包到不经常发布的版本中所产生的依赖性。从计划的角度来看，由于优先顺序的讨论，这个过程被拉长了，因为在生产线的错误一侧可能意味着在向客户交付产品时要延迟几个月。如果你问一位业务组合负责人，他们最优先考虑的是什么，我猜他们可以在几秒钟内告诉你。然而，大多数大型组织可以每年花几个月的时间来规划他们的年度 IT 工作组合。一些组织在一个单独的故事进入敏捷开发团队的 backlog 之前，花费了超过 50%的新项目构建时间！

从开发的角度来看，将大量的工作打包到发布中意味着更多的依赖关系，这些依赖关系必须跨计划和受影响的应用程序进行管理。从测试的角度来看，下游环境(ST，UAT)必须管理应用程序版本方面的更多信息，尤其是测试数据，这会使流程变得复杂和缓慢。测试数据的复杂性增加与测试所需的数据集中存在的成对关系的数量成比例。因此，从发布和变更的角度来看，测试的复杂性将会非线性地增加(可能与依赖系统的平方成比例);考虑到一次要改变多少，有必要进行大量的协调。

管理大中型企业中存在的所有依赖关系的所有工作完全消除了将工作分批交付可能带来的任何潜在节约。此外，不得不从发布中抽出一些工作的可能性(由于质量或业务准备或一些其他原因)有时会导致复杂的源代码管理(在某些情况下是特性分支)，这进一步使频繁合并到主干的过程变得复杂。这些类型的实践也有助于增加技术债务。因此，从这个角度来看这个问题，可以说明为什么我们看到的结果是完全合理的。

生产率与一个版本中依赖项的数量成反比

正如 Lee 在最初的博客中所说，一个组织的成功很大程度上取决于信任。信任的一个因素是清晰，这意味着理解每个版本给 IT 和客户环境带来的变化。因此，一个不利于信任的因素是以更少的频率交付更多的东西和更好地控制变化的观念，这是一个好的观念。

*信任与一个版本中依赖项的数量成反比*

与“大爆炸”计划相关的还有另一个隐藏的浪费因素。暂时回到我们的杂货店例子。史密斯每月远足可能会导致购买一些他们最终用不到的东西。如果不经常购买，易腐物品就不会被很好地分配。同样，在 IT 规划中，我们倾向于在我们的 IT 交付篮子中放一堆我们不确定会需要的东西，结果我们浪费了很多精力在那些几乎不用或根本不需要的功能上。一些企业估计，他们投入到大型版本中的 50-65%实际上并没有给业务带来真正的价值。进行更频繁的发布允许一个持续的发现过程，以更好地指导 IT 资源在真正有价值的方面的使用。

*废物与释放量成正比。*

换句话说:

*收益(每项 IT 投资的价值)与发布频率成正比。*

**修改交货时间的计算**

所以如果我们重新审视李的模型

*   计划成本 T [计划成本]
*   开发复杂度 T [设计] + T [开发] + T [构建]
*   测试复杂度 T [测试]
*   发布和变更管理复杂度 T [发布] + T [部署] + T [评估]

信任%–即使琼斯和史密斯模型之间的一切都是成比例的，影响清晰度、一致性和协作的信任成分，对于大型(史密斯)发布来说要低得多。鉴于信任具有倍增效应，仅此一点就可以解释研究中发现的结果。

**文化挑战**

虽然很明显，我们需要对业务中引入的变化保持敏感，但是让业务涉众能够在需要时获取功能并更频繁地获得它，不仅对客户有好处，而且从 it 的角度来看，在提高生产率和减少技术债务方面也有极大的好处。挑战在于让业务和 IT 领域的领导者相信进行更持续的计划和频繁交付的好处。独角兽可能引领了这种类型的思维，但实际上是马将从这种类型的文化转变中受益最多，因为马在减轻依赖因素方面受益最多，这种依赖因素可能会破坏质量、生产率和周期时间。

在 Sanjeev Sharma 的这个系列的下一篇博客*devo PS 的艺术*中阅读更多关于这个主题的内容。

[【1】](#_ftnref1)《2014 年开发运营状况报告》，Puppet Labs，IT Revolution，https://Puppet Labs . com/sites/default/files/2014-State-of-devo PS-report . pdf

[【2】](#_ftnref2)《凤凰计划》，吉恩·金，凯文·贝尔，乔治·斯帕福德，http://www . Amazon . com/The-Phoenix-Project-Helping-Business/DP/0988262592

### **关于作者**

*[![Carmen](../Images/e088a66a9980bebb0f4789c53ec74260.png)](https://devops.com/wp-content/uploads/2015/07/Carmen.jpg)*Carmen DeArdo 是 Nationwide Insurance 的应用程序开发工具和技术总监。Carmen 负责在移动、分布式和大型机以及其他技术中利用 DevOps、精益和敏捷技术推动持续交付。这包括在开发生命周期中使用的技术的建议和实现(例如，IBM Rational 工具套件，开源技术)。