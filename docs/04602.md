# 虚拟机、容器、云、集群:调度差异

> 原文:[https://devo PS . com/VMs-containers-cloud-cluster-scheduling-differences/](https://devops.com/vms-containers-cloud-cluster-scheduling-differences/)

调度是数据中心运行的重要组成部分，更重要的是让数据中心的虚拟化部分(无论是虚拟机、云、容器还是集群)正常工作。

虽然虚拟化性能有许多可变因素，但调度始终会影响性能。然而，我们只是在集群中谈论了很多(在集群中，需要与 OS 调度器相当的健壮调度器)。

这是有原因的，值得探究。

![](../Images/6e4c1e6fd8b1c50c358e6277619cc0f0.png)(旁注:我在写这篇博客的时候和 Lori 谈到了这篇博客，她让我想起了我们上硕士课程的时候，操作系统课用 Homer Simpsons 贪婪地想要甜甜圈作为我们的调度项目。因此，每当我们想到时间安排，我们就会在脑海中听到许多荷马过程中的一个被拒绝吃甜甜圈并发出“哦！”)

对于虚拟机，调度在很大程度上被放弃，以利于其他资源的利用。创建虚拟机时，虚拟化只关心 CPU 和内存需求。你告诉它，唯一一次你再次担心的是如果你需要比物理硬件所能提供的更多的 CPU 核心，在某些情况下，CPU 虚拟化将允许你继续旋转虚拟机，即使在那之后。只有真正的调度机制在重负载情况下实际上可能彼此不一致。例如，主机操作系统调度程序可以在客户操作系统将应用程序的重要性提升到“高得惊人，现在就做”的同时，换出虚拟机的活动线程尽管这只是开始表明关于服务器和负载的基本规则被忽略了，但它确实发生了。

私有云也有同样的问题。为什么？因为即使营销界的每个人都假装这不是真的，私有云与 VMware [ESXi](https://www.vmware.com/products/esxi-and-esx.html) 本质上是相同的底层工具集。企业中的使用模式表明，不仅每个人都知道这一点，而且差异也没有任何相关组织愿意承认的那么大。不是说它们是相同的代码，而是在实践中，它们做相同的事情。

这两者(以及公共云)真正利用调度的一个地方是当自动响应使用高峰时，这种高峰可能会埋葬一个系统。然而，对使用高峰的解决方案不是这些系统的一部分；它们是由 DevOps(或 Dev，或 Ops)人员制作的，他们在掉线会造成损失的地方工作，因此，快速响应增加可用服务器池，然后再缩减它是很重要的。但是，由于他们使用自己的指标来确定需求，更多的这些系统是在应用供应工具中实现的，而不是在云和虚拟化软件中实现的。我们可以争论这个功能实际上属于哪里，但不是它今天在哪里实现。

我在这方面有点涉足公共云，所以我将解决这个问题。当人们谈论它更“敏捷”或“自适应”时，他们指的是“通过我们编写的这种准调度代码，在需要时加速实例。”“代码”是 python 脚本还是 Ansible 剧本并不重要——是他们安排的，而不是系统。

那就剩下聚类软件了(比如 [Mesos](https://mesos.apache.org) )。因为集群软件将许多机器视为一件大事，所以它需要一个调度程序来管理资源。在 Mesos 的例子中，中央调度器真的没有那么智能，我认为这是一个天才的实现。它知道每台机器有哪些资源(CPU、内存)可用，它知道从那台机器分配了哪些资源，对于每个“框架”(把它们想象成作业执行者；虽然这有点简单，但对于这个讨论来说是完美的)它需要什么来完成它的工作。然后，它进行最佳匹配，向框架提供资源，并等待更多的资源从完成的执行中可用。

因此，在虚拟机的世界中，如果您有 50 个需要资源的独特应用程序，您需要创建 50 个虚拟机来为它们提供服务。在任一云环境中，您都可以做到这一点。我们喜欢开玩笑说，由于微服务，容器被视为虚拟机，除非您有 50 个独特的应用程序，您创建了 500 个容器，但现实是，它们在许多用例中与虚拟机完全一样，在容器化现有应用程序时，会创建 50 个容器。看一看 [MesoSphere 的](https://mesosphere.com) 2016 [集群用户调查](https://mesosphere.com/resources/apache-mesos-survey-2016-report/)，你可以看到相当数量的集群用户正在使用带有 Mesos 和 DC/OS 的容器，而他们中的许多人并没有专门使用微服务。

![](../Images/dec12d6168d19b6af3fead036f12a1da.png)

*资料来源:【2016 年 8 月中间层用户调查*

在集群环境中，当资源可用时，你有一台巨大的机器来运行这些应用程序，所以如果你的 50 个应用程序需要的资源比集群提供的少，它们就简单地并行执行；如果您没有足够的硬件来运行它们，与虚拟机不同，您可以将它们排队，假设群集没有过载，最终它们都会运行。

当容器被添加到集群(一个公共环境)中时，这变得更加有趣，因为那时你确实有离散的容器，但是调度器仍然管理多少资源可用/正在使用，并且容器架构允许应用程序在集群中携带它的需求。

我们为什么关心？因为您知道您的工作负载是什么，以及哪种调度方法对您的组织更重要。如果有 50 个应用程序都有稳定的资源需求并且一直在运行，那么虚拟化可能适合您，但是如果组织的工作负载不断变化并且资源需要高速循环，那么集群可能适合您。不管怎样，知道外面有什么永远不会成为障碍。

唐·麦克维蒂