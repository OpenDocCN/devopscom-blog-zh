# 混乱心态:教你的代码如何应对

> 原文：<https://devops.com/the-chaos-mindset-teaching-your-code-to-cope/>

混沌工程听起来既诱人又令人兴奋——实验很有趣，对吧？但是对这种方法的一些误解是，它不是关于快速移动和打破东西。它是关于在测试代码弹性的软件生产过程中设计和引入中断，很像汽车工业中的崩溃测试。

如果你仔细想想，这是开发人员喜欢的思维方式的逻辑延伸:我们正在为现实世界设计软件和系统。他们不应该能够处理现实世界的情况吗？

为了有效地为现实世界设计，开发团队不一定需要成为混沌工程师。这不是关于一套全新技能的培训。相反，它是关于采用一种混沌思维——一套系统和视角，让你的团队参与受控实验，以交付能够应对最终用户扔给他们的任何东西的产品。

那么，你如何知道你的团队是否准备好采用混沌工程原理呢？你应该做些什么来帮助他们？

## 混沌工程:基础

这种方法是关于使用分布式系统作为一个“安全”的实验环境，这样开发团队可以确保他们的产品能够承受生产中的意外动荡。网飞的工程师基于他们在 AWS 上为网飞开发的经验，创造了这个术语。

混沌工程的有趣之处在于，它让开发人员找到现有系统中的漏洞，从而允许他们开发弹性。通过在分布式环境中的现有平台或沙盒开发环境中运行实验，团队可以在不影响最终用户的情况下监督和控制实验。

有些应用程序，如金融或贸易中的事务性应用程序，不应该在生产中被中断，开发人员应该在沙盒环境中进行测试。如果你的团队已经使用了容器化技术，那么混沌工程就很容易实施——无论如何，这应该是任何现代 DevOps [CI/CD 流程](https://devops.com/?s=CI%2FCD)的一部分。在应用程序到达发布步骤之前，通常设置一个 DevOps CI/CD 管道来运行一系列测试。在这个测试步骤中，您可以很容易地添加一些中断；有些可能更难到位，需要更复杂的环境。

开发团队可以使用现有的环境和系统向彼此展示意想不到的问题是如何影响软件产品的生产的，允许他们协作并在生产变慢或完全停止之前解决编码之谜。

工程师设计的应用程序会遇到一些常见的问题，无论这些应用程序是在内部运行还是在云中运行。我们可以将这些问题分为以下几类:硬件限制、子系统故障、外部系统故障和软件缺陷。虽然我们可以定义更多的类别，但这些是主要的类别，也是易于测试的类别。

## 混沌心态:混沌之道

像敏捷一样，混沌工程不仅仅是一套活动和工作流程——它还是一种精神状态。你的人民和你的文化必须准备好并且能够采用混沌原则，以及混沌过程。

对于 DevOps 领导者来说，采用新的思维方式听起来可能有点，嗯，模糊。但这种转变是基于具体的行动，而不仅仅是哲学思考。

考虑云基础架构领域的一个示例:如果云服务集中在一个位置或云基础架构内有限数量的微服务中，则云服务中托管的任务关键型应用程序可能面临失败的风险。但是，如果应用程序以分布式方式托管，您可以为应用程序级可用性和弹性创造更大的机会，并且可以在现有的生产环境中测试这种弹性。

对于大多数企业来说，这种分布式体系结构并不是全新的，因此，以在各种基础设施场景中测试可用性的方式开发应用程序的过程也不应该是一个陌生的概念。作为一个 DevOps 领导者，你可以建立一种以弹性为中心的思维文化，方法是给你的团队提供他们需要的工具来采用混沌风格的测试，然后向他们展示如何将这种思维建立到每一次冲刺和每一次站立中。

训练你的团队需要努力，但你不必独自完成。网飞的[猿人军](https://github.com/Netflix/SimianArmy)有成吨的工具和指导；脸书风暴和[亚马逊游戏日](https://aws.amazon.com/gameday/)，这两个模拟云中故障的作战室类型的体验，也有有用的例子和想法。

## 现实生活中的混沌工程

部署受混沌启发的实验策略并不容易。从一套简单的操作原则开始，作为设计混乱策略的指南:

*   **假设:**我们认为系统应该如何工作，所以我们知道它什么时候不工作。
*   **场景规划:**你知道现实世界中可能发生的失败事件或危机点有哪些？
*   **设置实验:**设计并生产测量代码强度的测试。
*   **配置监控:**监控将有助于测试假设，并帮助您实时了解中断的影响和解决方案。
*   让实验自己运行:自动化测试可以让你持续地评估性能和弹性。
*   **包含实验:**你不希望已经发布的软件被你的实验室实验破坏，所以确保设计时有适当的防护。
*   **关闭开关:**即使在封闭的情况下，也要有一个关闭开关，以防止中断进一步影响某些用户。

混沌工程最大的讽刺是它一点也不混乱。这是一种打破常规的方法，让你的团队更聪明、更快地了解他们的产品和应用程序在现实世界中将如何工作。这是一个与敏捷实践完美融合的策略。尽管它不会让你的应用程序刀枪不入，但它绝对能帮助你以更大的优雅和技巧躲过失败的子弹。

您必须将软件架构作为一个整体来看待，以便为架构的每个部分找到最合适的混沌工程测试工具。没有一个工具可以测试你的架构的所有组件；你将不得不对不同的部分使用不同的工具——并且不要忘记监控！只有通过适当的监控，您才能评估软件如何响应中断。

有时候，最好的方法，也是最简单的方法，是在你的软件中构建一些混沌工程步骤，这样软件本身就可以在给定特定输入的情况下被破坏，而不会以一种明显的方式暴露安全弱点。这非常像云应用程序如何创建心跳和健康检查端点。我们喜欢认为混沌工程是对单元测试和集成测试的一个很好的补充，除了我们在生产系统上运行它。