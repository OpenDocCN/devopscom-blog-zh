# 使用特征标志保持渐进交付质量

> 原文：<https://devops.com/maintaining-progressive-delivery-quality-with-feature-flags/>

网飞怎么知道你到底想看什么？社交网络如何确保主要软件更新在数百万用户中顺利部署？答案，部分在于**渐进式交付**。渐进式交付，即新功能的逐步引入，已经成为推出新功能的关键。通过在一小部分用户身上测试未经验证的功能，平台可以在与主要用户群保持融洽关系的同时快速发展。但是，QA 在渐进交付周期中处于什么位置？

随着软件开发团队面临快速迭代的需求，QA 工程师的角色也在演变。QA 团队越来越多地被指派来支持新的客户体验计划，并满足开发者消费者的需求。他们必须在这样做的同时，了解开发人员引入新功能时要监控哪些客户指标。

最近，我与最近被 Episerver 收购的[首席软件质量保证工程师](https://www.optimizely.com/episerver-to-acquire-optimizely/)[杰夫·辛](https://www.linkedin.com/in/jeffsing/)聊了聊，探讨如何在一个渐进的交付生命周期中使用特性标志来保持质量和响应用户反馈。

## 定义渐进式交付和功能标志

渐进交付是一种强调早期代码推送和快速反馈的软件发布风格。通过在更大的用户群的小部分中测试功能，开发人员可以快速判断哪些有效，哪些无效。

**特征标志**是渐进式交付工作的必要组成部分。也被称为**特性切换**，特性标志是开关，使开发人员能够关闭或打开一个特性，帮助工程团队测试未完成的特性或 alpha 特性，同时避免维护多个分支。“特性标志是一种强大的技术，允许团队在不改变代码的情况下修改系统行为，”皮特·霍奇森在 MartinFowler.com[的一篇帖子中写道。](https://www.martinfowler.com/articles/feature-toggles.html)

## 功能标志支持实验

Sing 说，采用渐进式交付的特征标志允许进行大量的实验。例如，公司可以在一小部分用户身上测试新的用户界面调整。如果它运行良好，团队可以针对特定用户的口味进一步优化它。

“你为什么要造一个没人想用的东西呢？你怎么知道你在做正确的事情？”阿星问。

迭代发布策略并不新鲜——它们还有其他的名字:金丝雀发布、A/B 测试、有针对性的发布和特性控制。然而，特性标志的独特之处在于能够进行粒度优化。

例如，如果你将一个朋友的亚马逊主页与你自己的主页进行比较，你可能会发现仪表盘、产品推荐和整体用户界面都有很大不同。Sing 说，这些公司正在继续“在每个用户的基础上进行积极的实验”。这使他们能够实时个性化体验，以满足特定用户的口味。

许多其他公司正在利用渐进式交付策略。[蓝围裙](https://www.optimizely.com/customers/blue-apron/)例如，采用实验来发现和提炼商业价值。实验是 [HelloFresh](https://engineering.hellofresh.com/a-story-of-experimentation-culture-at-hellofresh-be0f0ceb171b) 提炼客户体验的核心。 [Compass](https://blog.optimizely.com/2020/05/14/adopting-optimizely-at-compass/) 还使用渐进式交付工具，在一套服务于各种平台的应用程序中实现功能标记。

对于 QA 团队来说，这意味着转移权利——以持续交付的速度从业务测试转移到纳米测试。因此，QA 团队必须扮演积极的角色——“不断测试客户反馈，并不断重申该功能，”Sing 说。

## 实现特性标志:QA 右移

通过将客户反馈添加到持续交付循环中，特性标志有助于增量部署策略，并成为开发运维的基本要素。那么，我们如何在应用程序开发过程中实现特性标志呢？

如果我们在一个小产品中测试一个功能，一个明显的想法是注释掉或者取消注释代码。但是，这并不能很好地扩展。相反，开发人员可以编写一个条件变量。然而，仍然有更多的动态功能切换选项。更高级的解决方案可能涉及切换路由器和/或 UI 驱动的替代方案。

Sing 描述了一个系统，该系统使用编写为 YAML 文件的开关，并采用可视仪表板来切换开/关功能。这种设置可以启用一个过程，开发人员通过该过程检入代码并将其传递给站点可靠性工程师(SREs)或 QA 经理。然后，他们可以在生产中启动测试，实时查看来自测试用户的数据，并做出相应的响应。

与一个 [CI/CD 管道](https://devops.com/how-to-scale-microservices-ci-cd-pipelines/)集成将是下一个合乎逻辑的步骤。每个构建都可能包含许多潜在的特性。如果代码中的一个标志打开，系统将执行所有代码，并且可以很容易地远程关闭或打开组件。Sing 说，通过这种方式，工程师“无需代码部署就可以实时控制事物的表现方式”。

Sing 说，将特征标志和渐进式交付结合起来，可以获得非常有价值的数据。如果团队可以看到系统行为、跳出率、客户 NPS 分数和业务转换等指标，他们就可以更好地提高未来部署的质量。“你不能否认确凿的数据，”他指出。

## 功能标志的好处

在持续开发中使用特性标志似乎有很多好处。在这个过程中，QA 在工程团队如何推出(或回滚)新功能方面扮演着更现实的角色。“QA 必须了解业务影响和客户故事，”Sing 说。“这不仅仅是正常运行时间的问题；这也是一种体验。”

正如您从上面的用例中所看到的，带有特性标志的渐进式交付带来了许多好处:

*   **快速验证**:通过改进测试，将新产品功能和概念验证更快地推向市场。
*   **试验和迭代**:发布增量软件版本。尝试考虑边缘情况的新功能或未完成的功能。
*   **发展**:避免分支不断合并。
*   **反映客户旅程**:在客户旅程中收集更多启发，以测试和测量客户数据。
*   **针对每个用户进行优化**:针对用户口味进行测试和优化。“你为什么要造一个没人想用的东西？”对于 Sing 来说，有针对性推出可以立即满足用户的需求。
*   **限制爆炸半径**:如果新功能导致停机，可轻松切换的功能意味着它们可以快速关闭并重新投入开发，从而提高服务可靠性。

## 功能标志的缺点

特性标志引入了许多测试新特性的有效方法，但是它们在其他领域也有副作用。特性标志的一个潜在缺点是支持大量复杂定义的用户场景。

每次细分都会带来新的优化要求，支持必须适应各种功能集的快速增长。公司需要先进的工具来支持轻松添加或删除功能。“你需要力量去理解发生了什么，以及你如何管理它，”辛指出。

拥有数千个微服务的破碎生态系统可能变得难以持续支持。工程团队必须在永无止境的优化和保持一个有凝聚力的产品之间划一条线。理想情况下，开发人员可以重用基本组件，但以不同的方式表示它们。

另一个负面影响是舆论。随着[社交困境](https://www.latimes.com/entertainment-arts/movies/story/2020-09-09/review-social-dilemma-facebook-google-netflix)和相关技术行业评论的发布，许多面向用户的技术网络受到严厉批评，因为他们不道德地使用用户数据来开发超针对性的广告活动。不尊重用户的优化策略应该被禁止。

这还不算围绕用户数据和隐私的法规。如果用户不同意共享用户数据以“改善用户体验”，工程团队将没有必要的度量和跟踪数据来决定实现哪些功能。

虽然功能标志似乎有助于优化商业价值，但在实施之前，有许多潜在的“问题”需要仔细考虑，从技术后勤到服务碎片化、用户道德和法律后果。

## 最后的想法

“就像任何新技术一样，如果你不正确地使用它，它几乎比你不使用它更好，”辛说。如果渐进式交付没有得到正确的管理，带着 QA 的心态，它可能会回来咬他们。

随着我们不断开发新技术以实现更快、更智能的运输，考虑客户需求也很重要。“自动化是伟大的，但计算机不能理解客户真正想要什么，”辛指出。为了避免高度个性化的技术障碍和社会危险，QA 应该成为考虑客户幸福的客户支持者。