# 度量、日志和跟踪:监控中可观察性的金三角

> 原文：<https://devops.com/metrics-logs-and-traces-the-golden-triangle-of-observability-in-monitoring/>

随着底层技术的发展，监控基础设施和应用程序环境的工作变得越来越复杂，这并不奇怪。随着我们的业务对 it 的依赖越来越深，正确监控的需求也越来越大，这也就不足为奇了，因此，很好地掌握可供您使用的核心工具非常重要。

您可能称之为可观察性的金三角包括度量、日志和跟踪。每个人在基础架构和应用程序监控中都扮演着特定的角色，因此您需要了解他们带来了什么。

## **指标**

度量可能是三种监控工具中最有价值的，因为:

*   如此多的资源旨在提供各种健康和性能信息(并且有大量的工具来收集这些信息)。
*   他们很有效率。
*   它们经常产生。
*   它们很容易在基础设施的各个元素之间关联起来。

从操作系统到应用程序的一切都会生成指标，这些指标至少会包括一个名称、一个时间戳和一个表示某个值的字段。既然如此多的资源已经准备好告诉我们关于它们自己的情况，那么当涉及到监控时，度量是一个明显的起点。

几乎所有的指标都将使您能够判断一个资源是活的还是死的，但是如果目标足够有价值，您将希望能够确定系统实际上出了什么问题或出了什么问题。正如您所想象的，后者将需要关于系统内部正在发生的事情的详细信息，即所谓的依赖于内部仪器的白盒监控。更基本的黑盒方法基于外部可见的指示器得出关于系统健康的结论(它是否响应任何系统调用？).

但是，关于指标，需要理解的最重要的事情可能是关于能够跨基础设施组件关联指标的最后一点。考虑到当今 IT 环境中常见的复杂的相互依赖关系，整合指标以获得更全面的视图的能力可以节省大量时间。由于云基础架构的动态特性以及该基础架构和应用程序之间不断变化的关系，随着我们转向云原生环境，这一点变得更加重要。

利用度量的最初挑战是可用信息的多样性以及收集和理解这些信息所需的工具数量。还有一个问题是，如何从如此多的资源中以如此多的格式存储数据。但由此带来的好处远远超过了找出如何利用信息所需的努力。

同样值得注意的是，由于没有用于度量标准收集的标准 API，许多组织使用代理来收集数据，这些数据要么被推到中央位置进行分析，要么由中央资源提取。Gartner 表示，客户经常提到的代理包括 push agents Collectd 和 Telegraf，而 Prometheus 则被称为从目标获取信息的工具。

## **日志**

日志可能是监控工具箱中第二重要的工具，因为几乎所有东西都记录了它们在任何给定时间正在做什么的信息。此外，日志往往比度量标准提供更多关于资源的深入信息。因此，如果指标显示资源失效，日志将有助于告诉您它失效的原因。

日志的问题是好东西可能太多了。由于您环境中的一切都在跟踪他们在做什么，并急于共享这些信息，因此很容易看到这会导致数据堆积如山。您没有简化监控过程，而是简单地创建了一个新的集中式大草堆。

和度量标准一样，日志格式的差异和大量可用于收集和理解日志的工具，使得从这些丰富的资料中获取最大价值的工作变得更加复杂。然而，有许多用于收集日志的常用工具，比如 syslog 和开源工具，比如 Fluentd。

最大限度地利用这些工具的诀窍是限制您收集的内容，使其易于管理，并且在可能的情况下，集中在公共领域，这样您可以更容易地找到大海捞针。

## **痕迹**

监控三角形中最后但同样重要的是应用程序跟踪数据，它“跟踪”关于特定应用程序操作的信息。如今有如此多的应用程序相互依赖，这些操作通常会涉及多个服务的跳跃(所谓的跨度)。

因此，跟踪增加了对应用程序端到端健康状况的关键可见性。但是，它们只关注应用程序层，并且对底层基础架构的健康状况提供有限的可见性。因此，即使您收集了跟踪，您仍然需要指标来了解您环境的全部情况。APM 工具向集中式指标存储提供跟踪信息，因此跟踪为以应用为中心的视图提供了很好的数据源。

在基于容器的微服务架构中，对跟踪所能提供的观点的需求变得更加迫切，这种架构只不过是缝合在一起的服务的集合。这些环境可以用分布式跟踪来解决。

## 这三样你都需要吗？

度量、日志和跟踪之间显然有重叠。但是对于是否需要所有这三种类型的监控工具这个问题，快速的答案是，这要看情况。您的环境越简单，对性能下降和停机的容忍度越高，保持正常运行所需的工具就越少。基本的度量标准可能对你很有用。

相反，更复杂的环境必须一直保持正常运行，或者需要尽快修复，这就需要混合使用多种工具，而不仅仅是回答“它坏了吗？”度量和日志将是基本要求。

最后，如果您的环境由许多错综复杂的部分组成，那么在遇到跟踪问题时，添加跟踪将会节省您的精力。如果你还没到那一步，但看到容器和微服务在你的未来扮演着更重要的角色，你可能想从今天开始熟悉跟踪工具。

请记住，这些工具都需要考虑存储问题。是的，可以选择支持来自同一个存储库的多个工具，但是在构建监控库时，您需要考虑这些需求。最终，您将需要能够跨环境的分析和警报工具，因此在考虑选项时请记住这一点。

度量、日志和跟踪共同构成了可观察性的金三角，将帮助您在当今推动业务的不断变化的 IT 世界中保持领先。

-[戴夫的爸爸](https://devops.com/author/apurva-dave/)