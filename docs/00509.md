# 将您的组织从定期维护中解放出来的四个步骤

> 原文:[https://devo PS . com/four-steps-to-free-your-organization-from-scheduled-maintenance/](https://devops.com/four-steps-to-free-your-organization-from-scheduled-maintenance/)

无论您是运营工程师还是客户，在交付软件即服务时，定期维护通常被视为理所当然的事情。虽然比意外停机好得多，但计划内停机对每个相关人员来说仍然很难——客户总是有非工作时间的访问需求，并且您希望执行维护的低流量时间通常也是您的运营工程师和管理员希望睡觉的时间。最重要的是，定期维护意味着你的系统没有你想象的那么可靠，因为你害怕在工作日改变它。

我们如何使定期维护对所有相关人员都更好？

计划维护在 PagerDuty 是行不通的，因为我们的客户不知道他们的监控工具何时会发出警报。我们不得不努力专注和创新，以提供持续的正常运行时间，我的同事兼我们运营团队的成员 Doug Barth 最近在 [DevOps Days Chicago](https://www.youtube.com/watch?v=01Qfk7d8CMg&feature=youtu.be&t=21m36s) 做了一次演讲，讲述了我们用来完全放弃定期维护的策略，并以不影响整个系统的迭代维护取而代之。

**1。分阶段部署**

您的部署需要坚如磐石。它们应该编写脚本，快速回滚，并定期测试以确保回滚不会滞后。

它们还需要向前和向后兼容一个版本。当你推出一个新版本时，停止印刷不是一个选择。[红-蓝-绿](http://martinfowler.com/bliki/BlueGreenDeployment.html)部署在这里至关重要，因为它们确保在任何给定的时间，只有三分之一的基础设施会发生变化。

最后，[无状态应用](http://www.rackspace.com/blog/coding-in-the-cloud-rule-3-use-a-stateless-design-whenever-possible/)必须成为规范。您应该能够重启应用程序，而不会对客户产生任何影响(如强制注销或购物车丢失)。

**2。避免刀口变化**

明智地使用 canary 部署来测试部署，判断其完整性并比较结果。这些测试部署只影响系统的一小部分，所以坏代码或意外错误不会给整个服务带来灾难。

在他的演讲中，道格提出了一些实用的方法来实现这一点:

*   Gate 特性，这样你就可以发布黑暗代码，然后慢慢地将新特性应用到一部分客户身上。
*   确保您是在您的客户群的代表性样本上测试这些变化:不同的帐户大小、使用模式和配置。
*   想办法慢慢地将流量从一个系统转移到另一个系统，以降低配置错误或基础设施不完善带来的风险。
*   另外运行关键路径代码。执行它并记录错误，但是不要马上依赖它。

**3。让重试成为你的新好友**

您的系统应该加载重试。将它们构建到所有服务层跳中，并使用[指数补偿](https://en.wikipedia.org/wiki/Exponential_backoff)来避免使下游系统不堪重负。服务层之间的请求必须是等幂的，这样您就可以向新服务器重新发出请求，而不必重复应用更改。

在不关心响应的情况下，使用队列将客户端与服务器分离。如果您受困于请求/响应流，请使用断路器方法，在这种方法中，如果服务中断，您的客户端库将返回最少的结果，从而减少前端延迟和错误。

**4。不要把所有的鸡蛋放在一个篮子里**

将您的数据分布到许多服务器上，这样就不会有一台服务器重要到让您无法安全地使用它。

在[page duty](https://www.pagerduty.com)，我们使用多主 MySQL 集群，这有助于操作和垂直扩展。我们还将 Cassandra 等分散的、线性可扩展的数据库用于我们的警报管道:由于事务不受单个节点行为的限制，我们可以在白天进行操作工作。

总之，这四个策略使组织能够摆脱恼人的每周停机时间，帮助管理员和运营工程师睡得更香、更放心、更好地维护—所有这些都提前完成。这不仅有利于您团队的生活质量，而且有助于您提供出色的客户体验——无论您的用户在哪里，也无论时间是什么。