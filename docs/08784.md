# 什么是混沌工程(什么不是)

> 原文:[https://devops.com/what-chaos-engineering-is-and-isnt/](https://devops.com/what-chaos-engineering-is-and-isnt/)

2008 年，当网飞从数据中心转移到云端时，[混沌工程](https://devops.com/?s=chaos+engineering)偶然诞生了。搬迁没有按计划进行。

当时的想法是，数据中心将网飞锁定在单点故障的架构中，就像大型数据库和垂直扩展的组件一样。迁移到云将需要水平扩展的组件，这将减少单点故障。但是，向水平扩展的云部署实践的转移并没有像他们预期的那样增加流媒体服务的正常运行时间。

使系统足够健壮以处理实例消失的具体方法并不重要。根据系统环境的不同，它甚至可能有所不同。重要的是，它必须完成，因为由于实例不稳定事件的高频率，流媒体服务正面临可用性不足。在某种程度上，网飞只是放大了单点故障效应。

进入混沌猴。Chaos Monkey 为该公司提供了一种方法，可以主动测试每个人对失败的恢复能力，并在工作时间进行测试，以便人们可以在有资源的时候应对任何潜在的影响，而不是在寻呼机通常会响起的凌晨 3 点。

然后，2012 年 12 月 24 日，发生了。亚马逊网络服务(AWS)遭遇了弹性负载平衡器(elb)的滚动中断。这些组件连接请求并将流量路由到部署服务的计算实例。随着 ELBs 的下降，额外的请求无法得到满足。由于网飞的控制飞机运行在 AWS 上，客户无法选择视频并开始播放。

为了确保所有这些团队的服务都能够胜任任务，创建了一个使某个区域离线的活动。好吧，AWS 不允许网飞让一个地区离线(关于在该地区有其他客户的事情)，所以，相反，网飞模拟了这个活动；贴着“混沌孔”的标签

快进到 2015 年左右。网飞让混沌孔研究大规模的消失区域，并引入了混沌猴子，它研究小规模的消失实例。

在网飞大学混沌工程的早期，这个学科实际上是什么并不明显。有一些关于“拔掉电线”、“破坏东西”或“在生产中测试”的流行语，伴随着许多关于如何使服务可靠的误解，以及很少的帮助支持这项工作的实际工具的例子。

为了正式确立这一原则，2015 年初，我接受了为网飞的混沌工程团队制定章程和路线图的任务。我建立并管理了这个团队三年。我的合著者“[混沌工程:实践中的系统弹性](https://www.verica.io/blog/the-chaos-engineering-book/)”Nora Jones 很早就以工程师和技术负责人的身份加入了混沌工程团队。她负责关于我们构建的工具的重要架构决策，并监督实施。

首先，我和我的团队坐下来正式定义混沌工程。我们特别希望澄清:

混沌工程的定义是什么？这有什么意义？
·我如何知道我在做什么？
我该如何改进我的练习？

我们研究了弹性工程和其他学科，以便为其他人如何参与混沌工程提出一个定义和蓝图。经过大约一个月的宣言工作，我们产生了混沌工程原理。这门学科被正式确定下来:

“混沌工程是一门在分布式系统上进行实验的学科，目的是建立对系统承受生产中动荡条件能力的信心。”

这个定义确定了它是一种实验形式，与测试是分开的。它还提到了“生产中的动荡条件”，以强调这不是为了制造混乱。混沌工程就是让系统中固有的混沌变得可见。做混沌工程的意义在于建立信心。

这些原则接着描述了一个实验的基本模板，它大量借用了卡尔·波普尔的可证伪性原则。在这点上，混沌工程更像是一门科学而非技术。

## 什么是混沌工程

原则定义了学科，这样我们就知道什么时候在做混沌工程，怎么做，怎么做好。如今，混沌工程更常见的定义是，“促进实验以发现系统弱点。”

混沌工程实验的步骤如下:

1.  首先，将“稳定状态”定义为系统的一些可测量的输出，表示正常的行为。
2.  假设这种稳定状态将在对照组和实验组中持续。
3.  引入反映真实世界事件的变量，如服务器崩溃、硬盘故障、网络连接中断等。
4.  通过在对照组和实验组之间寻找稳定状态的差异来试图推翻假设。

通过设计，在如何实现这些实验方面有很大的自由度。

## 实验与测试

严格来说，测试不会创造新知识。测试要求编写测试的工程师事先了解他们正在寻找的系统的特定属性。复杂系统对于这种类型的分析是不透明的——人类根本无法理解复杂系统中各部分的所有潜在相互作用的所有潜在副作用。这就引出了测试的一个关键特性。

测试基于现有的知识做出一个断言，然后运行测试将该断言的效价压缩，通常分为真或假。测试是关于系统已知属性的陈述。

另一方面，实验创造新知识。实验提出了一个假设，只要这个假设没有被证明是错误的，这个假设的可信度就会增加。如果它被证明是错误的，那么我们会学到新的东西。这引发了一项调查，以找出为什么我们的假设是错误的。在一个复杂的系统中，事情发生的原因往往并不明显。实验要么建立信心，要么教会我们自己系统的新特性。这是对未知的探索。

实践中再多的测试也无法与从实验中获得的洞察力相提并论，因为测试需要人提前提出断言。实验正式引入了一种发现新性质的方法。在新发现的系统属性被发现后，完全有可能将其转化为测试。它也有助于将关于一个系统的新假设编码成新的假设，这创造了类似于“回归实验”的东西，探索系统随时间的变化。因为混沌工程是从复杂的系统问题中诞生的，所以这一学科更倾向于实验而不是测试是至关重要的。

## 验证与确认

使用操作管理和后勤计划启发的验证和确认的定义，我们可以说混沌工程强烈偏向于前者。

### 确认

复杂系统的验证是在系统边界分析输出的过程。房主可以在不了解管道或市政供水服务(系统部件)如何工作的情况下，通过测试污染物来验证来自水槽水龙头(系统边界)的水(输出)的质量。

### 确认

复杂系统的验证是一个分析系统各部分并建立反映这些部分相互作用的心理模型的过程。房主可以通过检查所有的管道和基础设施(系统部件)来验证水的质量，这些管道和基础设施(系统部件)涉及捕获、清洁和将水(功能部件的心理模型)输送到住宅区，并最终输送到有问题的房子。

这两种实践都是潜在有用的，并且都建立了对系统输出的信心。作为软件工程师，我们经常有一种冲动去钻研代码，并验证它反映了我们对它应该如何工作的心理模型。与这种偏好相反，混沌工程强烈偏好验证而非确认。混沌工程关心的是某样东西是否工作，而不是 T2 如何工作。

请注意，在管道比喻中，我们可以验证供应清洁饮用水的所有组件，但最终仍会因为一些我们没有预料到的原因而导致水被污染。在一个复杂的系统中，总是有不可预测的相互作用。但是如果我们证实水龙头里的水是干净的，那么我们就不必关心它是如何变成那样的。在大多数商业案例中，系统的输出比实现是否符合我们的心智模型要重要得多。混沌工程更关心业务案例和输出，而不是交互部分的实现或心智模型。

## 混沌工程不是什么

有两个概念经常与混沌工程混淆，即生产中的破东西和抗脆性。

### 打破东西

偶尔，在博客帖子或会议演示中，我们听到混沌工程被描述为“打破生产中的东西”虽然这听起来很酷，但它对大规模运行的企业和其他能够从实践中受益最多的复杂系统运营商没有吸引力。

更好的描述应该是“在生产中修理东西”打碎东西很容易；困难在于减小爆炸半径，批判性地考虑安全性，确定某件事情是否值得修理，决定你是否应该投资进行试验——还有很多。

打破东西可以有无数种方式，只需要投入很少的时间。这里更大的问题是，当我们甚至不知道它们已经坏了的时候，我们如何对它们进行推理？

“在生产中修复东西”在捕捉混沌工程的价值方面做得更好，因为整个实践的要点是主动提高复杂系统的可用性和安全性。混沌工程是软件领域中唯一一个专注于主动提高复杂系统安全性的主要学科。

### 抗脆性

熟悉纳西姆·塔勒布引入的[抗脆弱性概念的人，往往认为混沌工程本质上是同一事物的软件版本。塔勒布认为，像“兴奋效应”这样的词不足以捕捉复杂系统的适应能力，因此他发明了“抗脆弱”一词，指的是暴露于随机压力时变得更强的系统。](https://www.amazon.com/Antifragile-Things-That-Disorder-Incerto/dp/0812979680)

混沌工程和反脆弱性之间的一个重要的关键区别是，混沌工程教育人类操作员关于系统中固有的混沌，以便他们可以成为一个更有弹性的团队。相反，反脆弱性给系统增加了混乱，希望它在回应中变得更强大，而不是屈服于它。

作为一个框架，反脆弱性提出了与弹性工程、人为因素和安全系统研究的学术不一致的指导。例如，《反脆弱性》提出，提高系统稳健性的第一步是寻找弱点并消除它们。这个提议看起来很直观，但是弹性工程告诉我们，寻找安全上正确的事情比调查错误的事情更能提供信息。

抗脆弱的下一步是增加冗余。这似乎也很直观，但增加冗余可能会像减轻故障一样容易导致故障，弹性工程文献中充斥着冗余实际上导致安全故障的例子。也许最著名的例子是 1986 年的挑战者号灾难。O 型圈的冗余是美国宇航局批准继续发射的三个原因之一，尽管在五年的时间里，主要 O 型圈的损坏在内部已经是众所周知的了。

这两种思想流派之间存在分歧的例子还有很多。弹性工程是一个正在进行的研究领域，有几十年的支持，而反脆弱性是一个理论，主要存在于学术界和同行审查之外。很容易想象这两个概念是如何融合在一起的，因为两者都处理混沌和复杂系统，但反脆弱性的精神并不分享混沌工程的经验主义和基本基础。基于这些原因，我们应该认为它们是不同的追求。

将最初的四个原则步骤应用于大规模系统实验的真实世界经验与额外的深思熟虑的内省相结合，使网飞大学的混沌工程团队将实践推进到了实验之外。这些见解成为了“高级原则”，指导团队完成他们的混沌工程项目的成熟，并帮助我们建立一个我们可以追求的黄金标准——我们将在后续的帖子中讨论这些。