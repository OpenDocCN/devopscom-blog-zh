# 为规模化设计工程团队

> 原文:[https://devops.com/designing-engineering-teams-for-scale/](https://devops.com/designing-engineering-teams-for-scale/)

作为一名高级工程经理，我带领许多公司从几名工程师到全球规模的整个团队实现了超高速增长，在这个过程中，我学到了很多应对各方面增长和规模的经验。我把我的想法写下来，以帮助在代码、系统架构等方面有深厚知识的高级技术人员，他们希望了解如何将他们的职业生涯提升到一个新的水平。我希望这将提供一些关于如何设计你的系统和你的团队来支持业务规模的见解。这篇博文基于我在 2018 年特拉维夫 DevOpsDays 的主题演讲。

## 当你听到“音阶”时，你会想到什么？

让我们从“规模”的含义开始。当定义规模时，大多数技术专家可能首先想到的是额外的流量或用户。首先想到的可能是分布式系统、事件流量、更多的客户端使用同一个系统等等。这种规模是众所周知的，您可以找到许多关于这一主题的精彩帖子和演讲，并从许多经历过系统规模调整过程的公司那里学习。

但是还有其他类型的规模。作为一名高级工程师，以下是你如何学会识别哪一个是相关的，以及你如何帮助你的公司解决这个问题。

**扩展挑战多种多样，如果我必须将它们分为三个主要类别，那就是三个“T:**

1.  交通
2.  组
3.  领土

让我们深入探讨一下，看看每种技术的特点是什么，从技术角度来看有哪些独特的挑战，以及作为领先的技术专家，您可以如何提供帮助。然而，更重要的是，如何避免与扩展相关的错误，就像我多年来所犯的和学到的那样。

## 扩展挑战 1:流量

我们将从最常见的扩展挑战开始:流量规模。

这个可能是最容易识别的。当您看到越来越多的事件进入系统，越来越多的并发用户和注册客户数量，以及其他迹象时，您将开始感受到成长的烦恼。

这将开始带来一些技术挑战；例如，服务将无法提供，数据库性能将会下降，AWS 弹性负载平衡服务的响应呈指数级增长(有时是 50 倍),等等。

围绕流量规模对您的问题进行分类时，最重要的事情是记住，当务之急是准备好支持更多流量，以便用户仍然能够得到服务，即使有更多的用户，所以专注于与维持正常运行时间相关的任何事情。这意味着您必须准备好为峰值负载扩展 web 服务和所有其他实时功能。为此，自动伸缩以及弹性实时数据库是强制性的。另一方面，如果需要，脱机流程可以延迟，并在流量负载减少时异步赶上。

虽然我讨厌这么说，但我们总是需要认识到技术债务，并确保我们正在弥合这些赤字，代码质量和重构在加载时可以占据较低的优先级，因为你可能会发现自己从头开始重写服务，而你可能需要完全不同的服务架构。

团队呢？

随着流量的增长，通常需要增加更多的团队成员，因此足够数量的团队成员可以专注于扩展基础架构，而您仍然有足够的注意力来制定业务路线图。这是思考“DevOps”和创建开发工具的正确时间，这样工作可以更有效率，你可能能够用更少的人完成更多的工作。

你还需要更多的钱来购买基础设施服务，你需要为此做好准备。扩展需要资金，流量扩展会自动转化为您的数据中心或云提供商的月度发票。这可能意味着你也必须开始考虑使用节省成本的服务和优化你的使用。

## 扩展挑战 2:团队

第二种规模伴随着人力资本的成长之痛:团队规模。

虽然这似乎是显而易见的，但在许多情况下，公司往往会忽略不断增长的团队对系统本身的影响。

当你的团队需要在一年内翻倍时，招聘就成了一个规模问题。即使从 5 人增加到 10 人也是显著的增长。许多领先的技术专家倾向于忽略这种类型的规模，并将其视为一个管理问题。这不是真的；如果你认为自己是 R&D 领导层的一员，你应该在这一过程中扮演重要角色。

这种增长面临以下几个技术挑战:

1.  团队可能会引入额外的功能。例如:我倾向于雇用更多的多面手作为第一团队成员，当团队壮大时，会有更多的专家加入。此外，QA 工程师可能只有在已经有一个完整的开发团队后才会被雇佣，他们可能需要不同的工具。
2.  在许多情况下，手动过程不能随着团队的成长而扩展。例如，过去在生产数据库中手动完成的事情，在只有您一个人时可能没问题，但现在有四个人与您一起工作时，应该实现自动化。
3.  在某些情况下，系统架构应该被改变以使更多的人能够有效地工作。这是一个大问题:你的系统架构对于一个小规模的团队来说工作得很好，但是现在将会有更多的人在同一个代码基础上工作，管理起来变得更加复杂。一些公司采取的方法是让每个人都有相同的代码库，并通过使用代码审查、测试等等来强制工程质量。一些团队决定将一个服务拆分成单独的服务，因此每个团队将负责一个子服务。我更喜欢拆分服务，因为这使得团队所有权更加明确。
4.  知识共享和最佳实践应该正式化。根据我的经验，投资非常好的首次培训是有回报的。我通常使用的形式是在职培训，使用团队中一个专门的伙伴来指导新的团队成员完成编码任务，增加了自主性。这种方法使得能够在与业务相关的会话中从内部学习系统，包括自学相关技术的技术材料。避免过于复杂的最佳实践，腾出时间用脚本或精心编写的说明来代替它们。

最重要的是新人要有生产力。至关重要的是，每个新团队成员都可以像以前一样编写代码、测试和部署代码。雇佣效率较低的新人是没有意义的。

这是投资于良好的自动测试机制和良好的自动构建和部署的正确时机。

你最了解你的公司，在某些情况下，团队规模是流量规模的结果。如果不是这种情况，那么此时您可能需要将流量缩放放在一边。

你必须非常小心团队的成长。在某些情况下，您可以使用外部服务或自动化来减少团队增长。例如，你可以考虑使用托管解决方案，而不是雇佣更多的 DevOps 工程师。它的成本可能比非托管解决方案略高，但它可能会节省您宝贵的维护时间。

## 扩展挑战 3:新领域

第三个挑战是领土。随着一家公司寻求从其主要地理区域扩展到其他区域，新的挑战不仅出现在销售和组织结构上，还出现在技术上。让我们以一个组织为例，该组织目前正在为美国的客户提供服务，并正在向欧盟扩展:

1.  GDPR:在美国，加利福尼亚州和纽约州率先制定了类似 GDPR 的法律，而欧盟国家已经实施了隐私法。
2.  **语言和文化**:欧盟有不同的语言，这可能会影响你的产品。
3.  在受监管的环境中，如 FinTech 和 HealthTech，产品从美国转移到欧盟时可能会有所不同。

当您开始谈论数据保护和其他法规考虑事项时，很容易理解您是否面临销售和客户支持之外的领域挑战。技术挑战因公司而异，取决于您的业务领域:

1.  **生产环境的位置。**这在很大程度上是一个性能问题，当您的系统对性能高度敏感时，这种情况可能仍然存在。在大多数其他情况下，在向新地区扩张时，还需要考虑其他因素来决定是否需要额外的数据中心以及在哪里需要额外的数据中心。这可能是法规和客户特定需求的结果。在这种情况下，您需要指定为企业增加一个数据中心的成本。这不仅仅是额外的资金，而且还有可能更加困难的复杂性和产品需求，例如让同一用户同时处于两个不同的环境中，同时保持一切同步。在大多数情况下，法律团队可以找到合理的解决方案，只保留一个数据中心，这将使您的生活更加轻松。进行这样的讨论是很重要的，而作为一名领先的技术专家，你有责任领导这场讨论。
2.  **数据考虑。**不同的国家对数据隐私和数据保护有不同的规定。如果你同意商业人士为每个人保持最严格的规则，这可能是最容易的。

最重要的是，你要明白什么是真正的强制性，从法律和监管机构的角度来看，什么是更“值得拥有”的。

如果你还不支持 [i18n](https://en.wikipedia.org/wiki/Internationalization_and_localization) ，现在是时候了。如果额外的生产环境不是绝对必需的，尽量避免使用它们。

下面是我分解它的方式，尝试分析如何将技术用于不同类型的缩放。

这里有几个问题可以帮助你了解如何识别你公司的独特情况。

你应该先问自己，“这是暂时的，还是会一直存在下去？”

如果你对大多数问题的答案是 ***是*** ，那么你就在谈论扩展挑战。

既然我们已经理解了我们有一个缩放问题，那么让我们来理解缩放的类型。回到 3t，问问你自己:

*   是流量吗？
*   团队？
*   领地？
*   或者是几种类型的组合？

## 无法缩放

这些年来，我也经历了一些变化。在一家成长中的公司工作并参与扩展过程非常有趣。然而，在某些情况下，后见之明是 20/20 来理解你可能没有完美地处理它。这种情况在我身上发生过不止一次，我为自己的错误感到自豪，因为它们给了我学习和成长的机会。

我来分享几个:

1.  像许多公司一样， [LivePerson](https://www.liveperson.com/) 是从一个庞然大物开始的。这是一个基于 Java 的 web 应用程序，处理所有的访客流量，以及聊天、操作员等等。2012 年左右，随着团队的成长，经历质量挑战；我们收集了所有的单元测试和一些额外的集成测试，并决定它应该作为构建的一部分运行。构建过程将编译 Java 代码，执行额外的步骤，并在宣布成功或失败之前运行整个测试套件。这是一个很棒的想法，它让我们不仅看到了代码编译顺利，还看到了测试正在运行，没有任何问题。唯一破坏派对的是，整个过程花了 30 分钟。)分钟。这意味着我们不再需要等待 10 分钟来编译，而是在每次测试环境中部署一个 bug 修复时再增加 20 分钟。这是一个伟大的想法，但它增加了更多的时间“已经太长”的建设过程。
2.  在 [AppsFlyer](https://www.appsflyer.com/) ，我们从第一天起就有一个实时报告系统。这是最重要的商业产品之一，营销人员会购买这项服务来分析他们的活动。这个系统是在该公司只有几个小客户的时候建立的，并且是基于 MongoDB 的，通过增加计数器来实现次优解决方案。随着公司拥有越来越多的客户，尤其是更大的客户，系统无法很好地应对流量，我们每隔几周就会经历一次中断。我们增加了更多的计算能力，拆分了集群等等。这给了我们几个月的时间，直到有一天我们的两个最大的客户无法获取整个星期的数据。)，只能看到今天的数据。那一刻，我明白我犯了一个错误，我们必须及时培养下一代。
3.  这是我在家里犯的一个错误……去年连续下了三天雨后，我的天花板塌了。我的屋顶在许多冬天都很稳定，但它变得越来越旧，最终无法跟上不停的雨。周六凌晨 3 点，我们发现自己把碗放在天花板下，清理地板上的雨水。事实证明，你也可以在家里遇到生产问题。

## 非常诚实！

现在是对自己诚实的时候了！

你是否发现自己在说“我们不能完成这个任务”这样的话？“我们的基础设施无法支持新的挑战”？发展成为一名领先的技术专家，你应该能够用业务术语交流复杂性，并提出替代方案和折衷方案。

这是一篇全新文章的主题，但重要的是与业务展开正确的讨论，并用非技术人员能够理解的语言表达技术需求。说“当前系统不支持额外的支付方式，我们需要花时间在去欧盟之前重构它”，或者“我们看到更多的客户计划在未来几个月内使用该产品，所以我们需要花时间来增强架构，或许更换数据库技术以支持 10 倍规模”，比只说“这很难”要好

对企业来说，在做出任何决策之前理解复杂性和权衡是至关重要的，它使您能够影响决策。它还为你提供了内部信息，告诉你在公司的任何情况下，什么样的取舍是可以接受的，什么样的取舍是不能牺牲的。你需要非常小心，把阻碍公司发展的技术变革摆在桌面上。那些非常酷但对扩展并不重要的应该等等。

## 计划和执行

一旦我们确定了这是否是长期规模和规模类型，并绘制了差距图，现在就该制定计划并执行它了。

我不会说这是一件容易的事，但是你要从小步开始。一如既往，技术是企业发展的推动者，您的计划应该反映这一点。它应该包含所有的除垢剂，并且只包含它们。这意味着，在某些情况下，您必须将行业最佳实践放在一边，留待以后某个阶段使用，并坚持使用对您仍然有效的东西。例如，如果你的公司不是你的关键尺度点，那么你的公司开始的那块石头可能仍然有效。分裂它可以被推到一个时间点，当它成为关键的规模杀手。

没有魔法，只有不断的努力。

最后，确保你不要一次做太多的改变，因为总会有计划之外的事情发生。此外，不要忘记简单但改变生活的事情，如自动化和自动扩展，与其他经历过相同扩展的高级工程师交谈，从他们的错误中学习，并为小迭代做计划。

在一家快速发展的公司工作非常有趣。你可能正面临着不同的技术扩展挑战，这些挑战提供了成长和学习的机会，并带来了一些刺激。我希望这篇文章不仅能帮助你理解如何帮助你的公司，还能帮助你拓展职业生涯。