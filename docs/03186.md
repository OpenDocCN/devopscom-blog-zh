# 监控:满足视频点播的需求

> 原文:[https://devo PS . com/monitoring-meeting-the-demands-of-video-on-demand/](https://devops.com/monitoring-meeting-the-demands-of-video-on-demand/)

***强大的监控工具链如何帮助提高性能***

由于多种因素，数字服务提供商(DSP)的视频点播(VoD)生态系统面临巨大压力，包括发布的视频内容数量的成倍增长，设备数量的增加(手机、平板电脑、笔记本电脑、智能电视等)。)具有高清观看选项，并且不断需要改善客户体验。越来越多的 DSP 正在采用视频点播(VoD)服务的微服务架构，以提高此类大型复杂应用的可扩展性、弹性和连续交付/部署。

## **基于微服务的应用的复杂性**

DSP 选择微服务来获得好处。然而，监控微服务是非常具有挑战性的，因为被分解成松散耦合的服务(微服务)的集合的单个应用在非常动态的环境中的多个主机上运行，并且需要与本质上不同且动态的多个系统进行交互。

实施正确的工具链对于基于微服务的应用的有效性能监控至关重要。本文主要讨论如何构建一个强大的工具链来监控基于微服务的视频点播应用。

# **建立有效监控的工具链**

## **确定要监控的关键区域**

构建最佳工具链的第一步是确定要监控的关键区域。为了确保应用程序功能得到交付和优化，需要监控以下方面。

*   从请求到响应所用的时间
*   每个接触点的延时
*   每个接触点的请求成功率/失败率
*   按类别/流派/内容分类的请求成功率/失败率
*   按请求/类别/类型划分的忙/闲时间
*   按用户/内容/类别/流派分析请求趋势

由于 VoD 应用程序运行在分布于多个主机的微服务上，因此无法通过单一工具进行监控。因此，有必要构建一个工具链来有效地监控应用程序的性能。

## **视频点播应用监控涉及的关键活动**

VoD 应用程序具有分布式接触点，需要一系列活动来捕获 KPI，如成功/失败率、时间推移等。

*   从运行 VoD 应用程序的不同容器中抓取并发送日志文件。
*   根据流程(VoD 体系结构、应用程序 ID)对日志文件进行分类和处理，这些日志文件包含各种接触点的请求/响应类型、成功/失败以及请求/响应时间，以便为监控 KPI 获取有意义的值。
*   将排序后的日志文件存储在外部数据库中，以供进一步分析，如趋势分析、请求失败的类型、按时间划分的成功/失败比率等。
*   使用仪表板可视化和监控 KPI。

## **有效支持监控活动所需的工具**

![](../Images/5f2648f689d0f04dd4012195040dd37e.png)

*   **Log scraper:**抓取包含请求/响应类型、时间戳等的微服务日志文件。来自不同的宿主。
*   **日志发送器:**整理由刮刀从单个容器中收集的应用程序日志，并将其发送到外部存储系统。
*   **日志聚合器**:对来自一个应用下多个容器的微服务日志进行整合和排序，以分析性能指标。聚合器有助于识别请求/响应停滞或失败的接触点。
*   **消息队列:**当大量数据被写入数据库时，或者当网络出现问题和数据库不可用时，有助于减轻主机级磁盘空间的压力。
*   **数据库/存储:**外部集中式存储系统，可更好地访问已处理的日志文件，以进行根本原因分析、趋势分析等。
*   **性能监控仪表板:**基于规则的仪表板视图，显示来自已处理日志文件的性能 KPI 报告，并在出现异常时发送通知。

## **有效监控视频点播应用的推荐工具链**

*   **原木刮削器:** Beats 是一种轻量级代理，用于频繁刮削原木。然而，对于 VoD 应用程序监控，建议使用 Logstash，因为它提供了各种插件来转换日志数据，从而有助于有效地监控 VoD 应用程序。
*   **Log Shipper:** Fluentd 适用于边缘级别的监控。但是，对于 VoD 应用程序监控，推荐使用 Flume，因为它在日志文件需要排队、聚合、处理和存储在外部存储时效果更好。
*   **日志聚合器:** Storm 是一个分布式实时计算系统。但是，对于 VoD 应用程序监控，建议使用 Spark，因为它是一个快速的通用引擎，适用于大规模数据处理应用程序。
*   **Queuer:** Kafka 将大量的 VoD 日志文件进行排队，避免给数据库带来不必要的压力。

## **视频点播领域监控工具链的优势**

*   借助有效的应用程序日志和服务流监控，DSP 可以提高服务质量(QoS)。
*   使用本文中讨论的推荐工具链，DSP 可以减少高达 20%的监控开销/成本。
*   从监控中收集的数据可以帮助 DSP 进行趋势分析(用户偏好、热门内容、忙/闲时段等)。).
*   有了微服务监控，DSP 管理和改善客户体验和资源利用率变得更加容易。

*本文是与技术建筑师、产品设计师 [](http://www.prodapt.com/insights/) Praveen Chakravarthy 合著的。*

— [维斯瓦·尼甘](https://devops.com/author/vishwa-nigam/)