# 分手与和好:可组合的库伯内特持久存储

> 原文:[https://devo PS . com/breaking-up-composable-persistent-storage-for-kubernetes/](https://devops.com/breaking-up-and-making-up-composable-persistent-storage-for-kubernetes/)

Kubernetes 正迅速成为数据中心应用管理的标准。Kubernetes 将应用程序定义在一个容器模型中进行部署，并以更低的成本和更少的性能下降交付虚拟化基础架构的大多数软件即服务功能。在本文中，我们将讨论 Kubernetes 和横向扩展数据密集型应用程序的交集，Kubernetes 为这些应用程序解决了什么问题，以及为什么可组合基础架构提供了整体解决方案的剩余部分。

对于重型数据密集型应用，如 Spark、Kafka、Aerospike、Vertica、Cassandra 和 Elasticsearch，使用 [TensorFlow](https://www.tensorflow.org/) 的 ML-model 培训/服务，Kubernetes 承诺提供通用的应用编排解决方案。这些应用程序被称为横向扩展，因为它们只需添加更多节点，就可以提供额外的性能和容量来满足任何使用情形。这些应用程序带来的挑战是管理每个应用程序的大型生产部署，而管理每个都有自己的配置要求的多个应用程序更是雪上加霜。Kubernetes 在这里提供了一个解决方案，通过一个通用的容器编排平台来管理这些不同的数据密集型横向扩展应用程序。

横向扩展应用程序在三个方面不同于典型的企业应用程序。首先，横向扩展应用程序采用分而治之的方法来解决问题:如果您有更大的问题，只需通过添加节点来部署额外的容量和性能。其次，由于性能和数据容量只是通过添加构建块来提高，因此您可以利用廉价的现成商品(COTS)节点，避免传统纵向扩展应用程序所需的大型硬件采购中的资金陷阱。第三，数据密集型应用程序通常会在应用程序本身中集成一个优化的存储堆栈，从而有效地使用 COTS 节点中可用的廉价本地存储。最后一点已经成为横向扩展应用程序部署的一个问题领域，因为过度配置现在很常见，以克服在初始部署时预测工作负载行为的困难。

可组合基础设施解决了嵌入式本地存储为数据密集型应用程序带来的最后一个问题。回顾数据中心的各种转型，传统企业存储供应商做对的一件事是分离计算和存储。无论是在采购期间还是在整个应用生命周期中，将持久存储组件与运行实际应用的计算节点分开，都有助于提高成本效率和灵活性。

可组合的基础设施为这些横向扩展应用程序带来了将计算与存储分离的能力，这些应用程序拥有自己的嵌入式优化存储软件堆栈，因为它没有规定新的存储架构，而是简单地说“将您现有的服务器与嵌入式本地存储分离开来”，将存储放在您已经为应用程序部署的无处不在的高速低延迟结构上:以太网。从应用程序的角度来看，在一个可组合的基础设施中，存储仍然是本地的，应用程序像以前一样运行。

通过这种方式，应用程序可以不变地运行，并且运行它们的基础架构可以实时扩展、缩减或替换。这是真正的软件定义的基础架构，其中基础架构被视为代码。能够动态修改计算和存储的节点配置比率避免了购买时锁定可能调配不足的节点的问题(这只会导致过度调配)。可组合的基础设施消除了购买静态资源的缺点，这些静态资源在工作负载运行之前定义了可用的资源。

![](../Images/aa389ec5be79dd9e9f7c587b2d423a78.png)

2015 年不久前推出的 Kubernetes。许多 Kubernetes 的早期采用者专注于不依赖持久存储来交付有用服务的无状态应用程序。直到最近才出现对持久存储的支持(这是数据密集型应用程序的一个明显需求)。在采用了几种持久性存储集成方法之后，Kubernetes(和其他容器编排平台)中的主要参与者决定采用一种与编排无关的持久性存储 API，即容器存储接口(CSI)。CSI 为存储提供者——以及可组合的基础设施提供者——提供了一种标准方法来定义持久存储并将其附加到[容器](https://devops.com/the-role-of-containers-in-business-transformation/)上。

在考虑如何在 Kubernetes 上部署数据密集型应用程序时，为什么要对可组合基础设施感兴趣？因为 Kubernetes 只提供应用程序和容器编排——它并没有从根本上改变应用程序的工作方式。这些数据密集型应用程序被定义为利用 COTS 节点和商用存储，并在 COTS 节点和商用存储上得到最有效的部署。每个应用程序仍有自己的存储堆栈，每个都针对其特定的工作负载进行了精心优化。在数据密集型应用下部署存储设备或聚合硬盘或固态硬盘池的软件定义存储解决方案，很可能只会导致性能下降和不必要的成本。

一个可组合的基础设施解决方案只有在满足几个需求的情况下，才能作为 Kubernetes 部署的底层。

首先，可组合的基础设施必须扩展到 100，000 个设备，以支持部署在平台之上的应用程序。

第二，可组合的基础设施平台不能破坏或削弱 Kubernetes 的功能，并根据商品网络进行相应的扩展。可组合的基础设施解决方案必须与 Kubernetes 共享类似的设计理念，从而允许它扩展。Kubernetes 实现了一个分布式的期望状态模型，在这个模型中，工作分布在大多数自治节点中，以达到期望的部署配置。这种方法提供了超大规模所需的规模。您必须确保您选择的可组合基础设施解决方案提供类似的可伸缩方法。

第三，Kubernetes 强调一种配置状态，这种状态在任何单个节点故障或网络分区面前都是持久的。面对大型、高度互连的商用组件部署，持久的配置状态对于业务关键型应用程序规模的正确自动操作至关重要，您的可组合基础架构解决方案也必须支持这一点。

第四，Kubernetes 根据称为 pod 的容器组定义了应用程序部署模型。对于可管理的持久存储解决方案，对 CSI 和 Kubernetes 的支持必须提供存储绑定的本机 Pod 视图，因为 Pod(容器的托管集)是应用程序节点实例的代理，也是扩展和迁移的单元。

Kubernetes 通过提供一个轻量级的、功能丰富的应用软件编排平台，开启了数据中心架构的激动人心的新篇章。可以将 Kubernetes 视为理想的软件应用程序编排平台。缺少的是支持 Kubernetes 定义的应用程序编排动态模型的可伸缩硬件编排解决方案。一个功能丰富、集成良好的可组合基础设施平台提供了所需的硬件编排，以实现 Kubernetes 解决方案承诺的应用程序迁移和弹性。

——[布莱恩·鲍洛夫斯基](https://devops.com/author/brian-pawlowski/)