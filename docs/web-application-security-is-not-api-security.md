# Web 应用程序安全性不是 API 安全性

> 原文：<https://devops.com/web-application-security-is-not-api-security/>

您是否遵循与保护 API 相同的程序来保护 web 应用程序？两者有区别吗？

在过去的几个月里，我们一直在谈论 API 安全性，因为我们相信 API 安全性和传统的 web 应用程序安全性之间存在着重要的差异。对这些差异缺乏了解是危险的。

让我们看看这两者之间的区别，以及为什么应该将 API 安全性与一般的应用程序安全性区别对待。

## 什么是 API 安全性？

API 安全是保护 web APIs 免受攻击的实践。构建 API，通常以微服务为基础，已经成为一种发展趋势。许多移动应用程序和网站使用 API 发送和检索数据，即使最终用户并不知道这一事实。

API 不同于传统的 web 应用程序，这些差异会导致严重的安全问题。

## 是什么让 API 不同于传统的 Web 应用？

我将用一张图来回答这个问题，然后继续“放下麦克风”

![](img/6768060dba7dd439f735a58404ad5c1a.png)

*Here’s the entire Netflix architecture, comprised of about 700+ microservices. *([Source](https://medium.com/refraction-tech-everything/how-netflix-works-the-hugely-simplified-complex-stuff-that-happens-every-time-you-hit-play-3a40c9be254b))

(拿起话筒。)

上图说明了为什么 API 和传统的 web 应用有本质的区别。曾经的*一个* 请求到*一个* 服务器已经变成了*几十个* 或者*几百个* 请求到*几十个* 或者*几百个* 的微服务。

以前，工作相对轻松；维护一个大型应用程序。现在，您必须保护数百个小型 web 应用程序及其访问的数据。身份验证和授权看起来不一样。您最喜欢的框架的内置会话管理已经过时了。每个微服务都是自己的小王国。

此外，您现在必须知道所有这些 API 端点驻留在哪里，它们运行什么版本，以及当需求增加时如何扩展它们。

最后，开发和部署环境的变化会导致恶意行为者攻击应用程序的方式发生变化。你熟悉攻击者攻击 API 的新方法吗？

## API 面临的最大威胁是什么？

OWASP API Top 10 项目概述了 API 的 10 个危险风险。(分解见本[帖](https://owasp.org/www-project-api-security/)。)

相反，让我们看看 API Top 10 带来的重大主题。然后我们将讨论一些具体的违规行为，说明当 API 易受攻击时会发生什么。

### 认证和授权赢得大奖

好吧，也许“最有可能让你被黑”不算什么奖励，但是认证和授权是最常见和最危险的 API 安全缺陷。

对于许多开发人员来说，API 中的身份验证和授权就像是一个新世界。开发框架不管理会话，相反，应用程序传递带有声明的 JSON Web 令牌(JWT)。简而言之，每个微服务在代表它们执行任何工作之前，都必须验证调用者的身份和权限。

随着 API 数量的增长，开发人员更有可能会错过一些授权检查，并且数据漏洞会在您最意想不到的时候突然出现。

### API 端点无处不在

记得春假的时候带着两岁的女儿去了迪士尼的魔法王国。我不得不给她套上一条儿童皮带，以确保她不会消失在人群中。在这么大一群人中，只跟踪一个孩子是很有挑战性的。

微服务的爆炸式增长让你的基础设施充满了一大群端点，而儿童束缚似乎不太适合 Docker 容器。API 很容易消失。

不幸的是，这些“影子 API”，无论是开发人员出于测试目的编造出来的，还是被遗忘的旧版本，都可能成为攻击点。它们可能不安全，如果您不知道它们仍然公开暴露，有人可能会在您不知情的情况下攻击它。

## 真实的 API 漏洞示例

让我们通过查看真实的漏洞来说明 API 和 web 应用程序安全性之间的差异。

### Shopify“合作者”漏洞

安全研究员 Uzsunny 发现了 Shopify“合作者”功能中的一个关键缺陷，该缺陷允许攻击者在任何商店上为自己分配“合作者”角色。此功能可以解锁各种管理功能。

原来，处理这个协作者业务逻辑的 API 端点并没有验证将协作者添加到商店的请求是否来自商店经理。因此，任何人都可以使用正确的参数调用该端点，并获得对 Shopify 平台上任何商店的管理权限。

[*查看我们关于这个漏洞如何工作以及为什么它很难被检测到的详细帖子*](https://www.traceable.ai/blog-post/the-shopify-breach-why-authorization-exploits-slip-through-most-security-defenses) *。*

### 使用影子 API 绕过脸书身份验证

晦涩难懂并不安全，坚定的攻击者会找到被遗忘的 API 主机。AppSecure 网络安全研究团队发现了一种方法，可以通过脸书忘记存在的几个 API 端点来访问任何脸书账户。AppSecure 团队获得了 1.5 万美元的 bug 奖金。

虽然是在 2016 年发现的，但这个 bug 说明了 API 架构中普遍存在的一种漏洞。这个 bug 很微妙，但是演示了最小的漏洞如何让攻击者横行无忌。

该漏洞存在于脸书的密码恢复逻辑。当用户因为忘记密码而请求恢复帐户时，他们会通过短信收到一个随机的六位数代码。他们在浏览器中输入代码，浏览器发送带有代码的 API 调用。

脸书在端点上设置了速率限制，以防止暴力攻击。API 在 10 次失败尝试后阻止了客户端请求。然而，API 端点存在于其他主机上，脸书的工程师没有意识到这一点。攻击者可以将有效载荷发送到“beta.facebook.com”和“mbasic.beta.facebook.com ”,并暴力破解恢复代码。这些端点没有十次尝试的限制。

查看我们关于此漏洞的详细帖子，了解现代应用程序 sec 工具如何可能会遗漏此漏洞。

### 优步 API BOLA 漏洞

在 API 十大列表中，不完整的对象级授权(BOLA)排名第一。优步的 API 有这个漏洞。值得庆幸的是，在恶意行为者造成损害之前，它被安全研究人员发现了(据我们所知)。但这很好地说明了 BOLA 有多危险。

该漏洞泄漏了敏感信息，包括可用于执行完全帐户接管的身份验证令牌。

当新的驱动程序加入优步平台时，该漏洞就会出现。浏览器将“userUuid”发送到 API 端点，API 返回用于填充客户端的驱动程序的相关数据。

不幸的是，API 端点没有检查调用客户端是否有权查看其返回的详细信息。攻击者可以添加另一个“userUuid”并获得一个相当大的 JSON 对象，其中包含其他用户的帐户详细信息，包括名字和姓氏、电子邮件地址和用户标识符。

这个漏洞说明了泄露太多信息对于任何 API 都是危险的(过度的数据暴露是前 10 名中的第三名)。此外，不充分的授权检查可能导致不费吹灰之力就接管帐户。

查看我们的详细帖子，了解关于此漏洞的更多信息。

## API 安全性的未来

诸如 Web 应用程序防火墙、下一代 Web 应用程序防火墙和运行时应用程序自我保护之类的应用程序安全技术通常不会发现我们已经讨论过的漏洞。这些攻击表现为普通流量，因此许多防御措施让它们通过。

API 安全性的未来取决于业务逻辑。应用程序安全工具必须了解应用程序的上下文和业务逻辑，以了解非管理人员不应该向商店添加合作者，或者客户不应该访问该用户 ID 的信息。

Traceable AI 使用机器学习来学习应用程序的业务逻辑，因此这些类型的攻击会被发现并阻止。[看看 Traceable AI 在行动](https://www.traceable.ai/view-traceable-demo?utm_source=traceable&utm_medium=blog&utm_term=&utm_content=&utm_campaign=blog)看看 API 安全的未来是什么样子。