# 持续交付成功的 7 个最佳实践

> 原文:[https://devo PS . com/7-最佳实践-连续交付-成功/](https://devops.com/7-best-practices-continuous-delivery-success/)

[持续交付](http://www.dbmaestro.com/2016/04/whats-the-difference-between-devops-continuous-delivery/)指的是沿着部署管道在短时间内持续的构建-测试-发布周期中开发软件。在部署到生产环境之前，对流程和脚本进行重复测试意味着大多数错误可以在早期发现，并且影响极小。此外，由于每个版本的更改更少，查找和修复此类错误要容易得多——由于非常注重可见性、即时反馈和增量更改，软件发布更快、更频繁，部署问题也更少。

为了实现这一点，公司必须有一个简单且可重复的部署流程。当然，最可靠的是可以进入任何环境的自动化部署管道。

我们已经确定了七个连续交付的最佳实践，它们由一组补充的特定于任务的工具支持，在所谓的“DevOps 工具链”中，以实现端到端的流程自动化，并最大限度地减少人为错误。

### 版本控制一切

本机代码部署过程通常包括内置的安全网，防止进程外、本地生成的工件进入生产环境。开发人员所做的每一个更改都必须记录在源代码控制库中，否则就不会包含在构建过程中。如果开发人员将本地生成的工件复制到测试环境中，那么下一次部署将会覆盖这种进程外的变更。

坚持只有一个真实可靠的来源，为所有开发过程创造了一个稳定的基础。然而，这些过程的强度取决于它们最薄弱的环节。这就是为什么有效持续交付的首要黄金法则是对一切进行版本控制。对代码有效的方法也会保持配置、脚本、数据库、网站 html 甚至文档的完整性。

### 构建一次二进制文件

不是每个组织的构建过程都是相同的或者使用相同的工具，但是一个组织中的每个构建过程必须完全一致。无论构建是部署到自动化测试环境的单个文件，还是具有几个不同的可能部署版本的复杂构建，每个构建版本都应该以完全相同的方式发生，并产生独特的二进制工件。

这种一次性编译消除了由于各种部署环境、第三方库或不同的编译上下文或配置而导致不稳定或不可预测的版本的未跟踪差异的风险。将编译阶段的输出(二进制文件)保存到二进制存储库中，部署流程可以从中检索相关的工件。

### 每次都以相同的方式部署

不一致的部署过程可能成为跨环境的配置偏差的来源，尤其是在连续交付系统中常见的快速发布。结果，宝贵的时间和精力被浪费在识别和解决应用程序在一个环境中工作而在另一个环境中不工作所产生的困难上。

为了在所有环境中实现可靠的流程，必须从头到尾重复相同的步骤。这确保了在较低的环境中使用更频繁的部署(如集成、QA 等)也能获得相同的结果。)，如在更高级的环境中(生产前和生产)，部署更少。

### 烟气试验

冒烟测试部署是一种非常快速的方法，可以确保程序最关键的功能正常工作，并通过基本的诊断。这种非详尽的软件测试(对所有元素，如服务、数据库、消息传递总线、外部服务等。)不能提供与完整测试套件相同的细粒度全面性；但是，它可以频繁而快速地运行，通常只需几分钟(而不是几小时或几天)。这使得非常耗时的基本问题能够更快地得到解决。

反馈回路工作得越快(尤其是使用自动化测试工具，如 [Telerik](http://www.telerik.com/) 、 [QTP](https://www.tutorialspoint.com/qtp/) 、 [TestComplete](https://smartbear.com/product/testcomplete/overview/) )，最终产品的质量就越高，并且越快达到发布就绪状态。

### 部署到类似生产的环境中

每个新的部署(例如，使用 [IBM uDeploy](https://developer.ibm.com/urbancode/products/urbancode-deploy/) 、 [CA Release Automation](http://www.ca.com/us/products/ca-release-automation.html) 、 [XebiaLabs](https://xebialabs.com/) 、 [Automic](http://automic.com/) )都应该在尽可能模拟实际最终生产环境的环境中进行。这包括基础设施、操作系统、数据库、补丁、网络拓扑、防火墙和配置。通过在这种详细的生产前环境中验证软件更改，可以有效地消除不匹配和最后一刻的意外，并且可以随时安全地将应用程序发布到生产环境中。

### 即时传播

根据定义，持续交付必须是一个构建、测试和发布的持续过程。每次签入到源代码管理存储库时，都应该触发编译(如果需要的话)和由构建服务器打包。反过来，这应该自动启动某些预定义的测试，直到软件可以被标记为可发布或者返回到开发。

持续集成工具(例如 [Jenkins / CloudBees](https://www.cloudbees.com/jenkins/about) 、 [Bamboo](https://www.atlassian.com/software/bamboo) 、 [TeamCity](https://www.jetbrains.com/teamcity/specials/teamcity/teamcity.html?gclid=CjwKEAjwtNbABRCsqO7J0_uJxWYSJAAiVo5LVjvwBKZlH5F9sAwy_yNfRJ-y1p8brii7g3yyUClJkBoCF1vw_wcB&gclsrc=aw.ds.ds&dclid=CLid8Lu-gtACFc0T0wodHfUAjQ) )确保交付管道上的级联行动是一致的、自动的和即时的。因此，为了更有效的部署和更新过程，开发团队合并开发的代码，并每天多次从自动化测试工具获得反馈。

### 包括数据库

如果不建议使用确保安全可靠的源代码、任务、配置、构建和部署管理的相同基本协议来管理数据库，那么连续交付最佳实践的列表将是不完整的。然而，很多时候这一点被忽略了，因为数据库不像其他软件组件或编译代码那样容易从开发复制到测试再到生产。然而，数据库实际上是最有价值且不可替代的资产(我们的数据)的存储库，准确地保存数据对于持续交付是必不可少的。

尽管数据库带来了一些独特的挑战，但专用的数据库工具，如强制数据库源代码控制(适用于所有环境)、数据库构建自动化工具以及数据库发布和验证流程，可以确保开发运维链中的稳定资源。

考虑这七个连续交付的最佳实践将允许您创建一个具有更高生产力、更快上市时间、更低风险和更高质量的部署管道。

正如我们所见，确保快速、健壮和准确可重复的连续交付的关键是自动化、部署一致性、全面测试和数据库版本控制。有了这些故障保险，按下“发布到生产”按钮就可以更频繁、更有信心了。

## 关于作者/亚尼夫·耶胡达

[![yaniv-e1404303491389](../Images/d471a803278bd88bfa0abd5f3a2315c1.png)亚尼夫·耶胡达](https://www.linkedin.com/in/yaniv-yehuda-892135)是 DBmaestro 的联合创始人兼首席技术官，db maestro 是一家专注于数据库开发和部署技术的企业软件开发公司。Yaniv 是一名 DevOps 专家，他在过去几年中提高了人们对数据库开发和部署所面临的[挑战以及如何支持数据库连续交付的认识。在](http://www3.dbmaestro.com/the-challenges-and-pitfalls-of-database-deployment-automation) [LinkedIn](https://www.linkedin.com/in/yaniv-yehuda-892135) 和 [Twitter](https://twitter.com/yanivyehuda) 上和他联系。