# 在生产中管理微服务时的六个路由挑战以及如何避免它们

> 原文:[https://devo PS . com/six-routing-challenges-when-managing-micro services-in-production-and-how-to-avoid-them/](https://devops.com/six-routing-challenges-when-managing-microservices-in-production-and-how-to-avoid-them/)

即使是经验丰富的 DevOps 团队也可能难以处理生产中管理微服务的细微差别——在这种情况下，对网络通信的更多关注可能会带来传统架构常见问题之外的新运营挑战。但是，通过明智地使用基于软件的路由组件，可以避免或减少以下方面的障碍影响。

## **实施跟踪和监控**

即使是在开发过程中经过严格测试的应用程序，在生产中也会出现异常。为了解决这些问题，DevOps 团队需要有效的跟踪和监控工具来了解集群中运行时发生的情况。

作为一种策略，开发人员应该选择能够与他们现有的监控和跟踪后端很好地集成的路由解决方案。请记住，虽然微服务可能由某个内部团队开发，但一旦部署，它就可供其他团队使用。如果应用程序被设计为可跟踪的，兼容的跟踪工具可以动态地识别服务调用的来源及其调用流，从而使其他团队能够利用微服务。当应用程序还被设计为提供指标时，监控工具可以有效地跟踪微服务的关键资源消耗指标，以评估其子组件在负载下的可伸缩性，并识别任何需要注意的性能限制。

由于所有服务间通信都要通过软件路由元素，因此您可以战略性地设计您的应用程序，以支持收集微服务跟踪和监控数据。然后，团队可以将这些数据应用到工作中，以便在构建新功能时更轻松地克服挑战。

## **减轻通信故障**

考虑到在基于微服务的生产环境中发生的无数通信，这种架构很容易出现通信故障，微服务根本无法到达。无论这些故障是由于容器、主机、网络分区的错误还是服务本身可用性的短期中断而发生的，都必须有弹性保护措施来减轻对应用程序用户群的任何影响。

例如:当一个实例失败时，负载均衡器可以用来自动将请求重新路由到健康的实例，然后在检测到它再次可用时将流量返回到失败的实例。在整个微服务变得不可用的情况下，客户端服务应该利用电路中断来停止请求、返回错误并启动回退响应。这样做可以避免危险的重复重试请求，重复重试请求只会耗尽资源，并可能导致级联故障。

这些缓解策略中的每一个都可以通过为每个客户端放置必要的逻辑来实现。然而，这种技术实现起来既麻烦又容易出错。应对这些挑战的更好方法是利用路由解决方案来执行实例健康检查和电路断开，允许 DevOps 团队控制他们的应用程序如何响应故障，而不是依赖网络层的逻辑。

## **处理意外的负载峰值**

在生产环境中，负载可能会由于各种原因意外激增，从简单的突然受用户欢迎到恶意的分布式拒绝服务(DDoS)攻击。无论根本原因是什么，应用程序都必须做好充分准备来承受这些事件而不会失败。

为了让应用处理负载峰值，速率限制是一种简单(但功能强大)的技术，它允许运营商指定前端服务的请求速率。通过路由解决方案实现这种保护解决了避免因负载强度突然变化而停机的难题。

## **保护微服务通信和许可**

在运营生产部署时，安全性始终是一个需要关注的问题。然而，微服务环境通常绝对没有内部网络通信权限。他们还面临着实施适当的加密来保护内部和外部流量中的敏感数据的挑战。

虽然允许任何服务访问任何其他服务具有灵活性，但风险是巨大的。为了保护访问和暴露敏感数据的微服务，明智的做法是只访问那些具有经过审查的业务合理性的客户端服务。路由技术使得使用网络分段来实施这些安全策略成为可能。

与此同时，路由解决方案可以帮助企业对关键数据的空中传输进行加密，这不仅是一种最佳实践，而且从法规遵从性的角度来看，在许多行业都是必要的。服务网格可以为所有内部东西向流量提供安全的 TLS 加密，而边缘路由器可以使用提供的证书加密外部南北向流量。对于南北流量，同样值得注意的是:将路由技术与 [让我们加密](https://letsencrypt.org/) 等服务相结合，可以实现可信证书生命周期管理的完全自动化，完全消除人工干预的需要。

## **实现高可用性**

利用软件路由技术实现高可用性比传统的硬件故障转移解决方案更加经济高效。它提供了构建具有相当弹性的生产微服务环境的机会。例如:路由实施应利用高度可用的架构，包括水平可扩展的数据平面和独立的容错控制平面。虽然数据平面允许根据需要添加实例来满足容量和弹性需求，但控制平面已做好承受故障的准备，并确保用户体验无缝和不间断的正常运行时间。

## **跨多云和异构环境部署**

大型企业通常利用跨多个云和/或本地环境的部署，其中每个环境可能依赖于不同的容器编排技术。能够支持一系列编排工具的高度可移植的路由技术可以极大地减少开发人员在支持多种环境时面临的挑战。这使他们能够跨部署部署相同的熟悉解决方案和通用路由层模型。

路由技术是决定 DevOps 团队能够克服成功部署生产微服务的挑战的能力和难易程度的关键变量。通过仔细考虑选择路由解决方案，团队可以更好地应对这些挑战，甚至完全避免这些挑战。

曼努埃尔·扎普夫