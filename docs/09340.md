# 如何使用 DevSecOps 保护 CI/CD 管道

> 原文:[https://devo PS . com/how-to-secure-ci-CD-pipelines-with-devsecops/](https://devops.com/how-to-secure-ci-cd-pipelines-with-devsecops/)

许多公司在其工作流中采用 DevOps 方法，因为它正在走向一个更加自动化和云原生的世界，但对于一些行业来说，这种迁移并不容易。金融、医疗保健和政府部门中的许多公司都有义务满足法规遵从性要求。对于这些组织，DevSecOps 为 DevOps 方法增加了必要的安全关注。

合规性意味着遵守某些标准和控制措施，以确保应用程序的安全性。但合规性只能到此为止。有多少应用程序内部包含第三方依赖？例如，对于一家金融行业的公司来说，未能达到合规标准的代价有多高？

最初，在符合适用于您的组织的任何框架或标准的要求的同时，对应用程序进行容器化看起来几乎是不可能的。然而，在云原生环境中，技术也在快速发展，以实现健康的迁移，并确保应用程序能够满足合规性标准，而无需从头重写。

首先，让我们看看组织在法规遵从性方面必须遵守的标准。

### 【Kubernetes 和 Docker 的 CIS 基准

互联网安全中心(CIS)基准测试为在应用程序中正确使用[容器](https://devops.com/devops-and-containers/)提供了指导。CIS 基准专门讨论 Docker 和 Kubernetes。

### NIST SP 800-190

美国政府的国家标准与技术研究所(NIST)在其应用程序容器安全指南中将容器定义为一种虚拟化操作系统。

### PCI

支付卡行业(PCI)标准是一个有助于保护电子商务和零售领域数据的框架。

### HIPAA

健康保险便携性和责任法案(HIPAA)设定了医疗保健中患者数据保护的合规标准。

![](../Images/0b1230e895fc2e1f95c401f06baffadc.png)

## 通过 CI/CD 管道保护基础设施

所有这些标准都指导组织保持其基础设施的安全性，并符合其特定的行业最佳实践，但安全性并没有就此结束(甚至没有开始)。

安全系统从设计阶段和代码本身开始；您的目标应该是在开发生命周期中尽早内置安全控制和实施。将安全检查移到开发管道的早期(因此，更靠近源代码)的做法被称为左移。

您可能已经为您的应用准备好了 CI/CD 管道，这是一个将您的安全检查转移到左边的好地方。CNCF 投资组合中有一些很好的工具可以帮助你实现这一目标。

## 输入容器

在云原生世界，容器是一等公民。从 DevSecOps 的角度来看，容器代表了一个需要考虑的新的攻击面，从如何定义容器映像和容器内的最终内容(Dockerfile)开始，到容器如何随着时间的推移而发展，以应对可能发现的新漏洞。

我们能做的第一件事是把我们写的政策转换成我们能自动化的东西(比如代码)；例如，使用 OPA/conftest 这样的工具和 hadolint 这样的 Dockerfile linter，我们可以验证 Dockerfile 是否符合我们的安全策略。

例如，我们可以制定一个策略来限制用于构建新容器的基本映像(例如，限制 docker 文件中的 FROM 指令)。

第二件要考虑的事情是，根据容器映像的构建方式，它不仅可以包含我们的应用程序，还可以包含其他软件，比如依赖项和操作系统二进制文件。

这个额外的软件将来可能会发现新的漏洞，因此我们应该监控我们已经构建并推送到我们的注册表中的映像，通过定期扫描它们来发现它们是否对构建容器映像时未知的任何漏洞开放。

和以前一样，我们可以签署我们的应用程序构件。现在，我们可交付的工件是一个容器图像，所以最好能够对容器图像进行签名。通过这种方式，我们可以相信我们运行的容器映像来自我们，并且经过了我们的安全流程。像公证人、Grafeas 和 sigstore/cosign 这样的项目可以帮助容器签名过程。

## 在 Kubernetes 中运行容器

如果我们正在运行容器，下一个合乎逻辑的步骤是考虑如何运行它们。Kubernetes 越来越多地将它作为跨多台机器编排容器的解决方案。将 Kubernetes 引入等式需要考虑我们的 DevSecOps 工作流中的另一个攻击面。

### 货单

除了我们应用程序的源代码，我们还有 Kubernetes 清单，它定义了如何将我们的应用程序部署到 Kubernetes 集群中。

我们可以采用与容器定义相同的方法:定义一些在流程早期强制执行的策略代码，以便我们的清单与我们的安全策略保持一致(例如，不运行未标记的图像，仅运行来自我们的可信来源的图像，入口必须具有 TLS，不使用节点端口服务),并在出现语法问题时使 YAML 文件尽早失败。

当清单通过 Kubernetes 准入控制器应用到集群时，我们还可以在运行时执行大多数相同的策略和一些附加的策略。

有一些工具可以帮助我们实现这些功能，如 OPA/conftest、kubeval 或 kubelinter，用于林挺和验证，对于准入控制，除了 API 服务器准入插件之外，我们还可以使用 OPA/Gatekeeper 或 Kyverno。

## 秘密

秘密需要特别注意，因为它们包含敏感信息。

如果您使用 GitOps 方法，应用程序的秘密通常存储在存储库中。以下是一些讨论 GitOps 和 [Kubernetes secrets](https://blog.sighup.io/kubernetes-secrets/) 中[被封印的秘密的资源。](https://blog.sighup.io/sealed-secrets-in-gitops/)

### RBAC

不要使用默认服务帐户:定义与其权限相关联的显式服务帐户，这样您就可以确切地知道谁可以做什么。

避免在角色和集群角色中使用通配符；使用 RBAC，您还可以为用户和服务帐户定义细粒度的权限。

### 了解你的依赖关系

我们需要考虑的另一个攻击面是应用程序的依赖性。重要的是首先要知道它们是什么，以及它们是否有任何已知的漏洞。为了帮助我们，我们可以为应用程序创建一个软件材料清单，并对其进行分析。

最后，就像我们定期检查存储在注册表中的图像一样，我们可以持续分析 Kubernetes 集群中正在运行的内容。这将确保没有可疑活动，如异常网络请求、运行关键 CVE 的映像等。

### 结论

到目前为止，您应该对如何保护您的管道有了更好的了解。但是，请记住，这主要是关于过程和文化变化。

首先，你需要知道你的攻击面——这不仅是一个技术选择，也是关于你 和 认为什么是重要的。

这些概念从一开始就很难应用，因此更好的方法是引入变化，习惯这些变化，并思考如何逐步改进现有流程。

* * *

*加入我们，参加 5 月 16 日至 20 日在西班牙巴伦西亚举办的*[*kube con+CloudNativeCon Europe 2022*](https://events.linuxfoundation.org/kubecon-cloudnativecon-europe/)*——三年来首次亲临欧洲的盛会！*