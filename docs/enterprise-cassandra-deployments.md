# 企业 Cassandra 部署

> 原文：<https://devops.com/enterprise-cassandra-deployments/>

在云中成功部署 Cassandra 需要一定的技能和知识。在这篇博客中，我将分享在云中成功部署 Cassandra 的最佳实践，例如亚马逊网络服务( [AWS](https://aws.amazon.com/) )和谷歌云平台( [GCP](https://cloud.google.com/launcher/solution/bitnami-launchpad/cassandra?q=cassa) )。我还将讨论当部署在公共云中时，如何保护和恢复 Cassandra 集群中的数据。

## **公共云中的 Cassandra 部署**

在 AWS 中成功部署企业 Cassandra 有两种主要方式:

*   使用“托管”Cassandra 部署。这是一个合理的方法；唯一的缺点是无法定制超出供应商通常提供的数据放置。

*   如果您希望完全控制 Cassandra 部署，并根据您的业务需求对其进行定制以进行扩展和执行，请自行管理集群。

请参考来自 [Datastax](https://goo.gl/WiA1Lv) 或 [Apache Cassandra](https://goo.gl/61Ny5R) 的文档，了解 Cassandra 部署的详细最佳实践。为了简化 AWS 中可伸缩 Cassandra 集群的部署，这里重申了以下最佳实践。

## 储存；储备

AWS 和 GCP 都为其计算实例提供了两种类型的本地存储选项。对于 AWS，选项有弹性块存储(EBS)和临时存储。在 GCP，选项是持久磁盘和本地 SSD。这两种选择各有利弊。选择最适合您的部署的一个。

### 持久存储

EBS 卷具有类似于网络存储(如 NAS 或 SAN)的性能特征。因为来自 EBS 卷的存储本质上是多租户的，所以它不适合分布式的日志结构数据库，如 Cassandra。如果您希望通过 EBS 卷确保可靠的性能，请将“EBS 优化实例”与“调配的 IOPS”结合使用由于 EBS 卷的 IO 流量通过实例网络传输，EBS 优化将提供可靠的性能，但不保证任何性能提升。要充分利用 EBS 卷的性能，请使用包含多个磁盘的实例，并将用于“数据”和“提交日志”的卷分开

*如果您必须使用 EBS 卷，请使用“EBS 优化实例”和“调配 IOPS”，并将数据和提交日志拆分到不同的卷上。*

### 短暂储存

对于下游 Cassandra 环境(如测试/开发和试运行),临时存储是一个很好的选择。由于临时卷通常是 SSD，因此不需要将数据和提交日志分离到单独的驱动器中。为了优化性能，请选择带有多个临时存储驱动器的 EC2 实例，并将它们一起条带化到一个逻辑卷中。向逻辑卷发送数据和提交日志。请记住，当您停止 EC2 实例时，临时存储中的数据将被删除。

*将所有临时驱动器条带化到单个卷中，以获得最高性能。*

## 数据分布

Cassandra 使用 Snitch 来确定集群的拓扑结构。Snitch 还用于确定集群中每个节点的数据中心和机架。复制策略用于确定群集中不同节点之间的数据放置。

### **AWS**

1.  EC2Snitch 适用于单区域部署。

1.  Ec2MultiRegionSnitch 适用于分布在多个 AWS 区域的集群。请注意，多 dc、主动-主动配置使您的群集能够应对区域故障，对于多 DC 群集，请使用“本地仲裁”来提高性能。

### **谷歌云平台(GCP)**

1.  使用 GoogleCloudSnitch 在 GCP 部署 Cassandra。

1.  GoogleCloudSnitch 将区域视为 Cassandra 数据中心，将可用性区域视为机架。

## 其他功能

AWS 和 GCP 都提供了一系列的操作能力，使得在 Apache Cassandra 集群上保持高正常运行时间变得更加容易。必须根据您的部署需求仔细选择这些功能。

1.  **负载均衡:**网络级负载均衡服务由 AWS(弹性负载均衡器)和 GCP 共同提供。不建议在 Cassandra 前面放置负载均衡器。最好使用能够处理这种情况的客户端连接器，考虑开源工具，如 [Presto](https://goo.gl/4XmB7B) 和 [Astyanax](https://goo.gl/BeXWoP)

1.  自动缩放:AWS 和 GCP 都为计算实例提供了自动缩放功能。然而，尽管这个功能看起来非常诱人，但是将所有 C*节点放在一个自动缩放组中不会产生预期的结果。相反，为集群中的每个节点创建一个单独的“1 节点”自动扩展组。这将确保无论何时节点关闭，它都会自动恢复运行。这将确保当节点停止运行时群集数据放置不会受到干扰，并且恢复运行的节点不会导致过多的数据移动。

## **可扩展的备份和可靠的时间点恢复**

备份数据是企业组织的必备工具。数据丢失的影响如此之大，以至于没有企业愿意冒险单独依赖复制。保护公共云环境中的数据似乎令人望而生畏，但与内部部署相比，有几个选项可以使这一点变得更容易。一个简单的选项可能看起来像一个本机快照:

### 存储快照

我见过很少有客户使用 EBS 卷的快照来保护他们集群中的数据免受逻辑和/或操作错误的影响。这个解决方案可以工作，但是有一些严重的限制。除了维护用于拍摄快照的脚本的开销之外，还有很大的存储成本开销。拍摄卷快照不允许对数据进行增量备份。这导致存储在快照中的数据量呈指数级增长，从而导致备份解决方案的高成本。

### **亚马逊 S3 或谷歌云存储**

使用 S3 存储桶作为辅助存储使企业能够使用低成本、高吞吐量的存储，同时降低存储备份数据的总体运营成本。以下是使用 S3 时的一些建议:

1.  **S3 地区:**亚马逊 S3 存储桶因地区而异。在一个地区创建的铲斗将为同一地区的其他基础设施提供更好的性能特征。随后，务必确保用作辅助存储的 S3 存储区与受保护的生产数据库和 Datos IO 群集位于同一区域。

1.  **[存储类别](https://goo.gl/j49G21)和生命周期策略:**亚马逊 S3 允许用户在存储桶上创建生命周期策略。这些策略规定了桶中对象的性能和响应时间特征。标准 1A 更适用于寿命较长且访问频率较低的数据，不适合作为辅助存储。此外，不要在用于辅助存储的存储桶上打开任何生命周期策略。所有存储桶都应属于标准存储类别。

## **结论**

随着企业利用公共云环境提供的灵活性，了解 Cassandra 部署的各个方面以确保高效利用您的资金和时间非常重要。