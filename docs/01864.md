# DevOps 聊天:服务网格跟踪，从 Envoy、Omnition 到 Splunk

> 原文:[https://devo PS . com/devo PS-chat-service-mesh-tracing-from-envoy-omnition-to-splunk/](https://devops.com/devops-chat-service-mesh-tracing-from-envoy-omnition-to-splunk/)

随着应用程序功能变得越来越小、容器化、成为微服务并组合成服务网，一系列新的挑战突然出现。每个服务执行什么功能？哪个州的服务业陷入困境？在复杂的服务网格中，服务之间的依赖关系是什么？我们如何测量服务交互之间的可观察性和跟踪？

Omnition 的软件工程师 Constance Caramanolis 参加了我们的 DevOps 聊天，这是在 Splunk 宣布收购之前录制的。在微软工作后，Constance 加入了 Lyft，部分原因是与 Envoy 合作，Envoy 是 Lyft 创建的一个开源项目，通过服务网格实现上游和下游跟踪。康斯坦斯最近加入了 Omnition，虽然还在秘密行动，以帮助“翻转跟踪它的头。”

这真是一场精彩的对话，让我们了解了管理大规模服务网络的挑战和解决方案。听众也应该看看我们的 [DevOps 聊天集](https://devops.com/devops-chat-splunk-moves-into-microservices-with-omnition-buy/)与里克·菲茨、SVP 和 Splunk IT 市场部总经理谈论 Splunk 收购 Omnition。

## 

[https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/661347137&color=%23ff5500&auto_play=false&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true](https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/661347137&color=%23ff5500&auto_play=false&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true)

## 副本

米奇 A **什莉** **:** 大家好。我是 DevOps.com 的米奇·阿什利，您正在收听的是另一个 DevOps 聊天播客。今天我邀请到了 Omnition 的软件工程师 Constance Caramanolis。康斯坦斯，欢迎来到 DevOps 聊天。很高兴你能上播客。

康斯坦斯·卡拉马诺丽丝:非常感谢你邀请我。我非常兴奋。

哦，我也很兴奋。我喜欢有，原谅这个术语，但是像你这样的摇滚明星，开发者在我们的播客上做一些很酷的工作。主题是大规模的服务网格，但在我们开始之前，你能先介绍一下你自己吗，也许告诉我们一点你作为软件工程师的背景，你目前在 Omnition 做什么，以及你是否能告诉我们一点关于 Omnition 的事情？

**卡拉马诺利斯:**是啊。所以我入行好几年了。我最初是从我的微软开始的。因此，在构建需要可靠运行的大型组件方面，我获得了很多良好的经验。所以我在那里做 Windows 和 Windows Film，然后我在三年半前搬到 Lyft，在那里我特意加入了与 Matt Kline 和 Jose Nino 以及 Lyft 其他人一起工作的 Envoy。在 Lyft，我负责 Envoy 的各个方面，从配置管理到为开源社区添加集成功能，或者只是在 Lyft 中推广它。

我在 Lyft 的最后几个月，我在我们的数据平台团队中工作，只是构建一个工作流工具的变体。所以现在我实际上刚刚加入 Omnition 不久。我将重点介绍开放式遥测组件。我们正在通过如此多的有价值的数据使用开放式遥测技术，以至于跟踪提供了这样一种功能，它实际上不仅仅是查看单个跟踪，而是能够全面了解应用程序做了什么，产生了什么影响，以及它如何使用跟踪数据进行传播。

**A** **shley** **:** 很容易理解你为什么从 Lyft 的《特使》工作转型到现在的 Omnition。好吧，我们先来谈谈服务网格、微服务，当然还有容器等等。这当然是我们目前开发应用程序的方式。服务网格带来了一些其他东西，我认为会更复杂，因为你在谈论一个可配置的低延迟基础架构层，它实际上是为了处理基于网络的高容量通信而设计的。这就告诉你，这涉及到复杂性，任何时候你构建软件、创建应用，你如何在服务网状架构中运行，都会带来一些挑战。根据你的经验，你遇到过哪些挑战？

**Caramanolis:** 我认为最大的问题，尤其是它如何与 Envoy 提供可观察性的主要目标联系起来，就是当你将组件拆开，将互联网的不同部分放在一起时，做哪些仍然有效，哪些不起作用，并对此有一个一致的定义是非常具有挑战性的。当我们谈论特使时，我们喜欢用一个很好的例子，特别是在人们适应特使之前，失败是没有标准定义的。有人可能会说，a 503 不是错误。请不要这样做。

**A** **什莉** **:** 我会在本期播客中避免提及。

**Caramanolis:** 谢谢。但是如果你没有——在不同的语言和工具中没有标准的错误定义，那么不同团队的人或者更高层的副总裁或主管就很难知道事情是否正常。跨任何服务网格的可观察性都是相当复杂的。另一件事绝对是拓扑方面的协调，特别是当我们谈论来自巨石的时候。monolith 的好处之一是你知道所有代码在哪里，你可以找出在哪里，因为它通常在一个 repo 中，你可以直接阅读它。

但另一方面——这肯定很棒，因为您需要看到所有东西都在哪里，但当它变得非常大时，可能需要很长时间来构建和部署它。有些代码可能每十分钟运行一次。那么，为什么它需要和高优先级的东西一起运行呢？它需要非常高效。当你把事物分开时，就很难把事物之间的相互作用联系起来。由于每个人通常都试图使文档保持最新，有时您会忘记“哦，我实际上是在调用一个刚刚转移到服务 B 和 __ 服务 a 的 API。”所以保持服务拓扑的心理模型是非常具有挑战性的，并且是如此动态。

**A** **shley** **:** 尤其是微服务架构。我们也在创造更多这样的人。

哦，我的天。是啊。特别是，可以说一个人一天的开始，就像，“嘿，创建一个新的服务并部署它，让它调用一个非常低优先级的 API 调用。”那就是——你直接依赖于你雇佣了多少人，举例来说，服务的数量会迅速增加。我认为这可能是微服务的第三个挑战。一个是在实际操作中。从运营的角度来看，当出现问题时，你如何补救？因为不幸的是，事情会出错，通常任何应用程序的目标都是尽可能长时间运行并为客户服务，无论您对客户的定义是什么。

当事情确实出错时，你如何构建工具来处理事情？你是否可以将其标准化，这样你就不必培训一家公司的工程师使用十种不同的工具来说，“处理某个错误案例或三个不同的错误案例，并在这方面标准化”？

****什莉** **:** 很有意思。我很想知道为什么你会选择使用像 Envoy 这样的工具。请告诉我们一点你最终是如何使用 Envoy 的。**

****Caramanolis:** 我加入 Lyft 是为了研究 Envoy，因为实际上在我加入 Lyft 的近一年前，我遇到了 Matt，但他谈到了如何——当我们谈到它时，Lyft 只是需要扩展，因为我们遇到的一个大问题是我们在 ELB 上没有获得真正好的可观测性。因此，有时我们可以看到一些事情——我们知道有人说我——例如，我试图 ____ 骑行，但是当我们查看我们的指标时，我们看不到任何失败。**

**因此，这显然导致了一个计划，你看到我们的可观察性，只是我们的常规请求路径需要改进。马特和我——这只是一个例子。我想在 Matt 之前的一次演讲中，他肯定更多地谈到了 Lyft 建造 Envoy 的动机。毫无疑问——也仅仅是一个领域——我一直喜欢基础设施和后端。因此，能够建立整个公司都依赖的东西，Lyft 能够扩展是我们成功的拦路虎。**

**所以 Envoy 允许我们扩展，因为我们可以立即添加 10 或 100 个服务，而不必担心服务发现。所以，仅仅是成为如此重要的事情的一部分，有机会学到这么多东西，我肯定会说，我被这个项目吓倒了。所以我喜欢参加一个项目的想法，在这个项目中，我会——在精神上被踢屁股，因为我不知道这是什么。这是在深水区和鲨鱼一起游泳，我迫不及待地想看看我是否能学会游泳，看看这有多棒——这如何塑造了我作为一名开发人员。**

**你是一个勇敢的人。不是每个人都愿意让自己这样冒那么大的风险。所以恭喜你。太好了。**

****Caramanolis:** 谢谢。**

****一个** **什莉** **:** 妙极了。我们更多的人应该这样做。嗯，您最近做了一次演讲，我记得是在 18 年 12 月，KubeCon 与服务网格特使讨论了减少检测的问题。说一点这个吧。**

****卡拉马诺利斯:**是啊。所以很多演讲——所以我想说我们，作为一个团体。有一个很棒的社区，由贡献者和维护者组成，也有一些人围绕着 Envoy 写博客，这个社区的大部分人都谈到了 Envoy 的特性，以及它如何从更多的技术角度帮助他们，如何帮助他们扩展和变得可靠，以及如何调试问题。这绝对是我们内部经历的一件事，我们如何将它转化为其他开发人员，我说的其他开发人员，比如应用程序开发人员。而不是开发人员或基础架构工程师。其余的应用程序开发人员如何使用 Envoy 来实现他们的日常利益？**

**因此，我试图做一个演讲，展示我如何在 Lyft 使用 Envoy 来识别问题来自哪里，并将其建立起来，以便其他人更容易理解。我还试图强调，我知道随着我在《特使》上所做的大量工作，我已经建立了自己的盲点，这些盲点是我已经忘记的或至关重要的。所以我举了一个例子，在我加入 Lyft 之前，我对惠普状态代码的定义非常模糊。我敢肯定，有很多应用程序开发人员不具备这一点——他们不知道这意味着什么。**

**因此，我必须介绍这些是什么意思，以及它们与 Envoy 的关系，这样每个人都可以使用相同的工具，以便在出现问题时更好地进行调试。所以是的。我试着让它成为一个易于理解的演示。**

****一个**T2 什莉 **:** 有意思。是啊。我听说这个报告很受欢迎。我敢肯定，有很多人在问了一些好问题或想了解更多信息后会找上你。这是一种很好的分享方式。当你和其他人对社区作出贡献时，不仅仅是代码或其他东西，还有谈话，人们会看到 Envoy 和技术的实际应用。自从发表了关于减少检测时间或实现服务网格特使的演讲后，你在学习方面有什么收获吗？**

****Caramanolis:** 我认为一些更大的收获是——或者更能引起我共鸣的收获是，这种类型的会谈需要更多地发生，尤其是在特使内部，比如说介绍、调试会谈，甚至是互动。比方说，如果我们能够在有 Envoy 的地方建立一个测试环境，比如一个微型微服务环境。然后你可以做测试请求，看看它们是如何失败的。在给人们一个实际操作的安全方法来学习特使如何工作之后，那将是非常棒的，因为你可以在幻灯片上看到一切。你可以听它，它能引起共鸣，但是如果没有人来回应你的想法，把它应用到今天就有点困难了。**

**作为一个项目，特使本身已经非常非常成功，有很多令人惊讶的贡献和意见。我非常幸运地与来自谷歌和所有这些不同公司的许多非常聪明的人一起工作。我之所以提到谷歌，是因为他们是我最密切合作的人。我应该说，所有这些非常非常聪明的人，我都间接或直接地向他们学习。但是在会议上，人们会走过来对我们说，“哦，我试着和特使一起做这个，”你会说，“哦，我从来没有想到过。”**

**在特使会议上，大约有 30 分钟的时间，人们会说，“哦，我们正在尝试做这个案子。因此，我们建立了自己的过滤器，我们这样做了。”你会说，“哇，这真的很酷。”仅仅看到其他人如何以不同的方式思考一个问题真的可以突出我们自己知识的差距，或者像“哦，也许我们应该试试他们的方法。”所以我认为这可能是会议最有价值的地方。也许我可以与人分享，但是听听其他人对这个话题的看法真的教会了我很多解决问题的不同方法。**

****A** **shley** **:** 果然是。一次谈话几乎就像是开始了一场双向对话。这就是那种——抓住它，为人们提供大量有用的信息，然后和你交谈。这太棒了。**

**哦，是的。事实上，这是一个很好的表达方式。是啊。**

****A** **shley** **:** 那么，对于那些可能没有使用特使经验的人，如果他们刚刚接触特使，你有什么建议？你会建议他们如何开始，也许你可以与他们分享一些早期的经验教训，告诉他们如何更有效地使用它？**

**通常当这类问题出现时，我会问人们他们想解决什么问题。至少在 KubeCon 有一个常见的问题，因为这是 KubeCon 的背景，就是“我应该迁移到 Kubernetes 还是 Envoy？”我总是这样回答:“你最迫切的问题是什么？您是否在网络可观察性或错误案例标准化方面有问题，或者您当前的部署渠道没有按预期工作？”**

**假设他们想更多地关注特使部分，那么我想——这就像是了解他们的拓扑结构。特使如此配置。任何一个肯定和 Envoy 一起工作过并且听过这个的人可能都会对此傻笑。特使配置肯定是势不可挡的，尤其是对那些入门者来说。所以开始很简单。要么是马特，我想马特和我自己，我们中的一个人谈到了我们如何在 Lyft 推出特使。因此，我们开始时要么在边缘进行，要么在没有服务网格或出口的情况下在入口进行，然后慢慢地建立起来，就像在交互的一个部分建立起来，而不是一次完成，因为一下子有太多组件可能会出错。**

**一个错误配置的值，它可能是技术上正确的值，但假设您放错了端口，但您在任何地方都能听到它，那么找出错误的地方就非常困难。因此，我的建议肯定是从小处着手，设定一个真正清晰的范围，无论是一个服务或一组服务的入口还是出口，或者只是在您的边缘，然后在您的开发人员社区中建立信任。因此，一旦你有了这一点，一定要开始教育使用它的其他开发人员说，“这就是错误的样子，这就是它的含义”，并帮助他们看到价值，因为一旦所有开发人员都看到了价值，至少对我来说，简化他们的生活，因为他们不再需要花费时间像“我知道这一个错误是失败的，但要么是哪个服务导致的，要么我知道这是网络问题还是糟糕的应用程序代码？”**

**有了 Lyft，Envoy 能够很好地将其隔离到服务 B，这是一个糟糕的一天，我们可以看到它是否在其他任何地方产生了任何其他影响，但至少我们知道在哪里关注服务 B。如果有任何问题，Slack 社区，Envoy 的标志通道非常响应，如果你遇到问题，就像总是在那里提问或发布问题，让 hub 和人们尽快做出真正一致的努力来回复。我想说社区——**

**A **什莉** **:** 太棒了。**

**我真的很尊重他们，也很爱他们，我很怀念每天和他们一起工作的日子。**

****A** **shley** **:** 你能不能把你在 Omnition 做的事情翻译或转换成一点点？你现在做什么工作？**

****卡拉马诺利斯:**是啊。实际上，我要回顾一下我的 KubeCon 演讲。我在 KubeCon 演讲中谈到了我是如何面对这个问题的。我知道这很有意思——我得到了，比如说，如果我要用一个例子，我想我用的例子和演讲是我不能看照片。我知道它触及边缘，从服务 A 到服务 B 再到服务 c。我之所以能够使用 Envoy 做到这一点，是因为 Envoy 对您的上游和下游颜色有非常清晰的度量。为了避免在这里定义，因为有些人有不同的定义，Envoy 会告诉你你依赖什么服务。**

**因此，如果不知道您的服务依赖于何处，有时就很难跟踪哪段代码导致了问题。所以实际上人们这样做的一个方法是用痕迹。如果您跟踪–说我知道这个请求失败了。我可以寻找这条轨迹，然后看到它从服务 A 到服务 B 再到服务 C，这真的很有价值。因此，Omnition 试图做的实际上是从头开始跟踪，因为通常正常的范式是查看单个跟踪，然后尝试关联周围的其他数据。要么是请求的输入值。**

**要么是，“哦，我们知道总是服务 B 有——在 ____ 之后有一段不好的时间。”因此，它通常从一个非常精细的数据点开始，构建信息。我们获取所有跟踪数据，您可以看到，所有数据都从服务 A 转到了 B，有些转到了 C、d，然后，如果出现问题，就会出现一条红线，您可能会说，“哦，我知道服务 B 遇到了这个错误。让我深入调查一下。”**

**那看起来非常有用。**

****卡拉马诺利斯:**是啊。这就像——实际上——它几乎会使我在 KubeCon 的演讲过时，因为我正在尝试使用 Envoy 教授 ____，就像我遵循服务图一样，但我遵循 Envoy 产生的对称。**

****A** **shley** **:** 祝你一切顺利。像这样的工具实际上是能够像我们现在构建软件那样发展基础设施。恭喜你搬家，我为你感到兴奋，康斯坦斯。祝你一切顺利。感谢你参加播客。**

**米奇，非常感谢你。很荣幸能上播客。我玩得很开心。**

****A** **什莉** **:** 嗯，我也是，我也很荣幸有你在这里。您已经收听了另一个 DevOps 聊天播客。我要感谢我的客人，康丝坦斯·卡拉马诺利斯，Omnition 的软件工程师，当然也感谢我们的听众加入我们。我是米奇·阿什利和 DevOps.com。您已经收听了另一个 DevOps 聊天播客。在外面要小心。**

**— [米切尔·阿什利](https://devops.com/author/mitchellashley/)**