# 构建令人惊叹的应用程序，第 3 部分:优化网络

> 原文:[https://devo PS . com/building-amazing-apps-part-3-optimizing-the-network/](https://devops.com/building-amazing-apps-part-3-optimizing-the-network/)

这是关于在边缘构建和交付令人惊叹的应用的三篇文章系列的第三部分。看第一部 [*这里*](https://devops.com/building-amazing-apps-part-1-optimizing-the-front-end/) *，看第二部* [*这里*](https://devops.com/building-amazing-apps-part-2-optimizing-the-back-end) *。*

## **简介**

如今有数以百万计的应用程序可用，任何用户只需在屏幕上轻点几下或点击一下鼠标，就可以非常容易地下载并安装其中的任何一个。如果你想开发并交付一款让用户惊喜的应用，你需要能够与众不同。

在过去的 14 年里，我一直与提供最受欢迎的应用程序的顶级公司密切合作，帮助他们优化应用程序的速度和规模，以便用户获得出色的体验。在这个由三部分组成的系列中，我们将探索你必须采取的基本步骤，以构建和交付你自己的令人惊叹的大规模应用程序，让用户不断回来。

我们将这些步骤分为三个关键领域:

*   [前端](https://devops.com/building-amazing-apps-part-1-optimizing-the-front-end/):覆盖最终用户与之交互的应用程序部分。
*   [后端](https://devops.com/building-amazing-apps-part-2-optimizing-the-back-end/):查看支持应用程序所需的原始基础设施，包括数据库、应用程序、web 服务器等。
*   网络:连接前端和后端的胶水。

在本系列的最后一篇文章中，我们将探讨你可以在网络上做的四件事，来优化你的应用程序，让它变得更加神奇:

*   分布式 DNS
*   协议优化
*   延迟优化
*   边缘计算

## **分布式域名系统**

域名系统(DNS)是确保您的客户端可以访问您的应用程序的关键部分(事实上，这是当今黑客非常流行的攻击媒介，因为如果您的 DNS 关闭，没有人可以访问您的 [PPP](https://en.wikipedia.org/wiki/Point-to-Point_Protocol) )。将您的 DNS 分布在许多服务器上有助于确保您的 DNS(以及您的应用程序)快速且高度可用，因此您应该使用在许多地方拥有大型 DNS 服务器网络的 DNS 供应商。

验证您是否有一个适当分布的 DNS 基础设施是相当容易的。只需遵循以下步骤:

*   确定您的域使用多少域名服务器及其 IP 地址。理想情况下，你需要一个介于 3 和 12 之间的数字——越多越好。您可以使用 dig 和 nslookup 等命令行工具来识别给定域的名称服务器。
*   使用 IP 地理定位系统找出域名服务器的物理位置。此时，您可以大致了解这些服务器是否离您的最终用户足够近。提示:一些 cdn 提供诊断工具，可以通过 API 编写脚本来自动执行 IP 地理定位。
*   如果您想要更彻底，您可能需要在用户的主要位置和名称服务器 IP 地址之间运行连接测试，以确保网络延迟(即信息在客户端和服务器之间来回传输所需的时间)保持在 100 毫秒以下(越低越好)。一些互联网提供商和 cdn 提供窥镜技术，使您能够运行来自世界各地服务器的连接测试。

## **协议优化**

一旦你的客户知道在哪里连接，他们如何连接和使用的协议是不应该被忽视的。HTTP/2 是现代的高级网络协议，因为它使用更有效的二进制格式、报头压缩、单一网络连接、流多路复用和服务器推送。事实上，我在 HTTP/2 的早期参与了很多工作([该标准于 2015 年 2 月获得批准](https://www.mnot.net/blog/2015/02/18/http2))，并从那时起帮助互联网上一些最大的网站实现了 HTTP/2，并且仍然花费了大量时间在各种环境中测试新协议。我已经在包括 [Velocity](https://conferences.oreilly.com/velocity/vl-eu-2016/public/schedule/detail/52820) 在内的会议上分享了我的发现，并在我合著的“[Learning HTTP/2”O ' Reilly book](https://amzn.to/2TJbpUU)中分享了我的发现。简而言之，大多数网站可以通过将协议从 HTTP/1.1 切换到 HTTP/2 来提高 5%到 15%的页面加载性能，如果您的网站使用 HTTPS，这就像扳动开关一样简单。

为了说明这一改进，我创建了一个[演示站点](https://http2.akamai.com/),测试了许多小图片在 HTTP/1.1 和 HTTP/2 上的下载速度，并显示了差异。

![](../Images/d828ff1d05fd705a0ff6e44765917e87.png)

Figure A

如图 A 所示，在我的手机上，通过 LTE 连接，HTTP/2 的内容加载速度是 HTTP/1.1 的八倍。考虑到实现 HTTP/2 是多么简单，这是一个巨大的进步。

根据 [HTTP Archive](https://httparchive.org/) 的数据，截至 2018 年 6 月，20%的主机支持 HTTP/2，但这些主机负责所有请求的 40%——这意味着 HTTP/2 支持一些最受欢迎的网站。

然而，正如 O'Reilly 的《学习 HTTP/2》一书中的 HTTP/2 性能章节所解释的，有很多因素会影响 HTTP/2 的优势。其中一些是您可以控制的，而其他的——比如网络丢包——就很难处理，并且会影响 HTTP/2 的性能，因为 HTTP/2 是在一个 TCP 连接上运行的。

注意:TCP 代表传输控制协议，其实现的某些部分(例如，启动缓慢和繁琐的网络拥塞算法)会影响 HTTP/2 性能，因为与服务器的所有通信都要通过一个 TCP 连接。

web 的未来是 [HTTP/3](https://en.wikipedia.org/wiki/HTTP/3) ，它使用 HTTP/2 over QUIC(一种更新更高效的传输层协议)。然而，截至 2019 年 4 月，HTTP/3 仍处于草案状态，尚未被批准为标准。

理想情况下，您的服务器应该监控网络连接，并根据当前条件使用不同的网络协议。某些内容交付网络(cdn)提供这种功能。例如，为了最大化吞吐量，顶级 CDN 提供商在其边缘服务器上使用定制软件，根据服务器与最终用户建立的每个连接的具体条件，动态使用不同的网络协议、TCP 设置和拥塞控制算法。简而言之，使用最佳协议会使您的应用程序更快、更出色。

## **延迟优化**

延迟是影响计算机网络吞吐量的自然物理限制。你可能知道，每当你在户外并且有闪电的风暴时，你可以数秒直到你听到雷声来识别风暴有多近(如果你数不到一秒，你最好进入室内！).用计算机术语来说，延迟是指在两个系统之间来回发送网络数据包所需的时间。这个概念被称为往返时间(RTT)，通常以毫秒为单位。您可以使用 ping 或 mtr 等网络工具轻松测量两个系统之间的 RTT。

延迟对性能有很大的影响，因为离要连接的服务器越远，通信就越慢。根据经验，您希望确保延迟远低于 100 毫秒。实现这一目标的最简单方法是利用本地设备缓存来避免与服务器的额外网络连接，并使用 CDN 使您的服务器更靠近最终用户。

下面的图表(见图 B)显示了延迟对页面加载时间的影响比带宽更大。正如您所看到的，将带宽从 5Mbps 增加到 10Mbps 只会使页面加载时间提高 5%,任何超过 10Mbps 的带宽增加都不会产生很大的影响。然而，减少延迟会大大缩短页面加载时间。这使得你的应用程序对你的终端用户来说更加神奇。

![](../Images/87f1e82f9a5e4905d473ee239bbb021f.png)

Figure B

## **边缘计算**

如果你是一名开发人员或 DevOps 工程师(或者仅仅是热爱技术),就移动计算能力而言，你很有可能是世界上最顶尖的 1%人口之一。但是你认为理所当然的事情，比如在手机上调整图片大小，对于数百万拥有较弱移动设备的互联网用户来说，将会花费更长的时间。

那么，如果在起点运行逻辑由于网络延迟而导致延迟，并且在客户端运行逻辑在功能较弱的设备上可能太慢，我们该怎么办呢？解决方案是[边缘计算](https://en.wikipedia.org/wiki/Edge_computing)，它包括将原始逻辑移动到离最终用户足够近的服务器，延迟不会影响性能。cdn 是提供这种接近的最佳位置，因为它们天然的分布式架构；CDN 可以设置 cookies，重写 HTML，并根据用户的屏幕尺寸调整和交付优化的图像，因此这些图像不会花很长时间在 CPU 有限的低端移动设备上显示。

边缘计算是超越云计算的下一步。您应该尝试使用一家 CDN 公司，该公司为您提供在尽可能接近您的用户的位置运行业务逻辑的能力，以确保您的应用程序速度快，并且可以在不影响您的基础架构的情况下扩展。

## **总结**

在这一系列文章中，我们回顾了如果您想要大规模构建和交付令人惊叹的应用程序，您应该考虑的一些基本事项。这不是你能做的所有事情的全面列表，但为你提供了一些最有影响力的应用改进领域。

— [哈维尔·加尔萨](https://devops.com/author/javier-garza/)